<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-transactions-conflicts-revisions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Transactions, Conflicts and Revisions | RxDB - JavaScript Database</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" name="twitter:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" property="og:url" content="https://rxdb.info/transactions-conflicts-revisions.html"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Transactions, Conflicts and Revisions | RxDB - JavaScript Database"><meta data-rh="true" name="description" content="Learn RxDB&#x27;s approach to local and replication conflicts. Discover how incremental writes and custom handlers keep your app stable and efficient."><meta data-rh="true" property="og:description" content="Learn RxDB&#x27;s approach to local and replication conflicts. Discover how incremental writes and custom handlers keep your app stable and efficient."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rxdb.info/transactions-conflicts-revisions.html"><link data-rh="true" rel="alternate" href="https://rxdb.info/transactions-conflicts-revisions.html" hreflang="en"><link data-rh="true" rel="alternate" href="https://rxdb.info/transactions-conflicts-revisions.html" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-62D63SY3S0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-62D63SY3S0",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-PL63TR5",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>






<meta name="theme-color" content="#ed168f">
<link rel="icon" type="image/svg+xml" href="/files/logo/logo.svg">
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" sizes="180x180">
<link rel="preconnect" href="https://consentcdn.cookiebot.com/">
<link rel="preconnect" href="https://consent.cookiebot.com/">
<link rel="preconnect" href="https://region1.analytics.google.com/">
<link rel="preconnect" href="https://www.redditstatic.com/">
<link rel="preconnect" href="https://pixel-config.reddit.com/"><link rel="stylesheet" href="/assets/css/styles.b066e612.css">
<script src="/assets/js/runtime~main.f8cb08bf.js" defer="defer"></script>
<script src="/assets/js/main.c9c8ff04.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PL63TR5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/files/logo/logo_text_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/overview.html">Docs</a><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="sync" href="/replication.html">Sync</a></div><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="storages" href="/rx-storage.html">Storages</a></div><a class="navbar__item navbar__link" href="/premium/">Premium</a><a class="navbar__item navbar__link" href="/consulting/">Support</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="/chat/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-discord" target="_blank"> </a><a href="/code/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-github" target="_blank"> </a></div></div><div class="navbar-line" style="position:fixed;left:0;z-index:10;height:2px;width:100vw;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;transform-origin:left center;will-change:transform;backface-visibility:hidden;contain:layout;transform:scaleX(0)"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Y1UP"><div style="padding:10px;padding-top:30px;margin-left:auto;margin-right:auto"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" aria-label="Search" class="navbar__search-input search-bar" style="margin-left:auto;margin-right:auto;display:block"></div></div><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/overview.html"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview.html"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quickstart.html"><span title="ðŸš€ Quickstart" class="linkLabel_WmDU">ðŸš€ Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/install.html"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-mode.html"><span title="Development Mode" class="linkLabel_WmDU">Development Mode</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/typescript.html"><span title="TypeScript Setup" class="linkLabel_WmDU">TypeScript Setup</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-database.html"><span title="Core Entities" class="categoryLinkLabel_W154">Core Entities</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-storage.html"><span title="ðŸ’¾ Storages" class="categoryLinkLabel_W154">ðŸ’¾ Storages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/schema-validation.html"><span title="Storage Wrappers" class="categoryLinkLabel_W154">Storage Wrappers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/replication.html"><span title="ðŸ”„ Replication" class="categoryLinkLabel_W154">ðŸ”„ Replication</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-server.html"><span title="Server" class="categoryLinkLabel_W154">Server</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/transactions-conflicts-revisions.html"><span title="How RxDB works" class="categoryLinkLabel_W154">How RxDB works</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/transactions-conflicts-revisions.html"><span title="Transactions Conflicts Revisions" class="linkLabel_WmDU">Transactions Conflicts Revisions</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/query-cache.html"><span title="Query Cache" class="linkLabel_WmDU">Query Cache</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/plugins.html"><span title="Creating Plugins" class="linkLabel_WmDU">Creating Plugins</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/errors.html"><span title="Errors" class="linkLabel_WmDU">Errors</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/migration-schema.html"><span title="Advanced Features" class="categoryLinkLabel_W154">Advanced Features</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/react.html"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-storage-performance.html"><span title="Performance" class="categoryLinkLabel_W154">Performance</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/releases/17.0.0.html"><span title="Releases" class="categoryLinkLabel_W154">Releases</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/articles/browser-database.html"><span title="Articles" class="categoryLinkLabel_W154">Articles</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contribution.html"><span title="Contribute" class="linkLabel_WmDU">Contribute</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/consulting/"><span title="Contact" class="categoryLinkLabel_W154">Contact</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Transactions, Conflicts and Revisions</h1></header>
<p>In contrast to most SQL databases, RxDB does not have the concept of relational, ACID transactions. Instead, RxDB has to apply different techniques that better suit the offline-first, client side world where it is not possible to create a transaction between multiple maybe-offline client devices.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-rxdb-does-not-have-transactions">Why RxDB does not have transactions<a href="#why-rxdb-does-not-have-transactions" class="hash-link" aria-label="Direct link to Why RxDB does not have transactions" title="Direct link to Why RxDB does not have transactions" translate="no">â€‹</a></h2>
<p>When talking about transactions, we mean <a href="https://en.wikipedia.org/wiki/ACID" target="_blank" rel="noopener noreferrer" class="">ACID transactions</a> that guarantee the properties of atomicity, consistency, isolation and durability.
With an ACID transaction you can mutate data dependent on the current state of the database. It is ensured that no other database operations happen in between your transaction and after the transaction has finished, it is guaranteed that the new data is actually written to the disc.</p>
<p>To implement ACID transactions on a <strong>single server</strong>, the database has to keep track on who is running transactions and then schedule these transactions so that they can run in isolation.</p>
<p>As soon as you have to split your database on <strong>multiple servers</strong>, transaction handling becomes way more difficult. The servers have to communicate with each other to find a consensus about which transaction can run and which has to wait. Network connections might break, or one server might complete its part of the transaction and then be required to roll back its changes because of an error on another server.</p>
<p>But with RxDB you have <strong>multiple clients</strong> that can go randomly online or offline. The users can have different devices and the clock of these devices can go off by any time. To support ACID transactions here, RxDB would have to make the whole world stand still for all clients, while one client is doing a write operation. And even that can only work when all clients are online. Implementing that might be possible, but at the cost of an unpredictable amount of performance loss and not being able to support <a class="" href="/offline-first.html">offline-first</a>.</p>
<blockquote>
<p>A single write operation to a document is the only atomic thing you can do in RxDB.</p>
</blockquote>
<p>The benefits of not having to support transactions:</p>
<ul>
<li class="">Clients can read and write data without blocking each other.</li>
<li class="">Clients can write data while being <strong>offline</strong> and then replicate with a server when they are <strong>online</strong> again, called <a class="" href="/offline-first.html">offline-first</a>.</li>
<li class="">Creating a compatible backend for the replication is easy so that RxDB can replicate with any existing infrastructure.</li>
<li class="">Optimizations like <a class="" href="/rx-storage-sharding.html">Sharding</a> can be used.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="revisions">Revisions<a href="#revisions" class="hash-link" aria-label="Direct link to Revisions" title="Direct link to Revisions" translate="no">â€‹</a></h2>
<p>Working without transactions leads to having undefined state when doing multiple database operations at the same time. Most client side databases rely on a last-write-wins strategy on write operations. This might be a viable solution for some cases, but often this leads to strange problems that are hard to debug.</p>
<p>Instead, to ensure that the behavior of RxDB is <strong>always predictable</strong>, RxDB relies on <strong>revisions</strong> for version control. Revisions work similar to <a href="https://martinfowler.com/articles/patterns-of-distributed-systems/lamport-clock.html" target="_blank" rel="noopener noreferrer" class="">Lamport Clocks</a>.</p>
<p>Each document is stored together with its revision string, that looks like <code>1-9dcca3b8e1a</code> and consists of:</p>
<ul>
<li class="">The revision height, a number that starts with <code>1</code> and is increased with each write to that document.</li>
<li class="">The database instance token.</li>
</ul>
<p>An operation to the RxDB data layer does not only contain the new document data, but also the previous document data with its revision string. If the previous revision matches the revision that is currently stored in the database, the write operation can succeed. If the previous revision is <strong>different</strong> than the revision that is currently stored in the database, the operation will throw a <code>409 CONFLICT</code> error.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conflicts">Conflicts<a href="#conflicts" class="hash-link" aria-label="Direct link to Conflicts" title="Direct link to Conflicts" translate="no">â€‹</a></h2>
<p>There are two types of conflicts in RxDB, the <strong>local conflict</strong> and the <strong>replication conflict</strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="local-conflicts">Local conflicts<a href="#local-conflicts" class="hash-link" aria-label="Direct link to Local conflicts" title="Direct link to Local conflicts" translate="no">â€‹</a></h3>
<p>A local conflict can happen when a write operation assumes a different previous document state, than what is currently stored in the database. This can happen when multiple parts of your application do simultaneous writes to the same document. This can happen on a single browser tab, or when multiple tabs write at once or when a write appears while the document gets replicated from a remote server replication.</p>
<p>When a local conflict appears, RxDB will throw a <code>409 CONFLICT</code> error. The calling code must then handle the error properly, depending on the application logic.</p>
<p>Instead of handling local conflicts, in most cases it is easier to ensure that they cannot happen, by using <code>incremental</code> database operations like <a class="" href="/rx-document.html">incrementalModify()</a>, <a class="" href="/rx-document.html">incrementalPatch()</a> or <a class="" href="/rx-collection.html">incrementalUpsert()</a>. These write operations have a built-in way to handle conflicts by re-applying the mutation functions to the conflicting document state.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="replication-conflicts">Replication conflicts<a href="#replication-conflicts" class="hash-link" aria-label="Direct link to Replication conflicts" title="Direct link to Replication conflicts" translate="no">â€‹</a></h2>
<p>A replication conflict appears when multiple clients write to the same documents at once and these documents are then replicated to the backend server.</p>
<p>When you replicate with the <a class="" href="/replication-graphql.html">Graphql replication</a> and the <a class="" href="/replication.html">replication primitives</a>, RxDB assumes that conflicts are <strong>detected</strong> and <strong>resolved</strong> at the client side.</p>
<p>When a document is send to the backend and the backend detected a conflict (by comparing revisions or other properties), the backend will respond with the actual document state so that the client can compare this with the local document state and create a new, resolved document state that is then pushed to the server again. You can read more about the replication conflicts <a class="" href="/replication.html#conflict-handling">here</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-conflict-handler">Custom conflict handler<a href="#custom-conflict-handler" class="hash-link" aria-label="Direct link to Custom conflict handler" title="Direct link to Custom conflict handler" translate="no">â€‹</a></h2>
<p>A conflict handler is an object with two JavaScript functions:</p>
<ul>
<li class="">Detect if two document states are equal</li>
<li class="">Solve existing conflicts</li>
</ul>
<p>Because the conflict handler also is used for conflict detection, it will run many times on pull-, push- and write operations of RxDB. Most of the time it will detect that there is no conflict and then return.</p>
<p>Lets have a look at the <a href="https://github.com/pubkey/rxdb/blob/master/src/replication-protocol/default-conflict-handler.ts" target="_blank" rel="noopener noreferrer" class="">default conflict handler</a> of RxDB to learn how to create a custom one:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { deepEqual } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb/plugins/utils&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">export</span><span style="color:var(--shiki-token-keyword)"> const</span><span style="color:var(--shiki-token-constant)"> defaultConflictHandler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> RxConflictHandler</span><span style="color:var(--shiki-foreground)">&lt;</span><span style="color:var(--shiki-token-constant)">any</span><span style="color:var(--shiki-foreground)">&gt; </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    isEqual</span><span style="color:var(--shiki-foreground)">(a</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> b) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">        /**</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * isEqual() is used to detect conflicts or to detect if a</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * document has to be pushed to the remote.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * If the documents are deep equal,</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * we have no conflict.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * Because deepEqual is CPU expensive, on your custom conflict handler you might only</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * check some properties, like the updatedAt time or revisions</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * for better performance.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         */</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        return</span><span style="color:var(--shiki-token-function)"> deepEqual</span><span style="color:var(--shiki-foreground)">(a</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> b);</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    resolve</span><span style="color:var(--shiki-foreground)">(i) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">        /**</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * The default conflict handler will always</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * drop the fork state and use the master state instead.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * </span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * In your custom conflict handler you likely want to merge properties</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * of the realMasterState and the newDocumentState instead.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         */</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        return</span><span style="color:var(--shiki-token-constant)"> i</span><span style="color:var(--shiki-foreground)">.realMasterState;</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">};</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>To overwrite the default conflict handler, you have to specify a custom <code>conflictHandler</code> property when creating a collection with <code>addCollections()</code>.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="js" data-theme="css-variables"><code data-language="js" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> myCollections</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> myDatabase</span><span style="color:var(--shiki-token-function)">.addCollections</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">  // key = collectionName</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  humans</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    schema</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> mySchema</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    conflictHandler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> myCustomConflictHandler</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure></div></article><ul style="margin-top:25px;list-style-type:none"><li style="line-height:4;color:var(--expo-theme-text-secondary)">Was this page helpful?<div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div><div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer;transform:scale(1, -1)"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div></li><li><a href="/chat/" target="_blank" style="color:var(--fontColor-offwhite)"><img src="/img/community-links/discord-logo.svg" style="padding-right:16px;height:18px;vertical-align:middle" loading="lazy">Ask a question on the forums about <!-- -->Transactions,...</a></li></ul><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a href="/rx-server-scaling.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:left;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:left;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Previous</span><br>Â« <!-- -->RxServer Scaling</a><a href="/query-cache.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:right;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:right;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Next</span><br>Query Cache<!-- --> Â»</a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#why-rxdb-does-not-have-transactions" class="table-of-contents__link toc-highlight">Why RxDB does not have transactions</a></li><li><a href="#revisions" class="table-of-contents__link toc-highlight">Revisions</a></li><li><a href="#conflicts" class="table-of-contents__link toc-highlight">Conflicts</a><ul><li><a href="#local-conflicts" class="table-of-contents__link toc-highlight">Local conflicts</a></li></ul></li><li><a href="#replication-conflicts" class="table-of-contents__link toc-highlight">Replication conflicts</a></li><li><a href="#custom-conflict-handler" class="table-of-contents__link toc-highlight">Custom conflict handler</a></li></ul></div></div></div></div></main></div></div></div><div class="block footer dark"><div style="display:flex;flex-wrap:wrap;gap:44px" class="content"><div class="half left"><span><a variant="text" href="/" class="footer-logo-button"><img src="/files/logo/logo_text_white.svg" alt="RxDB" loading="lazy" class="width-140-120"></a><div class="footer-community-links"><a variant="text" href="/newsletter/" target="_blank" aria-label="Newsletter"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22.5 13.5v-7a2 2 0 0 0-2-2h-16a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8"></path><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m22.5 7.5-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2.5 7.5M19.5 16.5v6M16.5 19.5h6"></path></svg></a><a variant="text" href="https://twitter.com/intent/user?screen_name=rxdbjs" target="_blank" aria-label="Twitter"><img src="/files/icons/twitter-blue.svg" alt="Twitter" loading="lazy"></a><a variant="text" href="https://www.linkedin.com/company/rxdb" target="_blank" aria-label="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 21"><g clip-path="url(#a)"><path fill="#fff" d="M17.3 17.6h-3V13c0-1 0-2.5-1.6-2.5-1.5 0-1.8 1.2-1.8 2.5v4.7H8V8h2.9v1.3a3 3 0 0 1 2.9-1.6c3 0 3.6 2 3.6 4.6zM4.5 6.6a1.7 1.7 0 1 1 0-3.5 1.7 1.7 0 0 1 0 3.5m1.5 11H3V8h3zM18.8.4H1.5A1.5 1.5 0 0 0 0 1.8v17.4a1.5 1.5 0 0 0 1.5 1.4h17.3a1.5 1.5 0 0 0 1.5-1.4V1.8A1.5 1.5 0 0 0 18.8.4"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 .4h24v20.5H0z"></path></clipPath></defs></svg></a><a variant="text" href="/code/" target="_blank" aria-label="Github"><span class="navbar-icon-github" style="width:22px;height:22px;display:inline-block"></span></a><a variant="text" href="/chat/" target="_blank" aria-label="Discord"><span class="navbar-icon-discord" style="width:22px;height:22px;display:inline-block"></span></a></div></span></div><div class="half right" style="display:flex;flex:1"><div style="display:flex"><div class="footer-links min-width-180-135"><a variant="text" href="/overview.html" target="">Docs</a><a variant="text" href="/replication.html" target="">Sync</a><a variant="text" href="/rx-storage.html" target="">Storages</a><a variant="text" href="/premium/" target="_blank">Premium</a><a variant="text" href="/consulting/" target="_blank">Support</a></div><div class="footer-links min-width-180-135"><a variant="text" href="/#reviews" target="">Our Customers</a><a variant="text" href="/consulting#become-partner" target="">Become a Partner</a><a variant="text" href="/legal-notice/" target="_blank">Legal Notice</a></div></div></div></div></div><div class="navbar-line" style="display:block;z-index:10;height:1.5px;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;width:100%"></div><div class="call-to-action-popup"><div class="close-popup"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="" style="transform:scale(1);transition:transform 0.2s ease-in-out;display:inline-block;cursor:pointer"><path d="M4 16H8L8 12H4L4 16Z" fill="white"></path><path d="M0 20H4L4 16H0L0 20Z" fill="white"></path><path d="M8 11.9999H12V7.99992H8L8 11.9999Z" fill="white"></path><path d="M4 8.00008H8L8 4.00008H4L4 8.00008Z" fill="white"></path><path d="M0 4.00004L4 4.00004L4 3.8147e-05L0 3.8147e-05L0 4.00004Z" fill="white"></path><path d="M16 11.9999H12V15.9999H16V11.9999Z" fill="white"></path><path d="M20 16H16V20H20V16Z" fill="white"></path><path d="M16 4.00004H12V8.00004H16V4.00004Z" fill="white"></path><path d="M20 0H16V4H20V0Z" fill="white"></path></svg></div></div></div>
</body>
</html>