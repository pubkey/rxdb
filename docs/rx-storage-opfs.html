<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-rx-storage-opfs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Supercharged OPFS Database with RxDB | RxDB - JavaScript Database</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" name="twitter:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" property="og:url" content="https://rxdb.info/rx-storage-opfs.html"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Supercharged OPFS Database with RxDB | RxDB - JavaScript Database"><meta data-rh="true" name="description" content="Discover how to harness the Origin Private File System with RxDB&#x27;s OPFS RxStorage for unrivaled performance and security in client-side data storage."><meta data-rh="true" property="og:description" content="Discover how to harness the Origin Private File System with RxDB&#x27;s OPFS RxStorage for unrivaled performance and security in client-side data storage."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rxdb.info/rx-storage-opfs.html"><link data-rh="true" rel="alternate" href="https://rxdb.info/rx-storage-opfs.html" hreflang="en"><link data-rh="true" rel="alternate" href="https://rxdb.info/rx-storage-opfs.html" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-62D63SY3S0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-62D63SY3S0",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-PL63TR5",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>





<meta name="theme-color" content="#ed168f">
<link rel="icon" type="image/svg+xml" href="/files/logo/logo.svg">
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" sizes="180x180">
<link rel="preconnect" href="https://consentcdn.cookiebot.com/">
<link rel="preconnect" href="https://consent.cookiebot.com/">
<link rel="preconnect" href="https://region1.analytics.google.com/">
<link rel="preconnect" href="https://www.redditstatic.com/">
<link rel="preconnect" href="https://pixel-config.reddit.com/"><link rel="stylesheet" href="/assets/css/styles.7dfe3d16.css">
<script src="/assets/js/runtime~main.b05faf63.js" defer="defer"></script>
<script src="/assets/js/main.5dd0acba.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PL63TR5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/files/logo/logo_text_white.svg"><link rel="preload" as="image" href="./files/rx-storage-performance-browser.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/overview.html">Docs</a><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="sync" href="/replication.html">Sync</a></div><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="storages" href="/rx-storage.html">Storages</a></div><a class="navbar__item navbar__link" href="/premium/">Premium</a><a class="navbar__item navbar__link" href="/consulting/">Support</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="/chat/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-discord" target="_blank"> </a><a href="/code/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-github" target="_blank"> </a></div></div><div class="navbar-line" style="position:fixed;left:0;z-index:10;height:2px;width:100vw;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;transform-origin:left center;will-change:transform;backface-visibility:hidden;contain:layout;transform:scaleX(0)"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Y1UP"><div style="padding:10px;padding-top:30px;margin-left:auto;margin-right:auto"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" aria-label="Search" class="navbar__search-input search-bar" style="margin-left:auto;margin-right:auto;display:block"></div></div><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/overview.html"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview.html"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quickstart.html"><span title="ðŸš€ Quickstart" class="linkLabel_WmDU">ðŸš€ Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/install.html"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-mode.html"><span title="Development Mode" class="linkLabel_WmDU">Development Mode</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/typescript.html"><span title="TypeScript Setup" class="linkLabel_WmDU">TypeScript Setup</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-database.html"><span title="Core Entities" class="categoryLinkLabel_W154">Core Entities</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/rx-storage.html"><span title="ðŸ’¾ Storages" class="categoryLinkLabel_W154">ðŸ’¾ Storages</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage.html"><span title="RxStorage Overview" class="linkLabel_WmDU">RxStorage Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage-localstorage.html"><span title="LocalStorage (Browser)" class="linkLabel_WmDU">LocalStorage (Browser)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage-indexeddb.html"><span title="IndexedDB ðŸ‘‘ (Browser, Capacitor)" class="linkLabel_WmDU">IndexedDB ðŸ‘‘ (Browser, Capacitor)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rx-storage-opfs.html"><span title="OPFS ðŸ‘‘ (Browser)" class="linkLabel_WmDU">OPFS ðŸ‘‘ (Browser)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage-memory.html"><span title="Memory" class="linkLabel_WmDU">Memory</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage-filesystem-node.html"><span title="Filesystem Node ðŸ‘‘ (Node.js)" class="linkLabel_WmDU">Filesystem Node ðŸ‘‘ (Node.js)</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-storage-sqlite.html"><span title="SQLite (Capacitor, React-Native, Expo, Tauri, Electron, Node.js)" class="linkLabel_WmDU">SQLite (Capacitor, React-Native, Expo, Tauri, Electron, Node.js)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rx-storage-dexie.html"><span title="Third Party Storages" class="categoryLinkLabel_W154">Third Party Storages</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/schema-validation.html"><span title="Storage Wrappers" class="categoryLinkLabel_W154">Storage Wrappers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/replication.html"><span title="ðŸ”„ Replication" class="categoryLinkLabel_W154">ðŸ”„ Replication</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-server.html"><span title="Server" class="categoryLinkLabel_W154">Server</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/transactions-conflicts-revisions.html"><span title="How RxDB works" class="categoryLinkLabel_W154">How RxDB works</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/migration-schema.html"><span title="Advanced Features" class="categoryLinkLabel_W154">Advanced Features</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-storage-performance.html"><span title="Performance" class="categoryLinkLabel_W154">Performance</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/releases/16.0.0.html"><span title="Releases" class="categoryLinkLabel_W154">Releases</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/articles/browser-database.html"><span title="Articles" class="categoryLinkLabel_W154">Articles</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contribution.html"><span title="Contribute" class="linkLabel_WmDU">Contribute</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/consulting/"><span title="Contact" class="categoryLinkLabel_W154">Contact</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Origin Private File System (OPFS) Database with the RxDB OPFS-RxStorage</h1></header>
<p>With the <a href="https://rxdb.info/" target="_blank" rel="noopener noreferrer" class="">RxDB</a> OPFS storage you can build a fully featured database on top of the <a href="https://web.dev/opfs" target="_blank" rel="noopener noreferrer" class="">Origin Private File System</a> (OPFS) browser API. Compared to other storage solutions, it has a way better performance.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-opfs">What is OPFS<a href="#what-is-opfs" class="hash-link" aria-label="Direct link to What is OPFS" title="Direct link to What is OPFS" translate="no">â€‹</a></h2>
<p>The <strong>Origin Private File System (OPFS)</strong> is a native browser storage API that allows web applications to manage files in a private, sandboxed, <strong>origin-specific virtual filesystem</strong>. Unlike <a class="" href="/rx-storage-indexeddb.html">IndexedDB</a> and <a class="" href="/articles/localstorage.html">LocalStorage</a>, which are optimized as object/key-value storage, OPFS provides more granular control for file operations, enabling byte-by-byte access, file streaming, and even low-level manipulations.
OPFS is ideal for applications requiring <strong>high-performance</strong> file operations (<strong>3x-4x faster compared to IndexedDB</strong>) inside of a client-side application, offering advantages like improved speed, more efficient use of resources, and enhanced security and privacy features.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="opfs-limitations">OPFS limitations<a href="#opfs-limitations" class="hash-link" aria-label="Direct link to OPFS limitations" title="Direct link to OPFS limitations" translate="no">â€‹</a></h3>
<p>From the beginning of 2023, the Origin Private File System API is supported by <a href="https://caniuse.com/native-filesystem-api" target="_blank" rel="noopener noreferrer" class="">all modern browsers</a> like Safari, Chrome, Edge and Firefox. Only Internet Explorer is not supported and likely will never get support.</p>
<p>It is important to know that the most performant synchronous methods like <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemSyncAccessHandle/read" target="_blank" rel="noopener noreferrer" class=""><code>read()</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemSyncAccessHandle/write" target="_blank" rel="noopener noreferrer" class=""><code>write()</code></a> of the OPFS API are <strong>only available inside of a <a class="" href="/rx-storage-worker.html">WebWorker</a></strong>.
They cannot be used in the main thread, an iFrame or even a <a class="" href="/rx-storage-shared-worker.html">SharedWorker</a>.
The OPFS <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileHandle/createSyncAccessHandle" target="_blank" rel="noopener noreferrer" class=""><code>createSyncAccessHandle()</code></a> method that gives you access to the synchronous methods is not exposed in the main thread, only in a Worker.</p>
<p>While there is no concrete <strong>data size limit</strong> defined by the API, browsers will refuse to store more <a class="" href="/articles/indexeddb-max-storage-limit.html">data at some point</a>.
If no more data can be written, a <code>QuotaExceededError</code> is thrown which should be handled by the application, like showing an error message to the user.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-the-opfs-api-works">How the OPFS API works<a href="#how-the-opfs-api-works" class="hash-link" aria-label="Direct link to How the OPFS API works" title="Direct link to How the OPFS API works" translate="no">â€‹</a></h2>
<p>The OPFS API is pretty straightforward to use. First you get the root filesystem. Then you can create files and directories on that. Notice that whenever you <em>synchronously</em> write to, or read from a file, an <code>ArrayBuffer</code> must be used that contains the data. It is not possible to synchronously write plain strings or objects into the file. Therefore the <code>TextEncoder</code> and <code>TextDecoder</code> API must be used.</p>
<p>Also notice that some of the methods of <code>FileSystemSyncAccessHandle</code> <a href="https://developer.chrome.com/blog/sync-methods-for-accesshandles" target="_blank" rel="noopener noreferrer" class="">have been asynchronous</a> in the past, but are synchronous since Chromium 108. To make it less confusing, we just use <code>await</code> in front of them, so it will work in both cases.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-comment)">// Access the root directory of the origin&#x27;s private file system.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> root</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> navigator</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">storage</span><span style="color:var(--shiki-token-function)">.getDirectory</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Create a subdirectory.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> diaryDirectory</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> root</span><span style="color:var(--shiki-token-function)">.getDirectoryHandle</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;subfolder&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  create</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Create a new file named &#x27;example.txt&#x27;.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> fileHandle</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> diaryDirectory</span><span style="color:var(--shiki-token-function)">.getFileHandle</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;example.txt&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  create</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> true</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Create a FileSystemSyncAccessHandle on the file.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> fileHandle</span><span style="color:var(--shiki-token-function)">.createSyncAccessHandle</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Write a sentence to the file.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">let</span><span style="color:var(--shiki-foreground)"> writeBuffer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> new</span><span style="color:var(--shiki-token-function)"> TextEncoder</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-function)">.encode</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;Hello from RxDB&#x27;</span><span style="color:var(--shiki-foreground)">);</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> writeSize</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.write</span><span style="color:var(--shiki-foreground)">(writeBuffer);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Read file and transform data to string.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> readBuffer</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> new</span><span style="color:var(--shiki-token-function)"> Uint8Array</span><span style="color:var(--shiki-foreground)">(writeSize);</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> readSize</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.read</span><span style="color:var(--shiki-foreground)">(readBuffer</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> { at</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> 0</span><span style="color:var(--shiki-foreground)"> });</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> contentAsString</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> new</span><span style="color:var(--shiki-token-function)"> TextDecoder</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-function)">.decode</span><span style="color:var(--shiki-foreground)">(readBuffer);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Write an exclamation mark to the end of the file.</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">writeBuffer </span><span style="color:var(--shiki-token-keyword)">=</span><span style="color:var(--shiki-token-keyword)"> new</span><span style="color:var(--shiki-token-function)"> TextEncoder</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-function)">.encode</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;!&#x27;</span><span style="color:var(--shiki-foreground)">);</span></span>
<span data-line=""><span style="color:var(--shiki-token-constant)">accessHandle</span><span style="color:var(--shiki-token-function)">.write</span><span style="color:var(--shiki-foreground)">(writeBuffer</span><span style="color:var(--shiki-token-punctuation)">,</span><span style="color:var(--shiki-foreground)"> { at</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> readSize });</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Truncate file to 10 bytes.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">await</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.truncate</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-constant)">10</span><span style="color:var(--shiki-foreground)">);</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Get the new size of the file.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> fileSize</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.getSize</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Persist changes to disk.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">await</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.flush</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Always close FileSystemSyncAccessHandle if done, so others can open the file again.</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">await</span><span style="color:var(--shiki-token-constant)"> accessHandle</span><span style="color:var(--shiki-token-function)">.close</span><span style="color:var(--shiki-foreground)">();</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>A more detailed description of the OPFS API can be found <a href="https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system" target="_blank" rel="noopener noreferrer" class="">on MDN</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="opfs-performance">OPFS performance<a href="#opfs-performance" class="hash-link" aria-label="Direct link to OPFS performance" title="Direct link to OPFS performance" translate="no">â€‹</a></h2>
<p>Because the Origin Private File System API provides low-level access to binary files, it is much faster compared to <a class="" href="/slow-indexeddb.html">IndexedDB</a> or <a class="" href="/articles/localstorage.html">localStorage</a>. According to the <a href="https://pubkey.github.io/client-side-databases/database-comparison/index.html" target="_blank" rel="noopener noreferrer" class="">storage performance test</a>, OPFS is up to 2x times faster on plain inserts when a new file is created on each write. Reads are even faster.</p>
<p>A good comparison about real world scenarios, are the <a class="" href="/rx-storage-performance.html">performance results</a> of the various RxDB storages. Here it shows that reads are up to 4x faster compared to IndexedDB, even with complex queries:</p>
<p align="center"><img src="./files/rx-storage-performance-browser.png" alt="RxStorage performance - browser" width="700"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-opfs-as-rxstorage-in-rxdb">Using OPFS as RxStorage in RxDB<a href="#using-opfs-as-rxstorage-in-rxdb" class="hash-link" aria-label="Direct link to Using OPFS as RxStorage in RxDB" title="Direct link to Using OPFS as RxStorage in RxDB" translate="no">â€‹</a></h2>
<p>The OPFS <a class="" href="/rx-storage.html">RxStorage</a> itself must run inside a WebWorker. Therefore we use the <a class="" href="/rx-storage-worker.html">Worker RxStorage</a> and let it point to the prebuild <code>opfs.worker.js</code> file that comes shipped with RxDB Premium ðŸ‘‘.</p>
<p>Notice that the OPFS RxStorage is part of the <a class="" href="/premium/">RxDB Premium ðŸ‘‘</a> plugin that must be purchased.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    createRxDatabase</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">} </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { getRxStorageWorker } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb-premium/plugins/storage-worker&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> database</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-function)"> createRxDatabase</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;mydatabase&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    storage</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> getRxStorageWorker</span><span style="color:var(--shiki-foreground)">(</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">            /**</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">             * This file must be statically served from a webserver.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">             * You might want to first copy it somewhere outside of</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">             * your node_modules folder.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">             */</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">            workerInput</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;node_modules/rxdb-premium/dist/workers/opfs.worker.js&#x27;</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    )</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-opfs-in-the-main-thread-instead-of-a-worker">Using OPFS in the main thread instead of a worker<a href="#using-opfs-in-the-main-thread-instead-of-a-worker" class="hash-link" aria-label="Direct link to Using OPFS in the main thread instead of a worker" title="Direct link to Using OPFS in the main thread instead of a worker" translate="no">â€‹</a></h2>
<p>The <code>createSyncAccessHandle</code> method from the Filesystem API is only available inside of a Webworker. Therefore you cannot use <code>getRxStorageOPFS()</code> in the main thread. But there is a slightly slower way to access the virtual filesystem from the main thread. RxDB support the <code>getRxStorageOPFSMainThread()</code> for that. Notice that this uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileHandle/createWritable" target="_blank" rel="noopener noreferrer" class="">createWritable</a> function which is not supported in safari.</p>
<p>Using OPFS from the main thread can have benefits because not having to cross the worker bridge can reduce latence in reads and writes.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { createRxDatabase } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { getRxStorageOPFSMainThread } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb-premium/plugins/storage-opfs&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> database</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-function)"> createRxDatabase</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    name</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;mydatabase&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    storage</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-function)"> getRxStorageOPFSMainThread</span><span style="color:var(--shiki-foreground)">()</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-a-custom-workerjs">Building a custom <code>worker.js</code><a href="#building-a-custom-workerjs" class="hash-link" aria-label="Direct link to building-a-custom-workerjs" title="Direct link to building-a-custom-workerjs" translate="no">â€‹</a></h2>
<p>When you want to run additional plugins like storage wrappers or replication <strong>inside</strong> of the worker, you have to build your own <code>worker.js</code> file. You can do that similar to other workers by calling <code>exposeWorkerRxStorage</code> like described in the <a class="" href="/rx-storage-worker.html">worker storage plugin</a>.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-comment)">// inside of the worker.js file</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { getRxStorageOPFS } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb-premium/plugins/storage-opfs&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { exposeWorkerRxStorage } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb-premium/plugins/storage-worker&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> storage</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-function)"> getRxStorageOPFS</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">exposeWorkerRxStorage</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    storage</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-usesrxdatabaseinworker-when-a-rxdatabase-is-also-used-inside-of-the-worker">Setting <code>usesRxDatabaseInWorker</code> when a RxDatabase is also used inside of the worker<a href="#setting-usesrxdatabaseinworker-when-a-rxdatabase-is-also-used-inside-of-the-worker" class="hash-link" aria-label="Direct link to setting-usesrxdatabaseinworker-when-a-rxdatabase-is-also-used-inside-of-the-worker" title="Direct link to setting-usesrxdatabaseinworker-when-a-rxdatabase-is-also-used-inside-of-the-worker" translate="no">â€‹</a></h2>
<p>When you use the OPFS inside of a worker, it will internally use strings to represent operation results. This has the benefit that transferring strings from the worker to the main thread, is way faster compared to complex json objects. The <code>getRxStorageWorker()</code> will automatically decode these strings on the main thread so that the data can be used by the RxDatabase.</p>
<p>But using a RxDatabase <strong>inside</strong> of your worker can make sense for example when you want to move the <a class="" href="/replication.html">replication</a> with a server. To enable this, you have to set <code>usesRxDatabaseInWorker</code> to <code>true</code>:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-comment)">// inside of the worker.js file</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">import</span><span style="color:var(--shiki-foreground)"> { getRxStorageOPFS } </span><span style="color:var(--shiki-token-keyword)">from</span><span style="color:var(--shiki-token-string-expression)"> &#x27;rxdb-premium/plugins/storage-opfs&#x27;</span><span style="color:var(--shiki-foreground)">;</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> storage</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-function)"> getRxStorageOPFS</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  usesRxDatabaseInWorker</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> true</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>If you forget to set this and still create and use a <a class="" href="/rx-database.html">RxDatabase</a> inside of the worker, you might get the error message<code>or</code>Uncaught (in promise) TypeError: Cannot read properties of undefined (reading &#x27;length&#x27;)`.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="opfs-in-electron-react-native-or-capacitorjs">OPFS in Electron, React-Native or Capacitor.js<a href="#opfs-in-electron-react-native-or-capacitorjs" class="hash-link" aria-label="Direct link to OPFS in Electron, React-Native or Capacitor.js" title="Direct link to OPFS in Electron, React-Native or Capacitor.js" translate="no">â€‹</a></h2>
<p>Origin Private File System is a browser API that is only accessible in browsers. Other JavaScript like React-Native or Node.js, do not support it.</p>
<p><strong>Electron</strong> has two JavaScript contexts: the browser (chromium) context and the Node.js context. While you could use the OPFS API in the browser context, it is not recommended. Instead you should use the Filesystem API of Node.js and then only transfer the relevant data with the <a href="https://www.electronjs.org/de/docs/latest/api/ipc-renderer" target="_blank" rel="noopener noreferrer" class="">ipcRenderer</a>. With RxDB that is pretty easy to configure:</p>
<ul>
<li class="">In the <code>main.js</code>, expose the <a class="" href="/rx-storage-filesystem-node.html">Node Filesystem</a> storage with the <code>exposeIpcMainRxStorage()</code> that comes with the <a class="" href="/electron.html">electron plugin</a></li>
<li class="">In the browser context, access the main storage with the <code>getRxStorageIpcRenderer()</code> method.</li>
</ul>
<p><strong>React Native</strong> (and Expo) does not have an OPFS API. You could use the ReactNative Filesystem to directly write data. But to get a fully featured database like RxDB it is easier to use the <a class="" href="/rx-storage-sqlite.html">SQLite RxStorage</a> which starts an SQLite database inside of the ReactNative app and uses that to do the database operations.</p>
<p><strong>Capacitor.js</strong> is able to access the OPFS API.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="difference-between-file-system-access-api-and-origin-private-file-system-opfs">Difference between <code>File System Access API</code> and <code>Origin Private File System (OPFS)</code><a href="#difference-between-file-system-access-api-and-origin-private-file-system-opfs" class="hash-link" aria-label="Direct link to difference-between-file-system-access-api-and-origin-private-file-system-opfs" title="Direct link to difference-between-file-system-access-api-and-origin-private-file-system-opfs" translate="no">â€‹</a></h2>
<p>Often developers are confused with the differences between the <code>File System Access API</code> and the <code>Origin Private File System (OPFS)</code>.</p>
<ul>
<li class="">The <code>File System Access API</code> provides access to the files on the device file system, like the ones shown in the file explorer of the operating system. To use the File System API, the user has to actively select the files from a filepicker.</li>
<li class=""><code>Origin Private File System (OPFS)</code> is a sub-part of the <code>File System Standard</code> and it only describes the things you can do with the filesystem root from <code>navigator.storage.getDirectory()</code>. OPFS writes to a <strong>sandboxed</strong> filesystem, not visible to the user. Therefore the user does not have to actively select or allow the data access.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="learn-more-about-opfs">Learn more about OPFS:<a href="#learn-more-about-opfs" class="hash-link" aria-label="Direct link to Learn more about OPFS:" title="Direct link to Learn more about OPFS:" translate="no">â€‹</a></h2>
<ul>
<li class=""><a href="https://webkit.org/blog/12257/the-file-system-access-api-with-origin-private-file-system/" target="_blank" rel="noopener noreferrer" class="">WebKit: The File System API with Origin Private File System</a></li>
<li class=""><a href="https://caniuse.com/native-filesystem-api" target="_blank" rel="noopener noreferrer" class="">Browser Support</a></li>
<li class=""><a href="https://pubkey.github.io/client-side-databases/database-comparison/index.html" target="_blank" rel="noopener noreferrer" class="">Performance Test Tool</a></li>
</ul></div></article><ul style="margin-top:25px;list-style-type:none"><li style="line-height:4;color:var(--expo-theme-text-secondary)">Was this page helpful?<div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div><div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer;transform:scale(1, -1)"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div></li><li><a href="/chat/" target="_blank" style="color:var(--fontColor-offwhite)"><img src="/img/community-links/discord-logo.svg" style="padding-right:16px;height:18px;vertical-align:middle" loading="lazy">Ask a question on the forums about <!-- -->Supercharged OPFS...</a></li></ul><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a href="/rx-storage-indexeddb.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:left;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:left;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Previous</span><br>Â« <!-- -->IndexedDB ðŸ‘‘ (Browser, Capacitor)</a><a href="/rx-storage-memory.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:right;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:right;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Next</span><br>Memory<!-- --> Â»</a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-opfs" class="table-of-contents__link toc-highlight">What is OPFS</a><ul><li><a href="#opfs-limitations" class="table-of-contents__link toc-highlight">OPFS limitations</a></li></ul></li><li><a href="#how-the-opfs-api-works" class="table-of-contents__link toc-highlight">How the OPFS API works</a></li><li><a href="#opfs-performance" class="table-of-contents__link toc-highlight">OPFS performance</a></li><li><a href="#using-opfs-as-rxstorage-in-rxdb" class="table-of-contents__link toc-highlight">Using OPFS as RxStorage in RxDB</a></li><li><a href="#using-opfs-in-the-main-thread-instead-of-a-worker" class="table-of-contents__link toc-highlight">Using OPFS in the main thread instead of a worker</a></li><li><a href="#building-a-custom-workerjs" class="table-of-contents__link toc-highlight">Building a custom <code>worker.js</code></a></li><li><a href="#setting-usesrxdatabaseinworker-when-a-rxdatabase-is-also-used-inside-of-the-worker" class="table-of-contents__link toc-highlight">Setting <code>usesRxDatabaseInWorker</code> when a RxDatabase is also used inside of the worker</a></li><li><a href="#opfs-in-electron-react-native-or-capacitorjs" class="table-of-contents__link toc-highlight">OPFS in Electron, React-Native or Capacitor.js</a></li><li><a href="#difference-between-file-system-access-api-and-origin-private-file-system-opfs" class="table-of-contents__link toc-highlight">Difference between <code>File System Access API</code> and <code>Origin Private File System (OPFS)</code></a></li><li><a href="#learn-more-about-opfs" class="table-of-contents__link toc-highlight">Learn more about OPFS:</a></li></ul></div></div></div></div></main></div></div></div><div class="block footer dark"><div style="display:flex;flex-wrap:wrap;gap:44px" class="content"><div class="half left"><span><a variant="text" href="/" class="footer-logo-button"><img src="/files/logo/logo_text_white.svg" alt="RxDB" loading="lazy" class="width-140-120"></a><div class="footer-community-links"><a variant="text" href="/newsletter/" target="_blank" aria-label="Newsletter"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22.5 13.5v-7a2 2 0 0 0-2-2h-16a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8"></path><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m22.5 7.5-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2.5 7.5M19.5 16.5v6M16.5 19.5h6"></path></svg></a><a variant="text" href="https://twitter.com/intent/user?screen_name=rxdbjs" target="_blank" aria-label="Twitter"><img src="/files/icons/twitter-blue.svg" alt="Twitter" loading="lazy"></a><a variant="text" href="https://www.linkedin.com/company/rxdb" target="_blank" aria-label="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 21"><g clip-path="url(#a)"><path fill="#fff" d="M17.3 17.6h-3V13c0-1 0-2.5-1.6-2.5-1.5 0-1.8 1.2-1.8 2.5v4.7H8V8h2.9v1.3a3 3 0 0 1 2.9-1.6c3 0 3.6 2 3.6 4.6zM4.5 6.6a1.7 1.7 0 1 1 0-3.5 1.7 1.7 0 0 1 0 3.5m1.5 11H3V8h3zM18.8.4H1.5A1.5 1.5 0 0 0 0 1.8v17.4a1.5 1.5 0 0 0 1.5 1.4h17.3a1.5 1.5 0 0 0 1.5-1.4V1.8A1.5 1.5 0 0 0 18.8.4"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 .4h24v20.5H0z"></path></clipPath></defs></svg></a><a variant="text" href="/code/" target="_blank" aria-label="Github"><span class="navbar-icon-github" style="width:22px;height:22px;display:inline-block"></span></a><a variant="text" href="/chat/" target="_blank" aria-label="Discord"><span class="navbar-icon-discord" style="width:22px;height:22px;display:inline-block"></span></a></div></span></div><div class="half right" style="display:flex;flex:1"><div style="display:flex"><div class="footer-links min-width-180-135"><a variant="text" href="/overview.html" target="">Docs</a><a variant="text" href="/replication.html" target="">Sync</a><a variant="text" href="/rx-storage.html" target="">Storages</a><a variant="text" href="/premium/" target="_blank">Premium</a><a variant="text" href="/consulting/" target="_blank">Support</a></div><div class="footer-links min-width-180-135"><a variant="text" href="/#reviews" target="">Our Customers</a><a variant="text" href="/consulting#become-partner" target="">Become a Partner</a><a variant="text" href="/legal-notice/" target="_blank">Legal Notice</a></div></div></div></div></div><div class="navbar-line" style="display:block;z-index:10;height:1.5px;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;width:100%"></div><div class="call-to-action-popup"><div class="close-popup"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="" style="transform:scale(1);transition:transform 0.2s ease-in-out;display:inline-block;cursor:pointer"><path d="M4 16H8L8 12H4L4 16Z" fill="white"></path><path d="M0 20H4L4 16H0L0 20Z" fill="white"></path><path d="M8 11.9999H12V7.99992H8L8 11.9999Z" fill="white"></path><path d="M4 8.00008H8L8 4.00008H4L4 8.00008Z" fill="white"></path><path d="M0 4.00004L4 4.00004L4 3.8147e-05L0 3.8147e-05L0 4.00004Z" fill="white"></path><path d="M16 11.9999H12V15.9999H16V11.9999Z" fill="white"></path><path d="M20 16H16V20H20V16Z" fill="white"></path><path d="M16 4.00004H12V8.00004H16V4.00004Z" fill="white"></path><path d="M20 0H16V4H20V0Z" fill="white"></path></svg></div></div></div>
</body>
</html>