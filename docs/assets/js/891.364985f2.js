"use strict";(self.webpackChunkrxdb=self.webpackChunkrxdb||[]).push([[891],{167:(e,t,r)=>{r.d(t,{h:()=>a});var a={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"\n        RxDB Error-Code: "+e+".\n        Hint: Error messages are not included in RxDB core to reduce build size.\n        To show the full error messages and to ensure that you do not make any mistakes when using RxDB,\n        use the dev-mode plugin when you are in development mode: https://rxdb.info/dev-mode.html?console=error\n        "}},891:(e,t,r)=>{r.r(t),r.d(t,{getDatabase:()=>Jr,hasIndexedDB:()=>Vr});var a=r(7329);function n(e,t){var r=e.get(t);if(void 0===r)throw new Error("missing value from map "+t);return r}function i(e,t,r,a){var n=e.get(t);return void 0===n?(n=r(),e.set(t,n)):a&&a(n),n}function s(e){return Object.assign({},e)}function o(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort((e,t)=>"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"object"==typeof e?1:-1).map(e=>o(e,t));if("object"==typeof e&&!Array.isArray(e)){var r={};return Object.keys(e).sort((e,t)=>e.localeCompare(t)).forEach(a=>{r[a]=o(e[a],t)}),r}return e}var c=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var r=new Array(t.length),a=r.length;a--;)r[a]=e(t[a]);return r}var n={};for(var i in t)n[i]=e(t[i]);return n};function u(e,t,r){return Object.defineProperty(e,t,{get:function(){return r}}),r}var h=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},l=new Set(["__proto__","prototype","constructor"]),d=new Set("0123456789");function m(e){var t=[],r="",a="start",n=!1;for(var i of e)switch(i){case"\\":if("index"===a)throw new Error("Invalid character in an index");if("indexEnd"===a)throw new Error("Invalid character after an index");n&&(r+=i),a="property",n=!n;break;case".":if("index"===a)throw new Error("Invalid character in an index");if("indexEnd"===a){a="property";break}if(n){n=!1,r+=i;break}if(l.has(r))return[];t.push(r),r="",a="property";break;case"[":if("index"===a)throw new Error("Invalid character in an index");if("indexEnd"===a){a="index";break}if(n){n=!1,r+=i;break}if("property"===a){if(l.has(r))return[];t.push(r),r=""}a="index";break;case"]":if("index"===a){t.push(Number.parseInt(r,10)),r="",a="indexEnd";break}if("indexEnd"===a)throw new Error("Invalid character after an index");default:if("index"===a&&!d.has(i))throw new Error("Invalid character in an index");if("indexEnd"===a)throw new Error("Invalid character after an index");"start"===a&&(a="property"),n&&(n=!1,r+="\\"),r+=i}switch(n&&(r+="\\"),a){case"property":if(l.has(r))return[];t.push(r);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function f(e,t){if("number"!=typeof t&&Array.isArray(e)){var r=Number.parseInt(t,10);return Number.isInteger(r)&&e[r]===e[t]}return!1}function p(e,t){if(f(e,t))throw new Error("Cannot use string index")}function v(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!h(e)||"string"!=typeof t)return void 0===r?e:r;var a=m(t);if(0===a.length)return r;for(var n=0;n<a.length;n++){var i=a[n];if(null==(e=f(e,i)?n===a.length-1?void 0:null:e[i])){if(n!==a.length-1)return r;break}}return void 0===e?r:e}function y(e,t,r){if(Array.isArray(t)&&(t=t.join(".")),!h(e)||"string"!=typeof t)return e;for(var a=e,n=m(t),i=0;i<n.length;i++){var s=n[i];p(e,s),i===n.length-1?e[s]=r:h(e[s])||(e[s]="number"==typeof n[i+1]?[]:{}),e=e[s]}return a}var g=r(8653),w=r(8060),b=/\./g,D=r(7587);function x(e,t){var r=t;return r="properties."+(r=r.replace(b,".properties.")),v(e,r=(0,D.L$)(r))}function _(e){return"string"==typeof e?e:e.key}function k(e,t){if("string"==typeof e.primaryKey)return t[e.primaryKey];var r=e.primaryKey;return r.fields.map(e=>{var r=v(t,e);if(void 0===r)throw(0,w.Br)("DOC18",{args:{field:e,documentData:t}});return r}).join(r.separator)}function I(e){var t=_((e=s(e)).primaryKey);e.properties=s(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=E,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var r=R(e);(0,g.Hb)(e.required,r),e.required=e.required.filter(e=>!e.includes(".")).filter((e,t,r)=>r.indexOf(e)===t),e.version=e.version||0;var a=e.indexes.map(e=>{var r=(0,g.k_)(e)?e.slice(0):[e];return r.includes(t)||r.push(t),"_deleted"!==r[0]&&r.unshift("_deleted"),r});0===a.length&&a.push(function(e){return["_deleted",e]}(t)),a.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map(e=>{a.push(e)});var n=new Set;return a.filter(e=>{var t=e.join(",");return!n.has(t)&&(n.add(t),!0)}),e.indexes=a,e}var E={type:"object",properties:{lwt:{type:"number",minimum:1,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function R(e){var t=Object.keys(e.properties).filter(t=>e.properties[t].final),r=_(e.primaryKey);return t.push(r),"string"!=typeof e.primaryKey&&e.primaryKey.fields.forEach(e=>t.push(e)),t}var C="docs",O="changes",P="attachments",S="dexie",j=new Map,B=new Map;var $="__";function N(e){var t=e.split(".");if(t.length>1)return t.map(e=>N(e)).join(".");if(e.startsWith("|")){var r=e.substring(1);return $+r}return e}function M(e){var t=e.split(".");return t.length>1?t.map(e=>M(e)).join("."):e.startsWith($)?"|"+e.substring($.length):e}function A(e,t){if(!t)return t;var r=s(t);return r=T(r),e.forEach(e=>{var a=v(t,e)?"1":"0",n=N(e);y(r,n,a)}),r}function q(e,t){return t?(t=L(t=s(t)),e.forEach(e=>{var r=v(t,e);y(t,e,"1"===r)}),t):t}function T(e){if(!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map(e=>T(e));if("object"==typeof e){var t={};return Object.entries(e).forEach(([e,r])=>{"object"==typeof r&&(r=T(r)),t[N(e)]=r}),t}}function L(e){if(!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(Array.isArray(e))return e.map(e=>L(e));if("object"==typeof e){var t={};return Object.entries(e).forEach(([r,a])=>{("object"==typeof a||Array.isArray(e))&&(a=L(a)),t[M(r)]=a}),t}}function Q(e){var t=[],r=_(e.primaryKey);t.push([r]),t.push(["_deleted",r]),e.indexes&&e.indexes.forEach(e=>{var r=(0,g.$r)(e);t.push(r)}),t.push(["_meta.lwt",r]),t.push(["_meta.lwt"]);var a=(t=t.map(e=>e.map(e=>N(e)))).map(e=>1===e.length?e[0]:"["+e.join("+")+"]");return(a=a.filter((e,t,r)=>r.indexOf(e)===t)).join(", ")}async function F(e,t){var r=await e;return(await r.dexieTable.bulkGet(t)).map(e=>q(r.booleanIndexes,e))}function W(e,t){return e+"||"+t}function H(e){var t=new Set,r=[];return e.indexes?(e.indexes.forEach(a=>{(0,g.$r)(a).forEach(a=>{t.has(a)||(t.add(a),"boolean"===x(e,a).type&&r.push(a))})}),r.push("_deleted"),(0,g.jw)(r)):r}var K=r(9092),z=0;function Z(){var e=Date.now();(e+=.01)<=z&&(e=z+.01);var t=parseFloat(e.toFixed(2));return z=t,t}var U={},V=r(1990),J=r(8289),X=J.Dr,G=!1;async function Y(){return G?X:(G=!0,X=(async()=>!(!U.premium||"string"!=typeof U.premium||"6da4936d1425ff3a5c44c02342c6daf791d266be3ae8479b8ec59e261df41b93"!==await(0,V.V0)(U.premium)))())}var ee=r(4978),te=String.fromCharCode(65535),re=Number.MIN_SAFE_INTEGER;function ae(e,t){var r=t.selector,a=e.indexes?e.indexes.slice(0):[];t.index&&(a=[t.index]);var n=!!t.sort.find(e=>"desc"===Object.values(e)[0]),i=new Set;Object.keys(r).forEach(t=>{var a=x(e,t);a&&"boolean"===a.type&&Object.prototype.hasOwnProperty.call(r[t],"$eq")&&i.add(t)});var s,o=t.sort.map(e=>Object.keys(e)[0]).filter(e=>!i.has(e)).join(","),c=-1;if(a.forEach(e=>{var a=!0,u=!0,h=e.map(e=>{var t=r[e],n=t?Object.keys(t):[],i={};t&&n.length?n.forEach(e=>{if(ne.has(e)){var r=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);i=Object.assign(i,r)}}):i={startKey:u?re:te,endKey:a?te:re,inclusiveStart:!0,inclusiveEnd:!0};return void 0===i.startKey&&(i.startKey=re),void 0===i.endKey&&(i.endKey=te),void 0===i.inclusiveStart&&(i.inclusiveStart=!0),void 0===i.inclusiveEnd&&(i.inclusiveEnd=!0),u&&!i.inclusiveStart&&(u=!1),a&&!i.inclusiveEnd&&(a=!1),i}),l=h.map(e=>e.startKey),d=h.map(e=>e.endKey),m={index:e,startKeys:l,endKeys:d,inclusiveEnd:a,inclusiveStart:u,sortSatisfiedByIndex:!n&&o===e.filter(e=>!i.has(e)).join(","),selectorSatisfiedByIndex:oe(e,t.selector,l,d)},f=function(e,t,r){var a=0,n=e=>{e>0&&(a+=e)},i=10,s=(0,g.Sd)(r.startKeys,e=>e!==re&&e!==te);n(s*i);var o=(0,g.Sd)(r.startKeys,e=>e!==te&&e!==re);n(o*i);var c=(0,g.Sd)(r.startKeys,(e,t)=>e===r.endKeys[t]);n(c*i*1.5);var u=r.sortSatisfiedByIndex?5:0;return n(u),a}(0,0,m);(f>=c||t.index)&&(c=f,s=m)}),!s)throw(0,w.Br)("SNH",{query:t});return s}var ne=new Set(["$eq","$gt","$gte","$lt","$lte"]),ie=new Set(["$eq","$gt","$gte"]),se=new Set(["$eq","$lt","$lte"]);function oe(e,t,r,a){var n=Object.entries(t).find(([t,r])=>!e.includes(t)||Object.entries(r).find(([e,t])=>!ne.has(e)));if(n)return!1;if(t.$and||t.$or)return!1;var i=[],s=new Set;for(var[o,c]of Object.entries(t)){if(!e.includes(o))return!1;var u=Object.keys(c).filter(e=>ie.has(e));if(u.length>1)return!1;var h=u[0];if(h&&s.add(o),"$eq"!==h){if(i.length>0)return!1;i.push(h)}}var l=[],d=new Set;for(var[m,f]of Object.entries(t)){if(!e.includes(m))return!1;var p=Object.keys(f).filter(e=>se.has(e));if(p.length>1)return!1;var v=p[0];if(v&&d.add(m),"$eq"!==v){if(l.length>0)return!1;l.push(v)}}var y=0;for(var g of e){for(var w of[s,d]){if(!w.has(g)&&w.size>0)return!1;w.delete(g)}if(r[y]!==a[y]&&s.size>0&&d.size>0)return!1;y++}return!0}var ce=r(744),ue=r(2779),he=r(4644),le=r(5918),de=r(7705),me=r(2403),fe=r(1073),pe=r(6950),ve=r(6823),ye=!1;function ge(e){return ye||((0,ue.DZ)("pipeline",{$sort:le.xF,$project:le.C2}),(0,ue.DZ)("query",{$and:de.a6,$eq:me.XV,$elemMatch:pe.Jy,$exists:ve.P,$gt:me.MR,$gte:me.fy,$in:me.oZ,$lt:me.NV,$lte:me.Q_,$ne:me.C5,$nin:me.GU,$mod:fe.Pp,$nor:de.q3,$not:de.En,$or:de.sU,$regex:fe.WP,$size:pe.Ig,$type:ve.T}),ye=!0),new he.X(e)}function we(e,t){var r=_(e.primaryKey);t=s(t);var a=c(t);if("number"!=typeof a.skip&&(a.skip=0),a.selector?(a.selector=a.selector,Object.entries(a.selector).forEach(([e,t])=>{"object"==typeof t&&null!==t||(a.selector[e]={$eq:t})})):a.selector={},a.index){var n=(0,g.$r)(a.index);n.includes(r)||n.push(r),a.index=n}if(a.sort)a.sort.find(e=>{return t=e,Object.keys(t)[0]===r;var t})||(a.sort=a.sort.slice(0),a.sort.push({[r]:"asc"}));else if(a.index)a.sort=a.index.map(e=>({[e]:"asc"}));else{if(e.indexes){var i=new Set;Object.entries(a.selector).forEach(([e,t])=>{("object"!=typeof t||null===t||!!Object.keys(t).find(e=>ne.has(e)))&&i.add(e)});var o,u=-1;e.indexes.forEach(e=>{var t=(0,g.k_)(e)?e:[e],r=t.findIndex(e=>!i.has(e));r>0&&r>u&&(u=r,o=t)}),o&&(a.sort=o.map(e=>({[e]:"asc"})))}if(!a.sort)if(e.indexes&&e.indexes.length>0){var h=e.indexes[0],l=(0,g.k_)(h)?h:[h];a.sort=l.map(e=>({[e]:"asc"}))}else a.sort=[{[r]:"asc"}]}return a}function be(e,t){if(!t.sort)throw(0,w.Br)("SNH",{query:t});var r=[];t.sort.forEach(e=>{var t,a,n,i=Object.keys(e)[0],s=Object.values(e)[0];r.push({key:i,direction:s,getValueFn:(t=i,a=t.split("."),n=a.length,1===n?e=>e[t]:e=>{for(var t=e,r=0;r<n;++r)if(void 0===(t=t[a[r]]))return t;return t})})});return(e,t)=>{for(var a=0;a<r.length;++a){var n=r[a],i=n.getValueFn(e),s=n.getValueFn(t);if(i!==s)return"asc"===n.direction?(0,ce.UD)(i,s):(0,ce.UD)(s,i)}}}function De(e,t){if(!t.sort)throw(0,w.Br)("SNH",{query:t});var r=ge(t.selector);return e=>r.test(e)}async function xe(e,t){var r=await e.exec();return r?Array.isArray(r)?Promise.all(r.map(e=>t(e))):r instanceof Map?Promise.all([...r.values()].map(e=>t(e))):await t(r):null}function _e(e,t){if(!t.sort)throw(0,w.Br)("SNH",{query:t});return{query:t,queryPlan:ae(e,t)}}function ke(e){return e===re?-1/0:e}function Ie(e,t,r){return e.includes(t)?r===te||!0===r?"1":"0":r}function Ee(e,t,r){if(!r){if("undefined"==typeof window)throw new Error("IDBKeyRange missing");r=window.IDBKeyRange}var a=t.startKeys.map((r,a)=>{var n=t.index[a];return Ie(e,n,r)}).map(ke),n=t.endKeys.map((r,a)=>{var n=t.index[a];return Ie(e,n,r)}).map(ke);return r.bound(a,n,!t.inclusiveStart,!t.inclusiveEnd)}async function Re(e,t){var r=await e.internals,a=t.query,n=a.skip?a.skip:0,i=n+(a.limit?a.limit:1/0),s=t.queryPlan,o=!1;s.selectorSatisfiedByIndex||(o=De(e.schema,t.query));var c=Ee(r.booleanIndexes,s,r.dexieDb._options.IDBKeyRange),u=s.index,h=[];if(await r.dexieDb.transaction("r",r.dexieTable,async e=>{var t,a=e.idbtrans.objectStore(C);t="["+u.map(e=>N(e)).join("+")+"]";var n=a.index(t).openCursor(c);await new Promise(e=>{n.onsuccess=function(t){var a=t.target.result;if(a){var n=q(r.booleanIndexes,a.value);o&&!o(n)||h.push(n),s.sortSatisfiedByIndex&&h.length===i?e():a.continue()}else e()}})}),!s.sortSatisfiedByIndex){var l=be(e.schema,t.query);h=h.sort(l)}return{documents:h=h.slice(n,i)}}var Ce=r(167);function Oe(e){for(var t="",r=0;r<e.length;r++){var a=e[r];if("-"===a)return parseInt(t,10);t+=a}throw new Error("malformatted revision: "+e)}function Pe(e,t){return(t?Oe(t._rev)+1:1)+"-"+e}var Se={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postCloseRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],prePrepareRxQuery:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preCloseRxDatabase:[],postRemoveRxDatabase:[],postCleanup:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function je(e,t){Se[e].length>0&&Se[e].forEach(e=>e(t))}async function Be(e,t){for(var r of Se[e])await r(t)}var $e="_rxdb_internal";async function Ne(e,t){var r=(await e.findDocumentsById([t],!1))[0];return r||void 0}async function Me(e,t,r){var a=await e.bulkWrite([t],r);if(a.error.length>0)throw a.error[0];return He(_(e.schema.primaryKey),[t],a)[0]}function Ae(e,t,r,a){if(a)throw 409===a.status?(0,w.Br)("CONFLICT",{collection:e.name,id:t,writeError:a,data:r}):422===a.status?(0,w.Br)("VD2",{collection:e.name,id:t,writeError:a,data:r}):a}function qe(e){return{previous:e.previous,document:Te(e.document)}}function Te(e){if(!e._attachments||0===Object.keys(e._attachments).length)return e;var t=s(e);return t._attachments={},Object.entries(e._attachments).forEach(([e,r])=>{var a,n,i;t._attachments[e]=(i=(a=r).data)?{length:(n=i,atob(n).length),digest:a.digest,type:a.type}:a}),t}function Le(e){return Object.assign({},e,{_meta:s(e._meta)})}function Qe(e,t,r){Ce.h.deepFreezeWhenDevMode(r);var a=_(t.schema.primaryKey),n={originalStorageInstance:t,schema:t.schema,internals:t.internals,collectionName:t.collectionName,databaseName:t.databaseName,options:t.options,async bulkWrite(r,n){for(var i=e.token,s=new Array(r.length),o=Z(),c=0;c<r.length;c++){var u=r[c],h=Le(u.document);h._meta.lwt=o;var l=u.previous;h._rev=Pe(i,l),s[c]={document:h,previous:l}}je("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:s});var d=await e.lockedRun(()=>t.bulkWrite(s,n)),m={error:[]};Fe.set(m,s);var f=0===d.error.length?[]:d.error.filter(e=>!(409!==e.status||e.writeRow.previous||e.writeRow.document._deleted||!(0,ee.ZN)(e.documentInDb)._deleted)||(m.error.push(e),!1));if(f.length>0){var p=new Set,v=f.map(t=>(p.add(t.documentId),{previous:t.documentInDb,document:Object.assign({},t.writeRow.document,{_rev:Pe(e.token,t.documentInDb)})})),y=await e.lockedRun(()=>t.bulkWrite(v,n));(0,g.Hb)(m.error,y.error);var w=He(a,s,m,p),b=He(a,v,y);return(0,g.Hb)(w,b),m}return m},query:r=>e.lockedRun(()=>t.query(r)),count:r=>e.lockedRun(()=>t.count(r)),findDocumentsById:(r,a)=>e.lockedRun(()=>t.findDocumentsById(r,a)),getAttachmentData:(r,a,n)=>e.lockedRun(()=>t.getAttachmentData(r,a,n)),getChangedDocumentsSince:t.getChangedDocumentsSince?(r,a)=>e.lockedRun(()=>t.getChangedDocumentsSince((0,ee.ZN)(r),a)):void 0,cleanup:r=>e.lockedRun(()=>t.cleanup(r)),remove:()=>(e.storageInstances.delete(n),e.lockedRun(()=>t.remove())),close:()=>(e.storageInstances.delete(n),e.lockedRun(()=>t.close())),changeStream:()=>t.changeStream()};return e.storageInstances.add(n),n}var Fe=new WeakMap,We=new WeakMap;function He(e,t,r,a){return i(We,r,()=>{var n=[],i=Fe.get(r);if(i||(i=t),r.error.length>0||a){for(var s=a||new Set,o=0;o<r.error.length;o++){var c=r.error[o];s.add(c.documentId)}for(var u=0;u<i.length;u++){var h=i[u].document;s.has(h[e])||n.push(Te(h))}}else{n.length=t.length-r.error.length;for(var l=0;l<i.length;l++){var d=i[l].document;n[l]=Te(d)}}return n})}var Ke=r(5714),ze=r(703),Ze=new Map;function Ue(e,t){var r=Ze.get(e);if(r)return r.refs.delete(t),0===r.refs.size?(Ze.delete(e),r.bc.close()):void 0}function Ve(e,t,r,a){if(t.multiInstance){var n=a||function(e,t,r,a){var n=Ze.get(t);return n||(n={bc:new ze.X2(["RxDB:",e,r].join("|")),refs:new Set},Ze.set(t,n)),n.refs.add(a),n.bc}(e,t.databaseInstanceToken,r.databaseName,r),i=new K.B,s=r=>{r.storageName===e&&r.databaseName===t.databaseName&&r.collectionName===t.collectionName&&r.version===t.schema.version&&i.next(r.eventBulk)};n.addEventListener("message",s);var o=r.changeStream(),c=!1,u=o.subscribe(r=>{c||n.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:r})});r.changeStream=function(){return i.asObservable().pipe((0,Ke.X)(o))};var h=r.close.bind(r);r.close=async function(){return c=!0,u.unsubscribe(),n.removeEventListener("message",s),a||await Ue(t.databaseInstanceToken,r),h()};var l=r.remove.bind(r);r.remove=async function(){return c=!0,u.unsubscribe(),n.removeEventListener("message",s),a||await Ue(t.databaseInstanceToken,r),l()}}}var Je=Z(),Xe=!1,Ge=function(){function e(e,t,r,a,n,i,s,o){this.changes$=new K.B,this.instanceId=Je++,this.storage=e,this.databaseName=t,this.collectionName=r,this.schema=a,this.internals=n,this.options=i,this.settings=s,this.devMode=o,this.primaryPath=_(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=async function(e,t){et(this),Xe||await Y()||console.warn(["-------------- RxDB Open Core RxStorage -------------------------------","You are using the free Dexie.js based RxStorage implementation from RxDB https://rxdb.info/rx-storage-dexie.html?console=dexie ","While this is a great option, we want to let you know that there are faster storage solutions available in our premium plugins.","For professional users and production environments, we highly recommend considering these premium options to enhance performance and reliability."," https://rxdb.info/premium/?console=dexie ","If you already purchased premium access you can disable this log by calling the setPremiumFlag() function from rxdb-premium/plugins/shared.","---------------------------------------------------------------------"].join("\n")),Xe=!0,e.forEach(e=>{if(!e.document._rev||e.previous&&!e.previous._rev)throw(0,w.Br)("SNH",{args:{row:e}})});var r=await this.internals,a={error:[]};this.devMode&&(e=e.map(e=>{var t=Le(e.document);return{previous:e.previous,document:t}}));var n,i=e.map(e=>e.document[this.primaryPath]);if(await r.dexieDb.transaction("rw",r.dexieTable,r.dexieAttachmentsTable,async()=>{var s=new Map;(await F(this.internals,i)).forEach(e=>{var t=e;return t&&s.set(t[this.primaryPath],t),t}),n=function(e,t,r,a,n,i,s){for(var o,c=!!e.schema.attachments,u=[],h=[],l=[],d={id:(0,D.zs)(10),events:[],checkpoint:null,context:n},m=d.events,f=[],p=[],v=[],y=r.size>0,g=a.length,b=function(){var e,n=a[x],d=n.document,g=n.previous,b=d[t],D=d._deleted,_=g&&g._deleted,k=void 0;if(y&&(k=r.get(b)),k){var I=k._rev;if(!g||g&&I!==g._rev){var E={isError:!0,status:409,documentId:b,writeRow:n,documentInDb:k};return l.push(E),1}var R=c?qe(n):n;c&&(D?g&&Object.keys(g._attachments).forEach(e=>{p.push({documentId:b,attachmentId:e,digest:(0,ee.ZN)(g)._attachments[e].digest})}):(Object.entries(d._attachments).find(([t,r])=>((g?g._attachments[t]:void 0)||r.data||(e={documentId:b,documentInDb:k,isError:!0,status:510,writeRow:n,attachmentId:t}),!0)),e||Object.entries(d._attachments).forEach(([e,t])=>{var r=g?g._attachments[e]:void 0;if(r){var a=R.document._attachments[e].digest;t.data&&r.digest!==a&&v.push({documentId:b,attachmentId:e,attachmentData:t,digest:t.digest})}else f.push({documentId:b,attachmentId:e,attachmentData:t,digest:t.digest})}))),e?l.push(e):(c?(h.push(qe(R)),s&&s(d)):(h.push(R),s&&s(d)),o=R);var C=null,O=null,P=null;if(_&&!D)P="INSERT",C=c?Te(d):d;else if(!g||_||D){if(!D)throw(0,w.Br)("SNH",{args:{writeRow:n}});P="DELETE",C=(0,ee.ZN)(d),O=g}else P="UPDATE",C=c?Te(d):d,O=g;var S={documentId:b,documentData:C,previousDocumentData:O,operation:P};m.push(S)}else{var j=!!D;if(c&&Object.entries(d._attachments).forEach(([t,r])=>{r.data?f.push({documentId:b,attachmentId:t,attachmentData:r,digest:r.digest}):(e={documentId:b,isError:!0,status:510,writeRow:n,attachmentId:t},l.push(e))}),e||(c?(u.push(qe(n)),i&&i(d)):(u.push(n),i&&i(d)),o=n),!j){var B={documentId:b,operation:"INSERT",documentData:c?Te(d):d,previousDocumentData:c&&g?Te(g):g};m.push(B)}}},x=0;x<g;x++)b();return{bulkInsertDocs:u,bulkUpdateDocs:h,newestRow:o,errors:l,eventBulk:d,attachmentsAdd:f,attachmentsRemove:p,attachmentsUpdate:v}}(this,this.primaryPath,s,e,t),a.error=n.errors;var o=[];n.bulkInsertDocs.forEach(e=>{o.push(e.document)}),n.bulkUpdateDocs.forEach(e=>{o.push(e.document)}),(o=o.map(e=>A(r.booleanIndexes,e))).length>0&&await r.dexieTable.bulkPut(o);var c=[];n.attachmentsAdd.forEach(e=>{c.push({id:W(e.documentId,e.attachmentId),data:e.attachmentData.data})}),n.attachmentsUpdate.forEach(e=>{c.push({id:W(e.documentId,e.attachmentId),data:e.attachmentData.data})}),await r.dexieAttachmentsTable.bulkPut(c),await r.dexieAttachmentsTable.bulkDelete(n.attachmentsRemove.map(e=>W(e.documentId,e.attachmentId)))}),(n=(0,ee.ZN)(n)).eventBulk.events.length>0){var s=(0,ee.ZN)(n.newestRow).document;n.eventBulk.checkpoint={id:s[this.primaryPath],lwt:s._meta.lwt},this.changes$.next(n.eventBulk)}return a},t.findDocumentsById=async function(e,t){et(this);var r=await this.internals,a=[];return await r.dexieDb.transaction("r",r.dexieTable,async()=>{(await F(this.internals,e)).forEach(e=>{!e||e._deleted&&!t||a.push(e)})}),a},t.query=function(e){return et(this),Re(this,e)},t.count=async function(e){if(e.queryPlan.selectorSatisfiedByIndex){var t=await async function(e,t){var r=await e.internals,a=t.queryPlan,n=a.index,i=Ee(r.booleanIndexes,a,r.dexieDb._options.IDBKeyRange),s=-1;return await r.dexieDb.transaction("r",r.dexieTable,async e=>{var t,r=e.idbtrans.objectStore(C);t="["+n.map(e=>N(e)).join("+")+"]";var a=r.index(t).count(i);s=await new Promise((e,t)=>{a.onsuccess=function(){e(a.result)},a.onerror=e=>t(e)})}),s}(this,e);return{count:t,mode:"fast"}}return{count:(await Re(this,e)).documents.length,mode:"slow"}},t.changeStream=function(){return et(this),this.changes$.asObservable()},t.cleanup=async function(e){et(this);var t=await this.internals;return await t.dexieDb.transaction("rw",t.dexieTable,async()=>{var r=Z()-e,a=await t.dexieTable.where("_meta.lwt").below(r).toArray(),n=[];a.forEach(e=>{"1"===e._deleted&&n.push(e[this.primaryPath])}),await t.dexieTable.bulkDelete(n)}),!0},t.getAttachmentData=async function(e,t,r){et(this);var a=await this.internals,n=W(e,t);return await a.dexieDb.transaction("r",a.dexieAttachmentsTable,async()=>{var r=await a.dexieAttachmentsTable.get(n);if(r)return r.data;throw new Error("attachment missing documentId: "+e+" attachmentId: "+t)})},t.remove=async function(){et(this);var e=await this.internals;return await e.dexieTable.clear(),this.close()},t.close=function(){return this.closed||(this.closed=(async()=>{this.changes$.complete(),await async function(e){var t=await e,r=B.get(e)-1;0===r?(t.dexieDb.close(),B.delete(e)):B.set(e,r)}(this.internals)})()),this.closed},e}();async function Ye(e,t,r){var n=function(e,t,r,n){var o="rxdb-dexie-"+e+"--"+n.version+"--"+t,c=i(j,o,()=>{var e=(async()=>{var e=s(r);e.autoOpen=!1;var t=new a.cf(o,e);r.onCreate&&await r.onCreate(t,o);var i={[C]:Q(n),[O]:"++sequence, id",[P]:"id"};return t.version(1).stores(i),await t.open(),{dexieDb:t,dexieTable:t[C],dexieAttachmentsTable:t[P],booleanIndexes:H(n)}})();return j.set(o,c),B.set(c,0),e});return c}(t.databaseName,t.collectionName,r,t.schema),o=new Ge(e,t.databaseName,t.collectionName,t.schema,n,t.options,r,t.devMode);return await Ve(S,t,o),Promise.resolve(o)}function et(e){if(e.closed)throw new Error("RxStorageInstanceDexie is closed "+e.databaseName+"-"+e.collectionName)}var tt="16.18.0",rt=function(){function e(e){this.name=S,this.rxdbVersion=tt,this.settings=e}return e.prototype.createStorageInstance=function(e){(function(e){if(e.schema.keyCompression)throw(0,w.Br)("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw(0,w.Br)("UT6",{args:{params:e}});var t;if(e.schema.attachments&&e.schema.attachments.compression)throw(0,w.Br)("UT7",{args:{params:e}})}(e),e.schema.indexes)&&e.schema.indexes.flat().filter(e=>!e.includes(".")).forEach(t=>{if(!e.schema.required||!e.schema.required.includes(t))throw(0,w.Br)("DXE1",{field:t,schema:e.schema})});return Ye(this,e,this.settings)},e}();function at(e={}){return new rt(e)}var nt=r(3836),it=r(7593),st=function(){function e(e,t){if(this.jsonSchema=e,this.hashFunction=t,this.indexes=function(e){return(e.indexes||[]).map(e=>(0,g.k_)(e)?e:[e])}(this.jsonSchema),this.primaryPath=_(this.jsonSchema.primaryKey),!e.properties[this.primaryPath].maxLength)throw(0,w.Br)("SC39",{schema:e});this.finalFields=R(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(e,t){this.finalFields.forEach(r=>{if(!(0,it.b)(e[r],t[r]))throw(0,w.Br)("DOC9",{dataBefore:e,dataAfter:t,fieldName:r,schema:this.jsonSchema})})},t.getDocumentPrototype=function(){var e={},t=x(this.jsonSchema,"");return Object.keys(t).forEach(t=>{var r=t;e.__defineGetter__(t,function(){if(this.get&&"function"==typeof this.get)return this.get(r)}),Object.defineProperty(e,t+"$",{get:function(){return this.get$(r)},enumerable:!1,configurable:!1}),Object.defineProperty(e,t+"$$",{get:function(){return this.get$$(r)},enumerable:!1,configurable:!1}),Object.defineProperty(e,t+"_",{get:function(){return this.populate(r)},enumerable:!1,configurable:!1})}),u(this,"getDocumentPrototype",()=>e),e},t.getPrimaryOfDocumentData=function(e){return k(this.jsonSchema,e)},(0,nt.A)(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var e={};return Object.entries(this.jsonSchema.properties).filter(([,e])=>Object.prototype.hasOwnProperty.call(e,"default")).forEach(([t,r])=>e[t]=r.default),u(this,"defaultValues",e)}},{key:"hash",get:function(){return u(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function ot(e,t,r=!0){r&&je("preCreateRxSchema",e);var a=I(e);a=function(e){return o(e,!0)}(a),Ce.h.deepFreezeWhenDevMode(a);var n=new st(a,t);return je("createRxSchema",n),n}var ct=r(7708),ut=r(8146),ht=r(3356),lt=r(5520),dt=r(8609);function mt(e){var t=e.split("-"),r="RxDB";return t.forEach(e=>{r+=(0,D.Z2)(e)}),r+="Plugin",new Error("You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { "+r+" } from 'rxdb/plugins/"+e+"';\n            addRxPlugin("+r+");\n        ")}function ft(e){return e.documentData?e.documentData:e.previousDocumentData}function pt(e){switch(e.operation){case"INSERT":return{operation:e.operation,id:e.documentId,doc:e.documentData,previous:null};case"UPDATE":return{operation:e.operation,id:e.documentId,doc:Ce.h.deepFreezeWhenDevMode(e.documentData),previous:e.previousDocumentData?e.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:e.operation,id:e.documentId,doc:null,previous:e.previousDocumentData}}}var vt=new Map;function yt(e){return i(vt,e,()=>{for(var t=new Array(e.events.length),r=e.events,a=e.collectionName,n=e.isLocal,i=Ce.h.deepFreezeWhenDevMode,s=0;s<r.length;s++){var o=r[s];t[s]={documentId:o.documentId,collectionName:a,isLocal:n,operation:o.operation,documentData:i(o.documentData),previousDocumentData:i(o.previousDocumentData)}}return t})}var gt=function(){function e(e,t,r,a){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=e,this.primaryPath=t,this.preWrite=r,this.postWrite=a}var t=e.prototype;return t.addWrite=function(e,t){var r=e[this.primaryPath],a=i(this.queueByDocId,r,()=>[]);return new Promise((r,n)=>{var i={lastKnownDocumentState:e,modifier:t,resolve:r,reject:n};(0,ee.ZN)(a).push(i),this.triggerRun()})},t.triggerRun=async function(){if(!0!==this.isRunning&&0!==this.queueByDocId.size){this.isRunning=!0;var e=[],t=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(t.entries()).map(async([t,r])=>{var a,n,i,s=(a=r.map(e=>e.lastKnownDocumentState),n=a[0],i=Oe(n._rev),a.forEach(e=>{var t=Oe(e._rev);t>i&&(n=e,i=t)}),n),o=s;for(var u of r)try{o=await u.modifier(c(o))}catch(h){u.reject(h),u.reject=()=>{},u.resolve=()=>{}}try{await this.preWrite(o,s)}catch(h){return void r.forEach(e=>e.reject(h))}e.push({previous:s,document:o})}));var r=e.length>0?await this.storageInstance.bulkWrite(e,"incremental-write"):{error:[]};return await Promise.all(He(this.primaryPath,e,r).map(e=>{var r=e[this.primaryPath];this.postWrite(e),n(t,r).forEach(t=>t.resolve(e))})),r.error.forEach(e=>{var r=e.documentId,a=n(t,r),s=(0,w.sX)(e);if(s){var o=i(this.queueByDocId,r,()=>[]);a.reverse().forEach(e=>{e.lastKnownDocumentState=(0,ee.ZN)(s.documentInDb),(0,ee.ZN)(o).unshift(e)})}else{var c=(0,w.cg)(e);a.forEach(e=>e.reject(c))}}),this.isRunning=!1,this.triggerRun()}},e}();function wt(e){return async t=>{var r=function(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}(t);r._deleted=t._deleted;var a=await e(r),n=Object.assign({},a,{_meta:t._meta,_attachments:t._attachments,_rev:t._rev,_deleted:void 0!==a._deleted?a._deleted:t._deleted});return void 0===n._deleted&&(n._deleted=!1),n}}var bt={get primaryPath(){if(this.isInstanceOfRxDocument)return this.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){if(this.isInstanceOfRxDocument)return this._data._rev},get deleted$(){if(this.isInstanceOfRxDocument)return this.$.pipe((0,ct.T)(e=>e._data._deleted))},get deleted$$(){var e=this;return e.collection.database.getReactivityFactory().fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){if(this.isInstanceOfRxDocument)return this._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){var e=this.primary;return this.collection.eventBulks$.pipe((0,ut.p)(e=>!e.isLocal),(0,ct.T)(t=>t.events.find(t=>t.documentId===e)),(0,ut.p)(e=>!!e),(0,ct.T)(e=>ft((0,ee.ZN)(e))),(0,ht.Z)(this.collection._docCache.getLatestDocumentData(e)),(0,lt.F)((e,t)=>e._rev===t._rev),(0,ct.T)(e=>this.collection._docCache.getCachedRxDocument(e)),(0,dt.t)(ee.bz))},get $$(){var e=this;return e.collection.database.getReactivityFactory().fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(e){if(Ce.h.isDevMode()){if(e.includes(".item."))throw(0,w.Br)("DOC1",{path:e});if(e===this.primaryPath)throw(0,w.Br)("DOC2");if(this.collection.schema.finalFields.includes(e))throw(0,w.Br)("DOC3",{path:e});if(!x(this.collection.schema.jsonSchema,e))throw(0,w.Br)("DOC4",{path:e})}return this.$.pipe((0,ct.T)(t=>v(t,e)),(0,lt.F)())},get$$(e){var t=this.get$(e);return this.collection.database.getReactivityFactory().fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=x(this.collection.schema.jsonSchema,e),r=this.get(e);if(!r)return J.$A;if(!t)throw(0,w.Br)("DOC5",{path:e});if(!t.ref)throw(0,w.Br)("DOC6",{path:e,schemaObj:t});var a=this.collection.database.collections[t.ref];if(!a)throw(0,w.Br)("DOC7",{ref:t.ref,path:e,schemaObj:t});return"array"===t.type?a.findByIds(r).exec().then(e=>{var t=e.values();return Array.from(t)}):a.findOne(r).exec()},get(e){return _t(this,e)},toJSON(e=!1){if(e)return Ce.h.deepFreezeWhenDevMode(this._data);var t=s(this._data);return delete t._rev,delete t._attachments,delete t._deleted,delete t._meta,Ce.h.deepFreezeWhenDevMode(t)},toMutableJSON(e=!1){return c(this.toJSON(e))},update(e){throw mt("update")},incrementalUpdate(e){throw mt("update")},updateCRDT(e){throw mt("crdt")},putAttachment(){throw mt("attachments")},putAttachmentBase64(){throw mt("attachments")},getAttachment(){throw mt("attachments")},allAttachments(){throw mt("attachments")},get allAttachments$(){throw mt("attachments")},async modify(e,t){var r=this._data,a=await wt(e)(r);return this._saveData(a,r)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,wt(e)).then(e=>this.collection._docCache.getCachedRxDocument(e))},patch(e){var t=this._data,r=c(t);return Object.entries(e).forEach(([e,t])=>{r[e]=t}),this._saveData(r,t)},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([e,r])=>{t[e]=r}),t))},async _saveData(e,t){if(e=s(e),this._data._deleted)throw(0,w.Br)("DOC11",{id:this.primary,document:this});await xt(this.collection,e,t);var r=[{previous:t,document:e}],a=await this.collection.storageInstance.bulkWrite(r,"rx-document-save-data"),n=a.error[0];return Ae(this.collection,this.primary,e,n),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(He(this.collection.schema.primaryPath,r,a)[0])},async remove(){if(this.deleted)return Promise.reject((0,w.Br)("DOC13",{document:this,id:this.primary}));var e=await this.collection.bulkRemove([this]);if(e.error.length>0){var t=e.error[0];Ae(this.collection,this.primary,this._data,t)}return e.success[0]},incrementalRemove(){return this.incrementalModify(async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e)).then(async e=>(await this.collection._runHooks("post","remove",e._data,e),e))},close(){throw(0,w.Br)("DOC14")}};function Dt(e=bt){var t=function(e,t){this.collection=e,this._data=t,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}function xt(e,t,r){return t._meta=Object.assign({},r._meta,t._meta),Ce.h.isDevMode()&&e.schema.validateChange(r,t),e._runHooks("pre","save",t,r)}function _t(e,t){return i(e._propertyCache,t,()=>{var r=v(e._data,t);return"object"!=typeof r||null===r||Array.isArray(r)?Ce.h.deepFreezeWhenDevMode(r):new Proxy(s(r),{get(r,a){if("string"!=typeof a)return r[a];var n=a.charAt(a.length-1);if("$"===n){if(a.endsWith("$$")){var i=a.slice(0,-2);return e.get$$((0,D.L$)(t+"."+i))}var s=a.slice(0,-1);return e.get$((0,D.L$)(t+"."+s))}if("_"===n){var o=a.slice(0,-1);return e.populate((0,D.L$)(t+"."+o))}var c=r[a];return"number"==typeof c||"string"==typeof c||"boolean"==typeof c?c:_t(e,(0,D.L$)(t+"."+a))}})})}var kt=r(2198),It=r(4157),Et=r(2442),Rt=r(6114);function Ct(e,t){return t.sort&&0!==t.sort.length?t.sort.map(e=>Object.keys(e)[0]):[e]}var Ot=new WeakMap;function Pt(e,t){if(!e.collection.database.eventReduce)return{runFullQueryAgain:!0};for(var r=function(e){return i(Ot,e,()=>{var t=e.collection,r=we(t.storageInstance.schema,c(e.mangoQuery)),a=t.schema.primaryPath,n=be(t.schema.jsonSchema,r),i=De(t.schema.jsonSchema,r);return{primaryKey:e.collection.schema.primaryPath,skip:r.skip,limit:r.limit,sortFields:Ct(a,r),sortComparator:(t,r)=>{var a={docA:t,docB:r,rxQuery:e};return n(a.docA,a.docB)},queryMatcher:t=>i({doc:t,rxQuery:e}.doc)}})}(e),a=(0,ee.ZN)(e._result).docsData.slice(0),n=(0,ee.ZN)(e._result).docsDataMap,s=!1,o=[],u=0;u<t.length;u++){var h=pt(t[u]);h&&o.push(h)}var l=o.find(e=>{var t={queryParams:r,changeEvent:e,previousResults:a,keyDocumentMap:n},i=(0,Rt.kC)(t);return"runFullQueryAgain"===i||("doNothing"!==i?(s=!0,(0,Rt.Cs)(i,r,e,a,n),!1):void 0)});return l?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:a}}var St=function(){function e(){this._map=new Map}return e.prototype.getByQuery=function(e){var t=e.toString();return i(this._map,t,()=>e)},e}();function jt(e,t){t.uncached=!0;var r=t.toString();e._map.delete(r)}function Bt(e){return e.refCount$.observers.length}var $t,Nt,Mt=($t=100,Nt=3e4,(e,t)=>{if(!(t._map.size<$t)){var r=Z()-Nt,a=[],n=Array.from(t._map.values());for(var i of n)Bt(i)>0||(0===i._lastEnsureEqual&&i._creationTime<r?jt(t,i):a.push(i));var s=a.length-$t;s<=0||a.sort((e,t)=>e._lastEnsureEqual-t._lastEnsureEqual).slice(0,s).forEach(e=>jt(t,e))}}),At=new WeakSet;var qt=function(){function e(e,t,r){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry="function"==typeof FinalizationRegistry?new FinalizationRegistry(e=>{var t=e.docId,r=this.cacheItemByDocId.get(t);r&&(r[0].delete(e.revisionHeight+e.lwt+""),0===r[0].size&&this.cacheItemByDocId.delete(t))}):void 0,this.primaryPath=e,this.changes$=t,this.documentCreator=r,t.subscribe(e=>{this.tasks.add(()=>{for(var t=this.cacheItemByDocId,r=0;r<e.length;r++){var a=e[r],n=t.get(a.documentId);if(n){var i=a.documentData;i||(i=a.previousDocumentData),n[1]=i}}}),this.tasks.size<=1&&(0,J.vN)().then(()=>{this.processTasks()})})}var t=e.prototype;return t.processTasks=function(){0!==this.tasks.size&&(Array.from(this.tasks).forEach(e=>e()),this.tasks.clear())},t.getLatestDocumentData=function(e){return this.processTasks(),n(this.cacheItemByDocId,e)[1]},t.getLatestDocumentDataIfExists=function(e){this.processTasks();var t=this.cacheItemByDocId.get(e);if(t)return t[1]},(0,nt.A)(e,[{key:"getCachedRxDocuments",get:function(){return u(this,"getCachedRxDocuments",Tt(this))}},{key:"getCachedRxDocument",get:function(){var e=Tt(this);return u(this,"getCachedRxDocument",t=>e([t])[0])}}])}();function Tt(e){var t=e.primaryPath,r=e.cacheItemByDocId,a=e.registry,n=Ce.h.deepFreezeWhenDevMode,i=e.documentCreator;return s=>{for(var o=new Array(s.length),c=[],u=0;u<s.length;u++){var h=s[u],l=h[t],d=Oe(h._rev),m=void 0,f=void 0,p=r.get(l);p?f=(m=p[0]).get(d+h._meta.lwt+""):(p=[m=new Map,h],r.set(l,p));var v=f?f.deref():void 0;v||(h=n(h),v=i(h),m.set(d+h._meta.lwt+"",Qt(v)),a&&c.push(v)),o[u]=v}return c.length>0&&a&&(e.tasks.add(()=>{for(var e=0;e<c.length;e++){var t=c[e];a.register(t,{docId:t.primary,revisionHeight:Oe(t.revision),lwt:t._data._meta.lwt})}}),e.tasks.size<=1&&(0,J.vN)().then(()=>{e.processTasks()})),o}}function Lt(e,t){return(0,e.getCachedRxDocuments)(t)}var Qt="function"==typeof WeakRef?function(e){return new WeakRef(e)}:function(e){return{deref:()=>e}};var Ft=function(){function e(e,t,r){this.time=Z(),this.query=e,this.count=r,this.documents=Lt(this.query.collection._docCache,t)}return e.prototype.getValue=function(e){var t=this.query.op;if("count"===t)return this.count;if("findOne"===t){var r=0===this.documents.length?null:this.documents[0];if(!r&&e)throw(0,w.Br)("QU10",{collection:this.query.collection.name,query:this.query.mangoQuery,op:t});return r}return"findByIds"===t?this.docsMap:this.documents.slice(0)},(0,nt.A)(e,[{key:"docsData",get:function(){return u(this,"docsData",this.documents.map(e=>e._data))}},{key:"docsDataMap",get:function(){var e=new Map;return this.documents.forEach(t=>{e.set(t.primary,t._data)}),u(this,"docsDataMap",e)}},{key:"docsMap",get:function(){for(var e=new Map,t=this.documents,r=0;r<t.length;r++){var a=t[r];e.set(a.primary,a)}return u(this,"docsMap",e)}}])}(),Wt=0,Ht=function(){function e(e,t,r,a={}){this.id=++Wt,this._execOverDatabaseCount=0,this._creationTime=Z(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new kt.t(null),this._result=null,this._latestChangeEvent=-1,this._ensureEqualQueue=J.Dr,this.op=e,this.mangoQuery=t,this.collection=r,this.other=a,t||(this.mangoQuery={selector:{}}),this.isFindOneByIdQuery=function(e,t){if(!t.skip&&t.selector&&1===Object.keys(t.selector).length&&t.selector[e]){var r=t.selector[e];if("string"==typeof r)return r;if(1===Object.keys(r).length&&"string"==typeof r.$eq)return r.$eq;if(1===Object.keys(r).length&&Array.isArray(r.$eq)&&!r.$eq.find(e=>"string"!=typeof e))return r.$eq}return!1}(this.collection.schema.primaryPath,t)}var t=e.prototype;return t._setResultData=function(e){if(void 0===e)throw(0,w.Br)("QU18",{database:this.collection.database.name,collection:this.collection.name});if("number"!=typeof e){e instanceof Map&&(e=Array.from(e.values()));var t=new Ft(this,e,e.length);this._result=t}else this._result=new Ft(this,[],e)},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,"count"===this.op){var e=this.getPreparedQuery(),t=await this.collection.storageInstance.count(e);if("slow"!==t.mode||this.collection.database.allowSlowCount)return t.count;throw(0,w.Br)("QU14",{collection:this.collection,queryObj:this.mangoQuery})}if("findByIds"===this.op){var r=(0,ee.ZN)(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,a=new Map,n=[];if(r.forEach(e=>{var t=this.collection._docCache.getLatestDocumentDataIfExists(e);if(t){if(!t._deleted){var r=this.collection._docCache.getCachedRxDocument(t);a.set(e,r)}}else n.push(e)}),n.length>0)(await this.collection.storageInstance.findDocumentsById(n,!1)).forEach(e=>{var t=this.collection._docCache.getCachedRxDocument(e);a.set(t.primary,t)});return a}var i=async function(e){var t=[],r=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var a=e.isFindOneByIdQuery;if(a=a.filter(r=>{var a=e.collection._docCache.getLatestDocumentDataIfExists(r);return!a||(a._deleted||t.push(a),!1)}),a.length>0){var n=await r.storageInstance.findDocumentsById(a,!1);(0,g.Hb)(t,n)}}else{var i=e.isFindOneByIdQuery,s=e.collection._docCache.getLatestDocumentDataIfExists(i);if(!s){var o=await r.storageInstance.findDocumentsById([i],!1);o[0]&&(s=o[0])}s&&!s._deleted&&t.push(s)}else{var c=e.getPreparedQuery(),u=await r.storageInstance.query(c);t=u.documents}return t}(this);return i.then(e=>e)},t.exec=async function(e){if(e&&"findOne"!==this.op)throw(0,w.Br)("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return await Zt(this),(0,ee.ZN)(this._result).getValue(e)},t.toString=function(){var e=o({op:this.op,query:we(this.collection.schema.jsonSchema,this.mangoQuery),other:this.other},!0),t=JSON.stringify(e);return this.toString=()=>t,t},t.getPreparedQuery=function(){var e={rxQuery:this,mangoQuery:we(this.collection.schema.jsonSchema,this.mangoQuery)};e.mangoQuery.selector._deleted={$eq:!1},e.mangoQuery.index&&e.mangoQuery.index.unshift("_deleted"),je("prePrepareQuery",e);var t=_e(this.collection.schema.jsonSchema,e.mangoQuery);return this.getPreparedQuery=()=>t,t},t.doesDocumentDataMatch=function(e){return!e._deleted&&this.queryMatcher(e)},t.remove=async function(){var e=await this.exec();if(Array.isArray(e)){var t=await this.collection.bulkRemove(e);if(t.error.length>0)throw(0,w.cg)(t.error[0]);return t.success}return e.remove()},t.incrementalRemove=function(){return xe(this.asRxQuery,e=>e.incrementalRemove())},t.update=function(e){throw mt("update")},t.patch=function(e){return xe(this.asRxQuery,t=>t.patch(e))},t.incrementalPatch=function(e){return xe(this.asRxQuery,t=>t.incrementalPatch(e))},t.modify=function(e){return xe(this.asRxQuery,t=>t.modify(e))},t.incrementalModify=function(e){return xe(this.asRxQuery,t=>t.incrementalModify(e))},t.where=function(e){throw mt("query-builder")},t.sort=function(e){throw mt("query-builder")},t.skip=function(e){throw mt("query-builder")},t.limit=function(e){throw mt("query-builder")},(0,nt.A)(e,[{key:"$",get:function(){if(!this._$){var e=this.collection.eventBulks$.pipe((0,ut.p)(e=>!e.isLocal),(0,ht.Z)(null),(0,Et.Z)(()=>Zt(this)),(0,ct.T)(()=>this._result),(0,dt.t)(ee.bz),(0,lt.F)((e,t)=>!(!e||e.time!==(0,ee.ZN)(t).time)),(0,ut.p)(e=>!!e),(0,ct.T)(e=>(0,ee.ZN)(e).getValue()));this._$=(0,It.h)(e,this.refCount$.pipe((0,ut.p)(()=>!1)))}return this._$}},{key:"$$",get:function(){return this.collection.database.getReactivityFactory().fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){this.collection.schema.jsonSchema;return u(this,"queryMatcher",De(0,we(this.collection.schema.jsonSchema,this.mangoQuery)))}},{key:"asRxQuery",get:function(){return this}}])}();function Kt(e,t,r,a){je("preCreateRxQuery",{op:e,queryObj:t,collection:r,other:a});var n,i,s=new Ht(e,t,r,a);return s=(n=s).collection._queryCache.getByQuery(n),i=r,At.has(i)||(At.add(i),(0,J.dY)().then(()=>(0,J.Ve)(200)).then(()=>{i.closed||i.cacheReplacementPolicy(i,i._queryCache),At.delete(i)})),s}function zt(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}async function Zt(e){return e.collection.awaitBeforeReads.size>0&&await Promise.all(Array.from(e.collection.awaitBeforeReads).map(e=>e())),!e.collection.database.closed&&!zt(e)&&(e._ensureEqualQueue=e._ensureEqualQueue.then(()=>function(e){if(e._lastEnsureEqual=Z(),e.collection.database.closed||zt(e))return J.Dr;var t=!1,r=!1;-1===e._latestChangeEvent&&(r=!0);if(!r){var a=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(null===a)r=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var n=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(a);if("count"===e.op){var i=(0,ee.ZN)(e._result).count,s=i;n.forEach(t=>{var r=t.previousDocumentData&&e.doesDocumentDataMatch(t.previousDocumentData),a=e.doesDocumentDataMatch(t.documentData);!r&&a&&s++,r&&!a&&s--}),s!==i&&(t=!0,e._setResultData(s))}else{var o=Pt(e,n);o.runFullQueryAgain?r=!0:o.changed&&(t=!0,e._setResultData(o.newResults))}}}if(r)return e._execOverDatabase().then(r=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),"number"==typeof r?(e._result&&r===e._result.count||(t=!0,e._setResultData(r)),t):(e._result&&function(e,t,r){if(t.length!==r.length)return!1;for(var a=0,n=t.length;a<n;){var i=t[a],s=r[a];if(a++,i[e]!==s[e]||i._rev!==s._rev||i._meta.lwt!==s._meta.lwt)return!1}return!0}(e.collection.schema.primaryPath,r,e._result.docsData)||(t=!0,e._setResultData(r)),t)));return Promise.resolve(t)}(e)),e._ensureEqualQueue)}var Ut="collection",Vt="storage-token",Jt=I({version:0,title:"RxInternalDocument",primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[Ut,Vt,"rx-migration-status","rx-pipeline-checkpoint","OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function Xt(e,t){return k(Jt,{key:e,context:t})}async function Gt(e){var t=_e(e.schema,{selector:{context:Ut,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0});return(await e.query(t)).documents}var Yt="storageToken",er=Xt(Yt,Vt);function tr(e,t){return e+"-"+t.version}function rr(e,t){return t=function(e,t){for(var r=Object.keys(e.defaultValues),a=0;a<r.length;++a){var n=r[a];Object.prototype.hasOwnProperty.call(t,n)&&void 0!==t[n]||(t[n]=e.defaultValues[n])}return t}(e,t=s(t)),"string"!=typeof e.jsonSchema.primaryKey&&(t=function(e,t,r){if("string"==typeof t.primaryKey)return r;var a=k(t,r),n=r[e];if(n&&n!==a)throw(0,w.Br)("DOC19",{args:{documentData:r,existingPrimary:n,newPrimary:a},schema:t});return r[e]=a,r}(e.primaryPath,e.jsonSchema,t)),t._meta={lwt:1},Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=""),t}async function ar(e,t,r,a,n,i,s,o){var c=(await Gt(t)).filter(e=>e.data.name===n),u=[];c.forEach(e=>{u.push({collectionName:e.data.name,schema:e.data.schema,isCollection:!0}),e.data.connectedStorages.forEach(e=>u.push({collectionName:e.collectionName,isCollection:!1,schema:e.schema}))});var h=new Set;if(u=u.filter(e=>{var t=e.collectionName+"||"+e.schema.version;return!h.has(t)&&(h.add(t),!0)}),await Promise.all(u.map(async t=>{var o=await e.createStorageInstance({collectionName:t.collectionName,databaseInstanceToken:r,databaseName:a,multiInstance:i,options:{},schema:t.schema,password:s,devMode:Ce.h.isDevMode()});await o.remove(),t.isCollection&&await Be("postRemoveRxCollection",{storage:e,databaseName:a,collectionName:n})})),o){var l=c.map(e=>{var t=Le(e);return t._deleted=!0,t._meta.lwt=Z(),t._rev=Pe(r,e),{previous:e,document:t}});await t.bulkWrite(l,"rx-database-remove-collection-all")}}function nr(e){if(e.closed)throw(0,w.Br)("COL21",{collection:e.name,version:e.schema.version})}var ir=function(){function e(e){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=e,this.subs.push(this.collection.eventBulks$.pipe((0,ut.p)(e=>!e.isLocal)).subscribe(e=>{this.tasks.add(()=>this._handleChangeEvents(e.events)),this.tasks.size<=1&&(0,J.vN)().then(()=>{this.processTasks()})}))}var t=e.prototype;return t.processTasks=function(){0!==this.tasks.size&&(Array.from(this.tasks).forEach(e=>e()),this.tasks.clear())},t._handleChangeEvents=function(e){var t=this.counter;this.counter=this.counter+e.length,e.length>this.limit?this.buffer=e.slice(-1*e.length):((0,g.Hb)(this.buffer,e),this.buffer=this.buffer.slice(-1*this.limit));for(var r=t+1,a=this.eventCounterMap,n=0;n<e.length;n++){var i=e[n];a.set(i,r+n)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(e){this.processTasks();var t=this.buffer[0],r=this.eventCounterMap.get(t);return e<r?null:e-r},t.getFrom=function(e){this.processTasks();var t=[],r=this.getArrayIndexByPointer(e);if(null===r)return null;for(;;){var a=this.buffer[r];if(r++,!a)return t;t.push(a)}},t.runFrom=function(e,t){this.processTasks();var r=this.getFrom(e);if(null===r)throw new Error("out of bounds");r.forEach(e=>t(e))},t.reduceByLastOfDoc=function(e){return this.processTasks(),e.slice(0)},t.close=function(){this.tasks.clear(),this.subs.forEach(e=>e.unsubscribe())},e}();var sr=new WeakMap;function or(e){var t=e.schema.getDocumentPrototype(),r=function(e){var t={};return Object.entries(e.methods).forEach(([e,r])=>{t[e]=r}),t}(e),a={};return[t,r,bt].forEach(e=>{Object.getOwnPropertyNames(e).forEach(t=>{var r=Object.getOwnPropertyDescriptor(e,t),n=!0;(t.startsWith("_")||t.endsWith("_")||t.startsWith("$")||t.endsWith("$"))&&(n=!1),"function"==typeof r.value?Object.defineProperty(a,t,{get(){return r.value.bind(this)},enumerable:n,configurable:!1}):(r.enumerable=n,r.configurable=!1,r.writable&&(r.writable=!1),Object.defineProperty(a,t,r))})}),a}function cr(e,t,r){var a=function(e,t,r){var a=new e(t,r);return je("createRxDocument",a),a}(t,e,Ce.h.deepFreezeWhenDevMode(r));return e._runHooksSync("post","create",r,a),je("postCreateRxDocument",a),a}var ur={isEqual:(e,t,r)=>(e=hr(e),t=hr(t),(0,it.b)(Te(e),Te(t))),resolve:e=>e.realMasterState};function hr(e){return e._attachments||((e=s(e))._attachments={}),e}var lr=["pre","post"],dr=["insert","save","remove","create"],mr=!1,fr=new Set,pr=function(){function e(e,t,r,a,n={},i={},s={},o={},c={},u=Mt,h={},l=ur){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this.awaitBeforeReads=new Set,this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=new St,this.$={},this.checkpoint$={},this._changeEventBuffer={},this.eventBulks$={},this.onClose=[],this.closed=!1,this.onRemove=[],this.database=e,this.name=t,this.schema=r,this.internalStorageInstance=a,this.instanceCreationOptions=n,this.migrationStrategies=i,this.methods=s,this.attachments=o,this.options=c,this.cacheReplacementPolicy=u,this.statics=h,this.conflictHandler=l,function(e){if(mr)return;mr=!0;var t=Object.getPrototypeOf(e);dr.forEach(e=>{lr.map(r=>{var a=r+(0,D.Z2)(e);t[a]=function(t,a){return this.addHook(r,e,t,a)}})})}(this.asRxCollection),e&&(this.eventBulks$=e.eventBulks$.pipe((0,ut.p)(e=>e.collectionName===this.name))),this.database&&fr.add(this)}var t=e.prototype;return t.prepare=async function(){if(!await Y()){for(var e=0;e<10&&fr.size>16;)e++,await this.promiseWait(30);if(fr.size>16)throw(0,w.Br)("COL23",{database:this.database.name,collection:this.name,args:{existing:Array.from(fr.values()).map(e=>({db:e.database?e.database.name:"",c:e.name}))}})}var t,r;this.storageInstance=Qe(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new gt(this.storageInstance,this.schema.primaryPath,(e,t)=>xt(this,e,t),e=>this._runHooks("post","save",e)),this.$=this.eventBulks$.pipe((0,Et.Z)(e=>yt(e))),this.checkpoint$=this.eventBulks$.pipe((0,ct.T)(e=>e.checkpoint)),this._changeEventBuffer=(t=this.asRxCollection,new ir(t)),this._docCache=new qt(this.schema.primaryPath,this.eventBulks$.pipe((0,ut.p)(e=>!e.isLocal),(0,ct.T)(e=>e.events)),e=>{var t;return r||(t=this.asRxCollection,r=i(sr,t,()=>Dt(or(t)))),cr(this.asRxCollection,r,e)});var a=this.database.internalStore.changeStream().pipe((0,ut.p)(e=>{var t=this.name+"-"+this.schema.version;return!!e.events.find(e=>"collection"===e.documentData.context&&e.documentData.key===t&&"DELETE"===e.operation)})).subscribe(async()=>{await this.close(),await Promise.all(this.onRemove.map(e=>e()))});this._subs.push(a);var n=await this.database.storageToken,s=this.storageInstance.changeStream().subscribe(e=>{var t={id:e.id,isLocal:!1,internal:!1,collectionName:this.name,storageToken:n,events:e.events,databaseToken:this.database.token,checkpoint:e.checkpoint,context:e.context};this.database.$emit(t)});return this._subs.push(s),J.em},t.cleanup=function(e){throw nr(this),mt("cleanup")},t.migrationNeeded=function(){throw mt("migration-schema")},t.getMigrationState=function(){throw mt("migration-schema")},t.startMigration=function(e=10){return nr(this),this.getMigrationState().startMigration(e)},t.migratePromise=function(e=10){return this.getMigrationState().migratePromise(e)},t.insert=async function(e){nr(this);var t=await this.bulkInsert([e]),r=t.error[0];return Ae(this,e[this.schema.primaryPath],e,r),(0,ee.ZN)(t.success[0])},t.insertIfNotExists=async function(e){var t=await this.bulkInsert([e]);if(t.error.length>0){var r=t.error[0];if(409===r.status){var a=r.documentInDb;return Lt(this._docCache,[a])[0]}throw r}return t.success[0]},t.bulkInsert=async function(e){if(nr(this),0===e.length)return{success:[],error:[]};var t,r=this.schema.primaryPath,a=new Set;if(this.hasHooks("pre","insert"))t=await Promise.all(e.map(e=>{var t=rr(this.schema,e);return this._runHooks("pre","insert",t).then(()=>(a.add(t[r]),{document:t}))}));else{t=new Array(e.length);for(var n=this.schema,i=0;i<e.length;i++){var s=rr(n,e[i]);a.add(s[r]),t[i]={document:s}}}if(a.size!==e.length)throw(0,w.Br)("COL22",{collection:this.name,args:{documents:e}});var o,c=await this.storageInstance.bulkWrite(t,"rx-collection-bulk-insert"),u=this,h={get success(){if(!o){var e=He(u.schema.primaryPath,t,c);o=Lt(u._docCache,e)}return o},error:c.error};if(this.hasHooks("post","insert")){var l=new Map;t.forEach(e=>{var t=e.document;l.set(t[r],t)}),await Promise.all(h.success.map(e=>this._runHooks("post","insert",l.get(e.primary),e)))}return h},t.bulkRemove=async function(e){nr(this);var t,r=this.schema.primaryPath;if(0===e.length)return{success:[],error:[]};"string"==typeof e[0]?t=await this.findByIds(e).exec():(t=new Map,e.forEach(e=>t.set(e.primary,e)));var a=[],n=new Map;Array.from(t.values()).forEach(e=>{var t=e.toMutableJSON(!0);a.push(t),n.set(e.primary,t)}),await Promise.all(a.map(e=>{var r=e[this.schema.primaryPath];return this._runHooks("pre","remove",e,t.get(r))}));var i=a.map(e=>{var t=s(e);return t._deleted=!0,{previous:e,document:t}}),o=await this.storageInstance.bulkWrite(i,"rx-collection-bulk-remove"),c=He(this.schema.primaryPath,i,o),u=[],h=c.map(e=>{var t=e[r],a=this._docCache.getCachedRxDocument(e);return u.push(a),t});return await Promise.all(h.map(e=>this._runHooks("post","remove",n.get(e),t.get(e)))),{success:u,error:o.error}},t.bulkUpsert=async function(e){nr(this);var t=[],r=new Map;e.forEach(e=>{var a=rr(this.schema,e),n=a[this.schema.primaryPath];if(!n)throw(0,w.Br)("COL3",{primaryPath:this.schema.primaryPath,data:a,schema:this.schema.jsonSchema});r.set(n,a),t.push(a)});var a=await this.bulkInsert(t),i=a.success.slice(0),s=[];return await Promise.all(a.error.map(async e=>{if(409!==e.status)s.push(e);else{var t=e.documentId,a=n(r,t),o=(0,ee.ZN)(e.documentInDb),c=this._docCache.getCachedRxDocuments([o])[0],u=await c.incrementalModify(()=>a);i.push(u)}})),{error:s,success:i}},t.upsert=async function(e){nr(this);var t=await this.bulkUpsert([e]);return Ae(this.asRxCollection,e[this.schema.primaryPath],e,t.error[0]),t.success[0]},t.incrementalUpsert=function(e){nr(this);var t=rr(this.schema,e),r=t[this.schema.primaryPath];if(!r)throw(0,w.Br)("COL4",{data:e});var a=this._incrementalUpsertQueues.get(r);return a||(a=J.em),a=a.then(()=>function(e,t,r){var a=e._docCache.getLatestDocumentDataIfExists(t);if(a)return Promise.resolve({doc:e._docCache.getCachedRxDocuments([a])[0],inserted:!1});return e.findOne(t).exec().then(t=>t?{doc:t,inserted:!1}:e.insert(r).then(e=>({doc:e,inserted:!0})))}(this,r,t)).then(e=>e.inserted?e.doc:function(e,t){return e.incrementalModify(e=>t)}(e.doc,t)),this._incrementalUpsertQueues.set(r,a),a},t.find=function(e){return nr(this),je("prePrepareRxQuery",{op:"find",queryObj:e,collection:this}),e||(e={selector:{}}),Kt("find",e,this)},t.findOne=function(e){var t;if(nr(this),je("prePrepareRxQuery",{op:"findOne",queryObj:e,collection:this}),"string"==typeof e)t=Kt("findOne",{selector:{[this.schema.primaryPath]:e},limit:1},this);else{if(e||(e={selector:{}}),e.limit)throw(0,w.Br)("QU6");(e=s(e)).limit=1,t=Kt("findOne",e,this)}return t},t.count=function(e){return nr(this),e||(e={selector:{}}),Kt("count",e,this)},t.findByIds=function(e){return nr(this),Kt("findByIds",{selector:{[this.schema.primaryPath]:{$in:e.slice(0)}}},this)},t.exportJSON=function(){throw mt("json-dump")},t.importJSON=function(e){throw mt("json-dump")},t.insertCRDT=function(e){throw mt("crdt")},t.addPipeline=function(e){throw mt("pipeline")},t.addHook=function(e,t,r,a=!1){if("function"!=typeof r)throw(0,w.JX)("COL7",{key:t,when:e});if(!lr.includes(e))throw(0,w.JX)("COL8",{key:t,when:e});if(!dr.includes(t))throw(0,w.Br)("COL9",{key:t});if("post"===e&&"create"===t&&!0===a)throw(0,w.Br)("COL10",{when:e,key:t,parallel:a});var n=r.bind(this),i=a?"parallel":"series";this.hooks[t]=this.hooks[t]||{},this.hooks[t][e]=this.hooks[t][e]||{series:[],parallel:[]},this.hooks[t][e][i].push(n)},t.getHooks=function(e,t){return this.hooks[t]&&this.hooks[t][e]?this.hooks[t][e]:{series:[],parallel:[]}},t.hasHooks=function(e,t){if(!this.hooks[t]||!this.hooks[t][e])return!1;var r=this.getHooks(e,t);return!!r&&(r.series.length>0||r.parallel.length>0)},t._runHooks=function(e,t,r,a){var n=this.getHooks(e,t);if(!n)return J.em;var i=n.series.map(e=>()=>e(r,a));return(0,J.h$)(i).then(()=>Promise.all(n.parallel.map(e=>e(r,a))))},t._runHooksSync=function(e,t,r,a){if(this.hasHooks(e,t)){var n=this.getHooks(e,t);n&&n.series.forEach(e=>e(r,a))}},t.promiseWait=function(e){return new Promise(t=>{var r=setTimeout(()=>{this.timeouts.delete(r),t()},e);this.timeouts.add(r)})},t.close=async function(){return this.closed?J.Dr:(fr.delete(this),await Promise.all(this.onClose.map(e=>e())),this.closed=!0,Array.from(this.timeouts).forEach(e=>clearTimeout(e)),this._changeEventBuffer&&this._changeEventBuffer.close(),this.database.requestIdlePromise().then(()=>this.storageInstance.close()).then(()=>(this._subs.forEach(e=>e.unsubscribe()),delete this.database.collections[this.name],Be("postCloseRxCollection",this).then(()=>!0))))},t.remove=async function(){await this.close(),await Promise.all(this.onRemove.map(e=>e())),await ar(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.multiInstance,this.database.password,this.database.hashFunction)},(0,nt.A)(e,[{key:"insert$",get:function(){return this.$.pipe((0,ut.p)(e=>"INSERT"===e.operation))}},{key:"update$",get:function(){return this.$.pipe((0,ut.p)(e=>"UPDATE"===e.operation))}},{key:"remove$",get:function(){return this.$.pipe((0,ut.p)(e=>"DELETE"===e.operation))}},{key:"asRxCollection",get:function(){return this}}])}();var vr=r(7635),yr=r(5525),gr=new Set,wr=new Map,br=function(){function e(e,t,r,a,n,i,s=!1,o={},c,u,h,l,d,m){this.idleQueue=new vr.G,this.rxdbVersion=tt,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onClose=[],this.closed=!1,this.collections={},this.states={},this.eventBulks$=new K.B,this.closePromise=null,this.observable$=this.eventBulks$.pipe((0,Et.Z)(e=>yt(e))),this.storageToken=J.Dr,this.storageTokenDocument=J.Dr,this.emittedEventBulkIds=new yr.p4(6e4),this.name=e,this.token=t,this.storage=r,this.instanceCreationOptions=a,this.password=n,this.multiInstance=i,this.eventReduce=s,this.options=o,this.internalStore=c,this.hashFunction=u,this.cleanupPolicy=h,this.allowSlowCount=l,this.reactivity=d,this.onClosed=m,"pseudoInstance"!==this.name&&(this.internalStore=Qe(this.asRxDatabase,c,Jt),this.storageTokenDocument=async function(e){var t=(0,D.zs)(10),r=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,a=[{document:{id:er,context:Vt,key:Yt,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:r},_deleted:!1,_meta:{lwt:1},_rev:"",_attachments:{}}}],n=await e.internalStore.bulkWrite(a,"internal-add-storage-token");if(!n.error[0])return He("id",a,n)[0];var i=(0,ee.ZN)(n.error[0]);if(i.isError&&(0,w.sX)(i)){var s=i;if(!function(e,t){if(!e)return!1;var r=e.split(".")[0],a=t.split(".")[0];return"15"===r&&"16"===a||r===a}(s.documentInDb.data.rxdbVersion,e.rxdbVersion))throw(0,w.Br)("DM5",{args:{database:e.name,databaseStateVersion:s.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(r&&r!==s.documentInDb.data.passwordHash)throw(0,w.Br)("DB1",{passwordHash:r,existingPasswordHash:s.documentInDb.data.passwordHash});var o=s.documentInDb;return(0,ee.ZN)(o)}throw i}(this.asRxDatabase).catch(e=>this.startupErrors.push(e)),this.storageToken=this.storageTokenDocument.then(e=>e.data.token).catch(e=>this.startupErrors.push(e)))}var t=e.prototype;return t.getReactivityFactory=function(){if(!this.reactivity)throw(0,w.Br)("DB14",{database:this.name});return this.reactivity},t.$emit=function(e){this.emittedEventBulkIds.has(e.id)||(this.emittedEventBulkIds.add(e.id),this.eventBulks$.next(e))},t.removeCollectionDoc=async function(e,t){var r=await Ne(this.internalStore,Xt(tr(e,t),Ut));if(!r)throw(0,w.Br)("SNH",{name:e,schema:t});var a=Le(r);a._deleted=!0,await this.internalStore.bulkWrite([{document:a,previous:r}],"rx-database-remove-collection")},t.addCollections=async function(e){var t={},r={},a=[],n={};await Promise.all(Object.entries(e).map(async([e,i])=>{var o=e,c=i.schema;t[o]=c;var u=ot(c,this.hashFunction);if(r[o]=u,this.collections[e])throw(0,w.Br)("DB3",{name:e});var h=tr(e,c),l={id:Xt(h,Ut),key:h,context:Ut,data:{name:o,schemaHash:await u.hash,schema:u.jsonSchema,version:u.version,connectedStorages:[]},_deleted:!1,_meta:{lwt:1},_rev:"",_attachments:{}};a.push({document:l});var d=Object.assign({},i,{name:o,schema:u,database:this}),m=s(i);m.database=this,m.name=e,je("preCreateRxCollection",m),d.conflictHandler=m.conflictHandler,n[o]=d}));var i=await this.internalStore.bulkWrite(a,"rx-database-add-collection");await async function(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}(this),await Promise.all(i.error.map(async e=>{if(409!==e.status)throw(0,w.Br)("DB12",{database:this.name,writeError:e});var a=(0,ee.ZN)(e.documentInDb),n=a.data.name,i=r[n];if(a.data.schemaHash!==await i.hash)throw(0,w.Br)("DB6",{database:this.name,collection:n,previousSchemaHash:a.data.schemaHash,schemaHash:await i.hash,previousSchema:a.data.schema,schema:(0,ee.ZN)(t[n])})}));var o={};return await Promise.all(Object.keys(e).map(async e=>{var t=n[e],r=await async function({database:e,name:t,schema:r,instanceCreationOptions:a={},migrationStrategies:n={},autoMigrate:i=!0,statics:s={},methods:o={},attachments:c={},options:u={},localDocuments:h=!1,cacheReplacementPolicy:l=Mt,conflictHandler:d=ur}){var m={databaseInstanceToken:e.token,databaseName:e.name,collectionName:t,schema:r.jsonSchema,options:a,multiInstance:e.multiInstance,password:e.password,devMode:Ce.h.isDevMode()};je("preCreateRxStorageInstance",m);var f=await async function(e,t){return t.multiInstance=e.multiInstance,await e.storage.createStorageInstance(t)}(e,m),p=new pr(e,t,r,f,a,n,o,c,u,l,s,d);try{await p.prepare(),Object.entries(s).forEach(([e,t])=>{Object.defineProperty(p,e,{get:()=>t.bind(p)})}),je("createRxCollection",{collection:p,creator:{name:t,schema:r,storageInstance:f,instanceCreationOptions:a,migrationStrategies:n,methods:o,attachments:c,options:u,cacheReplacementPolicy:l,localDocuments:h,statics:s}}),i&&0!==p.schema.version&&await p.migratePromise()}catch(v){throw fr.delete(p),await f.close(),v}return p}(t);o[e]=r,this.collections[e]=r,this[e]||Object.defineProperty(this,e,{get:()=>this.collections[e]})})),o},t.lockedRun=function(e){return this.idleQueue.wrapCall(e)},t.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},t.exportJSON=function(e){throw mt("json-dump")},t.addState=function(e){throw mt("state")},t.importJSON=function(e){throw mt("json-dump")},t.backup=function(e){throw mt("backup")},t.leaderElector=function(){throw mt("leader-election")},t.isLeader=function(){throw mt("leader-election")},t.waitForLeadership=function(){throw mt("leader-election")},t.migrationStates=function(){throw mt("migration-schema")},t.close=function(){if(this.closePromise)return this.closePromise;var{promise:e,resolve:t}=Dr(),r=e=>{this.onClosed&&this.onClosed(),this.closed=!0,t(e)};return this.closePromise=e,(async()=>{if(await Be("preCloseRxDatabase",this),this.eventBulks$.complete(),this._subs.map(e=>e.unsubscribe()),"pseudoInstance"!==this.name)return this.requestIdlePromise().then(()=>Promise.all(this.onClose.map(e=>e()))).then(()=>Promise.all(Object.keys(this.collections).map(e=>this.collections[e]).map(e=>e.close()))).then(()=>this.internalStore.close()).then(()=>r(!0));r(!1)})(),e},t.remove=function(){return this.close().then(()=>async function(e,t,r=!0,a){var n=(0,D.zs)(10),i=await _r(n,t,e,{},r,a),s=await Gt(i),o=new Set;s.forEach(e=>o.add(e.data.name));var c=Array.from(o);return await Promise.all(c.map(s=>ar(t,i,n,e,s,r,a))),await Be("postRemoveRxDatabase",{databaseName:e,storage:t}),await i.remove(),c}(this.name,this.storage,this.multiInstance,this.password))},(0,nt.A)(e,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();function Dr(){var e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}function xr(e,t){return t.name+"|"+e}async function _r(e,t,r,a,n,i){return await t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:$e,schema:Jt,options:a,multiInstance:n,password:i,devMode:Ce.h.isDevMode()})}function kr({storage:e,instanceCreationOptions:t,name:r,password:a,multiInstance:n=!0,eventReduce:i=!0,ignoreDuplicate:s=!1,options:o={},cleanupPolicy:c,closeDuplicates:u=!1,allowSlowCount:h=!1,localDocuments:l=!1,hashFunction:d=V.V0,reactivity:m}){je("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:r,password:a,multiInstance:n,eventReduce:i,ignoreDuplicate:s,options:o,localDocuments:l});var f=xr(r,e),p=wr.get(f)||new Set,v=Dr(),y=Array.from(p),g=()=>{p.delete(v.promise),gr.delete(f)};return p.add(v.promise),wr.set(f,p),(async()=>{if(u&&await Promise.all(y.map(e=>e.catch(()=>null).then(e=>e&&e.close()))),s){if(!Ce.h.isDevMode())throw(0,w.Br)("DB9",{database:r})}else!function(e,t){if(gr.has(xr(e,t)))throw(0,w.Br)("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}(r,e);gr.add(f);var p=(0,D.zs)(10),v=await _r(p,e,r,t,n,a),b=new br(r,p,e,t,a,n,i,o,v,d,c,h,m,g);return await Be("createRxDatabase",{database:b,creator:{storage:e,instanceCreationOptions:t,name:r,password:a,multiInstance:n,eventReduce:i,ignoreDuplicate:s,options:o,localDocuments:l}}),b})().then(e=>{v.resolve(e)}).catch(e=>{v.reject(e),g()}),v.promise}var Ir={RxSchema:st.prototype,RxDocument:bt,RxQuery:Ht.prototype,RxCollection:pr.prototype,RxDatabase:br.prototype},Er=new Set,Rr=new Set;var Cr=r(1449),Or=function(e){function t(t,r,a){var n;return(n=e.call(this,null,r)||this).id=t,n.parent=a,n}return(0,Cr.A)(t,e),t}(Dt()),Pr={get isLocal(){return!0},get allAttachments$(){throw(0,w.Br)("LD1",{document:this})},get primaryPath(){return"id"},get primary(){return this.id},get $(){var e=n(Nr,this.parent),t=this.primary;return this.parent.eventBulks$.pipe((0,ut.p)(e=>!!e.isLocal),(0,ct.T)(e=>e.events.find(e=>e.documentId===t)),(0,ut.p)(e=>!!e),(0,ct.T)(e=>ft((0,ee.ZN)(e))),(0,ht.Z)(e.docCache.getLatestDocumentData(this.primary)),(0,lt.F)((e,t)=>e._rev===t._rev),(0,ct.T)(t=>e.docCache.getCachedRxDocument(t)),(0,dt.t)(ee.bz))},get $$(){var e=this,t=Br(e);return t.getReactivityFactory().fromObservable(e.$,e.getLatest()._data,t)},get deleted$$(){var e=this,t=Br(e);return t.getReactivityFactory().fromObservable(e.deleted$,e.getLatest().deleted,t)},getLatest(){var e=n(Nr,this.parent),t=e.docCache.getLatestDocumentData(this.primary);return e.docCache.getCachedRxDocument(t)},get(e){if(e="data."+e,this._data){if("string"!=typeof e)throw(0,w.JX)("LD2",{objPath:e});var t=v(this._data,e);return t=Ce.h.deepFreezeWhenDevMode(t)}},get$(e){if(e="data."+e,Ce.h.isDevMode()){if(e.includes(".item."))throw(0,w.Br)("LD3",{objPath:e});if(e===this.primaryPath)throw(0,w.Br)("LD4")}return this.$.pipe((0,ct.T)(e=>e._data),(0,ct.T)(t=>v(t,e)),(0,lt.F)())},get$$(e){var t=Br(this);return t.getReactivityFactory().fromObservable(this.get$(e),this.getLatest().get(e),t)},async incrementalModify(e){var t=await Ar(this.parent);return t.incrementalWriteQueue.addWrite(this._data,async t=>(t.data=await e(t.data,this),t)).then(e=>t.docCache.getCachedRxDocument(e))},incrementalPatch(e){return this.incrementalModify(t=>(Object.entries(e).forEach(([e,r])=>{t[e]=r}),t))},async _saveData(e){var t=await Ar(this.parent),r=this._data;e.id=this.id;var a=[{previous:r,document:e}];return t.storageInstance.bulkWrite(a,"local-document-save-data").then(t=>{if(t.error[0])throw t.error[0];var r=He(this.collection.schema.primaryPath,a,t)[0];(e=s(e))._rev=r._rev})},async remove(){var e=await Ar(this.parent),t=s(this._data);return t._deleted=!0,Me(e.storageInstance,{previous:this._data,document:t},"local-document-remove").then(t=>e.docCache.getCachedRxDocument(t))}},Sr=!1,jr=()=>{if(!Sr){Sr=!0;var e=bt;Object.getOwnPropertyNames(e).forEach(t=>{if(!Object.getOwnPropertyDescriptor(Pr,t)){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(Pr,t,r)}});["populate","update","putAttachment","putAttachmentBase64","getAttachment","allAttachments"].forEach(e=>Pr[e]=(e=>()=>{throw(0,w.Br)("LD6",{functionName:e})})(e))}};function Br(e){var t=e.parent;return t instanceof br?t:t.database}var $r=new WeakMap,Nr=new WeakMap;function Mr(e){var t=e.database?e.database:e,r=e.database?e.name:"",a=(async()=>{var a=await qr(t.token,t.storage,t.name,r,t.instanceCreationOptions,t.multiInstance);a=Qe(t,a,Fr);var n=new qt("id",t.eventBulks$.pipe((0,ut.p)(e=>{var t=!1;return(""===r&&!e.collectionName||""!==r&&e.collectionName===r)&&(t=!0),t&&e.isLocal}),(0,ct.T)(e=>e.events)),t=>function(e,t){jr();var r=new Or(e.id,e,t);return Object.setPrototypeOf(r,Pr),r.prototype=Pr,r}(t,e)),i=new gt(a,"id",()=>{},()=>{}),s=await t.storageToken,o=a.changeStream().subscribe(r=>{for(var a=new Array(r.events.length),n=r.events,i=e.database?e.name:void 0,o=0;o<n.length;o++){var c=n[o];a[o]={documentId:c.documentId,collectionName:i,isLocal:!0,operation:c.operation,documentData:Ce.h.deepFreezeWhenDevMode(c.documentData),previousDocumentData:Ce.h.deepFreezeWhenDevMode(c.previousDocumentData)}}var u={id:r.id,isLocal:!0,internal:!1,collectionName:e.database?e.name:void 0,storageToken:s,events:a,databaseToken:t.token,checkpoint:r.checkpoint,context:r.context};t.$emit(u)});e._subs.push(o);var c={database:t,parent:e,storageInstance:a,docCache:n,incrementalWriteQueue:i};return Nr.set(e,c),c})();$r.set(e,a)}function Ar(e){var t=$r.get(e);if(!t){var r=e.database?e.database:e,a=e.database?e.name:"";throw(0,w.Br)("LD8",{database:r.name,collection:a})}return t}function qr(e,t,r,a,n,i){return t.createStorageInstance({databaseInstanceToken:e,databaseName:r,collectionName:Qr(a),schema:Fr,options:n,multiInstance:i,devMode:Ce.h.isDevMode()})}function Tr(e){var t=$r.get(e);if(t)return $r.delete(e),t.then(e=>e.storageInstance.close())}async function Lr(e,t,r){var a=(0,D.zs)(10),n=await qr(a,e,t,r,{},!1);await n.remove()}function Qr(e){return"plugin-local-documents-"+e}var Fr=I({title:"RxLocalDocument",version:0,primaryKey:"id",type:"object",properties:{id:{type:"string",maxLength:128},data:{type:"object",additionalProperties:!0}},required:["id","data"]});async function Wr(e,t){var r=await Ar(this),a={id:e,data:t,_deleted:!1,_meta:{lwt:1},_rev:"",_attachments:{}};return Me(r.storageInstance,{document:a},"local-document-insert").then(e=>r.docCache.getCachedRxDocument(e))}function Hr(e,t){return this.getLocal(e).then(r=>r?r.incrementalModify(()=>t):this.insertLocal(e,t))}async function Kr(e){var t=await Ar(this),r=t.docCache,a=r.getLatestDocumentDataIfExists(e);return a?Promise.resolve(r.getCachedRxDocument(a)):Ne(t.storageInstance,e).then(e=>e?t.docCache.getCachedRxDocument(e):null)}function zr(e){return this.$.pipe((0,ht.Z)(null),(0,Et.Z)(async t=>t?{changeEvent:t}:{doc:await this.getLocal(e)}),(0,Et.Z)(async t=>{if(t.changeEvent){var r=t.changeEvent;return r.isLocal&&r.documentId===e?{use:!0,doc:await this.getLocal(e)}:{use:!1}}return{use:!0,doc:t.doc}}),(0,ut.p)(e=>e.use),(0,ct.T)(e=>e.doc))}var Zr={name:"local-documents",rxdb:!0,prototypes:{RxCollection:e=>{e.insertLocal=Wr,e.upsertLocal=Hr,e.getLocal=Kr,e.getLocal$=zr},RxDatabase:e=>{e.insertLocal=Wr,e.upsertLocal=Hr,e.getLocal=Kr,e.getLocal$=zr}},hooks:{createRxDatabase:{before:e=>{e.creator.localDocuments&&Mr(e.database)}},createRxCollection:{before:e=>{e.creator.localDocuments&&Mr(e.collection)}},preCloseRxDatabase:{after:e=>Tr(e)},postCloseRxCollection:{after:e=>Tr(e)},postRemoveRxDatabase:{after:e=>Lr(e.storage,e.databaseName,"")},postRemoveRxCollection:{after:e=>Lr(e.storage,e.databaseName,e.collectionName)}},overwritable:{}};let Ur;function Vr(){return"undefined"!=typeof window&&window.indexedDB}function Jr(){return Ur||(Ur=(async()=>{!function(e){if(je("preAddRxPlugin",{plugin:e,plugins:Er}),!Er.has(e)){if(Rr.has(e.name))throw(0,w.Br)("PL3",{name:e.name,plugin:e});if(Er.add(e),Rr.add(e.name),!e.rxdb)throw(0,w.JX)("PL1",{plugin:e});e.init&&e.init(),e.prototypes&&Object.entries(e.prototypes).forEach(([e,t])=>t(Ir[e])),e.overwritable&&Object.assign(Ce.h,e.overwritable),e.hooks&&Object.entries(e.hooks).forEach(([e,t])=>{t.after&&Se[e].push(t.after),t.before&&Se[e].unshift(t.before)})}}(Zr);return await kr({name:"rxdb-landing-v4",localDocuments:!0,storage:at()})})()),Ur}},1990:(e,t,r)=>{r.d(t,{Ks:()=>s,V0:()=>i});var a,n=r(8060);var i=async function(e){var t=(new TextEncoder).encode(e),r=await function(){if(a)return a;if("undefined"==typeof crypto||void 0===crypto.subtle||"function"!=typeof crypto.subtle.digest)throw(0,n.Br)("UT8",{args:{typeof_crypto:typeof crypto,typeof_crypto_subtle:typeof crypto?.subtle,typeof_crypto_subtle_digest:typeof crypto?.subtle?.digest}});return a=crypto.subtle.digest.bind(crypto.subtle)}()("SHA-256",t);return Array.prototype.map.call(new Uint8Array(r),e=>("00"+e.toString(16)).slice(-2)).join("")};function s(e){for(var t=0,r=e.length,a=0;a<r;a++)t+=e.charCodeAt(a),t|=0;return t}},7587:(e,t,r)=>{r.d(t,{L$:()=>s,Z2:()=>i,zs:()=>n});var a="abcdefghijklmnopqrstuvwxyz";function n(e=10){for(var t="",r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*a.length));return t}function i(e){return(e+="").charAt(0).toUpperCase()+e.substr(1)}function s(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}},8060:(e,t,r)=>{r.d(t,{Br:()=>d,JX:()=>m,cg:()=>v,sX:()=>f});var a=r(3836),n=r(1449),i=r(6343),s=r(167);function o(e,t,r){return"\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="-".repeat(20)+"\n",t+="Parameters:\n",t+=Object.keys(e).map(t=>{var r="[object Object]";try{r="errors"===t?e[t].map(e=>JSON.stringify(e,Object.getOwnPropertyNames(e))):JSON.stringify(e[t],function(e,t){return void 0===t?null:t},2)}catch(a){}return t+": "+r}).join("\n"),t+="\n")}(r)}var c=function(e){function t(t,r,a={}){var n,i=o(r,0,a);return(n=e.call(this,i)||this).code=t,n.message=i,n.url=h(t),n.parameters=a,n.rxdb=!0,n}return(0,n.A)(t,e),t.prototype.toString=function(){return this.message},(0,a.A)(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}((0,i.A)(Error)),u=function(e){function t(t,r,a={}){var n,i=o(r,0,a);return(n=e.call(this,i)||this).code=t,n.message=i,n.url=h(t),n.parameters=a,n.rxdb=!0,n}return(0,n.A)(t,e),t.prototype.toString=function(){return this.message},(0,a.A)(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])}((0,i.A)(TypeError));function h(e){return"https://rxdb.info/errors.html?console=errors#"+e}function l(e){return"\nFind out more about this error here: "+h(e)+" \n"}function d(e,t){return new c(e,s.h.tunnelErrorMessage(e)+l(e),t)}function m(e,t){return new u(e,s.h.tunnelErrorMessage(e)+l(e),t)}function f(e){return!(!e||409!==e.status)&&e}var p={409:"document write conflict",422:"schema validation error",510:"attachment data missing"};function v(e){return d("COL20",{name:p[e.status],document:e.documentId,writeError:e})}},8289:(e,t,r)=>{function a(){return new Promise(e=>setTimeout(e,0))}function n(e=0){return new Promise(t=>setTimeout(t,e))}r.d(t,{$A:()=>s,Dr:()=>i,ND:()=>n,Ve:()=>h,dY:()=>a,em:()=>o,h$:()=>l,vN:()=>c});Promise.resolve(!0);var i=Promise.resolve(!1),s=Promise.resolve(null),o=Promise.resolve();function c(e=1e4){return"function"==typeof requestIdleCallback?new Promise(t=>{requestIdleCallback(()=>t(),{timeout:e})}):n(0)}var u=o;function h(e=void 0){return u=u.then(()=>c(e))}function l(e,t){return e.reduce((e,t)=>e.then(t),Promise.resolve(t))}}}]);