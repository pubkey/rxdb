"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[9548],{7014(e,s,r){r.r(s),r.d(s,{assets:()=>l,contentTitle:()=>t,default:()=>d,frontMatter:()=>i,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"rx-storage-pouchdb","title":"PouchDB RxStorage - Migrate for Better Performance","description":"Discover why PouchDB RxStorage is deprecated in RxDB. Learn its legacy, performance drawbacks, and how to upgrade to a faster solution.","source":"@site/docs/rx-storage-pouchdb.md","sourceDirName":".","slug":"/rx-storage-pouchdb.html","permalink":"/rx-storage-pouchdb.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"PouchDB RxStorage - Migrate for Better Performance","slug":"rx-storage-pouchdb.html","description":"Discover why PouchDB RxStorage is deprecated in RxDB. Learn its legacy, performance drawbacks, and how to upgrade to a faster solution."}}');var o=r(4848),a=r(8453);const i={title:"PouchDB RxStorage - Migrate for Better Performance",slug:"rx-storage-pouchdb.html",description:"Discover why PouchDB RxStorage is deprecated in RxDB. Learn its legacy, performance drawbacks, and how to upgrade to a faster solution."},t="RxStorage PouchDB",l={},h=[{value:"Why is the PouchDB RxStorage deprecated?",id:"why-is-the-pouchdb-rxstorage-deprecated",level:2},{value:"Pros",id:"pros",level:2},{value:"Cons",id:"cons",level:2},{value:"Usage",id:"usage",level:2},{value:"Polyfill the <code>global</code> variable",id:"polyfill-the-global-variable",level:2},{value:"Adapters",id:"adapters",level:2},{value:"Using the internal PouchDB Database",id:"using-the-internal-pouchdb-database",level:2}];function c(e){const s={a:"a",admonition:"admonition",code:"code",figure:"figure",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"rxstorage-pouchdb",children:"RxStorage PouchDB"})}),"\n",(0,o.jsxs)(s.p,{children:["The PouchDB RxStorage is based on the ",(0,o.jsx)(s.a,{href:"https://github.com/pouchdb/pouchdb",children:"PouchDB"})," database. It is the most battle proven RxStorage and has a big ecosystem of adapters. PouchDB does a lot of overhead to enable CouchDB replication which makes the PouchDB RxStorage one of the slowest."]}),"\n",(0,o.jsx)(s.admonition,{type:"warning",children:(0,o.jsxs)(s.p,{children:["The PouchDB RxStorage is removed from RxDB and can no longer be used in new projects. You should switch to a different ",(0,o.jsx)(s.a,{href:"/rx-storage.html",children:"RxStorage"}),"."]})}),"\n",(0,o.jsx)(s.h2,{id:"why-is-the-pouchdb-rxstorage-deprecated",children:"Why is the PouchDB RxStorage deprecated?"}),"\n",(0,o.jsxs)(s.p,{children:["When I started developing RxDB in 2016, I had a specific use case to solve.\nBecause there was no client-side database out there that fitted, I created\nRxDB as a wrapper around PouchDB. This worked great and all the PouchDB features\nlike the query engine, the adapter system, CouchDB-replication and so on, came for free.\nBut over the years, it became clear that PouchDB is not suitable for many applications,\nmostly because of its performance: To be compliant to CouchDB, PouchDB has to store all\nrevision trees of documents which slows down queries. Also purging these document revisions ",(0,o.jsx)(s.a,{href:"https://github.com/pouchdb/pouchdb/issues/802",children:"is not possible"}),"\nso the database storage size will only increase over time.\nAnother problem was that many issues in PouchDB have never been fixed, but only closed by the issue-bot like ",(0,o.jsx)(s.a,{href:"https://github.com/pouchdb/pouchdb/issues/6454",children:"this one"}),". The whole PouchDB RxStorage code was full of ",(0,o.jsx)(s.a,{href:"https://github.com/pubkey/rxdb/blob/285c3cf6008b3cc83bd9b9946118a621434f0cff/src/plugins/pouchdb/pouch-statics.ts#L181",children:"workarounds and monkey patches"})," to resolve\nthese issues for RxDB users. Many these patches decreased performance even further. Sometimes it was not possible to fix things from the outside, for example queries with ",(0,o.jsx)(s.code,{children:"$gt"})," operators return ",(0,o.jsx)(s.a,{href:"https://github.com/pouchdb/pouchdb/pull/8471",children:"the wrong documents"})," which is a no-go for a production database\nand hard to debug."]}),"\n",(0,o.jsxs)(s.p,{children:["In version ",(0,o.jsx)(s.a,{href:"/releases/10.0.0.html",children:"10.0.0"})," RxDB introduced the ",(0,o.jsx)(s.a,{href:"/rx-storage.html",children:"RxStorage"})," layer which\nallows users to swap out the underlying storage engine where RxDB stores and queries documents from.\nThis allowed to use alternatives from PouchDB, for example the ",(0,o.jsx)(s.a,{href:"/rx-storage-indexeddb.html",children:"IndexedDB RxStorage"})," in browsers\nor even the ",(0,o.jsx)(s.a,{href:"/rx-storage-foundationdb.html",children:"FoundationDB RxStorage"})," on the server side.\nThere where not many use cases left where it was a good choice to use the PouchDB RxStorage. Only replicating with a\nCouchDB server, was only possible with PouchDB. But this has also changed. RxDB has ",(0,o.jsx)(s.a,{href:"/replication-couchdb.html",children:"a plugin"})," that allows\nto replicate clients with any CouchDB server by using the ",(0,o.jsx)(s.a,{href:"/replication.html",children:"RxDB Sync Engine"}),". This plugins work with any RxStorage so that it is not necessary to use the PouchDB storage.\nRemoving PouchDB allows RxDB to add many awaited features like filtered change streams for easier replication and permission handling. It will also free up development time."]}),"\n",(0,o.jsx)(s.p,{children:"If you are currently using the PouchDB RxStorage, you have these options:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["Migrate to another ",(0,o.jsx)(s.a,{href:"/rx-storage.html",children:"RxStorage"})," (recommended)"]}),"\n",(0,o.jsx)(s.li,{children:"Never update RxDB to the next major version (stay on older 14.0.0)"}),"\n",(0,o.jsxs)(s.li,{children:["Fork the ",(0,o.jsx)(s.a,{href:"/rx-storage-pouchdb.html",children:"PouchDB RxStorage"})," and maintain the plugin by yourself."]}),"\n",(0,o.jsxs)(s.li,{children:["Fix all the ",(0,o.jsx)(s.a,{href:"https://github.com/pouchdb/pouchdb/issues?q=author%3Apubkey",children:"PouchDB problems"})," so that we can add PouchDB to the RxDB Core again."]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"pros",children:"Pros"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Most battle proven RxStorage"}),"\n",(0,o.jsx)(s.li,{children:"Supports replication with a CouchDB endpoint"}),"\n",(0,o.jsxs)(s.li,{children:["Support storing ",(0,o.jsx)(s.a,{href:"/rx-attachment.html",children:"attachments"})]}),"\n",(0,o.jsx)(s.li,{children:"Big ecosystem of adapters"}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"cons",children:"Cons"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:"Big bundle size"}),"\n",(0,o.jsx)(s.li,{children:"Slow performance because of revision handling overhead"}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(s.figure,{"data-rehype-pretty-code-figure":"",children:(0,o.jsx)(s.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,o.jsxs)(s.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" { createRxDatabase } "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" { getRxStoragePouch"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" addPouchPlugin } "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb/plugins/pouchdb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:" "}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"addPouchPlugin"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"require"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'pouchdb-adapter-idb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"));"})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:" "}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" db"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" createRxDatabase"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    name"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'exampledb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    storage"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" getRxStoragePouch"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"("})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"        'idb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        {"})}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"            /**"})}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"             * other pouchdb specific options"})}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"             * "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@link"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" https://pouchdb.com/api.html#create_database"})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"             */"})}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"        }"})}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    )"})}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,o.jsxs)(s.h2,{id:"polyfill-the-global-variable",children:["Polyfill the ",(0,o.jsx)(s.code,{children:"global"})," variable"]}),"\n",(0,o.jsxs)(s.p,{children:["When you use RxDB with ",(0,o.jsx)(s.strong,{children:"angular"})," or other ",(0,o.jsx)(s.strong,{children:"webpack"})," based frameworks, you might get the error:"]}),"\n",(0,o.jsx)(s.figure,{"data-rehype-pretty-code-figure":"",children:(0,o.jsx)(s.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"html","data-theme":"css-variables",children:(0,o.jsx)(s.code,{"data-language":"html","data-theme":"css-variables",style:{display:"grid"},children:(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"<"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"span"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" style"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:'"color: red;"'}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">Uncaught ReferenceError: global is not defined</"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"span"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:">"})]})})})}),"\n",(0,o.jsxs)(s.p,{children:["This is because pouchdb assumes a nodejs-specific ",(0,o.jsx)(s.code,{children:"global"})," variable that is not added to browser runtimes by some bundlers.\nYou have to add them by your own, like we do ",(0,o.jsx)(s.a,{href:"https://github.com/pubkey/rxdb/blob/master/examples/angular/src/polyfills.ts",children:"here"}),"."]}),"\n",(0,o.jsx)(s.figure,{"data-rehype-pretty-code-figure":"",children:(0,o.jsx)(s.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,o.jsxs)(s.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(window "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" any"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:").global "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" window;"})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(window "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"as"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" any"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:").process "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    env"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" { DEBUG"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" undefined"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" }"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"};"})})]})})}),"\n",(0,o.jsx)(s.h2,{id:"adapters",children:"Adapters"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.a,{href:"/adapters.html",children:"PouchDB has many adapters for all JavaScript runtimes"}),"."]}),"\n",(0,o.jsx)(s.h2,{id:"using-the-internal-pouchdb-database",children:"Using the internal PouchDB Database"}),"\n",(0,o.jsx)(s.p,{children:"For custom operations, you can access the internal PouchDB database.\nThis is dangerous because you might do changes that are not compatible with RxDB.\nOnly use this when there is no way to achieve your goals via the RxDB API."}),"\n",(0,o.jsx)(s.figure,{"data-rehype-pretty-code-figure":"",children:(0,o.jsx)(s.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"javascript","data-theme":"css-variables",children:(0,o.jsxs)(s.code,{"data-language":"javascript","data-theme":"css-variables",style:{display:"grid"},children:[(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"    getPouchDBOfRxCollection"})}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb/plugins/pouchdb'"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,o.jsx)(s.span,{"data-line":"",children:" "}),"\n",(0,o.jsxs)(s.span,{"data-line":"",children:[(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:" pouch"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:" getPouchDBOfRxCollection"}),(0,o.jsx)(s.span,{style:{color:"var(--shiki-foreground)"},children:"(myRxCollection);"})]})]})})})]})}function d(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,s,r){r.d(s,{R:()=>i,x:()=>t});var n=r(6540);const o={},a=n.createContext(o);function i(e){const s=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(a.Provider,{value:s},e.children)}}}]);