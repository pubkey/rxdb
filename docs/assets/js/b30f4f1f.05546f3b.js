"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[3779],{8305:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>i,default:()=>d,frontMatter:()=>h,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"rx-attachment","title":"Attachments","description":"Learn how to store and manage binary data like images or files in RxDB using attachments. Discover features, performance benefits, encryption, compression, and usage examples with code.","source":"@site/docs/rx-attachment.md","sourceDirName":".","slug":"/rx-attachment.html","permalink":"/rx-attachment.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Attachments","slug":"rx-attachment.html","description":"Learn how to store and manage binary data like images or files in RxDB using attachments. Discover features, performance benefits, encryption, compression, and usage examples with code."},"sidebar":"tutorialSidebar","previous":{"title":"Storage Migration","permalink":"/migration-storage.html"},"next":{"title":"RxPipelines","permalink":"/rx-pipeline.html"}}');var s=n(4848),c=n(8453);const h={title:"Attachments",slug:"rx-attachment.html",description:"Learn how to store and manage binary data like images or files in RxDB using attachments. Discover features, performance benefits, encryption, compression, and usage examples with code."},i="Attachments",r={},o=[{value:"Add the attachments plugin",id:"add-the-attachments-plugin",level:2},{value:"Enable attachments in the schema",id:"enable-attachments-in-the-schema",level:2},{value:"putAttachment()",id:"putattachment",level:2},{value:"putAttachmentBase64()",id:"putattachmentbase64",level:2},{value:"getAttachment()",id:"getattachment",level:2},{value:"allAttachments()",id:"allattachments",level:2},{value:"allAttachments$",id:"allattachments-1",level:2},{value:"RxAttachment",id:"rxattachment",level:2},{value:"doc",id:"doc",level:3},{value:"id",id:"id",level:3},{value:"type",id:"type",level:3},{value:"length",id:"length",level:3},{value:"digest",id:"digest",level:3},{value:"rev",id:"rev",level:3},{value:"remove()",id:"remove",level:3},{value:"getData()",id:"getdata",level:2},{value:"getDataBase64()",id:"getdatabase64",level:2},{value:"getStringData()",id:"getstringdata",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"attachments",children:"Attachments"})}),"\n",(0,s.jsxs)(t.p,{children:["Attachments are binary data files that can be attachment to an ",(0,s.jsx)(t.code,{children:"RxDocument"}),", like a file that is attached to an email."]}),"\n",(0,s.jsxs)(t.p,{children:["Using attachments instead of adding the data to the normal document, ensures that you still have a good ",(0,s.jsx)(t.strong,{children:"performance"})," when querying and writing documents, even when a big amount of data, like an image file has to be stored."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"You can store string, binary files, images and whatever you want side by side with your documents."}),"\n",(0,s.jsx)(t.li,{children:"Deleted documents automatically loose all their attachments data."}),"\n",(0,s.jsx)(t.li,{children:"Not all replication plugins support the replication of attachments."}),"\n",(0,s.jsxs)(t.li,{children:["Attachments can be stored ",(0,s.jsx)(t.a,{href:"/encryption.html",children:"encrypted"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Internally, attachments in RxDB are stored and handled similar to how ",(0,s.jsx)(t.a,{href:"https://pouchdb.com/guides/attachments.html#how-attachments-are-stored",children:"CouchDB, PouchDB"})," does it."]}),"\n",(0,s.jsx)(t.h2,{id:"add-the-attachments-plugin",children:"Add the attachments plugin"}),"\n",(0,s.jsxs)(t.p,{children:["To enable the attachments, you have to add the ",(0,s.jsx)(t.code,{children:"attachments"})," plugin."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { addRxPlugin } from 'rxdb';\nimport { RxDBAttachmentsPlugin } from 'rxdb/plugins/attachments';\naddRxPlugin(RxDBAttachmentsPlugin);\n"})}),"\n",(0,s.jsx)(t.h2,{id:"enable-attachments-in-the-schema",children:"Enable attachments in the schema"}),"\n",(0,s.jsxs)(t.p,{children:["Before you can use attachments, you have to ensure that the attachments-object is set in the schema of your ",(0,s.jsx)(t.code,{children:"RxCollection"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"\nconst mySchema = {\n    version: 0,\n    type: 'object',\n    properties: {\n        // .\n        // .\n        // .\n    },\n    attachments: {\n        encrypted: true // if true, the attachment-data will be encrypted with the db-password\n    }\n};\n\nconst myCollection = await myDatabase.addCollections({\n    humans: {\n        schema: mySchema\n    }\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"putattachment",children:"putAttachment()"}),"\n",(0,s.jsxs)(t.p,{children:["Adds an attachment to a ",(0,s.jsx)(t.code,{children:"RxDocument"}),". Returns a Promise with the new attachment."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"import { createBlob } from 'rxdb';\n\nconst attachment = await myDocument.putAttachment(\n    {\n        id: 'cat.txt',     // (string) name of the attachment\n        data: createBlob('meowmeow', 'text/plain'),   // (string|Blob) data of the attachment\n        type: 'text/plain'    // (string) type of the attachment-data like 'image/jpeg'\n    }\n);\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["Expo/React-Native does not support the ",(0,s.jsx)(t.code,{children:"Blob"})," API natively. Make sure you use your own polyfill that properly supports ",(0,s.jsx)(t.code,{children:"blob.arrayBuffer()"})," when using RxAttachments or use the ",(0,s.jsx)(t.code,{children:"putAttachmentBase64()"})," and ",(0,s.jsx)(t.code,{children:"getDataBase64()"})," so that you do not have to create blobs."]})}),"\n",(0,s.jsx)(t.h2,{id:"putattachmentbase64",children:"putAttachmentBase64()"}),"\n",(0,s.jsxs)(t.p,{children:["Same as ",(0,s.jsx)(t.code,{children:"putAttachment()"})," but accepts a plain base64 string instead of a ",(0,s.jsx)(t.code,{children:"Blob"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"const attachment = await doc.putAttachmentBase64({\n    id: 'cat.txt',\n    length: 4,\n    data: 'bWVvdw==',\n    type: 'text/plain'\n});\n"})}),"\n",(0,s.jsx)(t.h2,{id:"getattachment",children:"getAttachment()"}),"\n",(0,s.jsxs)(t.p,{children:["Returns an ",(0,s.jsx)(t.code,{children:"RxAttachment"})," by its id. Returns ",(0,s.jsx)(t.code,{children:"null"})," when the attachment does not exist."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachment = myDocument.getAttachment('cat.jpg');\n"})}),"\n",(0,s.jsx)(t.h2,{id:"allattachments",children:"allAttachments()"}),"\n",(0,s.jsxs)(t.p,{children:["Returns an array of all attachments of the ",(0,s.jsx)(t.code,{children:"RxDocument"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachments = myDocument.allAttachments();\n"})}),"\n",(0,s.jsx)(t.h2,{id:"allattachments-1",children:"allAttachments$"}),"\n",(0,s.jsx)(t.p,{children:"Gets an Observable which emits a stream of all attachments from the document. Re-emits each time an attachment gets added or removed from the RxDocument."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const all = [];\nmyDocument.allAttachments$.subscribe(\n    attachments => all = attachments\n);\n"})}),"\n",(0,s.jsx)(t.h2,{id:"rxattachment",children:"RxAttachment"}),"\n",(0,s.jsxs)(t.p,{children:["The attachments of RxDB are represented by the type ",(0,s.jsx)(t.code,{children:"RxAttachment"})," which has the following attributes/methods."]}),"\n",(0,s.jsx)(t.h3,{id:"doc",children:"doc"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"RxDocument"})," which the attachment is assigned to."]}),"\n",(0,s.jsx)(t.h3,{id:"id",children:"id"}),"\n",(0,s.jsxs)(t.p,{children:["The id as ",(0,s.jsx)(t.code,{children:"string"})," of the attachment."]}),"\n",(0,s.jsx)(t.h3,{id:"type",children:"type"}),"\n",(0,s.jsxs)(t.p,{children:["The type as ",(0,s.jsx)(t.code,{children:"string"})," of the attachment."]}),"\n",(0,s.jsx)(t.h3,{id:"length",children:"length"}),"\n",(0,s.jsxs)(t.p,{children:["The length of the data of the attachment as ",(0,s.jsx)(t.code,{children:"number"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"digest",children:"digest"}),"\n",(0,s.jsxs)(t.p,{children:["The hash of the attachments data as ",(0,s.jsx)(t.code,{children:"string"}),"."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"The digest is NOT calculated by RxDB, instead it is calculated by the RxStorage. The only guarantee is that the digest will change when the attachments data changes."})}),"\n",(0,s.jsx)(t.h3,{id:"rev",children:"rev"}),"\n",(0,s.jsxs)(t.p,{children:["The revision-number of the attachment as ",(0,s.jsx)(t.code,{children:"number"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"remove",children:"remove()"}),"\n",(0,s.jsx)(t.p,{children:"Removes the attachment. Returns a Promise that resolves when done."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachment = myDocument.getAttachment('cat.jpg');\nawait attachment.remove();\n"})}),"\n",(0,s.jsx)(t.h2,{id:"getdata",children:"getData()"}),"\n",(0,s.jsxs)(t.p,{children:["Returns a Promise which resolves the attachment's data as ",(0,s.jsx)(t.code,{children:"Blob"}),". (async)"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachment = myDocument.getAttachment('cat.jpg');\nconst blob = await attachment.getData(); // Blob\n"})}),"\n",(0,s.jsx)(t.h2,{id:"getdatabase64",children:"getDataBase64()"}),"\n",(0,s.jsxs)(t.p,{children:["Returns a Promise which resolves the attachment's data as ",(0,s.jsx)(t.strong,{children:"base64"})," ",(0,s.jsx)(t.code,{children:"string"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachment = myDocument.getAttachment('cat.jpg');\nconst base64Database = await attachment.getDataBase64(); // 'bWVvdw=='\n"})}),"\n",(0,s.jsx)(t.h2,{id:"getstringdata",children:"getStringData()"}),"\n",(0,s.jsxs)(t.p,{children:["Returns a Promise which resolves the attachment's data as ",(0,s.jsx)(t.code,{children:"string"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:"const attachment = await myDocument.getAttachment('cat.jpg');\nconst data = await attachment.getStringData(); // 'meow'\n"})}),"\n",(0,s.jsx)(t.h1,{id:"attachment-compression",children:"Attachment compression"}),"\n",(0,s.jsxs)(t.p,{children:["Storing many attachments can be a problem when the disc space of the device is exceeded.\nTherefore it can make sense to compress the attachments before storing them in the ",(0,s.jsx)(t.a,{href:"/rx-storage.html",children:"RxStorage"}),".\nWith the ",(0,s.jsx)(t.code,{children:"attachments-compression"})," plugin you can compress the attachments data on write and decompress it on reads.\nThis happens internally and will now change on how you use the api. The compression is run with the ",(0,s.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Compression_Streams_API",children:"Compression Streams API"})," which is only supported on ",(0,s.jsx)(t.a,{href:"https://caniuse.com/?search=compressionstream",children:"newer browsers"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import {\n    wrappedAttachmentsCompressionStorage\n} from 'rxdb/plugins/attachments-compression';\n\nimport { getRxStorageIndexedDB } from 'rxdb-premium/plugins/storage-indexeddb';\n\n// create a wrapped storage with attachment-compression.\nconst storageWithAttachmentsCompression = wrappedAttachmentsCompressionStorage({\n    storage: getRxStorageIndexedDB()\n});\n\nconst db = await createRxDatabase({\n    name: 'mydatabase',\n    storage: storageWithAttachmentsCompression\n});\n\n\n// set the compression mode at the schema level\nconst mySchema = {\n    version: 0,\n    type: 'object',\n    properties: {\n        // .\n        // .\n        // .\n    },\n    attachments: {\n        compression: 'deflate'  // <- Specify the compression mode here. OneOf ['deflate', 'gzip']\n    }\n};\n\n/* ... create your collections as usual and store attachments in them. */\n\n"})})]})}function d(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>h,x:()=>i});var a=n(6540);const s={},c=a.createContext(s);function h(e){const t=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:h(e.components),a.createElement(c.Provider,{value:t},e.children)}}}]);