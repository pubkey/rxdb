"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[4202],{449(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"rx-storage-sharding","title":"Sharding RxStorage \ud83d\udc51","description":"With the sharding plugin, you can improve the write and query times of some RxStorage implementations.","source":"@site/docs/rx-storage-sharding.md","sourceDirName":".","slug":"/rx-storage-sharding.html","permalink":"/rx-storage-sharding.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Sharding RxStorage \ud83d\udc51","slug":"rx-storage-sharding.html"},"sidebar":"tutorialSidebar","previous":{"title":"Memory Mapped RxStorage \ud83d\udc51","permalink":"/rx-storage-memory-mapped.html"},"next":{"title":"Localstorage Meta Optimizer \ud83d\udc51","permalink":"/rx-storage-localstorage-meta-optimizer.html"}}');var a=s(4848),i=s(8453);const o={title:"Sharding RxStorage \ud83d\udc51",slug:"rx-storage-sharding.html"},t="Sharding RxStorage",l={},d=[{value:"Using the sharding plugin",id:"using-the-sharding-plugin",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",figure:"figure",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",span:"span",strong:"strong",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"sharding-rxstorage",children:"Sharding RxStorage"})}),"\n",(0,a.jsxs)(n.p,{children:["With the sharding plugin, you can improve the write and query times of ",(0,a.jsx)(n.strong,{children:"some"})," ",(0,a.jsx)(n.code,{children:"RxStorage"})," implementations.\nFor example on ",(0,a.jsx)(n.a,{href:"/slow-indexeddb.html",children:"slow IndexedDB"}),", a performance gain of ",(0,a.jsx)(n.strong,{children:"30-50% on reads"}),", and ",(0,a.jsx)(n.strong,{children:"25% on writes"})," can be achieved by using multiple IndexedDB Stores instead of putting all documents into the same store."]}),"\n",(0,a.jsxs)(n.p,{children:["The sharding plugin works as a wrapper around any other ",(0,a.jsx)(n.code,{children:"RxStorage"}),". The sharding plugin will automatically create multiple shards per storage instance and it will merge and split read and write calls to it."]}),"\n",(0,a.jsx)(n.admonition,{title:"Premium",type:"note",children:(0,a.jsxs)(n.p,{children:["The sharding plugin is part of ",(0,a.jsx)(n.a,{href:"/premium/",children:"RxDB Premium \ud83d\udc51"}),". It is not part of the default RxDB module."]})}),"\n",(0,a.jsx)(n.h2,{id:"using-the-sharding-plugin",children:"Using the sharding plugin"}),"\n",(0,a.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,a.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,a.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    getRxStorageSharding"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb-premium/plugins/storage-sharding'"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" { getRxStorageLocalstorage } "}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb/plugins/storage-localstorage'"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * First wrap the original RxStorage with the sharding RxStorage."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" shardedRxStorage"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" getRxStorageSharding"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     * Here we use the localStorage RxStorage,"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     * it is also possible to use any other RxStorage instead."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    storage"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" getRxStorageLocalstorage"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * Add the sharding options to your schema."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * Changing these options will require a data migration."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mySchema"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /* ... */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    sharding"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"        /**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * Amount of shards per RxStorage instance."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * Depending on your data size and query patterns, the optimal shard amount may differ."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * Do a performance test to optimize that value."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * 10 Shards is a good value to start with."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * "})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * IMPORTANT: Changing the value of shards is not possible on a already existing database state,"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * you will loose access to  your data."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        shards"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" 10"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"        /**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * Sharding mode,"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * you can either shard by collection or by database."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * For most cases you should use 'collection' which will shard on the collection level."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * For example with the IndexedDB RxStorage, it will then create multiple stores per IndexedDB database"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * and not multiple IndexedDB databases, which would be slower."})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        mode"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'collection'"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    }"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /* ... */"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"}"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * Create the RxDatabase with the wrapped RxStorage. "})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" */"})}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" database"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" createRxDatabase"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    name"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'mydatabase'"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,a.jsxs)(n.span,{"data-line":"",children:[(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    storage"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" shardedRxStorage"})]}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:(0,a.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})}),"\n",(0,a.jsx)(n.span,{"data-line":"",children:" "})]})})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>o,x:()=>t});var r=s(6540);const a={},i=r.createContext(a);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);