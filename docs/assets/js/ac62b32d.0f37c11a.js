"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[9192],{3228(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"replication-websocket","title":"Websocket Replication","description":"With the websocket replication plugin, you can spawn a websocket server from a RxDB database in Node.js and replicate with it.","source":"@site/docs/replication-websocket.md","sourceDirName":".","slug":"/replication-websocket.html","permalink":"/replication-websocket.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Websocket Replication","slug":"replication-websocket.html"},"sidebar":"tutorialSidebar","previous":{"title":"GraphQL Replication","permalink":"/replication-graphql.html"},"next":{"title":"CouchDB Replication","permalink":"/replication-couchdb.html"}}');var i=s(4848),o=s(8453);const t={title:"Websocket Replication",slug:"replication-websocket.html"},a="Websocket Replication",l={},c=[{value:"Starting the Websocket Server",id:"starting-the-websocket-server",level:2},{value:"Connect to the Websocket Server",id:"connect-to-the-websocket-server",level:2},{value:"Customize",id:"customize",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",figure:"figure",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",span:"span",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"websocket-replication",children:"Websocket Replication"})}),"\n",(0,i.jsx)(n.p,{children:"With the websocket replication plugin, you can spawn a websocket server from a RxDB database in Node.js and replicate with it."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The websocket replication plugin does not have any concept for authentication or permission handling. It is designed to create an easy ",(0,i.jsx)(n.strong,{children:"server-to-server"})," replication. It is ",(0,i.jsx)(n.strong,{children:"not"})," made for client-server replication. Make a pull request if you need that feature."]})}),"\n",(0,i.jsx)(n.h2,{id:"starting-the-websocket-server",children:"Starting the Websocket Server"}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" { createRxDatabase } "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    startWebsocketServer"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb/plugins/replication-websocket'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// create a RxDatabase like normal"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" myDatabase"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" createRxDatabase"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/* ... */"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// start a websocket server"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" serverState"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" startWebsocketServer"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    database"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" myDatabase"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    port"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" 1337"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    path"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" '/socket'"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// stop the server"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" serverState"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".close"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]})]})})}),"\n",(0,i.jsx)(n.h2,{id:"connect-to-the-websocket-server",children:"Connect to the Websocket Server"}),"\n",(0,i.jsx)(n.p,{children:"The replication has to be started once for each collection that you want to replicate."}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    replicateWithWebsocketServer"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"} "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'rxdb/plugins/replication-websocket'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:";"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// start the replication"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" replicationState"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" replicateWithWebsocketServer"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /**"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     * To make the replication work,"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     * the client collection name must be equal"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     * to the server collection name."})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    collection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" myRxCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    url"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'ws://localhost:1337/socket'"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// stop the replication"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" replicationState"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".cancel"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]})]})})}),"\n",(0,i.jsx)(n.h2,{id:"customize",children:"Customize"}),"\n",(0,i.jsxs)(n.p,{children:["We use the ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/ws",children:"ws"})," npm library, so you can use all optional configuration provided by it.\nThis is especially important to improve performance by opting in of some optional settings."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>a});var r=s(6540);const i={},o=r.createContext(i);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);