"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[2966],{5643:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"rx-database","title":"RxDatabase - The Core of Your Realtime Data","description":"Get started with RxDatabase and integrate multiple storages. Learn to create, encrypt, and optimize your realtime database today.","source":"@site/docs/rx-database.md","sourceDirName":".","slug":"/rx-database.html","permalink":"/rx-database.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"RxDatabase - The Core of Your Realtime Data","slug":"rx-database.html","description":"Get started with RxDatabase and integrate multiple storages. Learn to create, encrypt, and optimize your realtime database today."},"sidebar":"tutorialSidebar","previous":{"title":"TypeScript Setup","permalink":"/tutorials/typescript.html"},"next":{"title":"RxSchema","permalink":"/rx-schema.html"}}');var s=t(4848),r=t(8453);const o={title:"RxDatabase - The Core of Your Realtime Data",slug:"rx-database.html",description:"Get started with RxDatabase and integrate multiple storages. Learn to create, encrypt, and optimize your realtime database today."},i="RxDatabase",l={},c=[{value:"Creation",id:"creation",level:2},{value:"name",id:"name",level:3},{value:"storage",id:"storage",level:3},{value:"password",id:"password",level:3},{value:"multiInstance",id:"multiinstance",level:3},{value:"eventReduce",id:"eventreduce",level:3},{value:"ignoreDuplicate",id:"ignoreduplicate",level:3},{value:"closeDuplicates",id:"closeduplicates",level:3},{value:"hashFunction",id:"hashfunction",level:3},{value:"Methods",id:"methods",level:2},{value:"Observe with $",id:"observe-with-",level:3},{value:"exportJSON()",id:"exportjson",level:3},{value:"importJSON()",id:"importjson",level:3},{value:"backup()",id:"backup",level:3},{value:"waitForLeadership()",id:"waitforleadership",level:3},{value:"requestIdlePromise()",id:"requestidlepromise",level:3},{value:"close()",id:"close",level:3},{value:"remove()",id:"remove",level:3},{value:"isRxDatabase",id:"isrxdatabase",level:3}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"rxdatabase",children:"RxDatabase"})}),"\n",(0,s.jsx)(a.p,{children:"A RxDatabase-Object contains your collections and handles the synchronization of change-events."}),"\n",(0,s.jsx)(a.h2,{id:"creation",children:"Creation"}),"\n",(0,s.jsxs)(a.p,{children:["The database is created by the asynchronous ",(0,s.jsx)(a.code,{children:".createRxDatabase()"})," function of the core RxDB module. It has the following parameters:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"import { createRxDatabase } from 'rxdb/plugins/core';\nimport { getRxStorageLocalstorage } from 'rxdb/plugins/storage-localstorage';\n\nconst db = await createRxDatabase({\n  name: 'heroesdb',                   // <- name\n  storage: getRxStorageLocalstorage(),       // <- RxStorage\n\n  /* Optional parameters: */\n  password: 'myPassword',             // <- password (optional)\n  multiInstance: true,                // <- multiInstance (optional, default: true)\n  eventReduce: true,                  // <- eventReduce (optional, default: false)\n  cleanupPolicy: {}                   // <- custom cleanup policy (optional) \n});\n"})}),"\n",(0,s.jsx)(a.h3,{id:"name",children:"name"}),"\n",(0,s.jsxs)(a.p,{children:["The database-name is a string which uniquely identifies the database. When two RxDatabases have the same name and use the same ",(0,s.jsx)(a.code,{children:"RxStorage"}),", their data can be assumed as equal and they will share events between each other.\nDepending on the storage or adapter this can also be used to define the filesystem folder of your data."]}),"\n",(0,s.jsx)(a.h3,{id:"storage",children:"storage"}),"\n",(0,s.jsxs)(a.p,{children:["RxDB works on top of an implementation of the ",(0,s.jsx)(a.a,{href:"/rx-storage.html",children:"RxStorage"})," interface. This interface is an abstraction that allows you to use different underlying databases that actually handle the documents. Depending on your use case you might use a different ",(0,s.jsx)(a.code,{children:"storage"})," with different tradeoffs in performance, bundle size or supported runtimes."]}),"\n",(0,s.jsxs)(a.p,{children:["There are many ",(0,s.jsx)(a.code,{children:"RxStorage"})," implementations that can be used depending on the JavaScript environment and performance requirements.\nFor example you can use the ",(0,s.jsx)(a.a,{href:"/rx-storage-localstorage.html",children:"LocalStorage RxStorage"})," in the browser or use the ",(0,s.jsx)(a.a,{href:"/rx-storage-mongodb.html",children:"MongoDB RxStorage"})," in Node.js."]}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.a,{href:"/rx-storage.html",children:"List of RxStorage implementations"})}),"\n"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"\n// use the LocalStroage that stores data in the browser.\nimport { getRxStorageLocalstorage } from 'rxdb/plugins/storage-localstorage';\n\nconst db = await createRxDatabase({\n  name: 'mydatabase',\n  storage: getRxStorageLocalstorage()\n});\n\n\n// ...or use the MongoDB RxStorage in Node.js.\nimport { getRxStorageMongoDB } from 'rxdb/plugins/storage-mongodb';\n\nconst dbMongo = await createRxDatabase({\n  name: 'mydatabase',\n  storage: getRxStorageMongoDB({\n    connection: 'mongodb://localhost:27017,localhost:27018,localhost:27019'\n  })\n});\n"})}),"\n",(0,s.jsx)(a.h3,{id:"password",children:"password"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:"(optional)"}),"\nIf you want to use encrypted fields in the collections of a database, you have to set a password for it. The password must be a string with at least 12 characters."]}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.a,{href:"/encryption.html",children:"Read more about encryption here"}),"."]}),"\n",(0,s.jsx)(a.h3,{id:"multiinstance",children:"multiInstance"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:"(optional=true)"}),"\nWhen you create more than one instance of the same database in a single javascript-runtime, you should set ",(0,s.jsx)(a.code,{children:"multiInstance"})," to ",(0,s.jsx)(a.code,{children:"true"}),". This will enable the event sharing between the two instances. For example when the user has opened multiple browser windows, events will be shared between them so that both windows react to the same changes.\n",(0,s.jsx)(a.code,{children:"multiInstance"})," should be set to ",(0,s.jsx)(a.code,{children:"false"})," when you have single-instances like a single Node.js-process, a react-native-app, a cordova-app or a single-window ",(0,s.jsx)(a.a,{href:"/electron-database.html",children:"electron"})," app which can decrease the startup time because no instance coordination has to be done."]}),"\n",(0,s.jsx)(a.h3,{id:"eventreduce",children:"eventReduce"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"(optional=false)"})}),"\n",(0,s.jsxs)(a.p,{children:["One big benefit of having a realtime database is that big performance optimizations can be done when the database knows a query is observed and the updated results are needed continuously. RxDB uses the ",(0,s.jsx)(a.a,{href:"https://github.com/pubkey/event-reduce",children:"EventReduce Algorithm"})," to optimize observer or recurring queries."]}),"\n",(0,s.jsxs)(a.p,{children:["For better performance, you should always set ",(0,s.jsx)(a.code,{children:"eventReduce: true"}),". This will also be the default in the next major RxDB version."]}),"\n",(0,s.jsx)(a.h3,{id:"ignoreduplicate",children:"ignoreDuplicate"}),"\n",(0,s.jsxs)(a.p,{children:[(0,s.jsx)(a.code,{children:"(optional=false)"}),"\nIf you create multiple RxDatabase-instances with the same name and same adapter, it's very likely that you have done something wrong.\nTo prevent this common mistake, RxDB will throw an error when you do this.\nIn some rare cases like unit-tests, you want to do this intentional by setting ",(0,s.jsx)(a.code,{children:"ignoreDuplicate"})," to ",(0,s.jsx)(a.code,{children:"true"}),". Because setting ",(0,s.jsx)(a.code,{children:"ignoreDuplicate: true"})," in production will decrease the performance by having multiple instances of the same database, ",(0,s.jsx)(a.code,{children:"ignoreDuplicate"})," is only allowed to be set in ",(0,s.jsx)(a.a,{href:"/dev-mode.html",children:"dev-mode"}),"."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-js",children:"const db1 = await createRxDatabase({\n  name: 'heroesdb',\n  storage: getRxStorageLocalstorage(),\n  ignoreDuplicate: true\n});\nconst db2 = await createRxDatabase({\n  name: 'heroesdb',\n  storage: getRxStorageLocalstorage(),\n  ignoreDuplicate: true // this create-call will not throw because you explicitly allow it\n});\n"})}),"\n",(0,s.jsx)(a.h3,{id:"closeduplicates",children:"closeDuplicates"}),"\n",(0,s.jsx)(a.p,{children:(0,s.jsx)(a.code,{children:"(optional=false)"})}),"\n",(0,s.jsx)(a.p,{children:"Closes all other RxDatabases instances that have the same storage+name combination."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-js",children:"const db1 = await createRxDatabase({\n  name: 'heroesdb',\n  storage: getRxStorageLocalstorage(),\n  closeDuplicates: true\n});\nconst db2 = await createRxDatabase({\n  name: 'heroesdb',\n  storage: getRxStorageLocalstorage(),\n  closeDuplicates: true // this create-call will close db1\n});\n\n// db1 is now closed.\n"})}),"\n",(0,s.jsx)(a.h3,{id:"hashfunction",children:"hashFunction"}),"\n",(0,s.jsxs)(a.p,{children:["By default, RxDB will use ",(0,s.jsx)(a.code,{children:"crypto.subtle.digest('SHA-256', data)"})," for hashing. If you need a different hash function or the ",(0,s.jsx)(a.code,{children:"crypto.subtle"})," API is not supported in your JavaScript runtime, you can provide an own hash function instead. A hash function gets a string as input and returns a ",(0,s.jsx)(a.code,{children:"Promise"})," that resolves a string."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-ts",children:"// example hash function that runs in plain JavaScript\nimport { sha256 } from 'ohash';\nfunction myOwnHashFunction(input: string) {\n    return Promise.resolve(sha256(input));\n}\nconst db = await createRxDatabase({\n  hashFunction: myOwnHashFunction\n  /* ... */\n});\n"})}),"\n",(0,s.jsxs)(a.p,{children:["If you get the error message ",(0,s.jsx)(a.code,{children:"TypeError: Cannot read properties of undefined (reading 'digest')"})," this likely means that you are neither running on ",(0,s.jsx)(a.code,{children:"localhost"})," nor on ",(0,s.jsx)(a.code,{children:"https"})," which is why your browser might not allow access to ",(0,s.jsx)(a.code,{children:"crypto.subtle.digest"}),"."]}),"\n",(0,s.jsx)(a.h2,{id:"methods",children:"Methods"}),"\n",(0,s.jsx)(a.h3,{id:"observe-with-",children:"Observe with $"}),"\n",(0,s.jsxs)(a.p,{children:["Calling this will return an ",(0,s.jsx)(a.a,{href:"http://reactivex.io/documentation/observable.html",children:"rxjs-Observable"})," which streams all write events of the ",(0,s.jsx)(a.code,{children:"RxDatabase"}),"."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"myDb.$.subscribe(changeEvent => console.dir(changeEvent));\n"})}),"\n",(0,s.jsx)(a.h3,{id:"exportjson",children:"exportJSON()"}),"\n",(0,s.jsxs)(a.p,{children:["Use this function to create a json-export from every piece of data in every collection of this database. You can pass ",(0,s.jsx)(a.code,{children:"true"})," as a parameter to decrypt the encrypted data-fields of your document."]}),"\n",(0,s.jsxs)(a.p,{children:["Before ",(0,s.jsx)(a.code,{children:"exportJSON()"})," and ",(0,s.jsx)(a.code,{children:"importJSON()"})," can be used, you have to add the ",(0,s.jsx)(a.code,{children:"json-dump"})," plugin."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"import { addRxPlugin } from 'rxdb';\nimport { RxDBJsonDumpPlugin } from 'rxdb/plugins/json-dump';\naddRxPlugin(RxDBJsonDumpPlugin);\n"})}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"myDatabase.exportJSON()\n  .then(json => console.dir(json));\n"})}),"\n",(0,s.jsx)(a.h3,{id:"importjson",children:"importJSON()"}),"\n",(0,s.jsx)(a.p,{children:"To import the json-dumps into your database, use this function."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"// import the dump to the database\nemptyDatabase.importJSON(json)\n  .then(() => console.log('done'));\n"})}),"\n",(0,s.jsx)(a.h3,{id:"backup",children:"backup()"}),"\n",(0,s.jsxs)(a.p,{children:["Writes the current (or ongoing) database state to the filesystem. ",(0,s.jsx)(a.a,{href:"/backup.html",children:"Read more"})]}),"\n",(0,s.jsx)(a.h3,{id:"waitforleadership",children:"waitForLeadership()"}),"\n",(0,s.jsxs)(a.p,{children:["Returns a Promise which resolves when the RxDatabase becomes ",(0,s.jsx)(a.a,{href:"/leader-election.html",children:"elected leader"}),"."]}),"\n",(0,s.jsx)(a.h3,{id:"requestidlepromise",children:"requestIdlePromise()"}),"\n",(0,s.jsxs)(a.p,{children:["Returns a promise which resolves when the database is in idle. This works similar to ",(0,s.jsx)(a.a,{href:"https://developer.mozilla.org/de/docs/Web/API/Window/requestIdleCallback",children:"requestIdleCallback"})," but tracks the idle-ness of the database instead of the CPU.\nUse this for semi-important tasks like cleanups which should not affect the speed of important tasks."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"\nmyDatabase.requestIdlePromise().then(() => {\n    // this will run at the moment the database has nothing else to do\n    myCollection.customCleanupFunction();\n});\n\n// with timeout\nmyDatabase.requestIdlePromise(1000 /* time in ms */).then(() => {\n    // this will run at the moment the database has nothing else to do\n    // or the timeout has passed\n    myCollection.customCleanupFunction();\n});\n\n"})}),"\n",(0,s.jsx)(a.h3,{id:"close",children:"close()"}),"\n",(0,s.jsxs)(a.p,{children:["Closes the databases object-instance. This is to free up memory and stop all observers and replications.\nReturns a ",(0,s.jsx)(a.code,{children:"Promise"})," that resolves when the database is closed.\nClosing a database will not remove the databases data. When you create the database again with ",(0,s.jsx)(a.code,{children:"createRxDatabase()"}),", all data will still be there."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"await myDatabase.close();\n"})}),"\n",(0,s.jsx)(a.h3,{id:"remove",children:"remove()"}),"\n",(0,s.jsx)(a.p,{children:"Wipes all documents from the storage. Use this to free up disc space."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"await myDatabase.remove();\n// database instance is now gone\n"})}),"\n",(0,s.jsxs)(a.p,{children:["You can also clear a database without removing its instance by using ",(0,s.jsx)(a.code,{children:"removeRxDatabase()"}),". This is useful if you want to migrate data or reset the users state by renaming the database. Then you can remove the previous data with ",(0,s.jsx)(a.code,{children:"removeRxDatabase()"})," without creating a RxDatabase first. Notice that this will only remove the\nstored data on the storage. It will not clear the cache of any ",(0,s.jsx)(a.a,{href:"/rx-database.html",children:"RxDatabase"})," instances."]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"import { removeRxDatabase } from 'rxdb';\nremoveRxDatabase('mydatabasename', 'localstorage');\n"})}),"\n",(0,s.jsx)(a.h3,{id:"isrxdatabase",children:"isRxDatabase"}),"\n",(0,s.jsx)(a.p,{children:"Returns true if the given object is an instance of RxDatabase. Returns false if not."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-javascript",children:"import { isRxDatabase } from 'rxdb';\nconst is = isRxDatabase(myObj);\n"})})]})}function h(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,a,t)=>{t.d(a,{R:()=>o,x:()=>i});var n=t(6540);const s={},r=n.createContext(s);function o(e){const a=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(r.Provider,{value:a},e.children)}}}]);