"use strict";(globalThis.webpackChunkrxdb=globalThis.webpackChunkrxdb||[]).push([[9997],{2591(e,n,s){s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"rx-pipeline","title":"RxPipeline - Automate Data Flows in RxDB","description":"Discover how RxPipeline automates your data workflows. Seamlessly process writes, manage leader election, and ensure crash-safe operations in RxDB.","source":"@site/docs/rx-pipeline.md","sourceDirName":".","slug":"/rx-pipeline.html","permalink":"/rx-pipeline.html","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"RxPipeline - Automate Data Flows in RxDB","slug":"rx-pipeline.html","description":"Discover how RxPipeline automates your data workflows. Seamlessly process writes, manage leader election, and ensure crash-safe operations in RxDB."},"sidebar":"tutorialSidebar","previous":{"title":"Attachments","permalink":"/rx-attachment.html"},"next":{"title":"Custom Reactivity","permalink":"/reactivity.html"}}');var i=s(4848),o=s(8453);const l={title:"RxPipeline - Automate Data Flows in RxDB",slug:"rx-pipeline.html",description:"Discover how RxPipeline automates your data workflows. Seamlessly process writes, manage leader election, and ensure crash-safe operations in RxDB."},a="RxPipeline",t={},c=[{value:"Creating a RxPipeline",id:"creating-a-rxpipeline",level:2},{value:"Use Cases for RxPipeline",id:"use-cases-for-rxpipeline",level:2},{value:"UseCase: Re-Index data that comes from replication",id:"usecase-re-index-data-that-comes-from-replication",level:3},{value:"UseCase: Fulltext Search",id:"usecase-fulltext-search",level:3},{value:"UseCase: Download data based on source documents",id:"usecase-download-data-based-on-source-documents",level:3},{value:"RxPipeline methods",id:"rxpipeline-methods",level:2},{value:"awaitIdle()",id:"awaitidle",level:3},{value:"close()",id:"close",level:3},{value:"remove()",id:"remove",level:3},{value:"Using RxPipeline correctly",id:"using-rxpipeline-correctly",level:2},{value:"Pipeline handlers must be idempotent",id:"pipeline-handlers-must-be-idempotent",level:3},{value:"Pipeline handlers must not throw",id:"pipeline-handlers-must-not-throw",level:3},{value:"Be careful when doing http requests in the handler",id:"be-careful-when-doing-http-requests-in-the-handler",level:3},{value:"Pipelines temporarily block external reads and writes",id:"pipelines-temporarily-block-external-reads-and-writes",level:3}];function d(e){const n={a:"a",code:"code",figure:"figure",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"rxpipeline",children:"RxPipeline"})}),"\n",(0,i.jsx)(n.p,{children:"The RxPipeline plugin enables you to run operations depending on writes to a collection.\nWhenever a write happens on the source collection of a pipeline, a handler is called to process the writes and run operations on another collection."}),"\n",(0,i.jsx)(n.p,{children:"You could have a similar behavior by observing the collection stream and process data on emits:"}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsx)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"mySourceCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"$"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".subscribe"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(event "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/* ...process...*/"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})]})})})}),"\n",(0,i.jsx)(n.p,{children:"While this could work in some cases, it causes many problems that are fixed by using the pipeline plugin instead:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["In an RxPipeline, only the ",(0,i.jsx)(n.a,{href:"/leader-election.html",children:"Leading Instance"})," runs the operations. For example when you have multiple browser tabs open, only one will run the processing and when that tab is closed, another tab will become elected leader and continue the pipeline processing."]}),"\n",(0,i.jsx)(n.li,{children:"On sudden stops and restarts of the JavaScript process, the processing will continue at the correct checkpoint and not miss out any documents even on unexpected crashes."}),"\n",(0,i.jsx)(n.li,{children:"Reads/Writes on the destination collection are halted while the pipeline is processing. This ensures your queries only return fully processed documents and no partial results. So when you run a query to the destination collection directly after a write to the source collection, you can be sure your query results are up to date and the pipeline has already been run at the moment the query resolved:"}),"\n"]}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mySourceCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".insert"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/* ... */"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * Because our pipeline blocks reads to the destination,"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * we know that the result array contains data created"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" * on top of the previously inserted documents."})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:" */"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" result"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" myDestinationCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".exec"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]})]})})}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-rxpipeline",children:"Creating a RxPipeline"}),"\n",(0,i.jsxs)(n.p,{children:["Pipelines are created on top of a source ",(0,i.jsx)(n.a,{href:"/rx-collection.html",children:"RxCollection"})," and have another ",(0,i.jsx)(n.code,{children:"RxCollection"})," as destination. An identifier is used to identify the state of the pipeline so that different pipelines have a different processing checkpoint state. A plain JavaScript function ",(0,i.jsx)(n.code,{children:"handler"})," is used to process the data of the source collection writes."]}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mySourceCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'my-pipeline'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" myDestinationCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"    handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" (docs) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"        /**"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * Here you can process the documents and write to"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         * the destination collection."})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"         */"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"        for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" docs) {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" myDestinationCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".insert"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                id"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                category"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".category"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"            });"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases-for-rxpipeline",children:"Use Cases for RxPipeline"}),"\n",(0,i.jsx)(n.p,{children:"The RxPipeline is a handy building block for different features and plugins. You can use it to aggregate data or restructure local data."}),"\n",(0,i.jsx)(n.h3,{id:"usecase-re-index-data-that-comes-from-replication",children:"UseCase: Re-Index data that comes from replication"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes you want to ",(0,i.jsx)(n.a,{href:"/replication.html",children:"replicate"})," atomic documents over the wire but locally you want to split these documents for better indexing. For example you replicate email documents that have multiple receivers in a string-array. While string-arrays cannot be indexed, locally you need a way to query for all emails of a given receiver.\nTo handle this case you can set up a RxPipeline that writes the mapping into a separate collection:"]}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'map-email-receivers'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" emailByReceiverCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"    handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" (docs) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"        for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" docs) {"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"            // remove previous mapping"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailByReceiverCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({emailId"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary})"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".remove"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"            // add new mapping"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            if"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"!"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".deleted) {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"                await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailByReceiverCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".bulkInsert"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"                    doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"receivers"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".map"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(receiver "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                        emailId"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                        receiver"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" receiver"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                    }))"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                );"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"            }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,i.jsx)(n.p,{children:'With this you can efficiently query for "all emails that a person received" by running:'}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mailIds"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailByReceiverCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    receiver"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'foobar@example.com'"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".exec"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]})]})})}),"\n",(0,i.jsx)(n.h3,{id:"usecase-fulltext-search",children:"UseCase: Fulltext Search"}),"\n",(0,i.jsx)(n.p,{children:"You can utilize the pipeline plugin to index text data for efficient fulltext search."}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'email-fulltext-search'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" mailByWordCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"    handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" (docs) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"        for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" docs) {"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"            // remove previous mapping"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mailByWordCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({emailId"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary})"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".remove"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"            // add new mapping"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            if"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"!"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".deleted) {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"                const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" words"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"text"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".split"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"' '"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:");"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"                await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mailByWordCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".bulkInsert"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"                    words"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".map"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(word "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                        emailId"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                        word"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" word"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                    }))"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                );"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"            }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,i.jsx)(n.p,{children:'With this you can efficiently query for "all emails that contain a given word" by running:'}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsx)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" mailIds"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailByReceiverCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({word"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'foobar'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"})"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".exec"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]})})})}),"\n",(0,i.jsx)(n.h3,{id:"usecase-download-data-based-on-source-documents",children:"UseCase: Download data based on source documents"}),"\n",(0,i.jsx)(n.p,{children:"When you have to fetch data for each document of a collection from a server, you can use the pipeline to ensure all documents have their data downloaded and no document is missed."}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" emailCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'download-data'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" serverDataCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"    handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" (docs) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"        for"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" ("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" of"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" docs) {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" response"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:" fetch"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'https://example.com/doc/'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" +"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary);"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" serverData"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" response"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".json"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"();"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"            await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" serverDataCollection"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".upsert"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                id"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" doc"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".primary"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"                data"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" serverData"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"            });"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"        }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"    }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,i.jsx)(n.h2,{id:"rxpipeline-methods",children:"RxPipeline methods"}),"\n",(0,i.jsx)(n.h3,{id:"awaitidle",children:"awaitIdle()"}),"\n",(0,i.jsxs)(n.p,{children:["You can await the idleness of a pipeline with ",(0,i.jsx)(n.code,{children:"await myRxPipeline.awaitIdle()"}),". This will await a promise that resolves when the pipeline has processed all documents and is not running anymore."]}),"\n",(0,i.jsx)(n.h3,{id:"close",children:"close()"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"await myRxPipeline.close()"})," stops the pipeline so that it is no longer doing stuff. This is automatically called when the RxCollection or RxDatabase of the pipeline is closed."]}),"\n",(0,i.jsx)(n.h3,{id:"remove",children:"remove()"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"await myRxPipeline.remove()"})," removes the pipeline and all metadata which it has stored. Recreating the pipeline afterwards will start processing all source documents from scratch."]}),"\n",(0,i.jsx)(n.h2,{id:"using-rxpipeline-correctly",children:"Using RxPipeline correctly"}),"\n",(0,i.jsx)(n.h3,{id:"pipeline-handlers-must-be-idempotent",children:"Pipeline handlers must be idempotent"}),"\n",(0,i.jsx)(n.p,{children:"Because a JavaScript process can exit at any time, like when the user closes a browser tab, the pipeline handler function must be idempotent. This means when it only runs partially and is started again with the same input, it should still end up in the correct result."}),"\n",(0,i.jsx)(n.h3,{id:"pipeline-handlers-must-not-throw",children:"Pipeline handlers must not throw"}),"\n",(0,i.jsxs)(n.p,{children:["Pipeline handlers must never throw. If you run operations inside of the handler that might cause errors, you must wrap the handler's code with a ",(0,i.jsx)(n.code,{children:"try-catch"})," by yourself and also handle retries. If your handler throws, your pipeline will be stuck and no longer be usable, which should never happen."]}),"\n",(0,i.jsx)(n.h3,{id:"be-careful-when-doing-http-requests-in-the-handler",children:"Be careful when doing http requests in the handler"}),"\n",(0,i.jsxs)(n.p,{children:["When you run http requests inside of your handler, you no longer have an ",(0,i.jsx)(n.a,{href:"/offline-first.html",children:"offline first"})," application because reads to the destination collection will be blocked until all handlers have finished. When your client is offline, therefore the collection will be blocked for reads and writes."]}),"\n",(0,i.jsx)(n.h3,{id:"pipelines-temporarily-block-external-reads-and-writes",children:"Pipelines temporarily block external reads and writes"}),"\n",(0,i.jsxs)(n.p,{children:["While a pipeline is running, ",(0,i.jsx)(n.strong,{children:"all reads and writes to its destination collection are blocked"}),". This guarantees that queries never observe partially processed data, but it also means that pipelines can block each other if they interact incorrectly."]}),"\n",(0,i.jsx)(n.p,{children:"Problems occur when multiple pipelines:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"read or write across the same collections, or"}),"\n",(0,i.jsxs)(n.li,{children:["wait for each other using ",(0,i.jsx)(n.code,{children:"awaitIdle()"})," from inside a pipeline handler."]}),"\n"]}),"\n",(0,i.jsx)(n.figure,{"data-rehype-pretty-code-figure":"",children:(0,i.jsx)(n.pre,{style:{backgroundColor:"var(--shiki-background)",color:"var(--shiki-foreground)"},tabIndex:"0","data-language":"ts","data-theme":"css-variables",children:(0,i.jsxs)(n.code,{"data-language":"ts","data-theme":"css-variables",style:{display:"grid"},children:[(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// Example of a deadlock"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// Pipeline A: files \u2192 files (reads folders)"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipelineA"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" db"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"files"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'file-path-sync'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" db"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".files"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"  handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" (docs) "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" folders"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" ="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" folders"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".find"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"()"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".exec"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(); "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// can block"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /* ... */"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:" "}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// Pipeline B: files \u2192 folders (waits for A)"})}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" db"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"folders"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".addPipeline"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  identifier"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:" 'file-count'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  destination"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" db"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:".folders"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"  handler"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:" async"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" () "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:" {"})]}),"\n",(0,i.jsxs)(n.span,{"data-line":"",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"    await"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:" pipelineA"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".awaitIdle"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"(); "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// \u274c may deadlock"})]}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"    /* ... */"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"  }"})}),"\n",(0,i.jsx)(n.span,{"data-line":"",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-foreground)"},children:"});"})})]})})}),"\n",(0,i.jsx)(n.p,{children:"To prevent deadlocks, consider:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Never call ",(0,i.jsx)(n.code,{children:"awaitIdle()"})," inside a pipeline handler."]}),"\n",(0,i.jsx)(n.li,{children:"Avoid circular dependencies between pipelines."}),"\n",(0,i.jsx)(n.li,{children:"Prefer one-directional data flow."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453(e,n,s){s.d(n,{R:()=>l,x:()=>a});var r=s(6540);const i={},o=r.createContext(i);function l(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);