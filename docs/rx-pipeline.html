<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-rx-pipeline" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">RxPipeline - Automate Data Flows in RxDB | RxDB - JavaScript Database</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" name="twitter:image" content="https://rxdb.info/img/rxdb_social_card.png"><meta data-rh="true" property="og:url" content="https://rxdb.info/rx-pipeline.html"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="RxPipeline - Automate Data Flows in RxDB | RxDB - JavaScript Database"><meta data-rh="true" name="description" content="Discover how RxPipeline automates your data workflows. Seamlessly process writes, manage leader election, and ensure crash-safe operations in RxDB."><meta data-rh="true" property="og:description" content="Discover how RxPipeline automates your data workflows. Seamlessly process writes, manage leader election, and ensure crash-safe operations in RxDB."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://rxdb.info/rx-pipeline.html"><link data-rh="true" rel="alternate" href="https://rxdb.info/rx-pipeline.html" hreflang="en"><link data-rh="true" rel="alternate" href="https://rxdb.info/rx-pipeline.html" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-62D63SY3S0"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-62D63SY3S0",{})</script>
<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var g=t.getElementsByTagName(a)[0],m=t.createElement(a);m.async=!0,m.src="https://www.googletagmanager.com/gtm.js?id=GTM-PL63TR5",g.parentNode.insertBefore(m,g)}(window,document,"script","dataLayer")</script>






<meta name="theme-color" content="#ed168f">
<link rel="icon" type="image/svg+xml" href="/files/logo/logo.svg">
<link rel="apple-touch-icon" href="/img/apple-touch-icon.png" sizes="180x180">
<link rel="preconnect" href="https://consentcdn.cookiebot.com/">
<link rel="preconnect" href="https://consent.cookiebot.com/">
<link rel="preconnect" href="https://region1.analytics.google.com/">
<link rel="preconnect" href="https://www.redditstatic.com/">
<link rel="preconnect" href="https://pixel-config.reddit.com/"><link rel="stylesheet" href="/assets/css/styles.b066e612.css">
<script src="/assets/js/runtime~main.f8cb08bf.js" defer="defer"></script>
<script src="/assets/js/main.c9c8ff04.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PL63TR5" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>


<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","dark"),document.documentElement.setAttribute("data-theme-choice","dark"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/files/logo/logo_text_white.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/files/logo/logo_text_white.svg" alt="RxDB" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/overview.html">Docs</a><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="sync" href="/replication.html">Sync</a></div><div class="dropdown-wrapper"><a class="navbar__item navbar__link" dropdown="storages" href="/rx-storage.html">Storages</a></div><a class="navbar__item navbar__link" href="/premium/">Premium</a><a class="navbar__item navbar__link" href="/consulting/">Support</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="/chat/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-discord" target="_blank"> </a><a href="/code/" class="navbar__item navbar__link navbar-icon navbar__item navbar-icon-github" target="_blank"> </a></div></div><div class="navbar-line" style="position:fixed;left:0;z-index:10;height:2px;width:100vw;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;transform-origin:left center;will-change:transform;backface-visibility:hidden;contain:layout;transform:scaleX(0)"></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Y1UP"><div style="padding:10px;padding-top:30px;margin-left:auto;margin-right:auto"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" aria-label="Search" class="navbar__search-input search-bar" style="margin-left:auto;margin-right:auto;display:block"></div></div><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/overview.html"><span title="Getting Started" class="categoryLinkLabel_W154">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview.html"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/quickstart.html"><span title="ðŸš€ Quickstart" class="linkLabel_WmDU">ðŸš€ Quickstart</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/install.html"><span title="Installation" class="linkLabel_WmDU">Installation</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-mode.html"><span title="Development Mode" class="linkLabel_WmDU">Development Mode</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/typescript.html"><span title="TypeScript Setup" class="linkLabel_WmDU">TypeScript Setup</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-database.html"><span title="Core Entities" class="categoryLinkLabel_W154">Core Entities</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-storage.html"><span title="ðŸ’¾ Storages" class="categoryLinkLabel_W154">ðŸ’¾ Storages</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/schema-validation.html"><span title="Storage Wrappers" class="categoryLinkLabel_W154">Storage Wrappers</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/replication.html"><span title="ðŸ”„ Replication" class="categoryLinkLabel_W154">ðŸ”„ Replication</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-server.html"><span title="Server" class="categoryLinkLabel_W154">Server</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/transactions-conflicts-revisions.html"><span title="How RxDB works" class="categoryLinkLabel_W154">How RxDB works</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/migration-schema.html"><span title="Advanced Features" class="categoryLinkLabel_W154">Advanced Features</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/migration-schema.html"><span title="Migration" class="categoryLinkLabel_W154">Migration</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-attachment.html"><span title="Attachments" class="linkLabel_WmDU">Attachments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rx-pipeline.html"><span title="RxPipelines" class="linkLabel_WmDU">RxPipelines</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reactivity.html"><span title="Custom Reactivity" class="linkLabel_WmDU">Custom Reactivity</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-state.html"><span title="RxState" class="linkLabel_WmDU">RxState</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rx-local-document.html"><span title="Local Documents" class="linkLabel_WmDU">Local Documents</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cleanup.html"><span title="Cleanup" class="linkLabel_WmDU">Cleanup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/backup.html"><span title="Backup" class="linkLabel_WmDU">Backup</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/leader-election.html"><span title="Leader Election" class="linkLabel_WmDU">Leader Election</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/middleware.html"><span title="Middleware" class="linkLabel_WmDU">Middleware</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/crdt.html"><span title="CRDT" class="linkLabel_WmDU">CRDT</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/population.html"><span title="Population" class="linkLabel_WmDU">Population</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/orm.html"><span title="ORM" class="linkLabel_WmDU">ORM</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/fulltext-search.html"><span title="Fulltext Search ðŸ‘‘" class="linkLabel_WmDU">Fulltext Search ðŸ‘‘</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/articles/javascript-vector-database.html"><span title="Vector Database" class="linkLabel_WmDU">Vector Database</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/query-optimizer.html"><span title="Query Optimizer ðŸ‘‘" class="linkLabel_WmDU">Query Optimizer ðŸ‘‘</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/third-party-plugins.html"><span title="Third Party Plugins" class="linkLabel_WmDU">Third Party Plugins</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/react.html"><span title="Integrations" class="categoryLinkLabel_W154">Integrations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rx-storage-performance.html"><span title="Performance" class="categoryLinkLabel_W154">Performance</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/releases/17.0.0.html"><span title="Releases" class="categoryLinkLabel_W154">Releases</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/articles/browser-database.html"><span title="Articles" class="categoryLinkLabel_W154">Articles</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/contribution.html"><span title="Contribute" class="linkLabel_WmDU">Contribute</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/consulting/"><span title="Contact" class="categoryLinkLabel_W154">Contact</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>RxPipeline</h1></header>
<p>The RxPipeline plugin enables you to run operations depending on writes to a collection.
Whenever a write happens on the source collection of a pipeline, a handler is called to process the writes and run operations on another collection.</p>
<p>You could have a similar behavior by observing the collection stream and process data on emits:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-constant)">mySourceCollection</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">$</span><span style="color:var(--shiki-token-function)">.subscribe</span><span style="color:var(--shiki-foreground)">(event </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span><span style="color:var(--shiki-token-comment)">/* ...process...*/</span><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>While this could work in some cases, it causes many problems that are fixed by using the pipeline plugin instead:</p>
<ul>
<li class="">In an RxPipeline, only the <a class="" href="/leader-election.html">Leading Instance</a> runs the operations. For example when you have multiple browser tabs open, only one will run the processing and when that tab is closed, another tab will become elected leader and continue the pipeline processing.</li>
<li class="">On sudden stops and restarts of the JavaScript process, the processing will continue at the correct checkpoint and not miss out any documents even on unexpected crashes.</li>
<li class="">Reads/Writes on the destination collection are halted while the pipeline is processing. This ensures your queries only return fully processed documents and no partial results. So when you run a query to the destination collection directly after a write to the source collection, you can be sure your query results are up to date and the pipeline has already been run at the moment the query resolved:</li>
</ul>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">await</span><span style="color:var(--shiki-token-constant)"> mySourceCollection</span><span style="color:var(--shiki-token-function)">.insert</span><span style="color:var(--shiki-foreground)">({</span><span style="color:var(--shiki-token-comment)">/* ... */</span><span style="color:var(--shiki-foreground)">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">/**</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)"> * Because our pipeline blocks reads to the destination,</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)"> * we know that the result array contains data created</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)"> * on top of the previously inserted documents.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)"> */</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> result</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> myDestinationCollection</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-function)">.exec</span><span style="color:var(--shiki-foreground)">();</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-a-rxpipeline">Creating a RxPipeline<a href="#creating-a-rxpipeline" class="hash-link" aria-label="Direct link to Creating a RxPipeline" title="Direct link to Creating a RxPipeline" translate="no">â€‹</a></h2>
<p>Pipelines are created on top of a source <a class="" href="/rx-collection.html">RxCollection</a> and have another <code>RxCollection</code> as destination. An identifier is used to identify the state of the pipeline so that different pipelines have a different processing checkpoint state. A plain JavaScript function <code>handler</code> is used to process the data of the source collection writes.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> pipeline</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> mySourceCollection</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;my-pipeline&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> myDestinationCollection</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> (docs) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">        /**</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * Here you can process the documents and write to</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         * the destination collection.</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">         */</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        for</span><span style="color:var(--shiki-foreground)"> (</span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-token-keyword)"> of</span><span style="color:var(--shiki-foreground)"> docs) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            await</span><span style="color:var(--shiki-token-constant)"> myDestinationCollection</span><span style="color:var(--shiki-token-function)">.insert</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                category</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.category</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">            });</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-cases-for-rxpipeline">Use Cases for RxPipeline<a href="#use-cases-for-rxpipeline" class="hash-link" aria-label="Direct link to Use Cases for RxPipeline" title="Direct link to Use Cases for RxPipeline" translate="no">â€‹</a></h2>
<p>The RxPipeline is a handy building block for different features and plugins. You can use it to aggregate data or restructure local data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usecase-re-index-data-that-comes-from-replication">UseCase: Re-Index data that comes from replication<a href="#usecase-re-index-data-that-comes-from-replication" class="hash-link" aria-label="Direct link to UseCase: Re-Index data that comes from replication" title="Direct link to UseCase: Re-Index data that comes from replication" translate="no">â€‹</a></h3>
<p>Sometimes you want to <a class="" href="/replication.html">replicate</a> atomic documents over the wire but locally you want to split these documents for better indexing. For example you replicate email documents that have multiple receivers in a string-array. While string-arrays cannot be indexed, locally you need a way to query for all emails of a given receiver.
To handle this case you can set up a RxPipeline that writes the mapping into a separate collection:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> pipeline</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> emailCollection</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;map-email-receivers&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> emailByReceiverCollection</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> (docs) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        for</span><span style="color:var(--shiki-foreground)"> (</span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-token-keyword)"> of</span><span style="color:var(--shiki-foreground)"> docs) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">            // remove previous mapping</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            await</span><span style="color:var(--shiki-token-constant)"> emailByReceiverCollection</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">({emailId</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary})</span><span style="color:var(--shiki-token-function)">.remove</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">            // add new mapping</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            if</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">!</span><span style="color:var(--shiki-token-constant)">doc</span><span style="color:var(--shiki-foreground)">.deleted) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">                await</span><span style="color:var(--shiki-token-constant)"> emailByReceiverCollection</span><span style="color:var(--shiki-token-function)">.bulkInsert</span><span style="color:var(--shiki-foreground)">(</span></span>
<span data-line=""><span style="color:var(--shiki-token-constant)">                    doc</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">receivers</span><span style="color:var(--shiki-token-function)">.map</span><span style="color:var(--shiki-foreground)">(receiver </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> ({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                        emailId</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                        receiver</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> receiver</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                    }))</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                );</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">            }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>With this you can efficiently query for &quot;all emails that a person received&quot; by running:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> mailIds</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> emailByReceiverCollection</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    receiver</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;foobar@example.com&#x27;</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">})</span><span style="color:var(--shiki-token-function)">.exec</span><span style="color:var(--shiki-foreground)">();</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usecase-fulltext-search">UseCase: Fulltext Search<a href="#usecase-fulltext-search" class="hash-link" aria-label="Direct link to UseCase: Fulltext Search" title="Direct link to UseCase: Fulltext Search" translate="no">â€‹</a></h3>
<p>You can utilize the pipeline plugin to index text data for efficient fulltext search.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> pipeline</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> emailCollection</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;email-fulltext-search&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> mailByWordCollection</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> (docs) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        for</span><span style="color:var(--shiki-foreground)"> (</span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-token-keyword)"> of</span><span style="color:var(--shiki-foreground)"> docs) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">            // remove previous mapping</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            await</span><span style="color:var(--shiki-token-constant)"> mailByWordCollection</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">({emailId</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary})</span><span style="color:var(--shiki-token-function)">.remove</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">            // add new mapping</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            if</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-keyword)">!</span><span style="color:var(--shiki-token-constant)">doc</span><span style="color:var(--shiki-foreground)">.deleted) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">                const</span><span style="color:var(--shiki-token-constant)"> words</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">text</span><span style="color:var(--shiki-token-function)">.split</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27; &#x27;</span><span style="color:var(--shiki-foreground)">);</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">                await</span><span style="color:var(--shiki-token-constant)"> mailByWordCollection</span><span style="color:var(--shiki-token-function)">.bulkInsert</span><span style="color:var(--shiki-foreground)">(</span></span>
<span data-line=""><span style="color:var(--shiki-token-constant)">                    words</span><span style="color:var(--shiki-token-function)">.map</span><span style="color:var(--shiki-foreground)">(word </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> ({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                        emailId</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                        word</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> word</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                    }))</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                );</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">            }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>With this you can efficiently query for &quot;all emails that contain a given word&quot; by running:</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> mailIds</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> emailByReceiverCollection</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">({word</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;foobar&#x27;</span><span style="color:var(--shiki-foreground)">})</span><span style="color:var(--shiki-token-function)">.exec</span><span style="color:var(--shiki-foreground)">();</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="usecase-download-data-based-on-source-documents">UseCase: Download data based on source documents<a href="#usecase-download-data-based-on-source-documents" class="hash-link" aria-label="Direct link to UseCase: Download data based on source documents" title="Direct link to UseCase: Download data based on source documents" translate="no">â€‹</a></h3>
<p>When you have to fetch data for each document of a collection from a server, you can use the pipeline to ensure all documents have their data downloaded and no document is missed.</p>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> pipeline</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> emailCollection</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;download-data&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> serverDataCollection</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">    handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> (docs) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">        for</span><span style="color:var(--shiki-foreground)"> (</span><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-token-keyword)"> of</span><span style="color:var(--shiki-foreground)"> docs) {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            const</span><span style="color:var(--shiki-token-constant)"> response</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-function)"> fetch</span><span style="color:var(--shiki-foreground)">(</span><span style="color:var(--shiki-token-string-expression)">&#x27;https://example.com/doc/&#x27;</span><span style="color:var(--shiki-token-keyword)"> +</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary);</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            const</span><span style="color:var(--shiki-token-constant)"> serverData</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> response</span><span style="color:var(--shiki-token-function)">.json</span><span style="color:var(--shiki-foreground)">();</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">            await</span><span style="color:var(--shiki-token-constant)"> serverDataCollection</span><span style="color:var(--shiki-token-function)">.upsert</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                id</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> doc</span><span style="color:var(--shiki-foreground)">.primary</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">                data</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-foreground)"> serverData</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">            });</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">        }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">    }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rxpipeline-methods">RxPipeline methods<a href="#rxpipeline-methods" class="hash-link" aria-label="Direct link to RxPipeline methods" title="Direct link to RxPipeline methods" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="awaitidle">awaitIdle()<a href="#awaitidle" class="hash-link" aria-label="Direct link to awaitIdle()" title="Direct link to awaitIdle()" translate="no">â€‹</a></h3>
<p>You can await the idleness of a pipeline with <code>await myRxPipeline.awaitIdle()</code>. This will await a promise that resolves when the pipeline has processed all documents and is not running anymore.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="close">close()<a href="#close" class="hash-link" aria-label="Direct link to close()" title="Direct link to close()" translate="no">â€‹</a></h3>
<p><code>await myRxPipeline.close()</code> stops the pipeline so that it is no longer doing stuff. This is automatically called when the RxCollection or RxDatabase of the pipeline is closed.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remove">remove()<a href="#remove" class="hash-link" aria-label="Direct link to remove()" title="Direct link to remove()" translate="no">â€‹</a></h3>
<p><code>await myRxPipeline.remove()</code> removes the pipeline and all metadata which it has stored. Recreating the pipeline afterwards will start processing all source documents from scratch.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-rxpipeline-correctly">Using RxPipeline correctly<a href="#using-rxpipeline-correctly" class="hash-link" aria-label="Direct link to Using RxPipeline correctly" title="Direct link to Using RxPipeline correctly" translate="no">â€‹</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipeline-handlers-must-be-idempotent">Pipeline handlers must be idempotent<a href="#pipeline-handlers-must-be-idempotent" class="hash-link" aria-label="Direct link to Pipeline handlers must be idempotent" title="Direct link to Pipeline handlers must be idempotent" translate="no">â€‹</a></h3>
<p>Because a JavaScript process can exit at any time, like when the user closes a browser tab, the pipeline handler function must be idempotent. This means when it only runs partially and is started again with the same input, it should still end up in the correct result.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipeline-handlers-must-not-throw">Pipeline handlers must not throw<a href="#pipeline-handlers-must-not-throw" class="hash-link" aria-label="Direct link to Pipeline handlers must not throw" title="Direct link to Pipeline handlers must not throw" translate="no">â€‹</a></h3>
<p>Pipeline handlers must never throw. If you run operations inside of the handler that might cause errors, you must wrap the handler&#x27;s code with a <code>try-catch</code> by yourself and also handle retries. If your handler throws, your pipeline will be stuck and no longer be usable, which should never happen.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="be-careful-when-doing-http-requests-in-the-handler">Be careful when doing http requests in the handler<a href="#be-careful-when-doing-http-requests-in-the-handler" class="hash-link" aria-label="Direct link to Be careful when doing http requests in the handler" title="Direct link to Be careful when doing http requests in the handler" translate="no">â€‹</a></h3>
<p>When you run http requests inside of your handler, you no longer have an <a class="" href="/offline-first.html">offline first</a> application because reads to the destination collection will be blocked until all handlers have finished. When your client is offline, therefore the collection will be blocked for reads and writes.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipelines-temporarily-block-external-reads-and-writes">Pipelines temporarily block external reads and writes<a href="#pipelines-temporarily-block-external-reads-and-writes" class="hash-link" aria-label="Direct link to Pipelines temporarily block external reads and writes" title="Direct link to Pipelines temporarily block external reads and writes" translate="no">â€‹</a></h3>
<p>While a pipeline is running, <strong>all reads and writes to its destination collection are blocked</strong>. This guarantees that queries never observe partially processed data, but it also means that pipelines can block each other if they interact incorrectly.</p>
<p>Problems occur when multiple pipelines:</p>
<ul>
<li class="">read or write across the same collections, or</li>
<li class="">wait for each other using <code>awaitIdle()</code> from inside a pipeline handler.</li>
</ul>
<figure data-rehype-pretty-code-figure=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="position:relative;--prism-background-color:var(--bg-color-code);--prism-color:var(--shiki-foreground)"><pre style="background-color:var(--shiki-background);color:var(--shiki-foreground)" tabindex="0" data-language="ts" data-theme="css-variables"><code data-language="ts" data-theme="css-variables" style="display:grid"><span data-line=""><span style="color:var(--shiki-token-comment)">// Example of a deadlock</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Pipeline A: files â†’ files (reads folders)</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">const</span><span style="color:var(--shiki-token-constant)"> pipelineA</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> db</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">files</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;file-path-sync&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> db</span><span style="color:var(--shiki-foreground)">.files</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">  handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> (docs) </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">    const</span><span style="color:var(--shiki-token-constant)"> folders</span><span style="color:var(--shiki-token-keyword)"> =</span><span style="color:var(--shiki-token-keyword)"> await</span><span style="color:var(--shiki-token-constant)"> folders</span><span style="color:var(--shiki-token-function)">.find</span><span style="color:var(--shiki-foreground)">()</span><span style="color:var(--shiki-token-function)">.exec</span><span style="color:var(--shiki-foreground)">(); </span><span style="color:var(--shiki-token-comment)">// can block</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">    /* ... */</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span>
<span data-line=""> </span>
<span data-line=""><span style="color:var(--shiki-token-comment)">// Pipeline B: files â†’ folders (waits for A)</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">await</span><span style="color:var(--shiki-token-constant)"> db</span><span style="color:var(--shiki-token-function)">.</span><span style="color:var(--shiki-token-constant)">folders</span><span style="color:var(--shiki-token-function)">.addPipeline</span><span style="color:var(--shiki-foreground)">({</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  identifier</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-string-expression)"> &#x27;file-count&#x27;</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  destination</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-constant)"> db</span><span style="color:var(--shiki-foreground)">.folders</span><span style="color:var(--shiki-token-punctuation)">,</span></span>
<span data-line=""><span style="color:var(--shiki-token-function)">  handler</span><span style="color:var(--shiki-token-keyword)">:</span><span style="color:var(--shiki-token-keyword)"> async</span><span style="color:var(--shiki-foreground)"> () </span><span style="color:var(--shiki-token-keyword)">=&gt;</span><span style="color:var(--shiki-foreground)"> {</span></span>
<span data-line=""><span style="color:var(--shiki-token-keyword)">    await</span><span style="color:var(--shiki-token-constant)"> pipelineA</span><span style="color:var(--shiki-token-function)">.awaitIdle</span><span style="color:var(--shiki-foreground)">(); </span><span style="color:var(--shiki-token-comment)">// âŒ may deadlock</span></span>
<span data-line=""><span style="color:var(--shiki-token-comment)">    /* ... */</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">  }</span></span>
<span data-line=""><span style="color:var(--shiki-foreground)">});</span></span></code></pre><div class="buttonGroup_M5ko"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_IEyt" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_TrPX"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_cVMy"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></figure>
<p>To prevent deadlocks, consider:</p>
<ul>
<li class="">Never call <code>awaitIdle()</code> inside a pipeline handler.</li>
<li class="">Avoid circular dependencies between pipelines.</li>
<li class="">Prefer one-directional data flow.</li>
</ul></div></article><ul style="margin-top:25px;list-style-type:none"><li style="line-height:4;color:var(--expo-theme-text-secondary)">Was this page helpful?<div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div><div style="border-radius:3px;border-color:var(--fontColor-offwhite);border-style:solid;border-width:1px;vertical-align:middle;padding:5px;padding-left:8px;padding-right:8px;text-align:center;justify-content:center;display:inline-flex;margin-left:20px;cursor:pointer;transform:scale(1, -1)"><img src="/img/thumbs-up-white.svg" loading="lazy" height="14"></div></li><li><a href="/chat/" target="_blank" style="color:var(--fontColor-offwhite)"><img src="/img/community-links/discord-logo.svg" style="padding-right:16px;height:18px;vertical-align:middle" loading="lazy">Ask a question on the forums about <!-- -->RxPipeline</a></li></ul><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a href="/rx-attachment.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:left;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:left;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Previous</span><br>Â« <!-- -->Attachments</a><a href="/reactivity.html" class="padding-button" style="display:inline-flex;height:auto;flex-direction:row;justify-content:right;align-items:center;gap:10px;font-size:1rem;font-weight:500;cursor:pointer;text-align:right;transition:all 0.2s ease-in-out;line-height:initial;user-select:none;box-sizing:border-box;text-decoration:none;position:relative;overflow:hidden;background:transparent;color:#fff;border:2px solid #fff;padding-top:14px;padding-bottom:14px"><span style="font-size:80%;display:contents">Next</span><br>Custom Reactivity<!-- --> Â»</a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-a-rxpipeline" class="table-of-contents__link toc-highlight">Creating a RxPipeline</a></li><li><a href="#use-cases-for-rxpipeline" class="table-of-contents__link toc-highlight">Use Cases for RxPipeline</a><ul><li><a href="#usecase-re-index-data-that-comes-from-replication" class="table-of-contents__link toc-highlight">UseCase: Re-Index data that comes from replication</a></li><li><a href="#usecase-fulltext-search" class="table-of-contents__link toc-highlight">UseCase: Fulltext Search</a></li><li><a href="#usecase-download-data-based-on-source-documents" class="table-of-contents__link toc-highlight">UseCase: Download data based on source documents</a></li></ul></li><li><a href="#rxpipeline-methods" class="table-of-contents__link toc-highlight">RxPipeline methods</a><ul><li><a href="#awaitidle" class="table-of-contents__link toc-highlight">awaitIdle()</a></li><li><a href="#close" class="table-of-contents__link toc-highlight">close()</a></li><li><a href="#remove" class="table-of-contents__link toc-highlight">remove()</a></li></ul></li><li><a href="#using-rxpipeline-correctly" class="table-of-contents__link toc-highlight">Using RxPipeline correctly</a><ul><li><a href="#pipeline-handlers-must-be-idempotent" class="table-of-contents__link toc-highlight">Pipeline handlers must be idempotent</a></li><li><a href="#pipeline-handlers-must-not-throw" class="table-of-contents__link toc-highlight">Pipeline handlers must not throw</a></li><li><a href="#be-careful-when-doing-http-requests-in-the-handler" class="table-of-contents__link toc-highlight">Be careful when doing http requests in the handler</a></li><li><a href="#pipelines-temporarily-block-external-reads-and-writes" class="table-of-contents__link toc-highlight">Pipelines temporarily block external reads and writes</a></li></ul></li></ul></div></div></div></div></main></div></div></div><div class="block footer dark"><div style="display:flex;flex-wrap:wrap;gap:44px" class="content"><div class="half left"><span><a variant="text" href="/" class="footer-logo-button"><img src="/files/logo/logo_text_white.svg" alt="RxDB" loading="lazy" class="width-140-120"></a><div class="footer-community-links"><a variant="text" href="/newsletter/" target="_blank" aria-label="Newsletter"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M22.5 13.5v-7a2 2 0 0 0-2-2h-16a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h8"></path><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m22.5 7.5-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2.5 7.5M19.5 16.5v6M16.5 19.5h6"></path></svg></a><a variant="text" href="https://twitter.com/intent/user?screen_name=rxdbjs" target="_blank" aria-label="Twitter"><img src="/files/icons/twitter-blue.svg" alt="Twitter" loading="lazy"></a><a variant="text" href="https://www.linkedin.com/company/rxdb" target="_blank" aria-label="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 21"><g clip-path="url(#a)"><path fill="#fff" d="M17.3 17.6h-3V13c0-1 0-2.5-1.6-2.5-1.5 0-1.8 1.2-1.8 2.5v4.7H8V8h2.9v1.3a3 3 0 0 1 2.9-1.6c3 0 3.6 2 3.6 4.6zM4.5 6.6a1.7 1.7 0 1 1 0-3.5 1.7 1.7 0 0 1 0 3.5m1.5 11H3V8h3zM18.8.4H1.5A1.5 1.5 0 0 0 0 1.8v17.4a1.5 1.5 0 0 0 1.5 1.4h17.3a1.5 1.5 0 0 0 1.5-1.4V1.8A1.5 1.5 0 0 0 18.8.4"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 .4h24v20.5H0z"></path></clipPath></defs></svg></a><a variant="text" href="/code/" target="_blank" aria-label="Github"><span class="navbar-icon-github" style="width:22px;height:22px;display:inline-block"></span></a><a variant="text" href="/chat/" target="_blank" aria-label="Discord"><span class="navbar-icon-discord" style="width:22px;height:22px;display:inline-block"></span></a></div></span></div><div class="half right" style="display:flex;flex:1"><div style="display:flex"><div class="footer-links min-width-180-135"><a variant="text" href="/overview.html" target="">Docs</a><a variant="text" href="/replication.html" target="">Sync</a><a variant="text" href="/rx-storage.html" target="">Storages</a><a variant="text" href="/premium/" target="_blank">Premium</a><a variant="text" href="/consulting/" target="_blank">Support</a></div><div class="footer-links min-width-180-135"><a variant="text" href="/#reviews" target="">Our Customers</a><a variant="text" href="/consulting#become-partner" target="">Become a Partner</a><a variant="text" href="/legal-notice/" target="_blank">Legal Notice</a></div></div></div></div></div><div class="navbar-line" style="display:block;z-index:10;height:1.5px;background-color:var(--color-top);border-top-right-radius:2px;border-bottom-right-radius:2px;width:100%"></div><div class="call-to-action-popup"><div class="close-popup"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="" style="transform:scale(1);transition:transform 0.2s ease-in-out;display:inline-block;cursor:pointer"><path d="M4 16H8L8 12H4L4 16Z" fill="white"></path><path d="M0 20H4L4 16H0L0 20Z" fill="white"></path><path d="M8 11.9999H12V7.99992H8L8 11.9999Z" fill="white"></path><path d="M4 8.00008H8L8 4.00008H4L4 8.00008Z" fill="white"></path><path d="M0 4.00004L4 4.00004L4 3.8147e-05L0 3.8147e-05L0 4.00004Z" fill="white"></path><path d="M16 11.9999H12V15.9999H16V11.9999Z" fill="white"></path><path d="M20 16H16V20H20V16Z" fill="white"></path><path d="M16 4.00004H12V8.00004H16V4.00004Z" fill="white"></path><path d="M20 0H16V4H20V0Z" fill="white"></path></svg></div></div></div>
</body>
</html>