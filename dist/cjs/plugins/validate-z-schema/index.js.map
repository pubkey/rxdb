{"version":3,"file":"index.js","names":["_zSchema","_interopRequireDefault","require","_pluginHelpers","getValidator","schema","validatorInstance","ZSchema","validator","obj","validate","docData","useValidator","errors","getLastErrors","formattedZSchemaErrors","map","title","description","message","path","wrappedValidateZSchemaStorage","exports","wrappedValidateStorageFactory"],"sources":["../../../../src/plugins/validate-z-schema/index.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using z-schema as jsonschema-validator\n * @link https://github.com/zaggino/z-schema\n */\nimport ZSchema from 'z-schema';\nimport type { RxJsonSchema } from '../../types/index.d.ts';\nimport { wrappedValidateStorageFactory } from '../../plugin-helpers.ts';\n\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validatorInstance = new (ZSchema as any)();\n    const validator = (obj: any) => {\n        validatorInstance.validate(obj, schema);\n        return validatorInstance;\n    };\n    return (docData: any) => {\n        const useValidator = validator(docData);\n        if (useValidator === true) {\n            return;\n        }\n        const errors: ZSchema.SchemaErrorDetail[] = (useValidator as any).getLastErrors();\n        if (errors) {\n            const formattedZSchemaErrors = (errors as any).map(({\n                title,\n                description,\n                message,\n                path\n            }: any) => ({\n                title,\n                description,\n                message,\n                path\n            }));\n            return formattedZSchemaErrors;\n        } else {\n            return [];\n        }\n    };\n}\n\nexport const wrappedValidateZSchemaStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'z-schema'\n);\n"],"mappings":";;;;;;;;AAKA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,cAAA,GAAAD,OAAA;AAPA;AACA;AACA;AACA;AACA;;AAMO,SAASE,YAAYA,CACxBC,MAAyB,EAC3B;EACE,IAAMC,iBAAiB,GAAG,IAAKC,gBAAO,CAAS,CAAC;EAChD,IAAMC,SAAS,GAAIC,GAAQ,IAAK;IAC5BH,iBAAiB,CAACI,QAAQ,CAACD,GAAG,EAAEJ,MAAM,CAAC;IACvC,OAAOC,iBAAiB;EAC5B,CAAC;EACD,OAAQK,OAAY,IAAK;IACrB,IAAMC,YAAY,GAAGJ,SAAS,CAACG,OAAO,CAAC;IACvC,IAAIC,YAAY,KAAK,IAAI,EAAE;MACvB;IACJ;IACA,IAAMC,MAAmC,GAAID,YAAY,CAASE,aAAa,CAAC,CAAC;IACjF,IAAID,MAAM,EAAE;MACR,IAAME,sBAAsB,GAAIF,MAAM,CAASG,GAAG,CAAC,CAAC;QAChDC,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACC,CAAC,MAAM;QACRH,KAAK;QACLC,WAAW;QACXC,OAAO;QACPC;MACJ,CAAC,CAAC,CAAC;MACH,OAAOL,sBAAsB;IACjC,CAAC,MAAM;MACH,OAAO,EAAE;IACb;EACJ,CAAC;AACL;AAEO,IAAMM,6BAA6B,GAAAC,OAAA,CAAAD,6BAAA,GAAG,IAAAE,4CAA6B,EACtEnB,YAAY,EACZ,UACJ,CAAC","ignoreList":[]}