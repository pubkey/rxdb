{"version":3,"file":"index.js","names":["_ajv","_interopRequireDefault","require","_ajvFormats","_pluginHelpers","ajv","getAjv","Ajv","strict","addKeyword","addFormats","getValidator","schema","validator","compile","docData","isValid","errors","wrappedValidateAjvStorage","exports","wrappedValidateStorageFactory"],"sources":["../../../../src/plugins/validate-ajv/index.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using ajv as jsonschema-validator\n * @link https://github.com/epoberezkin/ajv\n * @link https://github.com/ajv-validator/ajv/issues/2132#issuecomment-1537224620\n */\nimport Ajv from 'ajv';\nimport addFormats from 'ajv-formats';\nimport type {\n    RxDocumentData,\n    RxJsonSchema\n} from '../../types/index.d.ts';\nimport { wrappedValidateStorageFactory } from '../../plugin-helpers.ts';\n\n\nlet ajv: Ajv;\n\n\nexport function getAjv() {\n    if (!ajv) {\n        ajv = new Ajv({\n            strict: true\n        });\n        ajv.addKeyword('version');\n        ajv.addKeyword('keyCompression');\n        ajv.addKeyword('primaryKey');\n        ajv.addKeyword('indexes');\n        ajv.addKeyword('encrypted');\n        ajv.addKeyword('final');\n        ajv.addKeyword('sharding');\n        ajv.addKeyword('internalIndexes');\n        ajv.addKeyword('attachments');\n        ajv.addKeyword('ref');\n        ajv.addKeyword('crdt');\n        addFormats(ajv);\n    }\n    return ajv;\n}\n\n\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validator = getAjv().compile(schema);\n    return (docData: RxDocumentData<any>) => {\n        const isValid = validator(docData);\n        if (isValid) {\n            return [];\n        } else {\n            return validator.errors as any;\n        }\n    };\n}\n\n\n\nexport const wrappedValidateAjvStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'ajv'\n);\n"],"mappings":";;;;;;;;;AAMA,IAAAA,IAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAF,sBAAA,CAAAC,OAAA;AAKA,IAAAE,cAAA,GAAAF,OAAA;AAZA;AACA;AACA;AACA;AACA;AACA;;AAUA,IAAIG,GAAQ;AAGL,SAASC,MAAMA,CAAA,EAAG;EACrB,IAAI,CAACD,GAAG,EAAE;IACNA,GAAG,GAAG,IAAIE,YAAG,CAAC;MACVC,MAAM,EAAE;IACZ,CAAC,CAAC;IACFH,GAAG,CAACI,UAAU,CAAC,SAAS,CAAC;IACzBJ,GAAG,CAACI,UAAU,CAAC,gBAAgB,CAAC;IAChCJ,GAAG,CAACI,UAAU,CAAC,YAAY,CAAC;IAC5BJ,GAAG,CAACI,UAAU,CAAC,SAAS,CAAC;IACzBJ,GAAG,CAACI,UAAU,CAAC,WAAW,CAAC;IAC3BJ,GAAG,CAACI,UAAU,CAAC,OAAO,CAAC;IACvBJ,GAAG,CAACI,UAAU,CAAC,UAAU,CAAC;IAC1BJ,GAAG,CAACI,UAAU,CAAC,iBAAiB,CAAC;IACjCJ,GAAG,CAACI,UAAU,CAAC,aAAa,CAAC;IAC7BJ,GAAG,CAACI,UAAU,CAAC,KAAK,CAAC;IACrBJ,GAAG,CAACI,UAAU,CAAC,MAAM,CAAC;IACtB,IAAAC,mBAAU,EAACL,GAAG,CAAC;EACnB;EACA,OAAOA,GAAG;AACd;AAIO,SAASM,YAAYA,CACxBC,MAAyB,EAC3B;EACE,IAAMC,SAAS,GAAGP,MAAM,CAAC,CAAC,CAACQ,OAAO,CAACF,MAAM,CAAC;EAC1C,OAAQG,OAA4B,IAAK;IACrC,IAAMC,OAAO,GAAGH,SAAS,CAACE,OAAO,CAAC;IAClC,IAAIC,OAAO,EAAE;MACT,OAAO,EAAE;IACb,CAAC,MAAM;MACH,OAAOH,SAAS,CAACI,MAAM;IAC3B;EACJ,CAAC;AACL;AAIO,IAAMC,yBAAyB,GAAAC,OAAA,CAAAD,yBAAA,GAAG,IAAAE,4CAA6B,EAClET,YAAY,EACZ,KACJ,CAAC","ignoreList":[]}