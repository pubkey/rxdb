{"version":3,"file":"rx-schema-helper.js","names":["_rxError","require","_index","getPseudoSchemaForVersion","version","primaryKey","pseudoSchema","fillWithDefaultSettings","type","properties","maxLength","value","indexes","required","getSchemaByObjectPath","rxJsonSchema","path","usePath","replace","REGEX_ALL_DOTS","trimDots","ret","getProperty","fillPrimaryKey","primaryPath","jsonSchema","documentData","newPrimary","getComposedPrimaryKeyOfDocumentData","existingPrimary","newRxError","args","schema","getPrimaryFieldOfPrimaryKey","key","getLengthOfPrimaryKey","schemaPart","ensureNotFalsy","compositePrimary","fields","map","field","join","separator","normalizeRxJsonSchema","normalizedSchema","sortObject","getDefaultIndex","schemaObj","flatClone","additionalProperties","Object","prototype","hasOwnProperty","call","keyCompression","slice","encrypted","_rev","minLength","_attachments","_deleted","_meta","RX_META_SCHEMA","push","finalFields","getFinalFields","appendToArray","filter","includes","elem","pos","arr","indexOf","useIndexes","index","arIndex","isMaybeReadonlyArray","unshift","length","internalIndexes","idx","hasIndex","Set","indexStr","has","add","META_LWT_UNIX_TIME_MAX","exports","lwt","minimum","RX_META_LWT_MINIMUM","maximum","multipleOf","keys","final","forEach","fillObjectWithDefaults","rxSchema","obj","defaultKeys","defaultValues","i","DEFAULT_CHECKPOINT_SCHEMA","id"],"sources":["../../src/rx-schema-helper.ts"],"sourcesContent":["import { newRxError } from './rx-error.ts';\nimport type {\n    CompositePrimaryKey,\n    DeepReadonly,\n    JsonSchema,\n    PrimaryKey,\n    RxDocumentData,\n    RxJsonSchema,\n    RxStorageDefaultCheckpoint,\n    StringKeys\n} from './types/index.d.ts';\nimport {\n    appendToArray,\n    ensureNotFalsy,\n    flatClone,\n    getProperty,\n    isMaybeReadonlyArray,\n    REGEX_ALL_DOTS,\n    RX_META_LWT_MINIMUM,\n    sortObject,\n    trimDots\n} from './plugins/utils/index.ts';\nimport type { RxSchema } from './rx-schema.ts';\n\n/**\n * Helper function to create a valid RxJsonSchema\n * with a given version.\n */\nexport function getPseudoSchemaForVersion<T = any>(\n    version: number,\n    primaryKey: StringKeys<T>\n): RxJsonSchema<RxDocumentData<T>> {\n    const pseudoSchema: RxJsonSchema<RxDocumentData<T>> = fillWithDefaultSettings({\n        version,\n        type: 'object',\n        primaryKey: primaryKey as any,\n        properties: {\n            [primaryKey]: {\n                type: 'string',\n                maxLength: 100\n            },\n            value: {\n                type: 'string'\n            }\n        } as any,\n        indexes: [\n            [primaryKey]\n        ],\n        required: [primaryKey]\n    });\n    return pseudoSchema;\n}\n\n/**\n * Returns the sub-schema for a given path\n */\nexport function getSchemaByObjectPath<T = any>(\n    rxJsonSchema: RxJsonSchema<T>,\n    path: keyof T | string\n): JsonSchema {\n    let usePath: string = path as string;\n    usePath = usePath.replace(REGEX_ALL_DOTS, '.properties.');\n    usePath = 'properties.' + usePath;\n    usePath = trimDots(usePath);\n\n    const ret = getProperty(rxJsonSchema, usePath);\n    return ret;\n}\n\nexport function fillPrimaryKey<T>(\n    primaryPath: keyof T,\n    jsonSchema: RxJsonSchema<T>,\n    documentData: RxDocumentData<T>\n): RxDocumentData<T> {\n    // optimization shortcut.\n    if (typeof jsonSchema.primaryKey === 'string') {\n        return documentData;\n    }\n\n    const newPrimary = getComposedPrimaryKeyOfDocumentData<T>(\n        jsonSchema,\n        documentData\n    );\n    const existingPrimary: string | undefined = documentData[primaryPath] as any;\n    if (\n        existingPrimary &&\n        existingPrimary !== newPrimary\n    ) {\n        throw newRxError(\n            'DOC19',\n            {\n                args: {\n                    documentData,\n                    existingPrimary,\n                    newPrimary,\n                },\n                schema: jsonSchema\n            });\n    }\n\n    (documentData as any)[primaryPath] = newPrimary;\n    return documentData;\n}\n\nexport function getPrimaryFieldOfPrimaryKey<RxDocType>(\n    primaryKey: PrimaryKey<RxDocType>\n): StringKeys<RxDocType> {\n    if (typeof primaryKey === 'string') {\n        return primaryKey as any;\n    } else {\n        return (primaryKey as CompositePrimaryKey<RxDocType>).key;\n    }\n}\n\nexport function getLengthOfPrimaryKey<RxDocType>(\n    schema: RxJsonSchema<RxDocumentData<RxDocType>>\n): number {\n    const primaryPath = getPrimaryFieldOfPrimaryKey(schema.primaryKey);\n    const schemaPart = getSchemaByObjectPath(schema, primaryPath);\n    return ensureNotFalsy(schemaPart.maxLength);\n}\n\n/**\n * Returns the composed primaryKey of a document by its data.\n */\nexport function getComposedPrimaryKeyOfDocumentData<RxDocType>(\n    jsonSchema: RxJsonSchema<RxDocType> | RxJsonSchema<RxDocumentData<RxDocType>>,\n    documentData: Partial<RxDocType>\n): string {\n    if (typeof jsonSchema.primaryKey === 'string') {\n        return (documentData as any)[jsonSchema.primaryKey];\n    }\n\n    const compositePrimary: CompositePrimaryKey<RxDocType> = jsonSchema.primaryKey as any;\n    return compositePrimary.fields.map(field => {\n        const value = getProperty(documentData as any, field as string);\n        if (typeof value === 'undefined') {\n            throw newRxError('DOC18', { args: { field, documentData } });\n        }\n        return value;\n    }).join(compositePrimary.separator);\n}\n\n\n/**\n * Normalize the RxJsonSchema.\n * We need this to ensure everything is set up properly\n * and we have the same hash on schemas that represent the same value but\n * have different json.\n *\n * - Orders the schemas attributes by alphabetical order\n * - Adds the primaryKey to all indexes that do not contain the primaryKey\n * - We need this for deterministic sort order on all queries, which is required for event-reduce to work.\n *\n * @return RxJsonSchema - ordered and filled\n */\nexport function normalizeRxJsonSchema<T>(jsonSchema: RxJsonSchema<T>): RxJsonSchema<T> {\n    const normalizedSchema: RxJsonSchema<T> = sortObject(jsonSchema, true);\n    return normalizedSchema;\n}\n\n/**\n * If the schema does not specify any index,\n * we add this index so we at least can run RxQuery()\n * and only select non-deleted fields.\n */\nexport function getDefaultIndex(primaryPath: string) {\n    return ['_deleted', primaryPath];\n}\n\n/**\n * fills the schema-json with default-settings\n * @return cloned schemaObj\n */\nexport function fillWithDefaultSettings<T = any>(\n    schemaObj: RxJsonSchema<T>\n): RxJsonSchema<RxDocumentData<T>> {\n    schemaObj = flatClone(schemaObj);\n    const primaryPath: string = getPrimaryFieldOfPrimaryKey(schemaObj.primaryKey);\n    schemaObj.properties = flatClone(schemaObj.properties);\n\n    // additionalProperties is always false\n    schemaObj.additionalProperties = false;\n\n    // fill with key-compression-state ()\n    if (!Object.prototype.hasOwnProperty.call(schemaObj, 'keyCompression')) {\n        schemaObj.keyCompression = false;\n    }\n\n    // indexes must be array\n    schemaObj.indexes = schemaObj.indexes ? schemaObj.indexes.slice(0) : [];\n\n    // required must be array\n    schemaObj.required = schemaObj.required ? schemaObj.required.slice(0) : [];\n\n    // encrypted must be array\n    schemaObj.encrypted = schemaObj.encrypted ? schemaObj.encrypted.slice(0) : [];\n\n    // add _rev\n    (schemaObj.properties as any)._rev = {\n        type: 'string',\n        minLength: 1\n    };\n\n    // add attachments\n    (schemaObj.properties as any)._attachments = {\n        type: 'object'\n    };\n\n    // add deleted flag\n    (schemaObj.properties as any)._deleted = {\n        type: 'boolean'\n    };\n\n    // add meta property\n    (schemaObj.properties as any)._meta = RX_META_SCHEMA;\n\n    /**\n     * meta fields are all required\n     */\n    schemaObj.required = schemaObj.required ? schemaObj.required.slice(0) : [];\n    (schemaObj.required as string[]).push('_deleted');\n    (schemaObj.required as string[]).push('_rev');\n    (schemaObj.required as string[]).push('_meta');\n    (schemaObj.required as string[]).push('_attachments');\n\n    // final fields are always required\n    const finalFields = getFinalFields(schemaObj);\n    appendToArray(schemaObj.required as any, finalFields);\n    schemaObj.required = schemaObj.required\n        .filter((field: string) => !field.includes('.'))\n        .filter((elem: any, pos: any, arr: any) => arr.indexOf(elem) === pos); // unique;\n\n\n    // version is 0 by default\n    schemaObj.version = schemaObj.version || 0;\n\n    const useIndexes: string[][] = schemaObj.indexes.map(index => {\n        const arIndex = isMaybeReadonlyArray(index) ? index.slice(0) : [index];\n        /**\n         * Append primary key to indexes that do not contain the primaryKey.\n         * All indexes must have the primaryKey to ensure a deterministic sort order.\n         */\n        if (!arIndex.includes(primaryPath)) {\n            arIndex.push(primaryPath);\n        }\n\n        // add _deleted flag to all indexes so we can query only non-deleted fields\n        // in RxDB itself\n        if (arIndex[0] !== '_deleted') {\n            arIndex.unshift('_deleted');\n        }\n\n        return arIndex;\n    });\n\n    if (useIndexes.length === 0) {\n        useIndexes.push(getDefaultIndex(primaryPath));\n    }\n\n    // we need this index for the getChangedDocumentsSince() method\n    useIndexes.push(['_meta.lwt', primaryPath]);\n\n    // also add the internalIndexes\n    if (schemaObj.internalIndexes) {\n        schemaObj.internalIndexes.map(idx => {\n            useIndexes.push(idx);\n        });\n    }\n\n    // make indexes unique\n    const hasIndex = new Set<string>();\n    useIndexes.filter(index => {\n        const indexStr = index.join(',');\n        if (hasIndex.has(indexStr)) {\n            return false;\n        } else {\n            hasIndex.add(indexStr);\n            return true;\n        }\n    });\n\n    schemaObj.indexes = useIndexes;\n\n    return schemaObj as any;\n}\n\nexport const META_LWT_UNIX_TIME_MAX = 1000000000000000;\nexport const RX_META_SCHEMA: JsonSchema = {\n    type: 'object',\n    properties: {\n        /**\n         * The last-write time.\n         * Unix time in milliseconds.\n         */\n        lwt: {\n            type: 'number',\n            /**\n             * We use 1 as minimum so that the value is never falsy.\n             */\n            minimum: RX_META_LWT_MINIMUM,\n            maximum: META_LWT_UNIX_TIME_MAX,\n            multipleOf: 0.01\n        }\n    },\n    /**\n     * Additional properties are allowed\n     * and can be used by plugins to set various flags.\n     */\n    additionalProperties: true as any,\n    required: [\n        'lwt'\n    ]\n};\n\n\n/**\n * returns the final-fields of the schema\n * @return field-names of the final-fields\n */\nexport function getFinalFields<T = any>(\n    jsonSchema: RxJsonSchema<T>\n): string[] {\n    const ret = Object.keys(jsonSchema.properties)\n        .filter(key => (jsonSchema as any).properties[key].final);\n\n    // primary is also final\n    const primaryPath = getPrimaryFieldOfPrimaryKey(jsonSchema.primaryKey);\n    ret.push(primaryPath);\n\n    // fields of composite primary are final\n    if (typeof jsonSchema.primaryKey !== 'string') {\n        (jsonSchema.primaryKey as CompositePrimaryKey<T>).fields\n            .forEach(field => ret.push(field as string));\n    }\n\n    return ret;\n}\n\n/**\n * fills all unset fields with default-values if set\n * @hotPath\n */\nexport function fillObjectWithDefaults(rxSchema: RxSchema<any>, obj: any): any {\n    const defaultKeys = Object.keys(rxSchema.defaultValues);\n    for (let i = 0; i < defaultKeys.length; ++i) {\n        const key = defaultKeys[i];\n        if (!Object.prototype.hasOwnProperty.call(obj, key) || typeof obj[key] === 'undefined') {\n            obj[key] = rxSchema.defaultValues[key];\n        }\n    }\n    return obj;\n}\n\nexport const DEFAULT_CHECKPOINT_SCHEMA: DeepReadonly<JsonSchema<RxStorageDefaultCheckpoint>> = {\n    type: 'object',\n    properties: {\n        id: {\n            type: 'string'\n        },\n        lwt: {\n            type: 'number'\n        }\n    },\n    required: [\n        'id',\n        'lwt'\n    ],\n    additionalProperties: false\n} as const;\n"],"mappings":"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","ignoreList":[]}