{"version":3,"file":"graphql-schema-from-rx-schema.js","names":["SPACING","graphQLSchemaFromRxSchema","input","ret","asString","queries","mutations","subscriptions","inputs","types","Object","entries","forEach","collectionName","collectionSettings","fillUpOptionals","schema","prefixes","ensureNotFalsy","ucCollectionName","ucfirst","collectionNameInput","inputSchema","stripKeysFromSchema","ignoreInputKeys","inputGraphQL","getGraphqlSchemaFromJsonSchema","rootName","direction","pushRowGraphQL","pushRow","type","properties","assumedMasterState","newDocumentState","required","additionalProperties","checkpointSchema","checkpointFields","key","subSchema","push","checkpointInputGraphQL","checkpoint","headersSchema","headerFields","headerField","headersInputName","headers","headersInputGraphQL","concat","typeDefinitions","map","str","replaceTopLevelTypeName","outputSchema","ignoreOutputKeys","outputGraphQL","checkpointOutputGraphQL","pullBulkOutputGraphQL","pullBulk","documents","items","queryName","pull","queryKeys","queryString","join","mutationName","mutationString","subscriptionHeaderInputString","length","subscriptionName","stream","subscriptionString","fullQueryString","fullMutationString","fullSubscriptionString","fullTypeString","fullInputString","fullSchemaString","flatClone","fillWithDefaultSettings","keys","startsWith","deletedField","withRevisions","strip","cloned","clone","replace"],"sources":["../../../../src/plugins/replication-graphql/graphql-schema-from-rx-schema.ts"],"sourcesContent":["import { getGraphqlSchemaFromJsonSchema } from 'get-graphql-from-jsonschema';\n\nimport { fillWithDefaultSettings } from '../../rx-schema-helper';\n\nimport { RxJsonSchema } from '../../types';\nimport { clone, ensureNotFalsy, flatClone, ucfirst } from '../../util';\n\nexport type Prefixes = {\n    push?: string;\n    pushRow?: string;\n    checkpoint?: string;\n    pull?: string;\n    pullBulk?: string;\n    stream?: string;\n    headers?: string;\n};\n\n/**\n * just type some common types\n * to have better IDE autocomplete,\n * all strings are allowed\n */\nexport type GraphQLParamType = 'ID' | 'ID!' |\n    'String' | 'String!' |\n    'Int' | 'Int!' |\n    'Float' | 'Float!' |\n    string;\n\nexport type GraphQLSchemaFromRxSchemaInputSingleCollection = {\n    schema: RxJsonSchema<any>;\n    /**\n     * These fields of the document data\n     * will be used for the checkpoint.\n     */\n    checkpointFields: string[];\n    ignoreInputKeys?: string[];\n    ignoreOutputKeys?: string[];\n    withRevisions?: boolean;\n    prefixes?: Prefixes;\n    headerFields?: string[];\n    /**\n     * Name of the boolean field that marks deleted documents.\n     * [default='_deleted']\n     */\n    deletedField?: string;\n};\n\nexport type GraphQLSchemaFromRxSchemaInput = {\n    [collectionName: string]: GraphQLSchemaFromRxSchemaInputSingleCollection\n};\nexport type GraphQLSchemaFromRxSchemaOutput = {\n    asString: string;\n    queries: string[];\n    mutations: string[];\n    subscriptions: string[];\n    inputs: string[];\n    types: string[];\n};\n\n// we use two spaces because get-graphql-from-jsonschema does also\nexport const SPACING = '  ';\n\n/**\n * Create a GraphQL schema from a given RxJsonSchema\n */\nexport function graphQLSchemaFromRxSchema(\n    input: GraphQLSchemaFromRxSchemaInput\n): GraphQLSchemaFromRxSchemaOutput {\n    const ret: GraphQLSchemaFromRxSchemaOutput = {\n        asString: '',\n        queries: [],\n        mutations: [],\n        subscriptions: [],\n        inputs: [],\n        types: []\n    };\n\n\n    Object.entries(input).forEach(([collectionName, collectionSettings]) => {\n        collectionSettings = fillUpOptionals(collectionSettings);\n\n        const schema = collectionSettings.schema;\n        const prefixes: Prefixes = ensureNotFalsy(collectionSettings.prefixes);\n        const ucCollectionName = ucfirst(collectionName);\n        const collectionNameInput = ucfirst(collectionName) + 'Input';\n\n        // input\n        const inputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreInputKeys));\n\n        const inputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput,\n            schema: inputSchema as any,\n            direction: 'input'\n        });\n        const pushRowGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput + prefixes.pushRow,\n            schema: {\n                type: 'object',\n                properties: {\n                    assumedMasterState: inputSchema as any,\n                    newDocumentState: inputSchema as any\n                },\n                required: ['newDocumentState'],\n                additionalProperties: false\n            },\n            direction: 'input'\n        });\n\n        const checkpointSchema = {\n            type: 'object',\n            properties: {},\n            required: [],\n            additionalProperties: false\n        } as any;\n        collectionSettings.checkpointFields.forEach(key => {\n            const subSchema: any = schema.properties[key];\n            checkpointSchema.properties[key] = subSchema;\n            checkpointSchema.required.push(key);\n        });\n        const checkpointInputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput + prefixes.checkpoint,\n            schema: checkpointSchema as any,\n            direction: 'input'\n        });\n\n        const headersSchema: any = {\n            type: 'object',\n            additionalProperties: false,\n            properties: {},\n            required: []\n        };\n        ensureNotFalsy(collectionSettings.headerFields).forEach(headerField => {\n            headersSchema.properties[headerField] = {\n                type: 'string'\n            };\n            headersSchema.required.push(headerField);\n        });\n        const headersInputName = collectionNameInput + prefixes.headers;\n        const headersInputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: headersInputName,\n            schema: headersSchema,\n            direction: 'input'\n        });\n\n\n        ret.inputs = ret.inputs.concat(\n            inputGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput))\n        ).concat(\n            pushRowGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.pushRow))\n        ).concat(\n            checkpointInputGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.checkpoint))\n        ).concat(\n            headersInputGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, headersInputName))\n        );\n\n        // output\n        const outputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreOutputKeys));\n        const outputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionName,\n            schema: outputSchema as any,\n            direction: 'output'\n        });\n        const checkpointOutputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: ucCollectionName + prefixes.checkpoint,\n            schema: checkpointSchema as any,\n            direction: 'output'\n        });\n        const pullBulkOutputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: ucCollectionName + prefixes.pullBulk,\n            schema: {\n                type: 'object',\n                properties: {\n                    documents: {\n                        type: 'array',\n                        items: inputSchema as any\n                    },\n                    checkpoint: checkpointSchema as any\n                },\n                required: ['documents', 'checkpoint'],\n                additionalProperties: false\n            },\n            direction: 'output'\n        });\n        ret.types = ret.types.concat(\n            outputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName))\n        ).concat(\n            checkpointOutputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.checkpoint))\n        ).concat(\n            pullBulkOutputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.pullBulk))\n        );\n\n        // query\n        const queryName = prefixes.pull + ucCollectionName;\n        const queryKeys = [\n            'checkpoint: ' + collectionNameInput + prefixes.checkpoint,\n            'limit: Int!'\n        ];\n        const queryString = queryName + '(' + queryKeys.join(', ') + '): ' + ucCollectionName + prefixes.pullBulk + '!';\n        ret.queries.push(SPACING + queryString);\n\n        // mutation\n        const mutationName = prefixes.push + ucCollectionName;\n        const mutationString = mutationName + '(' + collectionName + prefixes.pushRow + ': [' + collectionNameInput + prefixes.pushRow + ']): [' + ucCollectionName + '!]!';\n        ret.mutations.push(SPACING + mutationString);\n\n        // subscription\n        let subscriptionHeaderInputString = '';\n        if (collectionSettings.headerFields && collectionSettings.headerFields.length > 0) {\n            subscriptionHeaderInputString = '(headers: ' + headersInputName + ')';\n        }\n        const subscriptionName = prefixes.stream + ucCollectionName;\n        const subscriptionString = subscriptionName + subscriptionHeaderInputString + ': ' + ucCollectionName + prefixes.pullBulk + '!';\n        ret.subscriptions.push(SPACING + subscriptionString);\n    });\n\n    // build full string\n    const fullQueryString = 'type Query {\\n' + ret.queries.join('\\n') + '\\n}\\n';\n    const fullMutationString = 'type Mutation {\\n' + ret.mutations.join('\\n') + '\\n}\\n';\n    const fullSubscriptionString = 'type Subscription {\\n' + ret.subscriptions.join('\\n') + '\\n}\\n';\n\n    const fullTypeString = ret.types.join('\\n');\n    const fullInputString = ret.inputs.join('\\n');\n\n    const fullSchemaString = '' +\n        'schema {\\n' +\n        SPACING + 'query: Query\\n' +\n        SPACING + 'mutation: Mutation\\n' +\n        SPACING + 'subscription: Subscription\\n' +\n        '}\\n';\n\n    ret.asString = '' +\n        fullQueryString + '\\n' +\n        fullMutationString + '\\n' +\n        fullSubscriptionString + '\\n' +\n        fullTypeString + '\\n' +\n        fullInputString + '\\n' +\n        fullSchemaString;\n\n    return ret;\n}\n\n\nexport function fillUpOptionals(\n    input: GraphQLSchemaFromRxSchemaInputSingleCollection\n): GraphQLSchemaFromRxSchemaInputSingleCollection {\n    input = flatClone(input);\n\n    const schema = fillWithDefaultSettings(input.schema);\n    // strip internal attributes\n    Object.keys(schema.properties).forEach(key => {\n        if (key.startsWith('_')) {\n            delete schema.properties[key];\n        }\n    });\n    input.schema = schema;\n\n    // add deleted field to schema\n    if (!input.deletedField) {\n        input.deletedField = '_deleted';\n    }\n    schema.properties[input.deletedField] = {\n        type: 'boolean'\n    };\n    (schema.required as string[]).push(input.deletedField);\n\n    // fill up prefixes\n    if (!input.prefixes) {\n        input.prefixes = {} as any;\n    }\n    const prefixes: Prefixes = input.prefixes as any;\n    if (!prefixes.push) {\n        prefixes.push = 'push';\n    }\n    if (!prefixes.pushRow) {\n        prefixes.pushRow = 'PushRow';\n    }\n    if (!prefixes.checkpoint) {\n        prefixes.checkpoint = 'Checkpoint';\n    }\n    if (!prefixes.pull) {\n        prefixes.pull = 'pull';\n    }\n    if (!prefixes.pullBulk) {\n        prefixes.pullBulk = 'PullBulk';\n    }\n    if (!prefixes.stream) {\n        prefixes.stream = 'stream';\n    }\n    if (!prefixes.headers) {\n        prefixes.headers = 'Headers';\n    }\n    if (!input.headerFields) {\n        input.headerFields = [];\n    }\n\n\n    if (!input.withRevisions) {\n        input.withRevisions = false;\n    }\n\n    if (!input.ignoreInputKeys) {\n        input.ignoreInputKeys = [];\n    }\n    if (!input.ignoreOutputKeys) {\n        input.ignoreOutputKeys = [];\n    }\n\n    return input;\n}\n\nfunction stripKeysFromSchema<T>(schema: RxJsonSchema<T>, strip: string[]): RxJsonSchema<Partial<T>> {\n    const cloned: any = clone(schema);\n    strip.forEach(key => {\n        delete cloned.properties[key];\n    });\n    return cloned;\n}\n\n/**\n * get-graphql-from-jsonschema add a T0-suffix\n * that we do not want for the top level type\n */\nfunction replaceTopLevelTypeName(str: string, ucCollectionName: string): string {\n    return str.replace(' ' + ucCollectionName + 'T0 ', ' ' + ucCollectionName + ' ');\n}\n"],"mappings":"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"}