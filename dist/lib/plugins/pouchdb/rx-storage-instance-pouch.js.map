{"version":3,"file":"rx-storage-instance-pouch.js","names":["pact","state","value","s","v","o","bind","then","observer","prototype","onFulfilled","onRejected","result","callback","e","_this","thenable","test","update","body","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","pouchFindDocumentsById","instance","ids","deleted","ensureNotClosed","ret","nonParallelQueue","internals","pouch","changes","live","since","doc_ids","style","viaChanges","Promise","all","results","map","get","id","rev","firstDoc","useFirstDoc","pouchDocumentDataToRxDocumentData","primaryPath","allDocs","include_docs","keys","pouchResult","rows","filter","row","doc","forEach","docData","lastId","RxStorageInstancePouch","storage","databaseName","collectionName","schema","options","changes$","Subject","subs","closed","PROMISE_RESOLVE_VOID","OPEN_POUCHDB_STORAGE_INSTANCES","add","getPrimaryFieldOfPrimaryKey","primaryKey","emitter","getCustomEventEmitterByPouch","emittedEventBulkIds","ObliviousSet","eventSub","subject","subscribe","eventBulk","events","length","has","event","documentData","pouchSwapIdToPrimary","previousDocumentData","next","push","close","sub","unsubscribe","OPEN_POUCH_INSTANCES","pouchInstanceId","remove","destroy","bulkWrite","documentWrites","context","newRxError","args","writeRowById","Map","insertDocsById","writeDocs","writeData","document","_meta","lwt","previous","_rev","primary","set","storeDocumentData","rxDocumentDataToPouchDocumentData","previousDocsInDb","success","error","bulkDocs","new_edits","custom","resultRow","writeRow","getFromMapOrThrow","previousDoc","err","isError","status","documentId","documentInDb","pushObj","flatClone","_attachments","writeAttachmentsToAttachments","query","preparedQuery","find","findResult","documents","docs","pouchDoc","useDoc","count","mode","getAttachmentData","attachmentId","getAttachment","attachmentData","isBuffer","Buffer","Blob","blobBufferUtil","toBase64String","findDocumentsById","changeStream","asObservable","cleanup","_minimumDeletedTime","compact","getChangedDocumentsSince","limit","checkpoint","changedDocuments","documentsData","Object","sequence","lastSequence","Error","lastRow","lastOfArray","changeRow","getFromObjectOrThrow","pouchChangesOpts","descending","first","skippedDesignDocuments","pouchResults","addChangedDocuments","isDesignDoc","startsWith","POUCHDB_DESIGN_PREFIX","seq","concat","last_seq","conflictResultionTasks","resolveConflictResultionTask","_taskSolution"],"sources":["../../../../src/plugins/pouchdb/rx-storage-instance-pouch.ts"],"sourcesContent":["import { ObliviousSet } from 'oblivious-set';\nimport {\n    Observable,\n    Subject,\n    Subscription\n} from 'rxjs';\nimport { newRxError } from '../../rx-error';\nimport type {\n    BulkWriteRow,\n    EventBulk,\n    PouchBulkDocResultRow,\n    PouchChangesOptionsNonLive,\n    PouchCheckpoint,\n    PouchSettings,\n    PouchWriteError,\n    PreparedQuery,\n    RxConflictResultionTask,\n    RxConflictResultionTaskSolution,\n    RxDocumentData,\n    RxDocumentDataById,\n    RxJsonSchema,\n    RxStorage,\n    RxStorageBulkWriteError,\n    RxStorageBulkWriteResponse,\n    RxStorageChangeEvent,\n    RxStorageCountResult,\n    RxStorageInstance,\n    RxStorageQueryResult,\n    StringKeys\n} from '../../types';\nimport {\n    OPEN_POUCHDB_STORAGE_INSTANCES,\n    OPEN_POUCH_INSTANCES,\n    POUCHDB_DESIGN_PREFIX,\n    pouchDocumentDataToRxDocumentData,\n    PouchStorageInternals,\n    pouchSwapIdToPrimary,\n    rxDocumentDataToPouchDocumentData,\n    writeAttachmentsToAttachments\n} from './pouchdb-helper';\nimport {\n    blobBufferUtil,\n    flatClone,\n    getFromMapOrThrow,\n    getFromObjectOrThrow,\n    lastOfArray,\n    PROMISE_RESOLVE_VOID\n} from '../../util';\nimport {\n    getCustomEventEmitterByPouch\n} from './custom-events-plugin';\nimport { getPrimaryFieldOfPrimaryKey } from '../../rx-schema-helper';\n\n\nlet lastId = 0;\n\nexport class RxStorageInstancePouch<RxDocType> implements RxStorageInstance<\n    RxDocType,\n    PouchStorageInternals,\n    PouchSettings,\n    PouchCheckpoint\n> {\n    public readonly id: number = lastId++;\n\n    private changes$: Subject<EventBulk<RxStorageChangeEvent<RxDocumentData<RxDocType>>, PouchCheckpoint>> = new Subject();\n    private subs: Subscription[] = [];\n    public primaryPath: StringKeys<RxDocumentData<RxDocType>>;\n\n    public closed: boolean = false;\n\n\n    /**\n     * Some PouchDB operations give wrong results when they run in parallel.\n     * So we have to ensure they are queued up.\n     */\n    public nonParallelQueue: Promise<any> = PROMISE_RESOLVE_VOID;\n\n    constructor(\n        public readonly storage: RxStorage<PouchStorageInternals, PouchSettings>,\n        public readonly databaseName: string,\n        public readonly collectionName: string,\n        public readonly schema: Readonly<RxJsonSchema<RxDocumentData<RxDocType>>>,\n        public readonly internals: Readonly<PouchStorageInternals>,\n        public readonly options: Readonly<PouchSettings>\n    ) {\n        OPEN_POUCHDB_STORAGE_INSTANCES.add(this);\n        this.primaryPath = getPrimaryFieldOfPrimaryKey(this.schema.primaryKey);\n        /**\n         * Instead of listening to pouch.changes,\n         * we have overwritten pouchdbs bulkDocs()\n         * and create our own event stream, this will work more reliable\n         * and does not mix up with write events from other sources.\n         */\n        const emitter = getCustomEventEmitterByPouch<RxDocType>(this.internals.pouch);\n\n        /**\n         * Contains all eventIds that of emitted events,\n         * used because multi-instance pouchdbs often will reemit the same\n         * event on the other browser tab so we have to de-duplicate them.\n         */\n        const emittedEventBulkIds: ObliviousSet<string> = new ObliviousSet(60 * 1000);\n\n        const eventSub = emitter.subject.subscribe((eventBulk) => {\n            if (\n                eventBulk.events.length === 0 ||\n                emittedEventBulkIds.has(eventBulk.id)\n            ) {\n                return;\n            }\n            emittedEventBulkIds.add(eventBulk.id);\n\n            // rewrite primaryPath of all events\n            eventBulk.events.forEach(event => {\n                if (event.documentData) {\n                    event.documentData = pouchSwapIdToPrimary(\n                        this.primaryPath,\n                        event.documentData as any\n                    );\n                }\n                if (event.previousDocumentData) {\n                    event.previousDocumentData = pouchSwapIdToPrimary(\n                        this.primaryPath,\n                        event.previousDocumentData as any\n                    );\n                }\n            });\n            this.changes$.next(eventBulk);\n        });\n        this.subs.push(eventSub);\n    }\n\n    close() {\n        ensureNotClosed(this);\n        this.closed = true;\n        this.subs.forEach(sub => sub.unsubscribe());\n        OPEN_POUCHDB_STORAGE_INSTANCES.delete(this);\n        OPEN_POUCH_INSTANCES.delete(this.internals.pouchInstanceId);\n\n        // TODO this did not work because a closed pouchdb cannot be recreated in the same process run\n        // await this.internals.pouch.close();\n        return PROMISE_RESOLVE_VOID;\n    }\n\n    async remove() {\n        ensureNotClosed(this);\n        this.closed = true;\n        this.subs.forEach(sub => sub.unsubscribe());\n\n        OPEN_POUCHDB_STORAGE_INSTANCES.delete(this);\n        OPEN_POUCH_INSTANCES.delete(this.internals.pouchInstanceId);\n\n        await this.internals.pouch.destroy();\n    }\n    public async bulkWrite(\n        documentWrites: BulkWriteRow<RxDocType>[],\n        context: string\n    ): Promise<\n        RxStorageBulkWriteResponse<RxDocType>\n    > {\n        ensureNotClosed(this);\n        if (documentWrites.length === 0) {\n            throw newRxError('P2', {\n                args: {\n                    documentWrites\n                }\n            });\n        }\n\n        const writeRowById: Map<string, BulkWriteRow<RxDocType>> = new Map();\n        const insertDocsById: Map<string, any> = new Map();\n        const writeDocs: (RxDocType & { _id: string; _rev: string })[] = documentWrites.map(writeData => {\n\n            /**\n             * Ensure that _meta.lwt is set correctly\n             */\n            if (\n                writeData.document._meta.lwt < 1000 ||\n                (\n                    writeData.previous &&\n                    writeData.previous._meta.lwt >= writeData.document._meta.lwt\n                )\n            ) {\n                throw newRxError('SNH', {\n                    args: writeData\n                });\n            }\n\n            /**\n             * Ensure that a revision exists,\n             * having an empty revision here would not throw\n             * but just not resolve forever.\n             */\n            if (!writeData.document._rev) {\n                throw newRxError('SNH', {\n                    args: writeData\n                });\n            }\n\n            const primary: string = (writeData.document as any)[this.primaryPath];\n            writeRowById.set(primary, writeData);\n            const storeDocumentData: any = rxDocumentDataToPouchDocumentData<RxDocType>(\n                this.primaryPath,\n                writeData.document\n            );\n            insertDocsById.set(primary, storeDocumentData);\n            return storeDocumentData;\n        });\n\n        const previousDocsInDb: Map<string, RxDocumentData<any>> = new Map();\n        const ret: RxStorageBulkWriteResponse<RxDocType> = {\n            success: {},\n            error: {}\n        };\n        this.nonParallelQueue = this.nonParallelQueue.then(async () => {\n            const pouchResult = await this.internals.pouch.bulkDocs(writeDocs, {\n                new_edits: false,\n                custom: {\n                    primaryPath: this.primaryPath,\n                    writeRowById,\n                    insertDocsById,\n                    previousDocsInDb,\n                    context\n                }\n            } as any);\n            return Promise.all(\n                pouchResult.map(async (resultRow) => {\n                    const writeRow = getFromMapOrThrow(writeRowById, resultRow.id);\n                    if ((resultRow as PouchWriteError).error) {\n                        const previousDoc = getFromMapOrThrow(previousDocsInDb, resultRow.id);\n                        const err: RxStorageBulkWriteError<RxDocType> = {\n                            isError: true,\n                            status: 409,\n                            documentId: resultRow.id,\n                            writeRow,\n                            documentInDb: pouchDocumentDataToRxDocumentData(\n                                this.primaryPath,\n                                previousDoc\n                            )\n                        };\n                        ret.error[resultRow.id] = err;\n                    } else {\n                        let pushObj: RxDocumentData<RxDocType> = flatClone(writeRow.document) as any;\n                        pushObj = pouchSwapIdToPrimary(this.primaryPath, pushObj);\n                        pushObj._rev = (resultRow as PouchBulkDocResultRow).rev;\n\n                        // replace the inserted attachments with their diggest\n                        pushObj._attachments = {};\n                        if (!writeRow.document._attachments) {\n                            writeRow.document._attachments = {};\n                        } else {\n                            pushObj._attachments = await writeAttachmentsToAttachments(writeRow.document._attachments);\n                        }\n                        ret.success[resultRow.id] = pushObj;\n                    }\n                })\n            );\n        });\n        await this.nonParallelQueue;\n        return ret;\n    }\n\n    public async query(\n        preparedQuery: PreparedQuery<RxDocType>\n    ): Promise<RxStorageQueryResult<RxDocType>> {\n        ensureNotClosed(this);\n        const findResult = await this.internals.pouch.find<RxDocType>(preparedQuery);\n        const ret: RxStorageQueryResult<RxDocType> = {\n            documents: findResult.docs.map(pouchDoc => {\n                const useDoc = pouchDocumentDataToRxDocumentData(\n                    this.primaryPath,\n                    pouchDoc\n                );\n                return useDoc;\n            })\n        };\n        return ret;\n    }\n    async count(\n        preparedQuery: PreparedQuery<RxDocType>\n    ): Promise<RxStorageCountResult> {\n        /**\n         * There is no count method in PouchDB,\n         * so we have to run a normal query and use the result length.\n         */\n        const result = await this.query(preparedQuery);\n        return {\n            count: result.documents.length,\n            mode: 'fast'\n        };\n    }\n\n    async getAttachmentData(\n        documentId: string,\n        attachmentId: string\n    ): Promise<string> {\n        ensureNotClosed(this);\n        let attachmentData = await this.internals.pouch.getAttachment(\n            documentId,\n            attachmentId\n        );\n\n        /**\n         * In Node.js, PouchDB works with Buffers because it is old and Node.js did\n         * not support Blob at the time is was coded.\n         * So here we have to transform the Buffer to a Blob.\n         */\n        const isBuffer = typeof Buffer !== 'undefined' && Buffer.isBuffer(attachmentData);\n        if (isBuffer) {\n            attachmentData = new Blob([attachmentData]);\n        }\n\n        const ret = await blobBufferUtil.toBase64String(attachmentData);\n        return ret;\n    }\n\n    findDocumentsById(\n        ids: string[],\n        deleted: boolean\n    ): Promise<RxDocumentDataById<RxDocType>> {\n        return pouchFindDocumentsById<RxDocType>(\n            this,\n            ids,\n            deleted\n        );\n    }\n\n    changeStream(): Observable<EventBulk<RxStorageChangeEvent<RxDocumentData<RxDocType>>, PouchCheckpoint>> {\n        ensureNotClosed(this);\n        return this.changes$.asObservable();\n    }\n\n    cleanup(_minimumDeletedTime: number): Promise<boolean> {\n        ensureNotClosed(this);\n        /**\n         * PouchDB does not support purging documents.\n         * So instead we run a compaction that might at least help a bit\n         * in freeing up disc space.\n         * @link https://github.com/pouchdb/pouchdb/issues/802\n         */\n        return this.internals.pouch\n            .compact()\n            .then(() => true);\n    }\n\n    async getChangedDocumentsSince(\n        limit: number,\n        checkpoint?: PouchCheckpoint\n    ): Promise<{\n        documents: RxDocumentData<RxDocType>[];\n        checkpoint: PouchCheckpoint;\n    }> {\n        ensureNotClosed(this);\n        if (!limit || typeof limit !== 'number') {\n            throw new Error('wrong limit');\n        }\n\n        const pouchChangesOpts: PouchChangesOptionsNonLive = {\n            live: false,\n            limit: limit,\n            include_docs: false,\n            since: checkpoint ? checkpoint.sequence : 0,\n            descending: false\n        };\n\n        let lastSequence = 0;\n        let first = true;\n        let skippedDesignDocuments = 0;\n        let changedDocuments: { id: string; sequence: number; }[] = [];\n        /**\n         * Because PouchDB also returns changes of _design documents,\n         * we have to fill up the results with more changes if this happens.\n         */\n        while (first || skippedDesignDocuments > 0) {\n            first = false;\n            skippedDesignDocuments = 0;\n            const pouchResults = await this.internals.pouch.changes(pouchChangesOpts);\n            const addChangedDocuments = pouchResults.results\n                .filter(row => {\n                    const isDesignDoc = row.id.startsWith(POUCHDB_DESIGN_PREFIX);\n                    if (isDesignDoc) {\n                        skippedDesignDocuments = skippedDesignDocuments + 1;\n                        return false;\n                    } else {\n                        return true;\n                    }\n                })\n                .map(row => ({\n                    id: row.id,\n                    sequence: row.seq\n                }));\n            changedDocuments = changedDocuments.concat(addChangedDocuments);\n            lastSequence = pouchResults.last_seq;\n\n            // modify pouch options for next run of pouch.changes()\n            pouchChangesOpts.since = lastSequence;\n            pouchChangesOpts.limit = skippedDesignDocuments;\n        }\n\n        const documentsData = await pouchFindDocumentsById<RxDocType>(\n            this,\n            changedDocuments.map(o => o.id),\n            true\n        );\n\n        if (\n            Object.keys(documentsData).length > 0 &&\n            checkpoint && checkpoint.sequence === lastSequence\n        ) {\n            /**\n             * When documents are returned, it makes no sense\n             * if the sequence is equal to the one given at the checkpoint.\n             */\n            throw new Error('same sequence');\n        }\n\n        const lastRow = lastOfArray(changedDocuments);\n        const documents = changedDocuments.map(changeRow => getFromObjectOrThrow(documentsData, changeRow.id));\n\n        return {\n            documents,\n            checkpoint: lastRow ? {\n                sequence: lastRow.sequence\n            } : checkpoint ? checkpoint : {\n                sequence: -1\n            }\n        }\n    }\n\n    conflictResultionTasks(): Observable<RxConflictResultionTask<RxDocType>> {\n        return new Subject();\n    }\n    async resolveConflictResultionTask(_taskSolution: RxConflictResultionTaskSolution<RxDocType>): Promise<void> { }\n}\n\n\n\nfunction ensureNotClosed(\n    instance: RxStorageInstancePouch<any>\n) {\n    if (instance.closed) {\n        throw new Error('RxStorageInstancePouch is closed ' + instance.databaseName + '-' + instance.collectionName);\n    }\n}\n\n\n/**\n * Because we internally use the findDocumentsById()\n * method, it is defined here because RxStorage wrappers\n * might swap out the function.\n */\nasync function pouchFindDocumentsById<RxDocType>(\n    instance: RxStorageInstancePouch<RxDocType>,\n    ids: string[],\n    deleted: boolean\n): Promise<RxDocumentDataById<RxDocType>> {\n    ensureNotClosed(instance);\n    const ret: RxDocumentDataById<RxDocType> = {};\n\n    /**\n     * On deleted documents, PouchDB will only return the tombstone.\n     * So we have to get the properties directly for each document\n     * with the hack of getting the changes and then make one request per document\n     * with the latest revision.\n     * TODO create an issue at pouchdb on how to get the document data of deleted documents,\n     * when one past revision was written via new_edits=false\n     * @link https://stackoverflow.com/a/63516761/3443137\n     */\n    if (deleted) {\n        instance.nonParallelQueue = instance.nonParallelQueue.then(async () => {\n            const viaChanges = await instance.internals.pouch.changes({\n                live: false,\n                since: 0,\n                doc_ids: ids,\n                style: 'all_docs'\n            });\n            await Promise.all(\n                viaChanges.results.map(async (result) => {\n                    const firstDoc = await instance.internals.pouch.get(\n                        result.id,\n                        {\n                            rev: result.changes[0].rev,\n                            deleted: 'ok',\n                            style: 'all_docs'\n                        }\n                    );\n                    const useFirstDoc = pouchDocumentDataToRxDocumentData(\n                        instance.primaryPath,\n                        firstDoc\n                    );\n                    ret[result.id] = useFirstDoc;\n                })\n            );\n        });\n        await instance.nonParallelQueue;\n        return ret;\n    } else {\n        instance.nonParallelQueue = instance.nonParallelQueue.then(async () => {\n            const pouchResult = await instance.internals.pouch.allDocs({\n                include_docs: true,\n                keys: ids\n            });\n            pouchResult.rows\n                .filter(row => !!row.doc)\n                .forEach(row => {\n                    let docData = row.doc;\n                    docData = pouchDocumentDataToRxDocumentData(\n                        instance.primaryPath,\n                        docData\n                    );\n                    ret[row.id] = docData;\n                });\n        });\n        await instance.nonParallelQueue;\n        return ret;\n    }\n}\n"],"mappings":"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"}