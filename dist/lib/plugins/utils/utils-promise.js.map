{"version":3,"file":"utils-promise.js","names":["nextTick","Promise","res","setTimeout","promiseWait","ms","toPromise","maybePromise","then","resolve","PROMISE_RESOLVE_TRUE","exports","PROMISE_RESOLVE_FALSE","PROMISE_RESOLVE_NULL","PROMISE_RESOLVE_VOID","idlePromiseQueue","requestIdlePromise","timeout","undefined","requestIdleCallback","requestIdleCallbackIfAvailable","fun","promiseSeries","tasks","initial","reduce","current","next"],"sources":["../../../../src/plugins/utils/utils-promise.ts"],"sourcesContent":["/**\n * returns a promise that resolves on the next tick\n */\nexport function nextTick(): Promise<void> {\n    return new Promise(res => setTimeout(res, 0));\n}\n\nexport function promiseWait(ms: number = 0): Promise<void> {\n    return new Promise(res => setTimeout(res, ms));\n}\n\nexport function toPromise<T>(maybePromise: Promise<T> | T): Promise<T> {\n    if (maybePromise && typeof (maybePromise as any).then === 'function') {\n        // is promise\n        return maybePromise as any;\n    } else {\n        return Promise.resolve(maybePromise);\n    }\n}\n\n/**\n * Reusing resolved promises has a better\n * performance than creating new ones each time.\n */\nexport const PROMISE_RESOLVE_TRUE: Promise<true> = Promise.resolve(true);\nexport const PROMISE_RESOLVE_FALSE: Promise<false> = Promise.resolve(false);\nexport const PROMISE_RESOLVE_NULL: Promise<null> = Promise.resolve(null);\nexport const PROMISE_RESOLVE_VOID: Promise<void> = Promise.resolve();\n\n\n/**\n * If multiple operations wait for an requestIdlePromise\n * we do not want them to resolve all at the same time.\n * So we have to queue the calls.\n */\nlet idlePromiseQueue = PROMISE_RESOLVE_VOID;\nexport function requestIdlePromise(\n    timeout: number | undefined = undefined\n) {\n    idlePromiseQueue = idlePromiseQueue.then(() => {\n        /**\n         * Do not use window.requestIdleCallback\n         * because some javascript runtimes like react-native,\n         * do not have a window object, but still have a global\n         * requestIdleCallback function.\n         * @link https://github.com/pubkey/rxdb/issues/4804\n        */\n        if (\n            typeof requestIdleCallback === 'function'\n        ) {\n            return new Promise<void>(res => {\n                requestIdleCallback(\n                    () => res(),\n                    {\n                        timeout\n                    }\n                );\n            });\n        } else {\n            return promiseWait(0);\n        }\n    });\n    return idlePromiseQueue;\n}\n\n\n/**\n * run the callback if requestIdleCallback available\n * do nothing if not\n * @link https://developer.mozilla.org/de/docs/Web/API/Window/requestIdleCallback\n */\nexport function requestIdleCallbackIfAvailable(fun: Function): void {\n    /**\n     * Do not use window.requestIdleCallback\n     * because some javascript runtimes like react-native,\n     * do not have a window object, but still have a global\n     * requestIdleCallback function.\n     * @link https://github.com/pubkey/rxdb/issues/4804\n    */\n    if (\n        typeof requestIdleCallback === 'function'\n    ) {\n        requestIdleCallback(() => {\n            fun();\n        });\n    }\n}\n\n\n/**\n * like Promise.all() but runs in series instead of parallel\n * @link https://github.com/egoist/promise.series/blob/master/index.js\n * @param tasks array with functions that return a promise\n */\nexport function promiseSeries(\n    tasks: Function[],\n    initial?: any\n): Promise<any[]> {\n    return tasks\n        .reduce(\n            (current, next) => (current as any).then(next),\n            Promise.resolve(initial)\n        );\n}\n"],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACO,SAASA,QAAQA,CAAA,EAAkB;EACtC,OAAO,IAAIC,OAAO,CAACC,GAAG,IAAIC,UAAU,CAACD,GAAG,EAAE,CAAC,CAAC,CAAC;AACjD;AAEO,SAASE,WAAWA,CAACC,EAAU,GAAG,CAAC,EAAiB;EACvD,OAAO,IAAIJ,OAAO,CAACC,GAAG,IAAIC,UAAU,CAACD,GAAG,EAAEG,EAAE,CAAC,CAAC;AAClD;AAEO,SAASC,SAASA,CAAIC,YAA4B,EAAc;EACnE,IAAIA,YAAY,IAAI,OAAQA,YAAY,CAASC,IAAI,KAAK,UAAU,EAAE;IAClE;IACA,OAAOD,YAAY;EACvB,CAAC,MAAM;IACH,OAAON,OAAO,CAACQ,OAAO,CAACF,YAAY,CAAC;EACxC;AACJ;;AAEA;AACA;AACA;AACA;AACO,IAAMG,oBAAmC,GAAAC,OAAA,CAAAD,oBAAA,GAAGT,OAAO,CAACQ,OAAO,CAAC,IAAI,CAAC;AACjE,IAAMG,qBAAqC,GAAAD,OAAA,CAAAC,qBAAA,GAAGX,OAAO,CAACQ,OAAO,CAAC,KAAK,CAAC;AACpE,IAAMI,oBAAmC,GAAAF,OAAA,CAAAE,oBAAA,GAAGZ,OAAO,CAACQ,OAAO,CAAC,IAAI,CAAC;AACjE,IAAMK,oBAAmC,GAAAH,OAAA,CAAAG,oBAAA,GAAGb,OAAO,CAACQ,OAAO,CAAC,CAAC;;AAGpE;AACA;AACA;AACA;AACA;AACA,IAAIM,gBAAgB,GAAGD,oBAAoB;AACpC,SAASE,kBAAkBA,CAC9BC,OAA2B,GAAGC,SAAS,EACzC;EACEH,gBAAgB,GAAGA,gBAAgB,CAACP,IAAI,CAAC,MAAM;IAC3C;AACR;AACA;AACA;AACA;AACA;AACA;IACQ,IACI,OAAOW,mBAAmB,KAAK,UAAU,EAC3C;MACE,OAAO,IAAIlB,OAAO,CAAOC,GAAG,IAAI;QAC5BiB,mBAAmB,CACf,MAAMjB,GAAG,CAAC,CAAC,EACX;UACIe;QACJ,CACJ,CAAC;MACL,CAAC,CAAC;IACN,CAAC,MAAM;MACH,OAAOb,WAAW,CAAC,CAAC,CAAC;IACzB;EACJ,CAAC,CAAC;EACF,OAAOW,gBAAgB;AAC3B;;AAGA;AACA;AACA;AACA;AACA;AACO,SAASK,8BAA8BA,CAACC,GAAa,EAAQ;EAChE;AACJ;AACA;AACA;AACA;AACA;AACA;EACI,IACI,OAAOF,mBAAmB,KAAK,UAAU,EAC3C;IACEA,mBAAmB,CAAC,MAAM;MACtBE,GAAG,CAAC,CAAC;IACT,CAAC,CAAC;EACN;AACJ;;AAGA;AACA;AACA;AACA;AACA;AACO,SAASC,aAAaA,CACzBC,KAAiB,EACjBC,OAAa,EACC;EACd,OAAOD,KAAK,CACPE,MAAM,CACH,CAACC,OAAO,EAAEC,IAAI,KAAMD,OAAO,CAASlB,IAAI,CAACmB,IAAI,CAAC,EAC9C1B,OAAO,CAACQ,OAAO,CAACe,OAAO,CAC3B,CAAC;AACT"}