{"version":3,"file":"migration-state.js","names":["_rxjs","require","_utils","DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE","WeakMap","exports","getMigrationStateByDatabase","database","getFromMapOrCreate","BehaviorSubject","onDatabaseDestroy","subject","get","complete"],"sources":["../../../../src/plugins/migration/migration-state.ts"],"sourcesContent":["import {\n    BehaviorSubject,\n    Observable\n} from 'rxjs';\nimport type {\n    MigrationState,\n    RxCollection,\n    RxDatabase\n} from '../../types';\nimport { getFromMapOrCreate } from '../../plugins/utils';\n\nexport type MigrationStateWithCollection = {\n    collection: RxCollection;\n    state: MigrationState;\n};\n\nexport const DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE = new WeakMap<RxDatabase, BehaviorSubject<Observable<MigrationStateWithCollection>[]>>();\n\nexport function getMigrationStateByDatabase(database: RxDatabase): BehaviorSubject<Observable<MigrationStateWithCollection>[]> {\n    return getFromMapOrCreate(\n        DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE,\n        database,\n        () => new BehaviorSubject<Observable<MigrationStateWithCollection>[]>([])\n    );\n}\n\n/**\n * Complete on database destroy\n * so people do not have to unsubscribe\n */\nexport function onDatabaseDestroy(database: RxDatabase) {\n    const subject = DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.get(database);\n    if (subject) {\n        subject.complete();\n    }\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AASA,IAAAC,MAAA,GAAAD,OAAA;AAOO,IAAME,wCAAwC,GAAG,IAAIC,OAAO,EAA2E;AAACC,OAAA,CAAAF,wCAAA,GAAAA,wCAAA;AAExI,SAASG,2BAA2BA,CAACC,QAAoB,EAA+D;EAC3H,OAAO,IAAAC,yBAAkB,EACrBL,wCAAwC,EACxCI,QAAQ,EACR,MAAM,IAAIE,qBAAe,CAA6C,EAAE,CAAC,CAC5E;AACL;;AAEA;AACA;AACA;AACA;AACO,SAASC,iBAAiBA,CAACH,QAAoB,EAAE;EACpD,IAAMI,OAAO,GAAGR,wCAAwC,CAACS,GAAG,CAACL,QAAQ,CAAC;EACtE,IAAII,OAAO,EAAE;IACTA,OAAO,CAACE,QAAQ,EAAE;EACtB;AACJ"}