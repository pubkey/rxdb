{"version":3,"file":"validate-ajv.js","names":["ajv","Ajv","strict","getValidator","schema","validator","compile","docData","isValid","newRxError","errors","document","wrappedValidateAjvStorage","wrappedValidateStorageFactory"],"sources":["../../../src/plugins/validate-ajv.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using ajv as jsonschema-validator\n * @link https://github.com/epoberezkin/ajv\n */\nimport Ajv from 'ajv';\nimport {\n    newRxError\n} from '../rx-error';\nimport type {\n    RxDocumentData,\n    RxJsonSchema\n} from '../types';\nimport { wrappedValidateStorageFactory } from '../plugin-helpers';\n\n\nconst ajv = new Ajv({\n    strict: false\n});\n\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validator = ajv.compile(schema);\n    return (docData: RxDocumentData<any>) => {\n        const isValid = validator(docData);\n        if (!isValid) {\n            throw newRxError('VD2', {\n                errors: validator.errors as any,\n                document: docData,\n                schema\n            });\n        }\n    };\n}\n\nexport const wrappedValidateAjvStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'ajv'\n);\n"],"mappings":";;;;;;;;;;AAKA;;AACA;;AAOA;;AAbA;AACA;AACA;AACA;AACA;AAYA,IAAMA,GAAG,GAAG,IAAIC,eAAJ,CAAQ;EAChBC,MAAM,EAAE;AADQ,CAAR,CAAZ;;AAKO,SAASC,YAAT,CACHC,MADG,EAEL;EACE,IAAMC,SAAS,GAAGL,GAAG,CAACM,OAAJ,CAAYF,MAAZ,CAAlB;EACA,OAAO,UAACG,OAAD,EAAkC;IACrC,IAAMC,OAAO,GAAGH,SAAS,CAACE,OAAD,CAAzB;;IACA,IAAI,CAACC,OAAL,EAAc;MACV,MAAM,IAAAC,mBAAA,EAAW,KAAX,EAAkB;QACpBC,MAAM,EAAEL,SAAS,CAACK,MADE;QAEpBC,QAAQ,EAAEJ,OAFU;QAGpBH,MAAM,EAANA;MAHoB,CAAlB,CAAN;IAKH;EACJ,CATD;AAUH;;AAEM,IAAMQ,yBAAyB,GAAG,IAAAC,4CAAA,EACrCV,YADqC,EAErC,KAFqC,CAAlC"}