{"version":3,"file":"check-migration-strategies.js","names":["checkMigrationStrategies","schema","migrationStrategies","Array","isArray","newRxTypeError","previousVersions","getPreviousVersions","length","Object","keys","newRxError","have","should","map","vNr","v","s","filter","strategy","forEach","version","type"],"sources":["../../../../src/plugins/dev-mode/check-migration-strategies.ts"],"sourcesContent":["import type { RxJsonSchema, NumberFunctionMap } from '../../types';\nimport { newRxTypeError, newRxError } from '../../rx-error';\nimport { getPreviousVersions } from '../../rx-schema';\n\n\n/**\n * checks if the migrationStrategies are ok, throws if not\n * @throws {Error|TypeError} if not ok\n */\nexport function checkMigrationStrategies(\n    schema: RxJsonSchema<any>,\n    migrationStrategies: NumberFunctionMap\n): boolean {\n    // migrationStrategies must be object not array\n    if (\n        typeof migrationStrategies !== 'object' ||\n        Array.isArray(migrationStrategies)\n    ) {\n        throw newRxTypeError('COL11', {\n            schema\n        });\n    }\n\n    const previousVersions = getPreviousVersions(schema);\n\n    // for every previousVersion there must be strategy\n    if (\n        previousVersions.length !== Object\n            .keys(migrationStrategies).length\n    ) {\n        throw newRxError('COL12', {\n            have: Object.keys(migrationStrategies),\n            should: previousVersions\n        });\n    }\n\n    // every strategy must have number as property and be a function\n    previousVersions\n        .map(vNr => ({\n            v: vNr,\n            s: migrationStrategies[(vNr + 1)]\n        }))\n        .filter(strategy => typeof strategy.s !== 'function')\n        .forEach(strategy => {\n            throw newRxTypeError('COL13', {\n                version: strategy.v,\n                type: typeof strategy,\n                schema\n            });\n        });\n\n    return true;\n}\n"],"mappings":";;;;;;AACA;AACA;AAGA;AACA;AACA;AACA;AACO,SAASA,wBAAwB,CACpCC,MAAyB,EACzBC,mBAAsC,EAC/B;EACP;EACA,IACI,OAAOA,mBAAmB,KAAK,QAAQ,IACvCC,KAAK,CAACC,OAAO,CAACF,mBAAmB,CAAC,EACpC;IACE,MAAM,IAAAG,uBAAc,EAAC,OAAO,EAAE;MAC1BJ;IACJ,CAAC,CAAC;EACN;EAEA,IAAMK,gBAAgB,GAAG,IAAAC,6BAAmB,EAACN,MAAM,CAAC;;EAEpD;EACA,IACIK,gBAAgB,CAACE,MAAM,KAAKC,MAAM,CAC7BC,IAAI,CAACR,mBAAmB,CAAC,CAACM,MAAM,EACvC;IACE,MAAM,IAAAG,mBAAU,EAAC,OAAO,EAAE;MACtBC,IAAI,EAAEH,MAAM,CAACC,IAAI,CAACR,mBAAmB,CAAC;MACtCW,MAAM,EAAEP;IACZ,CAAC,CAAC;EACN;;EAEA;EACAA,gBAAgB,CACXQ,GAAG,CAACC,GAAG,KAAK;IACTC,CAAC,EAAED,GAAG;IACNE,CAAC,EAAEf,mBAAmB,CAAEa,GAAG,GAAG,CAAC;EACnC,CAAC,CAAC,CAAC,CACFG,MAAM,CAACC,QAAQ,IAAI,OAAOA,QAAQ,CAACF,CAAC,KAAK,UAAU,CAAC,CACpDG,OAAO,CAACD,QAAQ,IAAI;IACjB,MAAM,IAAAd,uBAAc,EAAC,OAAO,EAAE;MAC1BgB,OAAO,EAAEF,QAAQ,CAACH,CAAC;MACnBM,IAAI,EAAE,OAAOH,QAAQ;MACrBlB;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;EAEN,OAAO,IAAI;AACf"}