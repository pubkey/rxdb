{"version":3,"file":"dexie-helper.js","names":["_dexie","require","_utils","_rxError","_rxSchemaHelper","_rxStorageStatics","DEXIE_DOCS_TABLE_NAME","exports","DEXIE_DELETED_DOCS_TABLE_NAME","DEXIE_CHANGES_TABLE_NAME","RX_STORAGE_NAME_DEXIE","RxStorageDexieStatics","RxStorageDefaultStatics","DEXIE_STATE_DB_BY_NAME","Map","REF_COUNT_PER_DEXIE_DB","getDexieDbWithTables","databaseName","collectionName","settings","schema","primaryPath","getPrimaryFieldOfPrimaryKey","primaryKey","dexieDbName","version","state","getFromMapOrCreate","value","useSettings","flatClone","autoOpen","dexieDb","Dexie","dexieStoresSettings","getDexieStoreSchema","stores","open","dexieTable","dexieDeletedTable","set","closeDexieDb","statePromise","prevCount","get","newCount","close","delete","ensureNoBooleanIndex","indexes","checkedFields","Set","forEach","index","fields","toArray","field","has","add","schemaObj","getSchemaByObjectPath","type","newRxError","DEXIE_PIPE_SUBSTITUTE","dexieReplaceIfStartsWithPipe","str","split","length","map","part","join","startsWith","withoutFirst","substring","dexieReplaceIfStartsWithPipeRevert","fromStorageToDexie","documentData","Array","isArray","row","ret","Object","entries","key","fromDexieToStorage","rxJsonSchema","parts","push","arIndex","getDocsInDb","internals","docIds","nonDeletedDocsInDb","deletedDocsInDb","Promise","all","bulkGet","docsInDb","slice","doc","idx"],"sources":["../../../../src/plugins/storage-dexie/dexie-helper.ts"],"sourcesContent":["import type {\n    DexieStorageInternals,\n    RxDocumentData,\n    RxJsonSchema\n} from '../../types';\nimport { Dexie } from 'dexie';\nimport { DexieSettings } from '../../types';\nimport { flatClone, getFromMapOrCreate, toArray } from '../utils';\nimport { newRxError } from '../../rx-error';\nimport {\n    getPrimaryFieldOfPrimaryKey,\n    getSchemaByObjectPath\n} from '../../rx-schema-helper';\nimport { RxStorageDefaultStatics } from '../../rx-storage-statics';\n\nexport const DEXIE_DOCS_TABLE_NAME = 'docs';\nexport const DEXIE_DELETED_DOCS_TABLE_NAME = 'deleted-docs';\nexport const DEXIE_CHANGES_TABLE_NAME = 'changes';\n\nexport const RX_STORAGE_NAME_DEXIE = 'dexie';\n\nexport const RxStorageDexieStatics = RxStorageDefaultStatics;\n\nconst DEXIE_STATE_DB_BY_NAME: Map<string, DexieStorageInternals> = new Map();\nconst REF_COUNT_PER_DEXIE_DB: Map<DexieStorageInternals, number> = new Map();\nexport function getDexieDbWithTables(\n    databaseName: string,\n    collectionName: string,\n    settings: DexieSettings,\n    schema: RxJsonSchema<any>\n): DexieStorageInternals {\n    const primaryPath = getPrimaryFieldOfPrimaryKey(schema.primaryKey);\n    const dexieDbName = 'rxdb-dexie-' + databaseName + '--' + schema.version + '--' + collectionName;\n\n    const state = getFromMapOrCreate(\n        DEXIE_STATE_DB_BY_NAME,\n        dexieDbName,\n        () => {\n            const value = (async () => {\n                /**\n                 * IndexedDB was not designed for dynamically adding tables on the fly,\n                 * so we create one dexie database per RxDB storage instance.\n                 * @link https://github.com/dexie/Dexie.js/issues/684#issuecomment-373224696\n                 */\n                const useSettings = flatClone(settings);\n                useSettings.autoOpen = false;\n                const dexieDb = new Dexie(dexieDbName, useSettings);\n                const dexieStoresSettings = {\n                    [DEXIE_DOCS_TABLE_NAME]: getDexieStoreSchema(schema),\n                    [DEXIE_CHANGES_TABLE_NAME]: '++sequence, id',\n                    /**\n                     * Instead of adding {deleted: false} to every query we run over the document store,\n                     * we move deleted documents into a separate store where they can only be queried\n                     * by primary key.\n                     * This increases performance because it is way easier for the query planner to select\n                     * a good index and we also do not have to add the _deleted field to every index.\n                     *\n                     * We also need the [_meta.lwt+' + primaryPath + '] index for getChangedDocumentsSince()\n                     */\n                    [DEXIE_DELETED_DOCS_TABLE_NAME]: primaryPath + ',_meta.lwt,[_meta.lwt+' + primaryPath + ']'\n                };\n\n                dexieDb.version(1).stores(dexieStoresSettings);\n                await dexieDb.open();\n                return {\n                    dexieDb,\n                    dexieTable: (dexieDb as any)[DEXIE_DOCS_TABLE_NAME],\n                    dexieDeletedTable: (dexieDb as any)[DEXIE_DELETED_DOCS_TABLE_NAME]\n                };\n            })();\n            DEXIE_STATE_DB_BY_NAME.set(dexieDbName, state);\n            REF_COUNT_PER_DEXIE_DB.set(state, 0);\n            return value;\n        }\n    );\n    return state;\n}\n\nexport async function closeDexieDb(statePromise: DexieStorageInternals) {\n    const state = await statePromise;\n    const prevCount = REF_COUNT_PER_DEXIE_DB.get(statePromise);\n    const newCount = (prevCount as any) - 1;\n    if (newCount === 0) {\n        state.dexieDb.close();\n        REF_COUNT_PER_DEXIE_DB.delete(statePromise);\n    } else {\n        REF_COUNT_PER_DEXIE_DB.set(statePromise, newCount);\n    }\n}\n\nexport function ensureNoBooleanIndex(schema: RxJsonSchema<any>) {\n    if (!schema.indexes) {\n        return;\n    }\n    const checkedFields = new Set<string>();\n    schema.indexes.forEach(index => {\n        const fields = toArray(index);\n        fields.forEach(field => {\n            if (checkedFields.has(field)) {\n                return;\n            }\n            checkedFields.add(field);\n            const schemaObj = getSchemaByObjectPath(schema, field);\n            if (schemaObj.type === 'boolean') {\n                throw newRxError('DXE1', {\n                    schema,\n                    index,\n                    field\n                });\n            }\n        });\n    });\n}\n\n\n\n/**\n * It is not possible to set non-javascript-variable-syntax\n * keys as IndexedDB indexes. So we have to substitute the pipe-char\n * which comes from the key-compression plugin.\n */\nexport const DEXIE_PIPE_SUBSTITUTE = '__';\nexport function dexieReplaceIfStartsWithPipe(str: string): string {\n    const split = str.split('.');\n    if (split.length > 1) {\n        return split.map(part => dexieReplaceIfStartsWithPipe(part)).join('.');\n    }\n\n    if (str.startsWith('|')) {\n        const withoutFirst = str.substring(1);\n        return DEXIE_PIPE_SUBSTITUTE + withoutFirst;\n    } else {\n        return str;\n    }\n}\n\nexport function dexieReplaceIfStartsWithPipeRevert(str: string): string {\n    const split = str.split('.');\n    if (split.length > 1) {\n        return split.map(part => dexieReplaceIfStartsWithPipeRevert(part)).join('.');\n    }\n\n    if (str.startsWith(DEXIE_PIPE_SUBSTITUTE)) {\n        const withoutFirst = str.substring(DEXIE_PIPE_SUBSTITUTE.length);\n        return '|' + withoutFirst;\n    } else {\n        return str;\n    }\n}\n\n/**\n * @recursive\n */\nexport function fromStorageToDexie(documentData: RxDocumentData<any>): any {\n    if (!documentData || typeof documentData === 'string' || typeof documentData === 'number' || typeof documentData === 'boolean') {\n        return documentData;\n    } else if (Array.isArray(documentData)) {\n        return documentData.map(row => fromStorageToDexie(row));\n    } else if (typeof documentData === 'object') {\n        const ret: any = {};\n        Object.entries(documentData).forEach(([key, value]) => {\n            if (typeof value === 'object') {\n                value = fromStorageToDexie(value);\n            }\n            ret[dexieReplaceIfStartsWithPipe(key)] = value;\n        });\n        return ret;\n    }\n}\n\nexport function fromDexieToStorage(documentData: any): RxDocumentData<any> {\n    if (!documentData || typeof documentData === 'string' || typeof documentData === 'number' || typeof documentData === 'boolean') {\n        return documentData;\n    } else if (Array.isArray(documentData)) {\n        return documentData.map(row => fromDexieToStorage(row));\n    } else if (typeof documentData === 'object') {\n        const ret: any = {};\n        Object.entries(documentData).forEach(([key, value]) => {\n            if (typeof value === 'object' || Array.isArray(documentData)) {\n                value = fromDexieToStorage(value);\n            }\n            ret[dexieReplaceIfStartsWithPipeRevert(key)] = value;\n        });\n        return ret;\n    }\n}\n\n\n/**\n * Creates a string that can be used to create the dexie store.\n * @link https://dexie.org/docs/API-Reference#quick-reference\n */\nexport function getDexieStoreSchema(\n    rxJsonSchema: RxJsonSchema<any>\n): string {\n    let parts: string[][] = [];\n\n    /**\n     * First part must be the primary key\n     * @link https://github.com/dexie/Dexie.js/issues/1307#issuecomment-846590912\n     */\n    const primaryKey = getPrimaryFieldOfPrimaryKey(rxJsonSchema.primaryKey);\n    parts.push([primaryKey]);\n\n    // add other indexes\n    if (rxJsonSchema.indexes) {\n        rxJsonSchema.indexes.forEach(index => {\n            const arIndex = toArray(index);\n            parts.push(arIndex);\n        });\n    }\n\n    // we also need the _meta.lwt+primaryKey index for the getChangedDocumentsSince() method.\n    parts.push(['_meta.lwt', primaryKey]);\n\n    /**\n     * It is not possible to set non-javascript-variable-syntax\n     * keys as IndexedDB indexes. So we have to substitute the pipe-char\n     * which comes from the key-compression plugin.\n     */\n    parts = parts.map(part => {\n        return part.map(str => dexieReplaceIfStartsWithPipe(str));\n    });\n\n    return parts.map(part => {\n        if (part.length === 1) {\n            return part[0];\n        } else {\n            return '[' + part.join('+') + ']';\n        }\n    }).join(', ');\n}\n\n/**\n * Returns all documents in the database.\n * Non-deleted plus deleted ones.\n */\nexport async function getDocsInDb<RxDocType>(\n    internals: DexieStorageInternals,\n    docIds: string[]\n): Promise<RxDocumentData<RxDocType>[]> {\n    const state = await internals;\n    const [\n        nonDeletedDocsInDb,\n        deletedDocsInDb\n    ] = await Promise.all([\n        state.dexieTable.bulkGet(docIds),\n        state.dexieDeletedTable.bulkGet(docIds)\n    ]);\n    const docsInDb = deletedDocsInDb.slice(0);\n    nonDeletedDocsInDb.forEach((doc, idx) => {\n        if (doc) {\n            docsInDb[idx] = doc;\n        }\n    });\n    return docsInDb;\n}\n"],"mappings":"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"}