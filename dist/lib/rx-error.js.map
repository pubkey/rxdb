{"version":3,"file":"rx-error.js","names":["_overwritable","require","parametersToString","parameters","ret","Object","keys","length","map","k","paramStr","err","JSON","stringify","getOwnPropertyNames","_k","v","undefined","e","join","messageForError","message","code","RxError","exports","_Error","_inheritsLoose2","default","_this","mes","call","rxdb","_proto","prototype","toString","_createClass2","key","get","_wrapNativeSuper2","Error","RxTypeError","_TypeError","_this2","_proto2","TypeError","newRxError","overwritable","tunnelErrorMessage","newRxTypeError","isBulkWriteConflictError","status","STORAGE_WRITE_ERROR_CODE_TO_MESSAGE","rxStorageWriteErrorToRxError","name","document","documentId","writeError"],"sources":["../../src/rx-error.ts"],"sourcesContent":["/**\n * here we use custom errors with the additional field 'parameters'\n */\n\nimport { overwritable } from './overwritable';\nimport type {\n    RxErrorParameters,\n    RxErrorKey,\n    RxStorageWriteError,\n    RxStorageWriteErrorConflict\n} from './types';\n\n/**\n * transform an object of parameters to a presentable string\n */\nfunction parametersToString(parameters: any): string {\n    let ret = '';\n    if (Object.keys(parameters).length === 0)\n        return ret;\n    ret += 'Given parameters: {\\n';\n    ret += Object.keys(parameters)\n        .map(k => {\n            let paramStr = '[object Object]';\n            try {\n                if (k === 'errors') {\n                    paramStr = parameters[k].map((err: any) => JSON.stringify(err, Object.getOwnPropertyNames(err)));\n                } else {\n                    paramStr = JSON.stringify(parameters[k], function (_k, v) {\n                        return v === undefined ? null : v;\n                    }, 2);\n                }\n            } catch (e) { }\n            return k + ':' + paramStr;\n        })\n        .join('\\n');\n    ret += '}';\n    return ret;\n}\n\nfunction messageForError(\n    message: string,\n    code: string,\n    parameters: any\n): string {\n    return 'RxError (' + code + '):' + '\\n' +\n        message + '\\n' +\n        parametersToString(parameters);\n}\n\nexport class RxError extends Error {\n    public code: RxErrorKey;\n    public message: string;\n    public parameters: RxErrorParameters;\n    // always true, use this to detect if its an rxdb-error\n    public rxdb: true;\n    constructor(\n        code: RxErrorKey,\n        message: string,\n        parameters: RxErrorParameters = {}\n    ) {\n        const mes = messageForError(message, code, parameters);\n        super(mes);\n        this.code = code;\n        this.message = mes;\n        this.parameters = parameters;\n        this.rxdb = true; // tag them as internal\n    }\n    get name(): string {\n        return 'RxError (' + this.code + ')';\n    }\n    toString(): string {\n        return this.message;\n    }\n    get typeError(): boolean {\n        return false;\n    }\n}\n\nexport class RxTypeError extends TypeError {\n    public code: RxErrorKey;\n    public message: string;\n    public parameters: RxErrorParameters;\n    // always true, use this to detect if its an rxdb-error\n    public rxdb: true;\n    constructor(\n        code: RxErrorKey,\n        message: string,\n        parameters: RxErrorParameters = {}\n    ) {\n        const mes = messageForError(message, code, parameters);\n        super(mes);\n        this.code = code;\n        this.message = mes;\n        this.parameters = parameters;\n        this.rxdb = true; // tag them as internal\n    }\n    get name(): string {\n        return 'RxTypeError (' + this.code + ')';\n    }\n    toString(): string {\n        return this.message;\n    }\n    get typeError(): boolean {\n        return true;\n    }\n}\n\nexport function newRxError(\n    code: RxErrorKey,\n    parameters?: RxErrorParameters\n): RxError {\n    return new RxError(\n        code,\n        overwritable.tunnelErrorMessage(code),\n        parameters\n    );\n}\n\nexport function newRxTypeError(\n    code: RxErrorKey,\n    parameters?: RxErrorParameters\n): RxTypeError {\n    return new RxTypeError(\n        code,\n        overwritable.tunnelErrorMessage(code),\n        parameters\n    );\n}\n\n\n/**\n * Returns the error if it is a 409 conflict,\n * return false if it is another error.\n */\nexport function isBulkWriteConflictError<RxDocType>(\n    err?: RxStorageWriteError<RxDocType> | any\n): RxStorageWriteErrorConflict<RxDocType> | false {\n    if (\n        err &&\n        err.status === 409\n    ) {\n        return err;\n    } else {\n        return false;\n    }\n}\n\n\nconst STORAGE_WRITE_ERROR_CODE_TO_MESSAGE: { [k: number]: string; } = {\n    409: 'document write conflict',\n    422: 'schema validation error',\n    510: 'attachment data missing'\n};\n\nexport function rxStorageWriteErrorToRxError(err: RxStorageWriteError<any>): RxError {\n    return newRxError('COL20', {\n        name: STORAGE_WRITE_ERROR_CODE_TO_MESSAGE[err.status],\n        document: err.documentId,\n        writeError: err\n    });\n}\n"],"mappings":"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"}