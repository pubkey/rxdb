(()=>{var t={1924:(t,e,r)=>{"use strict";var n=r(210),i=r(5559),o=i(n("String.prototype.indexOf"));t.exports=function(t,e){var r=n(t,!!e);return"function"==typeof r&&o(t,".prototype.")>-1?i(r):r}},5559:(t,e,r)=>{"use strict";var n=r(8612),i=r(210),o=i("%Function.prototype.apply%"),s=i("%Function.prototype.call%"),a=i("%Reflect.apply%",!0)||n.call(s,o),c=i("%Object.getOwnPropertyDescriptor%",!0),u=i("%Object.defineProperty%",!0),l=i("%Math.max%");if(u)try{u({},"a",{value:1})}catch(t){u=null}t.exports=function(t){var e=a(n,s,arguments);if(c&&u){var r=c(e,"length");r.configurable&&u(e,"length",{value:1+l(0,t.length-(arguments.length-1))})}return e};var f=function(){return a(n,o,arguments)};u?u(t.exports,"apply",{value:f}):t.exports.apply=f},6313:t=>{var e=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}var e,r,n;try{e=Map}catch(t){e=function(){}}try{r=Set}catch(t){r=function(){}}try{n=Promise}catch(t){n=function(){}}function i(o,a,c,u,l){"object"==typeof a&&(c=a.depth,u=a.prototype,l=a.includeNonEnumerable,a=a.circular);var f=[],h=[],p="undefined"!=typeof Buffer;return void 0===a&&(a=!0),void 0===c&&(c=1/0),function o(c,d){if(null===c)return null;if(0===d)return c;var y,v;if("object"!=typeof c)return c;if(t(c,e))y=new e;else if(t(c,r))y=new r;else if(t(c,n))y=new n((function(t,e){c.then((function(e){t(o(e,d-1))}),(function(t){e(o(t,d-1))}))}));else if(i.__isArray(c))y=[];else if(i.__isRegExp(c))y=new RegExp(c.source,s(c)),c.lastIndex&&(y.lastIndex=c.lastIndex);else if(i.__isDate(c))y=new Date(c.getTime());else{if(p&&Buffer.isBuffer(c))return y=Buffer.allocUnsafe?Buffer.allocUnsafe(c.length):new Buffer(c.length),c.copy(y),y;t(c,Error)?y=Object.create(c):void 0===u?(v=Object.getPrototypeOf(c),y=Object.create(v)):(y=Object.create(u),v=u)}if(a){var m=f.indexOf(c);if(-1!=m)return h[m];f.push(c),h.push(y)}for(var b in t(c,e)&&c.forEach((function(t,e){var r=o(e,d-1),n=o(t,d-1);y.set(r,n)})),t(c,r)&&c.forEach((function(t){var e=o(t,d-1);y.add(e)})),c){var g;v&&(g=Object.getOwnPropertyDescriptor(v,b)),g&&null==g.set||(y[b]=o(c[b],d-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(c);for(b=0;b<w.length;b++){var S=w[b];(!(P=Object.getOwnPropertyDescriptor(c,S))||P.enumerable||l)&&(y[S]=o(c[S],d-1),P.enumerable||Object.defineProperty(y,S,{enumerable:!1}))}}if(l){var I=Object.getOwnPropertyNames(c);for(b=0;b<I.length;b++){var P,O=I[b];(P=Object.getOwnPropertyDescriptor(c,O))&&P.enumerable||(y[O]=o(c[O],d-1),Object.defineProperty(y,O,{enumerable:!1}))}}return y}(o,c)}function o(t){return Object.prototype.toString.call(t)}function s(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return i.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},i.__objToStr=o,i.__isDate=function(t){return"object"==typeof t&&"[object Date]"===o(t)},i.__isArray=function(t){return"object"==typeof t&&"[object Array]"===o(t)},i.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===o(t)},i.__getRegExpFlags=s,i}();t.exports&&(t.exports=e)},5643:t=>{t.exports=!1},624:t=>{function e(t){if(t)return function(t){for(var r in e.prototype)t[r]=e.prototype[r];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},e.prototype.once=function(t,e){var r=this;function n(){r.off(t,n),e.apply(this,arguments)}return this._callbacks=this._callbacks||{},n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;for(var i=0;i<n.length;i++)if((r=n[i])===e||r.fn===e){n.splice(i,1);break}return this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),r=this._callbacks[t];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,e);return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}},7187:t=>{"use strict";var e,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(t,e,r){return Function.prototype.apply.call(t,e,r)};e=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(r,n){function i(r){t.removeListener(e,o),n(r)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}y(t,e,o,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&y(t,"error",e,r)}(t,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,r,n){var i,o,s,u;if(a(r),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),s=o[e]),void 0===s)s=o[e]=r,++t._eventsCount;else if("function"==typeof s?s=o[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=c(t))>0&&s.length>i&&!s.warned){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,u=l,console&&console.warn&&console.warn(u)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function h(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):d(i,i.length)}function p(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function d(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function y(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(o){n.once&&t.removeEventListener(e,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var i="error"===t,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)n(c,this,e);else{var u=c.length,l=d(c,u);for(r=0;r<u;++r)n(l[r],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return a(e),this.on(t,f(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,f(this,t,e)),this},o.prototype.removeListener=function(t,e){var r,n,i,o,s;if(a(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,s||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},o.prototype.listeners=function(t){return h(this,t,!0)},o.prototype.rawListeners=function(t){return h(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},4029:(t,e,r)=>{"use strict";var n=r(5320),i=Object.prototype.toString,o=Object.prototype.hasOwnProperty,s=function(t,e,r){for(var n=0,i=t.length;n<i;n++)o.call(t,n)&&(null==r?e(t[n],n,t):e.call(r,t[n],n,t))},a=function(t,e,r){for(var n=0,i=t.length;n<i;n++)null==r?e(t.charAt(n),n,t):e.call(r,t.charAt(n),n,t)},c=function(t,e,r){for(var n in t)o.call(t,n)&&(null==r?e(t[n],n,t):e.call(r,t[n],n,t))};t.exports=function(t,e,r){if(!n(e))throw new TypeError("iterator must be a function");var o;arguments.length>=3&&(o=r),"[object Array]"===i.call(t)?s(t,e,o):"string"==typeof t?a(t,e,o):c(t,e,o)}},7648:t=>{"use strict";var e="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,n=Object.prototype.toString,i="[object Function]";t.exports=function(t){var o=this;if("function"!=typeof o||n.call(o)!==i)throw new TypeError(e+o);for(var s,a=r.call(arguments,1),c=function(){if(this instanceof s){var e=o.apply(this,a.concat(r.call(arguments)));return Object(e)===e?e:this}return o.apply(t,a.concat(r.call(arguments)))},u=Math.max(0,o.length-a.length),l=[],f=0;f<u;f++)l.push("$"+f);if(s=Function("binder","return function ("+l.join(",")+"){ return binder.apply(this,arguments); }")(c),o.prototype){var h=function(){};h.prototype=o.prototype,s.prototype=new h,h.prototype=null}return s}},8612:(t,e,r)=>{"use strict";var n=r(7648);t.exports=Function.prototype.bind||n},210:(t,e,r)=>{"use strict";var n,i=SyntaxError,o=Function,s=TypeError,a=function(t){try{return o('"use strict"; return ('+t+").constructor;")()}catch(t){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(t){c=null}var u=function(){throw new s},l=c?function(){try{return u}catch(t){try{return c(arguments,"callee").get}catch(t){return u}}}():u,f=r(1405)(),h=Object.getPrototypeOf||function(t){return t.__proto__},p={},d="undefined"==typeof Uint8Array?n:h(Uint8Array),y={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":f?h([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":o,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":f?h(h([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&f?h((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&f?h((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":f?h(""[Symbol.iterator]()):n,"%Symbol%":f?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":l,"%TypedArray%":d,"%TypeError%":s,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},v=function t(e){var r;if("%AsyncFunction%"===e)r=a("async function () {}");else if("%GeneratorFunction%"===e)r=a("function* () {}");else if("%AsyncGeneratorFunction%"===e)r=a("async function* () {}");else if("%AsyncGenerator%"===e){var n=t("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&(r=h(i.prototype))}return y[e]=r,r},m={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=r(8612),g=r(7642),w=b.call(Function.call,Array.prototype.concat),S=b.call(Function.apply,Array.prototype.splice),I=b.call(Function.call,String.prototype.replace),P=b.call(Function.call,String.prototype.slice),O=b.call(Function.call,RegExp.prototype.exec),x=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,A=function(t){var e=P(t,0,1),r=P(t,-1);if("%"===e&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==e)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return I(t,x,(function(t,e,r,i){n[n.length]=r?I(i,k,"$1"):e||t})),n},j=function(t,e){var r,n=t;if(g(m,n)&&(n="%"+(r=m[n])[0]+"%"),g(y,n)){var o=y[n];if(o===p&&(o=v(n)),void 0===o&&!e)throw new s("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:o}}throw new i("intrinsic "+t+" does not exist!")};t.exports=function(t,e){if("string"!=typeof t||0===t.length)throw new s("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new s('"allowMissing" argument must be a boolean');if(null===O(/^%?[^%]*%?$/,t))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=A(t),n=r.length>0?r[0]:"",o=j("%"+n+"%",e),a=o.name,u=o.value,l=!1,f=o.alias;f&&(n=f[0],S(r,w([0,1],f)));for(var h=1,p=!0;h<r.length;h+=1){var d=r[h],v=P(d,0,1),m=P(d,-1);if(('"'===v||"'"===v||"`"===v||'"'===m||"'"===m||"`"===m)&&v!==m)throw new i("property names with quotes must have matching quotes");if("constructor"!==d&&p||(l=!0),g(y,a="%"+(n+="."+d)+"%"))u=y[a];else if(null!=u){if(!(d in u)){if(!e)throw new s("base intrinsic for "+t+" exists, but the property is not available.");return}if(c&&h+1>=r.length){var b=c(u,d);u=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:u[d]}else p=g(u,d),u=u[d];p&&!l&&(y[a]=u)}}return u}},7296:(t,e,r)=>{"use strict";var n=r(210)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(t){n=null}t.exports=n},1405:(t,e,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(5419);t.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&i())))}},5419:t=>{"use strict";t.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),r=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var n=Object.getOwnPropertySymbols(t);if(1!==n.length||n[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},6410:(t,e,r)=>{"use strict";var n=r(5419);t.exports=function(){return n()&&!!Symbol.toStringTag}},7642:(t,e,r)=>{"use strict";var n=r(8612);t.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},5717:t=>{"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}}},2584:(t,e,r)=>{"use strict";var n=r(6410)(),i=r(1924)("Object.prototype.toString"),o=function(t){return!(n&&t&&"object"==typeof t&&Symbol.toStringTag in t)&&"[object Arguments]"===i(t)},s=function(t){return!!o(t)||null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Array]"!==i(t)&&"[object Function]"===i(t.callee)},a=function(){return o(arguments)}();o.isLegacyArguments=s,t.exports=a?o:s},5320:t=>{"use strict";var e,r,n=Function.prototype.toString,i="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof i&&"function"==typeof Object.defineProperty)try{e=Object.defineProperty({},"length",{get:function(){throw r}}),r={},i((function(){throw 42}),null,e)}catch(t){t!==r&&(i=null)}else i=null;var o=/^\s*class\b/,s=function(t){try{var e=n.call(t);return o.test(e)}catch(t){return!1}},a=function(t){try{return!s(t)&&(n.call(t),!0)}catch(t){return!1}},c=Object.prototype.toString,u="function"==typeof Symbol&&!!Symbol.toStringTag,l=!(0 in[,]),f=function(){return!1};if("object"==typeof document){var h=document.all;c.call(h)===c.call(document.all)&&(f=function(t){if((l||!t)&&(void 0===t||"object"==typeof t))try{var e=c.call(t);return("[object HTMLAllCollection]"===e||"[object HTML document.all class]"===e||"[object HTMLCollection]"===e||"[object Object]"===e)&&null==t("")}catch(t){}return!1})}t.exports=i?function(t){if(f(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;try{i(t,null,e)}catch(t){if(t!==r)return!1}return!s(t)&&a(t)}:function(t){if(f(t))return!0;if(!t)return!1;if("function"!=typeof t&&"object"!=typeof t)return!1;if(u)return a(t);if(s(t))return!1;var e=c.call(t);return!("[object Function]"!==e&&"[object GeneratorFunction]"!==e&&!/^\[object HTML/.test(e))&&a(t)}},8662:(t,e,r)=>{"use strict";var n,i=Object.prototype.toString,o=Function.prototype.toString,s=/^\s*(?:function)?\*/,a=r(6410)(),c=Object.getPrototypeOf;t.exports=function(t){if("function"!=typeof t)return!1;if(s.test(o.call(t)))return!0;if(!a)return"[object GeneratorFunction]"===i.call(t);if(!c)return!1;if(void 0===n){var e=function(){if(!a)return!1;try{return Function("return function*() {}")()}catch(t){}}();n=!!e&&c(e)}return c(t)===n}},6898:t=>{"use strict";t.exports=t=>!!t&&("symbol"==typeof Symbol.observable&&"function"==typeof t[Symbol.observable]?t===t[Symbol.observable]():"function"==typeof t["@@observable"]&&t===t["@@observable"]())},5692:(t,e,r)=>{"use strict";var n=r(4029),i=r(3083),o=r(1924),s=o("Object.prototype.toString"),a=r(6410)(),c=r(7296),u="undefined"==typeof globalThis?r.g:globalThis,l=i(),f=o("Array.prototype.indexOf",!0)||function(t,e){for(var r=0;r<t.length;r+=1)if(t[r]===e)return r;return-1},h=o("String.prototype.slice"),p={},d=Object.getPrototypeOf;a&&c&&d&&n(l,(function(t){var e=new u[t];if(Symbol.toStringTag in e){var r=d(e),n=c(r,Symbol.toStringTag);if(!n){var i=d(r);n=c(i,Symbol.toStringTag)}p[t]=n.get}}));t.exports=function(t){if(!t||"object"!=typeof t)return!1;if(!a||!(Symbol.toStringTag in t)){var e=h(s(t),8,-1);return f(l,e)>-1}return!!c&&function(t){var e=!1;return n(p,(function(r,n){if(!e)try{e=r.call(t)===n}catch(t){}})),e}(t)}},6194:function(t,e,r){var n,i,o;i=[],void 0===(o="function"==typeof(n=function(){return function(){const t=r(693),e=r(7462),n=r(3086);function i(){this.mode="reference",this.dbref=null,this.dirtyPartitions=[]}return i.prototype.generateDestructured=function*(t){var e,r;if((t=t||{}).hasOwnProperty("partition")||(t.partition=-1),-1!==t.partition){var n,i;if(t.partition>=0)for(n=this.dbref.collections[t.partition].data.length,i=0;i<n;i++)yield JSON.stringify(this.dbref.collections[t.partition].data[i])}else{for(r=this.dbref.copy(),e=0;e<r.collections.length;e++)r.collections[e].data=[];yield r.serialize({serializationMethod:"normal"})}},i.prototype.loadDatabase=function(r,i){var o,s,a,c=this;this.dbref=null,t.stat(r,(function(u,l){var f;if(u)return"ENOENT"===u.code?void i(null):void i(u);l.isFile()?(o=t.createReadStream(r),s=new n,(a=e.createInterface(o,s)).on("line",(function(t){if(null===c.dbref&&""!==t)try{c.dbref=JSON.parse(t)}catch(t){f=t}})),a.on("close",(function(){f?i(f):c.dbref.collections.length>0&&c.loadNextCollection(r,0,(function(){i(c.dbref)}))}))):i(new Error(r+" is not a valid file."))}))},i.prototype.loadNextCollection=function(r,i,o){var s,a=t.createReadStream(r+"."+i),c=new n,u=e.createInterface(a,c),l=this;u.on("line",(function(t){if(""!==t){try{s=JSON.parse(t)}catch(t){o(t)}l.dbref.collections[i].data.push(s)}})),u.on("close",(function(t){a=null,c=null,u=null,s=null,++i<l.dbref.collections.length?l.loadNextCollection(r,i,o):o()}))},i.prototype.getPartition=function*(){var t,e=this.dbref.collections.length;for(yield-1,t=0;t<e;t++)this.dbref.collections[t].dirty&&(yield t)},i.prototype.exportDatabase=function(t,e,r){this.dbref=e;var n=this.getPartition();this.saveNextPartition(t,n,(function(){r(null)}))},i.prototype.saveNextPartition=function(e,r,n){var i,o=this,s=r.next();if(s.done)n();else{i=e+(-1===s.value?"":"."+s.value);var a=t.createWriteStream(i);for(var c of(a.on("close",(function(){o.saveNextPartition(e,r,n)})),this.generateDestructured({partition:s.value})))a.write(c+"\n");a.end()}},i}()})?n.apply(e,i):n)||(t.exports=o)},7996:function(t,e){var r,n,i;n=[],void 0===(i="function"==typeof(r=function(){return function(){function t(t,e){if(this.app="loki",this.options=e||{},void 0!==t&&(this.app=t),this.catalog=null,!this.checkAvailability())throw new Error("indexedDB does not seem to be supported for your environment")}function e(t){this.db=null,this.initializeLokiCatalog(t)}return t.prototype.closeDatabase=function(){this.catalog&&this.catalog.db&&(this.catalog.db.close(),this.catalog.db=null)},t.prototype.checkAvailability=function(){return!("undefined"==typeof indexedDB||!indexedDB)},t.prototype.loadDatabase=function(t,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,(function(t){if("function"==typeof r){if(0===t.id)return void r(null);r(t.val)}else console.log(t.val)})):this.catalog=new e((function(e){i.catalog=e,i.loadDatabase(t,r)}))},t.prototype.loadKey=t.prototype.loadDatabase,t.prototype.saveDatabase=function(t,r,n){var i=this.app,o=this;function s(t){t&&!0===t.success?n(null):n(new Error("Error saving database")),o.options.closeAfterSave&&o.closeDatabase()}null!==this.catalog&&null!==this.catalog.db?this.catalog.setAppKey(i,t,r,s):this.catalog=new e((function(e){o.saveDatabase(t,r,s)}))},t.prototype.saveKey=t.prototype.saveDatabase,t.prototype.deleteDatabase=function(t,r){var n=this.app,i=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKey(n,t,(function(t){var e=t.id;0!==e?i.catalog.deleteAppKey(e,r):"function"==typeof r&&r({success:!0})})):this.catalog=new e((function(e){i.catalog=e,i.deleteDatabase(t,r)}))},t.prototype.deleteKey=t.prototype.deleteDatabase,t.prototype.deleteDatabasePartitions=function(t){var e=this;this.getDatabaseList((function(r){r.forEach((function(r){r.startsWith(t)&&e.deleteDatabase(r)}))}))},t.prototype.getDatabaseList=function(t){var r=this.app,n=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAppKeys(r,(function(e){for(var r=[],n=0;n<e.length;n++)r.push(e[n].key);"function"==typeof t?t(r):r.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){n.catalog=e,n.getDatabaseList(t)}))},t.prototype.getKeyList=t.prototype.getDatabaseList,t.prototype.getCatalogSummary=function(t){this.app;var r=this;null!==this.catalog&&null!==this.catalog.db?this.catalog.getAllKeys((function(e){for(var r,n,i,o,s,a=[],c=0;c<e.length;c++)i=(r=e[c]).app||"",o=r.key||"",s=r.val||"",n=2*i.length+2*o.length+s.length+1,a.push({app:r.app,key:r.key,size:n});"function"==typeof t?t(a):a.forEach((function(t){console.log(t)}))})):this.catalog=new e((function(e){r.catalog=e,r.getCatalogSummary(t)}))},e.prototype.initializeLokiCatalog=function(t){var e=indexedDB.open("LokiCatalog",1),r=this;e.onupgradeneeded=function(t){var e=t.target.result;if(e.objectStoreNames.contains("LokiAKV")&&e.deleteObjectStore("LokiAKV"),!e.objectStoreNames.contains("LokiAKV")){var r=e.createObjectStore("LokiAKV",{keyPath:"id",autoIncrement:!0});r.createIndex("app","app",{unique:!1}),r.createIndex("key","key",{unique:!1}),r.createIndex("appkey","appkey",{unique:!0})}},e.onsuccess=function(e){r.db=e.target.result,"function"==typeof t&&t(r)},e.onerror=function(t){throw t}},e.prototype.getAppKey=function(t,e,r){var n,i=t+","+e,o=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("appkey").get(i);o.onsuccess=(n=r,function(t){var e=t.target.result;null==e&&(e={id:0,success:!1}),"function"==typeof n?n(e):console.log(e)}),o.onerror=function(t){return function(e){if("function"!=typeof t)throw e;t({id:0,success:!1})}}(r)},e.prototype.getAppKeyById=function(t,e,r){this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").get(t).onsuccess=function(t,e){return function(r){"function"==typeof e?e(r.target.result,t):console.log(r.target.result)}}(r,e)},e.prototype.setAppKey=function(t,e,r,n){var i,o=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV"),s=o.index("appkey"),a=t+","+e,c=s.get(a);c.onsuccess=function(i){var s=i.target.result;null==s?s={app:t,key:e,appkey:t+","+e,val:r}:s.val=r;var a,u=o.put(s);u.onerror=(a=n,function(t){"function"==typeof a?a({success:!1}):(console.error("LokiCatalog.setAppKey (set) onerror"),console.error(c.error))}),u.onsuccess=function(t){return function(e){"function"==typeof t&&t({success:!0})}}(n)},c.onerror=(i=n,function(t){"function"==typeof i?i({success:!1}):(console.error("LokiCatalog.setAppKey (get) onerror"),console.error(c.error))})},e.prototype.deleteAppKey=function(t,e){var r,n=this.db.transaction(["LokiAKV"],"readwrite").objectStore("LokiAKV").delete(t);n.onsuccess=(r=e,function(t){"function"==typeof r&&r({success:!0})}),n.onerror=function(t){return function(e){"function"==typeof t?t({success:!1}):(console.error("LokiCatalog.deleteAppKey raised onerror"),console.error(n.error))}}(e)},e.prototype.getAppKeys=function(t,e){var r,n=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").index("app"),i=IDBKeyRange.only(t),o=n.openCursor(i),s=[];o.onsuccess=function(t,e){return function(r){var n=r.target.result;if(n){var i=n.value;t.push(i),n.continue()}else"function"==typeof e?e(t):console.log(t)}}(s,e),o.onerror=(r=e,function(t){"function"==typeof r?r(null):(console.error("LokiCatalog.getAppKeys raised onerror"),console.error(t))})},e.prototype.getAllKeys=function(t){var e,r=this.db.transaction(["LokiAKV"],"readonly").objectStore("LokiAKV").openCursor(),n=[];r.onsuccess=function(t,e){return function(r){var n=r.target.result;if(n){var i=n.value;t.push(i),n.continue()}else"function"==typeof e?e(t):console.log(t)}}(n,t),r.onerror=(e=t,function(t){"function"==typeof e&&e(null)})},t}()})?r.apply(e,n):r)||(t.exports=i)},3050:function(t,e,r){var n,i,o;i=[],n=function(){return function(){"use strict";var t=Object.prototype.hasOwnProperty;function e(t){var r,i;if(Array.isArray(t)){for(i=0;i<t.length;i++)e(t[i]);n(t)}else if(null!==t&&"object"==typeof t){for(r in t)t.hasOwnProperty(r)&&e(t[r]);n(t)}}function n(t){Object.isFrozen(t)||Object.freeze(t)}function i(t){return Object.isFrozen(t)?m(t,"shallow"):t}var o={copyProperties:function(t,e){var r;for(r in t)e[r]=t[r]},resolveTransformObject:function(t,e,r){var n,i;if("number"!=typeof r&&(r=0),++r>=10)return t;for(n in t)"string"==typeof t[n]&&0===t[n].indexOf("[%lktxp]")?(i=t[n].substring(8),e.hasOwnProperty(i)&&(t[n]=e[i])):"object"==typeof t[n]&&(t[n]=o.resolveTransformObject(t[n],e,r));return t},resolveTransformParams:function(t,e){var r,n,i=[];if(void 0===e)return t;for(r=0;r<t.length;r++)n=m(t[r],"shallow-recurse-objects"),i.push(o.resolveTransformObject(n,e));return i},getIn:function(t,e,r){if(null!=t){if(!r)return t[e];if("string"==typeof e&&(e=e.split(".")),!Array.isArray(e))throw new Error("path must be a string or array. Found "+typeof e);for(var n=0,i=e.length;null!=t&&n<i;)t=t[e[n++]];return n&&n==i?t:void 0}}},s={aeq:a,lt:c,gt:u};function a(t,e){var r,n,i,o;if(t===e)return!0;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:i=1;break;case!1:i=3;break;case!0:i=4;break;case"":i=5;break;default:i=t==t?9:0}switch(e){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=e==e?9:0}if(9!==i||9!==o)return i===o}return r=Number(t),n=Number(e),r==r||n==n?r===n:(r=t.toString())==(n=e.toString())}function c(t,e,r){var n,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:o<s}return n=Number(t),i=Number(e),n==n&&i==i?n<i||!(n>i)&&r:n==n&&i!=i||(i!=i||n==n)&&(t<e||!(t>e)&&(t==e?r:(n=t.toString())<(i=e.toString())||n==i&&r))}function u(t,e,r){var n,i,o,s;if(!t||!e||!0===t||!0===e||t!=t||e!=e){switch(t){case void 0:case null:o=1;break;case!1:o=3;break;case!0:o=4;break;case"":o=5;break;default:o=t==t?9:0}switch(e){case void 0:case null:s=1;break;case!1:s=3;break;case!0:s=4;break;case"":s=5;break;default:s=e==e?9:0}if(9!==o||9!==s)return o===s?r:o>s}return n=Number(t),i=Number(e),n==n&&i==i?n>i||!(n<i)&&r:(n!=n||i==i)&&(i==i&&n!=n||t>e||!(t<e)&&(t==e?r:(n=t.toString())>(i=e.toString())||n==i&&r))}function l(t,e,r){return s.aeq(t,e)?0:s.lt(t,e,!1)?r?1:-1:s.gt(t,e,!1)?r?-1:1:0}function f(t,e,r){for(var n,i,s,a,c,u=0,f=0,h=t.length;f<h;f++)if(~(i=(n=t[f])[0]).indexOf(".")?(c=i.split("."),s=o.getIn(e,c,!0),a=o.getIn(r,c,!0)):(s=e[i],a=r[i]),0!==(u=l(s,a,n[1])))return u;return 0}function h(t,e,r,n,i,o){var s,a=o||0,c=e[a],u=!1;if("object"==typeof t&&c in t&&(s=t[c]),a+1>=e.length)u=r(s,n,i);else if(Array.isArray(s))for(var l=0,f=s.length;l<f&&!0!==(u=h(s[l],e,r,n,i,a+1));l+=1);else u=h(s,e,r,n,i,a+1);return u}function p(e){return"string"==typeof e||Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:"object"==typeof e&&null!==e?function(r){return t.call(e,r)}:null}function d(e,r,n){for(var i in r)if(t.call(r,i))return y[i](e,r[i],n);return!1}var y={$eq:function(t,e){return t===e},$aeq:function(t,e){return t==e},$ne:function(t,e){return e!=e?t==t:t!==e},$dteq:function(t,e){return s.aeq(t,e)},$gt:function(t,e){return s.gt(t,e,!1)},$gte:function(t,e){return s.gt(t,e,!0)},$lt:function(t,e){return s.lt(t,e,!1)},$lte:function(t,e){return s.lt(t,e,!0)},$jgt:function(t,e){return t>e},$jgte:function(t,e){return t>=e},$jlt:function(t,e){return t<e},$jlte:function(t,e){return t<=e},$between:function(t,e){return null!=t&&s.gt(t,e[0],!0)&&s.lt(t,e[1],!0)},$jbetween:function(t,e){return null!=t&&t>=e[0]&&t<=e[1]},$in:function(t,e){return-1!==e.indexOf(t)},$inSet:function(t,e){return e.has(t)},$nin:function(t,e){return-1===e.indexOf(t)},$keyin:function(t,e){return t in e},$nkeyin:function(t,e){return!(t in e)},$definedin:function(t,e){return void 0!==e[t]},$undefinedin:function(t,e){return void 0===e[t]},$regex:function(t,e){return e.test(t)},$containsString:function(t,e){return"string"==typeof t&&-1!==t.indexOf(e)},$containsNone:function(t,e){return!y.$containsAny(t,e)},$containsAny:function(t,e){var r=p(t);return null!==r&&(Array.isArray(e)?e.some(r):r(e))},$contains:function(t,e){var r=p(t);return null!==r&&(Array.isArray(e)?e.every(r):r(e))},$elemMatch:function(t,e){return!!Array.isArray(t)&&t.some((function(t){return Object.keys(e).every((function(r){var n=e[r];return"object"==typeof n&&n||(n={$eq:n}),-1!==r.indexOf(".")?h(t,r.split("."),d,e[r],t):d(t[r],n,t)}))}))},$type:function(t,e,r){var n=typeof t;return"object"===n&&(Array.isArray(t)?n="array":t instanceof Date&&(n="date")),"object"!=typeof e?n===e:d(n,e,r)},$finite:function(t,e){return e===isFinite(t)},$size:function(t,e,r){return!!Array.isArray(t)&&("object"!=typeof e?t.length===e:d(t.length,e,r))},$len:function(t,e,r){return"string"==typeof t&&("object"!=typeof e?t.length===e:d(t.length,e,r))},$where:function(t,e){return!0===e(t)},$not:function(t,e,r){return!d(t,e,r)},$and:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(!d(t,e[n],r))return!1;return!0},$or:function(t,e,r){for(var n=0,i=e.length;n<i;n+=1)if(d(t,e[n],r))return!0;return!1},$exists:function(t,e){return e?void 0!==t:void 0===t}};["$eq","$aeq","$ne","$dteq","$gt","$gte","$lt","$lte","$jgt","$jgte","$jlt","$jlte","$type"].forEach((function(t){var e=y[t];y["$"+t]=function(t,r,n){if("string"==typeof r)return e(t,n[r]);if("function"==typeof r)return e(t,r(n));throw new Error("Invalid argument to $$ matcher")}}));var v={$eq:y.$eq,$aeq:!0,$dteq:!0,$gt:!0,$gte:!0,$lt:!0,$lte:!0,$in:!0,$between:!0};function m(t,e){if(null==t)return null;var r;switch(e||"parse-stringify"){case"parse-stringify":r=JSON.parse(JSON.stringify(t));break;case"jquery-extend-deep":r=jQuery.extend(!0,{},t);break;case"shallow":r=Object.create(t.constructor.prototype),Object.keys(t).map((function(e){r[e]=t[e]}));break;case"shallow-assign":r=Object.create(t.constructor.prototype),Object.assign(r,t);break;case"shallow-recurse-objects":r=m(t,"shallow"),Object.keys(t).forEach((function(e){"object"==typeof t[e]&&"Object"===t[e].constructor.name?r[e]=m(t[e],"shallow-recurse-objects"):Array.isArray(t[e])&&(r[e]=b(t[e],"shallow-recurse-objects"))}))}return r}function b(t,e){if("parse-stringify"==e)return m(t,e);for(var r=[],n=0,i=t.length;n<i;n++)r[n]=m(t[n],e);return r}function g(){try{return window&&void 0!==window.localStorage&&null!==window.localStorage}catch(t){return!1}}function w(){}function S(t,e){this.filename=t||"loki.db",this.collections=[],this.databaseVersion=1.5,this.engineVersion=1.5,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.throttledSaves=!0,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.throttledSavePending=!1,this.throttledCallbacks=[],this.verbose=!(!e||!e.hasOwnProperty("verbose"))&&e.verbose,this.events={init:[],loaded:[],flushChanges:[],close:[],changes:[],warning:[]};var n=function(){return void 0!==r.g&&(r.g.android||r.g.NSObject)?"NATIVESCRIPT":"undefined"==typeof window||void 0!==r.g&&r.g.window&&"undefined"!=typeof process?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA"};e&&e.hasOwnProperty("env")?this.ENV=e.env:this.ENV=n(),"undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(e,!0),this.on("init",this.clearChanges)}function I(t){this.hashStore={},this.options=t||{},this.options.hasOwnProperty("asyncResponses")||(this.options.asyncResponses=!1),this.options.hasOwnProperty("asyncTimeout")||(this.options.asyncTimeout=50)}function P(t,e){if(this.mode="reference",this.adapter=null,this.options=e||{},this.dbref=null,this.dbname="",this.pageIterator={},!t)throw new Error("LokiPartitioningAdapter requires a (non-reference mode) adapter on construction");if("reference"===t.mode)throw new Error("LokiPartitioningAdapter cannot be instantiated with a reference mode adapter");this.adapter=t,this.options.hasOwnProperty("paging")||(this.options.paging=!1),this.options.hasOwnProperty("pageSize")||(this.options.pageSize=26214400),this.options.hasOwnProperty("delimiter")||(this.options.delimiter="$<\n")}function O(){try{this.fs=r(693)}catch(t){this.fs=null}}function x(){}function k(t,e){return e=e||{},this.collection=t,this.filteredrows=[],this.filterInitialized=!1,this}function A(t,e){if("$regex"===t)Array.isArray(e)?e=new RegExp(e[0],e[1]):e instanceof RegExp||(e=new RegExp(e));else if("object"==typeof e)for(var r in e)"$regex"!==r&&"object"!=typeof e[r]||(e[r]=A(r,e[r]));return e}function j(t,e,r){this.collection=t,this.name=e,this.rebuildPending=!1,this.options=r||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.options.hasOwnProperty("minRebuildInterval")||(this.options.minRebuildInterval=1),this.resultset=new k(t),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.collection.disableFreeze||Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,this.events={rebuild:[],filter:[],sort:[]}}function E(e,r){this.name=e,this.data=[],this.idIndex=null,this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var n=this;(r=r||{}).hasOwnProperty("unique")&&(Array.isArray(r.unique)||(r.unique=[r.unique]),r.unique.forEach((function(t){n.uniqueNames.push(t)}))),r.hasOwnProperty("exact")&&r.exact.forEach((function(t){n.constraints.exact[t]=new B(t)})),this.adaptiveBinaryIndices=!r.hasOwnProperty("adaptiveBinaryIndices")||r.adaptiveBinaryIndices,this.transactional=!!r.hasOwnProperty("transactional")&&r.transactional,this.cloneObjects=!!r.hasOwnProperty("clone")&&r.clone,this.cloneMethod=r.hasOwnProperty("cloneMethod")?r.cloneMethod:"parse-stringify",this.asyncListeners=!!r.hasOwnProperty("asyncListeners")&&r.asyncListeners,this.disableMeta=!!r.hasOwnProperty("disableMeta")&&r.disableMeta,this.disableChangesApi=!r.hasOwnProperty("disableChangesApi")||r.disableChangesApi,this.disableDeltaChangesApi=!r.hasOwnProperty("disableDeltaChangesApi")||r.disableDeltaChangesApi,this.disableChangesApi&&(this.disableDeltaChangesApi=!0),this.autoupdate=!!r.hasOwnProperty("autoupdate")&&r.autoupdate,this.serializableIndices=!r.hasOwnProperty("serializableIndices")||r.serializableIndices,this.disableFreeze=!r.hasOwnProperty("disableFreeze")||r.disableFreeze,this.ttl={age:null,ttlInterval:null,daemon:null},this.setTTL(r.ttl||-1,r.ttlInterval),this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],delete:[],warning:[]},this.changes=[],this.dirtyIds=[];var i=[];if(r&&r.indices)if("[object Array]"===Object.prototype.toString.call(r.indices))i=r.indices;else{if("string"!=typeof r.indices)throw new TypeError("Indices needs to be a string or an array of strings");i=[r.indices]}for(var o=0;o<i.length;o++)this.ensureIndex(i[o]);function s(e){var r="function"==typeof Set?new Set:[];r.add||(r.add=function(t){return-1===this.indexOf(t)&&this.push(t),this}),e.forEach((function(t){r.add(t.object)})),r.forEach((function(e){if(!t.call(e,"$loki"))return n.removeAutoUpdateObserver(e);try{n.update(e)}catch(t){}}))}function a(t,e){return e?c(e,t):JSON.parse(JSON.stringify(t))}function c(t,e){var r=null!==e&&"object"==typeof e?Object.keys(e):null;if(r&&r.length&&["string","boolean","number"].indexOf(typeof e)<0){for(var i={},o=0;o<r.length;o++){var s=r[o];if(e.hasOwnProperty(s))if(!t.hasOwnProperty(s)||n.uniqueNames.indexOf(s)>=0||"$loki"==s||"meta"==s)i[s]=e[s];else{var a=c(t[s],e[s]);void 0!==a&&a!={}&&(i[s]=a)}}return 0===Object.keys(i).length?void 0:i}return t===e?void 0:e}function u(){n.changes=[]}this.observerCallback=s,this.getChangeDelta=a,this.getObjectDelta=c,this.getChanges=function(){return n.changes},this.flushChanges=u,this.setChangesApi=function(t){n.disableChangesApi=!t,t||(n.disableDeltaChangesApi=!1)},this.on("delete",(function(t){n.disableChangesApi||n.createChange(n.name,"R",t)})),this.on("warning",(function(t){n.lokiConsoleWrapper.warn(t)})),u()}function D(t){return-1!==t.indexOf(".")}function _(t){return parseFloat(t,10)}function C(t,e){return t+e}function M(t,e){return t-e}function T(t){return t.reduce(C,0)/t.length}function N(t){var e=T(t),r=T(t.map((function(t){var r=t-e;return r*r})));return Math.sqrt(r)}function L(t,e,r){if(!1===r)return t[e];for(var n=e.split("."),i=t;n.length>0;)i=i[n.shift()];return i}function z(t,e,r){for(var n,i,o=0,s=t.length;o<s;){if(i=o+s>>1,0===(n=r.apply(null,[e,t[i]])))return{found:!0,index:i};n<0?s=i:o=i+1}return{found:!1,index:s}}function F(t){return function(e,r){return z(e,r,t)}}function $(){}function R(t){this.field=t,this.keyMap=Object.create(null),this.lokiMap=Object.create(null)}function B(t){this.index=Object.create(null),this.field=t}function q(t){this.field=t}return w.prototype.events={},w.prototype.asyncListeners=!1,w.prototype.on=function(t,e){var r,n=this;return Array.isArray(t)?(t.forEach((function(t){n.on(t,e)})),e):((r=this.events[t])||(r=this.events[t]=[]),r.push(e),e)},w.prototype.emit=function(t){var e,r=this;if(!t||!this.events[t])throw new Error("No event "+t+" defined");this.events[t].length&&(e=Array.prototype.slice.call(arguments,1),this.events[t].forEach((function(t){r.asyncListeners?setTimeout((function(){t.apply(r,e)}),1):t.apply(r,e)})))},w.prototype.addListener=w.prototype.on,w.prototype.removeListener=function(t,e){var r=this;if(Array.isArray(t))t.forEach((function(t){r.removeListener(t,e)}));else if(this.events[t]){var n=this.events[t];n.splice(n.indexOf(e),1)}},S.prototype=new w,S.prototype.constructor=S,S.prototype.getIndexedAdapter=function(){return r(7996)},S.prototype.configureOptions=function(t,e){var r={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage",MEMORY:"memory"},n={fs:O,localStorage:x,memory:I};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,void 0!==t){if(this.options=t,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof n[t.persistenceMethod]&&(this.persistenceMethod=t.persistenceMethod,this.persistenceAdapter=new n[t.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=t.adapter,this.options.adapter=null,this.isIncremental="incremental"===this.persistenceAdapter.mode),t.autoload&&e){var i=this;setTimeout((function(){i.loadDatabase(t,t.autoloadCallback)}),1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(t,t.autosaveCallback):this.autosaveEnable()),this.options.hasOwnProperty("throttledSaves")&&(this.throttledSaves=this.options.throttledSaves)}this.options.hasOwnProperty("serializationMethod")||(this.options.serializationMethod="normal"),this.options.hasOwnProperty("destructureDelimiter")||(this.options.destructureDelimiter="$<\n"),null===this.persistenceAdapter&&(this.persistenceMethod=r[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new n[this.persistenceMethod]))},S.prototype.copy=function(t){var e,r,n=new S(this.filename,{env:"NA"});if(t=t||{},n.loadJSONObject(this,{retainDirtyFlags:!0}),t.hasOwnProperty("removeNonSerializable")&&!0===t.removeNonSerializable)for(n.autosaveHandle=null,n.persistenceAdapter=null,e=n.collections.length,r=0;r<e;r++)n.collections[r].constraints=null,n.collections[r].ttl=null;return n},S.prototype.addCollection=function(t,e){var r,n=this.collections.length;if(e&&!0===e.disableMeta){if(!1===e.disableChangesApi)throw new Error("disableMeta option cannot be passed as true when disableChangesApi is passed as false");if(!1===e.disableDeltaChangesApi)throw new Error("disableMeta option cannot be passed as true when disableDeltaChangesApi is passed as false");if("number"==typeof e.ttl&&e.ttl>0)throw new Error("disableMeta option cannot be passed as true when ttl is enabled")}for(r=0;r<n;r+=1)if(this.collections[r].name===t)return this.collections[r];var i=new E(t,e);return i.isIncremental=this.isIncremental,this.collections.push(i),this.verbose&&(i.lokiConsoleWrapper=console),i},S.prototype.loadCollection=function(t){if(!t.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(t)},S.prototype.getCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t)return this.collections[e];return this.emit("warning","collection "+t+" not found"),null},S.prototype.renameCollection=function(t,e){var r=this.getCollection(t);return r&&(r.name=e),r},S.prototype.listCollections=function(){for(var t=this.collections.length,e=[];t--;)e.push({name:this.collections[t].name,type:this.collections[t].objType,count:this.collections[t].data.length});return e},S.prototype.removeCollection=function(t){var e,r=this.collections.length;for(e=0;e<r;e+=1)if(this.collections[e].name===t){var n=new E(t,{}),i=this.collections[e];for(var o in i)i.hasOwnProperty(o)&&n.hasOwnProperty(o)&&(i[o]=n[o]);return void this.collections.splice(e,1)}},S.prototype.getName=function(){return this.name},S.prototype.serializeReplacer=function(t,e){switch(t){case"autosaveHandle":case"persistenceAdapter":case"constraints":case"ttl":case"lokiConsoleWrapper":return null;case"throttledSavePending":case"throttledCallbacks":return;default:return e}},S.prototype.serialize=function(t){switch((t=t||{}).hasOwnProperty("serializationMethod")||(t.serializationMethod=this.options.serializationMethod),t.serializationMethod){case"normal":default:return JSON.stringify(this,this.serializeReplacer);case"pretty":return JSON.stringify(this,this.serializeReplacer,2);case"destructured":return this.serializeDestructured()}},S.prototype.toJson=S.prototype.serialize,S.prototype.serializeDestructured=function(t){var e,r,n,i,o,s=[];if((t=t||{}).hasOwnProperty("partitioned")||(t.partitioned=!1),t.hasOwnProperty("delimited")||(t.delimited=!0),t.hasOwnProperty("delimiter")||(t.delimiter=this.options.destructureDelimiter),!0===t.partitioned&&t.hasOwnProperty("partition")&&t.partition>=0)return this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:t.partition});for((o=new S(this.filename)).loadJSONObject(this),e=0;e<o.collections.length;e++)o.collections[e].data=[];if(!0===t.partitioned&&-1===t.partition)return o.serialize({serializationMethod:"normal"});for(s.push(o.serialize({serializationMethod:"normal"})),o=null,e=0;e<this.collections.length;e++)if(n=this.serializeCollection({delimited:t.delimited,delimiter:t.delimiter,collectionIndex:e}),!1===t.partitioned&&!1===t.delimited){if(!Array.isArray(n))throw new Error("a nondelimited, non partitioned collection serialization did not return an expected array");for(i=n.length,r=0;r<i;r++)s.push(n[r]),n[r]=null;s.push("")}else s.push(n);return t.partitioned?(t.delimited,s):t.delimited?(s.push(""),s.join(t.delimiter)):(s.push(""),s)},S.prototype.serializeCollection=function(t){var e,r,n=[];if((t=t||{}).hasOwnProperty("delimited")||(t.delimited=!0),!t.hasOwnProperty("collectionIndex"))throw new Error("serializeCollection called without 'collectionIndex' option");for(e=this.collections[t.collectionIndex].data.length,n=[],r=0;r<e;r++)n.push(JSON.stringify(this.collections[t.collectionIndex].data[r]));return t.delimited?(n.push(""),n.join(t.delimiter)):n},S.prototype.deserializeDestructured=function(t,e){var r,n,i,o=[],s=0,a=1,c=!1;if((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.partitioned){if(e.hasOwnProperty("partition"))return-1===e.partition?r=JSON.parse(t[0]):this.deserializeCollection(t[e.partition+1],e);for(n=(r=JSON.parse(t[0])).collections.length,s=0;s<n;s++)r.collections[s].data=this.deserializeCollection(t[s+1],e);return r}if(e.delimited){if(o=t.split(e.delimiter),t=null,0===o.length)return null}else o=t;for(n=(r=JSON.parse(o[0])).collections.length,o[0]=null;!c;)o[a],""===o[a]?++s>n&&(c=!0):(i=JSON.parse(o[a]),r.collections[s].data.push(i)),o[a++]=null;return r},S.prototype.deserializeCollection=function(t,e){var r,n,i=[];for((e=e||{}).hasOwnProperty("partitioned")||(e.partitioned=!1),e.hasOwnProperty("delimited")||(e.delimited=!0),e.hasOwnProperty("delimiter")||(e.delimiter=this.options.destructureDelimiter),e.delimited?(i=t.split(e.delimiter)).pop():i=t,n=i.length,r=0;r<n;r++)i[r]=JSON.parse(i[r]);return i},S.prototype.loadJSON=function(t,e){var r;if(0===t.length)r={};else switch(this.options.serializationMethod){case"normal":case"pretty":default:r=JSON.parse(t);break;case"destructured":r=this.deserializeDestructured(t)}this.loadJSONObject(r,e)},S.prototype.loadJSONObject=function(t,r){var n,i,s,a,c,u,l=0,f=t.collections?t.collections.length:0;function h(t){var e,n=r[t.name];return n.proto?(e=n.inflate||o.copyProperties,function(t){var r=new n.proto;return e(t,r),r}):n.inflate}for(this.name=t.name,t.hasOwnProperty("throttledSaves")&&r&&!r.hasOwnProperty("throttledSaves")&&(this.throttledSaves=t.throttledSaves),this.collections=[];l<f;l+=1){if(n=t.collections[l],(i=this.addCollection(n.name,{disableChangesApi:n.disableChangesApi,disableDeltaChangesApi:n.disableDeltaChangesApi,disableMeta:n.disableMeta,disableFreeze:!n.hasOwnProperty("disableFreeze")||n.disableFreeze})).adaptiveBinaryIndices=!!n.hasOwnProperty("adaptiveBinaryIndices")&&!0===n.adaptiveBinaryIndices,i.transactional=n.transactional,i.asyncListeners=n.asyncListeners,i.cloneObjects=n.cloneObjects,i.cloneMethod=n.cloneMethod||"parse-stringify",i.autoupdate=n.autoupdate,i.changes=n.changes,i.dirtyIds=n.dirtyIds||[],r&&!0===r.retainDirtyFlags?i.dirty=n.dirty:i.dirty=!1,s=n.data.length,a=0,r&&r.hasOwnProperty(n.name))for(c=h(n);a<s;a++)u=c(n.data[a]),i.data[a]=u,i.addAutoUpdateObserver(u),i.disableFreeze||e(i.data[a]);else for(;a<s;a++)i.data[a]=n.data[a],i.addAutoUpdateObserver(i.data[a]),i.disableFreeze||e(i.data[a]);if(i.maxId=void 0===n.maxId?0:n.maxId,void 0!==n.binaryIndices&&(i.binaryIndices=n.binaryIndices),void 0!==n.transforms&&(i.transforms=n.transforms),i.uniqueNames=[],n.hasOwnProperty("uniqueNames")&&(i.uniqueNames=n.uniqueNames),void 0!==n.DynamicViews){for(var p=0;p<n.DynamicViews.length;p++){var d=n.DynamicViews[p],y=i.addDynamicView(d.name,d.options);y.resultdata=d.resultdata,y.resultsdirty=d.resultsdirty,y.filterPipeline=d.filterPipeline,y.sortCriteriaSimple=d.sortCriteriaSimple,y.sortCriteria=d.sortCriteria,y.sortFunction=null,y.sortDirty=d.sortDirty,i.disableFreeze||(e(y.filterPipeline),y.sortCriteriaSimple?e(y.sortCriteriaSimple):y.sortCriteria&&e(y.sortCriteria)),y.resultset.filteredrows=d.resultset.filteredrows,y.resultset.filterInitialized=d.resultset.filterInitialized,y.rematerialize({removeWhereFilters:!0})}t.databaseVersion<1.5&&(i.ensureAllIndexes(!0),i.dirty=!0)}}},S.prototype.close=function(t){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&(this.saveDatabase(t),t=void 0)),t&&this.on("close",t),this.emit("close")},S.prototype.generateChangesNotification=function(t){function e(t){return t.name}var r=[],n=t||this.collections.map(e);return this.collections.forEach((function(t){-1!==n.indexOf(e(t))&&(r=r.concat(t.getChanges()))})),r},S.prototype.serializeChanges=function(t){return JSON.stringify(this.generateChangesNotification(t))},S.prototype.clearChanges=function(){this.collections.forEach((function(t){t.flushChanges&&t.flushChanges()}))},I.prototype.loadDatabase=function(t,e){var r=this;this.options.asyncResponses?setTimeout((function(){r.hashStore.hasOwnProperty(t)?e(r.hashStore[t].value):e(null)}),this.options.asyncTimeout):this.hashStore.hasOwnProperty(t)?e(this.hashStore[t].value):e(null)},I.prototype.saveDatabase=function(t,e,r){var n,i=this;this.options.asyncResponses?setTimeout((function(){n=i.hashStore.hasOwnProperty(t)?i.hashStore[t].savecount:0,i.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r()}),this.options.asyncTimeout):(n=this.hashStore.hasOwnProperty(t)?this.hashStore[t].savecount:0,this.hashStore[t]={savecount:n+1,lastsave:new Date,value:e},r())},I.prototype.deleteDatabase=function(t,e){this.hashStore.hasOwnProperty(t)&&delete this.hashStore[t],"function"==typeof e&&e()},P.prototype.loadDatabase=function(t,e){var r=this;this.dbname=t,this.dbref=new S(t),this.adapter.loadDatabase(t,(function(t){if(t){"string"!=typeof t&&e(new Error("LokiPartitioningAdapter received an unexpected response from inner adapter loadDatabase()"));var n=JSON.parse(t);r.dbref.loadJSONObject(n),n=null,r.dbref.collections.length,0!==r.dbref.collections.length?(r.pageIterator={collection:0,pageIndex:0},r.loadNextPartition(0,(function(){e(r.dbref)}))):e(r.dbref)}else e(t)}))},P.prototype.loadNextPartition=function(t,e){var r=this.dbname+"."+t,n=this;if(!0===this.options.paging)return this.pageIterator.pageIndex=0,void this.loadNextPage(e);this.adapter.loadDatabase(r,(function(r){var i=n.dbref.deserializeCollection(r,{delimited:!0,collectionIndex:t});n.dbref.collections[t].data=i,++t<n.dbref.collections.length?n.loadNextPartition(t,e):e()}))},P.prototype.loadNextPage=function(t){var e=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,r=this;this.adapter.loadDatabase(e,(function(e){var n=e.split(r.options.delimiter);e="";var i,o=n.length,s=""===n[o-1];for(s&&(n.pop(),""===n[(o=n.length)-1]&&1===o&&(n.pop(),o=n.length)),i=0;i<o;i++)r.dbref.collections[r.pageIterator.collection].data.push(JSON.parse(n[i])),n[i]=null;n=[],s?++r.pageIterator.collection<r.dbref.collections.length?r.loadNextPartition(r.pageIterator.collection,t):t():(r.pageIterator.pageIndex++,r.loadNextPage(t))}))},P.prototype.exportDatabase=function(t,e,r){var n,i=e.collections.length;for(this.dbref=e,this.dbname=t,this.dirtyPartitions=[-1],n=0;n<i;n++)e.collections[n].dirty&&this.dirtyPartitions.push(n);this.saveNextPartition((function(t){r(t)}))},P.prototype.saveNextPartition=function(t){var e=this,r=this.dirtyPartitions.shift(),n=this.dbname+(-1===r?"":"."+r);if(this.options.paging&&-1!==r)return this.pageIterator={collection:r,docIndex:0,pageIndex:0},void this.saveNextPage((function(r){0===e.dirtyPartitions.length?t(r):e.saveNextPartition(t)}));var i=this.dbref.serializeDestructured({partitioned:!0,delimited:!0,partition:r});this.adapter.saveDatabase(n,i,(function(r){r?t(r):0===e.dirtyPartitions.length?t(null):e.saveNextPartition(t)}))},P.prototype.saveNextPage=function(t){var e=this,r=this.dbref.collections[this.pageIterator.collection],n=this.dbname+"."+this.pageIterator.collection+"."+this.pageIterator.pageIndex,i=0,o=r.data.length,s=this.options.delimiter.length,a="",c="",u=!1,l=!1,f=function(r){c="",r&&t(r),u?t(null):(e.pageIterator.pageIndex++,e.saveNextPage(t))};for(0===r.data.length&&(u=!0);;)if(u||(a=JSON.stringify(r.data[this.pageIterator.docIndex]),c+=a,i+=a.length,++this.pageIterator.docIndex>=o&&(u=!0)),i>=this.options.pageSize&&(l=!0),l&&!u||(c+=this.options.delimiter,i+=s),u||l)return void this.adapter.saveDatabase(n,c,f)},O.prototype.loadDatabase=function(t,e){var r=this;this.fs.stat(t,(function(n,i){!n&&i.isFile()?r.fs.readFile(t,{encoding:"utf8"},(function(t,r){e(t?new Error(t):r)})):e(null)}))},O.prototype.saveDatabase=function(t,e,r){var n=this,i=t+"~";this.fs.writeFile(i,e,(function(e){e?r(new Error(e)):n.fs.rename(i,t,r)}))},O.prototype.deleteDatabase=function(t,e){this.fs.unlink(t,(function(t){t?e(new Error(t)):e()}))},x.prototype.loadDatabase=function(t,e){g()?e(localStorage.getItem(t)):e(new Error("localStorage is not available"))},x.prototype.saveDatabase=function(t,e,r){g()?(localStorage.setItem(t,e),r(null)):r(new Error("localStorage is not available"))},x.prototype.deleteDatabase=function(t,e){g()?(localStorage.removeItem(t),e(null)):e(new Error("localStorage is not available"))},S.prototype.throttledSaveDrain=function(t,e){var r=this,n=(new Date).getTime();if(this.throttledSaves||t(!0),(e=e||{}).hasOwnProperty("recursiveWait")||(e.recursiveWait=!0),e.hasOwnProperty("recursiveWaitLimit")||(e.recursiveWaitLimit=!1),e.hasOwnProperty("recursiveWaitLimitDuration")||(e.recursiveWaitLimitDuration=2e3),e.hasOwnProperty("started")||(e.started=(new Date).getTime()),this.throttledSaves&&this.throttledSavePending){if(!e.recursiveWait)return void this.throttledCallbacks.push(t);this.throttledCallbacks.push((function(){return r.throttledSavePending?e.recursiveWaitLimit&&n-e.started>e.recursiveWaitLimitDuration?void t(!1):void r.throttledSaveDrain(t,e):void t(!0)}))}else t(!0)},S.prototype.loadDatabaseInternal=function(t,e){var r=e||function(t,e){if(t)throw t},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,(function(e){if("string"==typeof e){var i=!1;try{n.loadJSON(e,t||{}),i=!0}catch(t){r(t)}i&&(r(null),n.emit("loaded","database "+n.filename+" loaded"))}else{if(!e)return r(null),void n.emit("loaded","empty database "+n.filename+" loaded");if(e instanceof Error)return void r(e);if("object"==typeof e)return n.loadJSONObject(e,t||{}),r(null),void n.emit("loaded","database "+n.filename+" loaded");r("unexpected adapter response : "+e)}})):r(new Error("persistenceAdapter not configured"))},S.prototype.loadDatabase=function(t,e){var r=this;this.throttledSaves?this.throttledSaveDrain((function(n){if(n)return r.throttledSavePending=!0,void r.loadDatabaseInternal(t,(function(t){0===r.throttledCallbacks.length?r.throttledSavePending=!1:r.saveDatabase(),"function"==typeof e&&e(t)}));"function"==typeof e&&e(new Error("Unable to pause save throttling long enough to read database"))}),t):this.loadDatabaseInternal(t,e)},S.prototype.saveDatabaseInternal=function(t){var e,r=t||function(t){if(t)throw t},n=this;this.persistenceAdapter?"incremental"===this.persistenceAdapter.mode?(this.ignoreAutosave=!0,this.persistenceAdapter.saveDatabase(this.filename,(function(){if(n.ignoreAutosave=!1,!e){var t=n.copy({removeNonSerializable:!0});return e=n.collections.map((function(t){return[t.dirty,t.dirtyIds]})),n.collections.forEach((function(t){t.dirty=!1,t.dirtyIds=[]})),t}r(new Error("adapter error - getLokiCopy called more than once"))}),(function(t){n.ignoreAutosave=!1,t&&e&&n.collections.forEach((function(t,r){var n=e[r];t.dirty=t.dirty||n[0],t.dirtyIds=t.dirtyIds.concat(n[1])})),r(t)}))):"reference"===this.persistenceAdapter.mode&&"function"==typeof this.persistenceAdapter.exportDatabase?this.persistenceAdapter.exportDatabase(this.filename,this.copy({removeNonSerializable:!0}),(function(t){n.autosaveClearFlags(),r(t)})):(this.autosaveClearFlags(),this.persistenceAdapter.saveDatabase(this.filename,this.serialize(),(function(t){r(t)}))):r(new Error("persistenceAdapter not configured"))},S.prototype.saveDatabase=function(t){if(this.throttledSaves)if(this.throttledSavePending)this.throttledCallbacks.push(t);else{var e=this.throttledCallbacks;this.throttledCallbacks=[],e.unshift(t),this.throttledSavePending=!0;var r=this;this.saveDatabaseInternal((function(t){r.throttledSavePending=!1,e.forEach((function(e){"function"==typeof e&&setTimeout((function(){e(t)}),1)})),r.throttledCallbacks.length>0&&r.saveDatabase()}))}else this.saveDatabaseInternal(t)},S.prototype.save=S.prototype.saveDatabase,S.prototype.deleteDatabase=function(t,e){var r=e||function(t,e){if(t)throw t};"function"!=typeof t||e||(r=t),null!==this.persistenceAdapter?this.persistenceAdapter.deleteDatabase(this.filename,(function(t){r(t)})):r(new Error("persistenceAdapter not configured"))},S.prototype.autosaveDirty=function(){for(var t=0;t<this.collections.length;t++)if(this.collections[t].dirty)return!0;return!1},S.prototype.autosaveClearFlags=function(){for(var t=0;t<this.collections.length;t++)this.collections[t].dirty=!1},S.prototype.autosaveEnable=function(t,e){this.autosave=!0;var r=5e3,n=this;void 0!==this.autosaveInterval&&null!==this.autosaveInterval&&(r=this.autosaveInterval),this.autosaveHandle=setInterval((function(){n.autosaveDirty()&&!n.ignoreAutosave&&n.saveDatabase(e)}),r)},S.prototype.autosaveDisable=function(){void 0!==this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},k.prototype.reset=function(){return this.filteredrows.length>0&&(this.filteredrows=[]),this.filterInitialized=!1,this},k.prototype.toJSON=function(){var t=this.copy();return t.collection=null,t},k.prototype.limit=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new k(this.collection);return e.filteredrows=this.filteredrows.slice(0,t),e.filterInitialized=!0,e},k.prototype.offset=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e=new k(this.collection);return e.filteredrows=this.filteredrows.slice(t),e.filterInitialized=!0,e},k.prototype.copy=function(){var t=new k(this.collection);return this.filteredrows.length>0&&(t.filteredrows=this.filteredrows.slice()),t.filterInitialized=this.filterInitialized,t},k.prototype.branch=k.prototype.copy,k.prototype.transform=function(t,e){var r,n,i=this;if("string"==typeof t&&this.collection.transforms.hasOwnProperty(t)&&(t=this.collection.transforms[t]),"object"!=typeof t||!Array.isArray(t))throw new Error("Invalid transform");for(void 0!==e&&(t=o.resolveTransformParams(t,e)),r=0;r<t.length;r++)switch((n=t[r]).type){case"find":i.find(n.value);break;case"where":i.where(n.value);break;case"simplesort":i.simplesort(n.property,n.desc||n.options);break;case"compoundsort":i.compoundsort(n.value);break;case"sort":i.sort(n.value);break;case"limit":i=i.limit(n.value);break;case"offset":i=i.offset(n.value);break;case"map":i=i.map(n.value,n.dataOptions);break;case"eqJoin":i=i.eqJoin(n.joinData,n.leftJoinKey,n.rightJoinKey,n.mapFun,n.dataOptions);break;case"mapReduce":i=i.mapReduce(n.mapFunction,n.reduceFunction);break;case"update":i.update(n.value);break;case"remove":i.remove()}return i},k.prototype.sort=function(t){this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var e,r,n=(e=t,r=this.collection.data,function(t,n){return e(r[t],r[n])});return this.filteredrows.sort(n),this},k.prototype.simplesort=function(t,e){var r,n=10,i=this.collection.data.length,s=this.filteredrows.length,a=this.collection.binaryIndices.hasOwnProperty(t);if(void 0!==e&&!1!==e||(e={desc:!1}),!0===e&&(e={desc:!0}),0===s){if(this.filterInitialized)return this;if(this.collection.binaryIndices.hasOwnProperty(t))return this.collection.ensureIndex(t),this.filteredrows=this.collection.binaryIndices[t].values.slice(0),e.desc&&this.filteredrows.reverse(),this;this.filteredrows=this.collection.prepareFullDocIndex()}else if(!e.disableIndexIntersect&&a&&(r=i/s,e.useJavascriptSorting&&(n=6),r<=n||e.forceIndexIntersect)){var c,u=this.filteredrows,f={};for(c=0;c<s;c++)f[u[c]]=!0;var h=this.collection.binaryIndices[t].values;return this.filteredrows=h.filter((function(t){return f[t]})),e.desc&&this.filteredrows.reverse(),this}if(e.useJavascriptSorting)return this.sort((function(e,r){return e[t]===r[t]?0:e[t]>r[t]?1:e[t]<r[t]?-1:void 0}));var p,d,y,v,m,b,g=(p=t,d=e.desc,y=this.collection.data,function(t,e){return~p.indexOf(".")?(b=p.split("."),v=o.getIn(y[t],b,!0),m=o.getIn(y[e],b,!0)):(v=y[t][p],m=y[e][p]),l(v,m,d)});return this.filteredrows.sort(g),this},k.prototype.compoundsort=function(t){if(0===t.length)throw new Error("Invalid call to compoundsort, need at least one property");var e;if(1===t.length)return e=t[0],Array.isArray(e)?this.simplesort(e[0],e[1]):this.simplesort(e,!1);for(var r=0,n=t.length;r<n;r+=1)e=t[r],Array.isArray(e)||(t[r]=[e,!1]);this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());var i,o,s=(i=t,o=this.collection.data,function(t,e){return f(i,o[t],o[e])});return this.filteredrows.sort(s),this},k.prototype.findOr=function(t){for(var e=null,r=0,n=0,i=[],o=[],s=0,a=(this.count(),0),c=t.length;a<c;a++)for(n=(e=this.branch().find(t[a]).filteredrows).length,r=0;r<n;r++)void 0===o[s=e[r]]&&(o[s]=!0,i.push(s));return this.filteredrows=i,this.filterInitialized=!0,this},k.prototype.$or=k.prototype.findOr,k.prototype.findAnd=function(t){for(var e=0,r=t.length;e<r;e++){if(0===this.count())return this;this.find(t[e])}return this},k.prototype.$and=k.prototype.findAnd,k.prototype.find=function(e,r){if(0===this.collection.data.length)return this.filteredrows=[],this.filterInitialized=!0,this;var n,i,s,a,c,u,l,f=e||"getAll",p=!1,d=[],m=[],b=null;if(r=r||!1,"object"==typeof f){for(n in f)(a={})[n]=f[n],m.push(a),t.call(f,n)&&(i=n,s=f[n]);if(m.length>1)return this.find({$and:m},r)}if(!i||"getAll"===f)return r&&(this.filterInitialized?this.filteredrows=this.filteredrows.slice(0,1):(this.filteredrows=this.collection.data.length>0?[0]:[],this.filterInitialized=!0)),this;if("$and"===i||"$or"===i)return this[i](s),r&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this;if(null===s||"object"!=typeof s||s instanceof Date)c="$eq",u=s;else{if("object"!=typeof s)throw new Error("Do not know what you want to do.");for(l in s)if(t.call(s,l)){c=l,u=s[l];break}}"$regex"!==c&&"object"!=typeof u||(u=A(c,u));var g=-1!==i.indexOf(".");!this.filterInitialized&&this.collection.binaryIndices[i]&&v[c]&&(!0!==this.collection.adaptiveBinaryIndices&&this.collection.ensureIndex(i),p=!0,b=this.collection.binaryIndices[i]),!p&&"$in"===c&&Array.isArray(u)&&"undefined"!=typeof Set&&(u=new Set(u),c="$inSet");var w,S,I=y[c],P=this.collection.data,O=0,x=0,k=0;if(this.filterInitialized){if(x=(w=this.filteredrows).length,g){for(i=i.split("."),O=0;O<x;O++)if(h(S=P[k=w[O]],i,I,u,S)&&(d.push(k),r))return this.filteredrows=d,this}else for(O=0;O<x;O++)if(I((S=P[k=w[O]])[i],u,S)&&(d.push(k),r))return this.filteredrows=d,this}else if(p){var j=this.collection.calculateRange(c,i,u);if("$in"!==c){for(O=j[0];O<=j[1];O++)if(!0!==v[c]){if(v[c](o.getIn(P[b.values[O]],i,g),u)&&(d.push(b.values[O]),r))return this.filteredrows=d,this.filterInitialized=!0,this}else if(d.push(b.values[O]),r)return this.filteredrows=d,this.filterInitialized=!0,this}else for(O=0,x=j.length;O<x;O++)if(d.push(b.values[j[O]]),r)return this.filteredrows=d,this.filterInitialized=!0,this}else if(x=P.length,g){for(i=i.split("."),O=0;O<x;O++)if(h(S=P[O],i,I,u,S)&&(d.push(O),r))return this.filteredrows=d,this.filterInitialized=!0,this}else for(O=0;O<x;O++)if(I((S=P[O])[i],u,S)&&(d.push(O),r))return this.filteredrows=d,this.filterInitialized=!0,this;return this.filteredrows=d,this.filterInitialized=!0,this},k.prototype.where=function(t){var e,r=[];if("function"!=typeof t)throw new TypeError("Argument is not a stored view or a function");e=t;try{if(this.filterInitialized){for(var n=this.filteredrows.length;n--;)!0===e(this.collection.data[this.filteredrows[n]])&&r.push(this.filteredrows[n]);return this.filteredrows=r,this}for(var i=this.collection.data.length;i--;)!0===e(this.collection.data[i])&&r.push(i);return this.filteredrows=r,this.filterInitialized=!0,this}catch(t){throw t}},k.prototype.count=function(){return this.filterInitialized?this.filteredrows.length:this.collection.count()},k.prototype.data=function(t){var e,r,n,i,o=[],s=this.collection.data;if((t=t||{}).removeMeta&&!t.forceClones&&(t.forceClones=!0,t.forceCloneMethod=t.forceCloneMethod||"shallow"),!this.collection.disableDeltaChangesApi&&this.collection.disableFreeze&&(t.forceClones=!0,t.forceCloneMethod="parse-stringify"),!this.filterInitialized){if(0===this.filteredrows.length){if(this.collection.cloneObjects||t.forceClones){for(r=s.length,i=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)e=m(s[n],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);return o}return s.slice()}this.filterInitialized=!0}var a=this.filteredrows;if(r=a.length,this.collection.cloneObjects||t.forceClones)for(i=t.forceCloneMethod||this.collection.cloneMethod,n=0;n<r;n++)e=m(s[a[n]],i),t.removeMeta&&(delete e.$loki,delete e.meta),o.push(e);else for(n=0;n<r;n++)o.push(s[a[n]]);return o},k.prototype.update=function(t){if("function"!=typeof t)throw new TypeError("Argument is not a function");this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex());for(var e,r=this.filteredrows.length,n=this.collection.data,i=0;i<r;i++)this.disableFreeze&&!this.collection.cloneObjects&&this.collection.disableDeltaChangesApi?(t(n[this.filteredrows[i]]),this.collection.update(n[this.filteredrows[i]])):(t(e=m(n[this.filteredrows[i]],this.collection.cloneMethod)),this.collection.update(e));return this},k.prototype.remove=function(){return this.filterInitialized||0!==this.filteredrows.length||(this.filteredrows=this.collection.prepareFullDocIndex()),this.collection.removeBatchByPositions(this.filteredrows),this.filteredrows=[],this},k.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},k.prototype.eqJoin=function(t,e,r,n,i){var o,s,a,c=[],u=[],l=[],f="function"==typeof e,h="function"==typeof r,p={};if(o=(c=this.data(i)).length,t instanceof E)u=t.chain().data(i);else if(t instanceof k)u=t.data(i);else{if(!Array.isArray(t))throw new TypeError("joinData needs to be an array or result set");u=t}s=u.length;for(var d=0;d<s;d++)p[a=h?r(u[d]):u[d][r]]=u[d];n||(n=function(t,e){return{left:t,right:e}});for(var y=0;y<o;y++)a=f?e(c[y]):c[y][e],l.push(n(c[y],p[a]||{}));return this.collection=new E("joinData"),this.collection.insert(l),this.filteredrows=[],this.filterInitialized=!1,this},k.prototype.map=function(t,e){var r=this.data(e).map(t);return this.collection=new E("mappedData"),this.collection.insert(r),this.filteredrows=[],this.filterInitialized=!1,this},j.prototype=new w,j.prototype.constructor=j,j.prototype.getSort=function(){return this.sortFunction||this.sortCriteria||this.sortCriteriaSimple},j.prototype.rematerialize=function(t){var e,r,n;t=t||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new k(this.collection),(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple)&&(this.sortDirty=!0);var i=Object.isFrozen(this.filterPipeline);if(t.hasOwnProperty("removeWhereFilters"))for(i&&(this.filterPipeline=this.filterPipeline.slice()),r=e=this.filterPipeline.length;r--;)"where"===this.filterPipeline[r].type&&(r!==this.filterPipeline.length-1&&(this.filterPipeline[r]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var o=this.filterPipeline;for(this.filterPipeline=[],e=o.length,n=0;n<e;n++)this.applyFind(o[n].val,o[n].uid);return i&&Object.freeze(this.filterPipeline),this.data(),this.emit("rebuild",this),this},j.prototype.branchResultset=function(t,e){var r=this.resultset.branch();return void 0===t?r:r.transform(t,e)},j.prototype.toJSON=function(){var t=new j(this.collection,this.name,this.options);return t.resultset=this.resultset,t.resultdata=[],t.resultsdirty=!0,t.filterPipeline=this.filterPipeline,t.sortFunction=this.sortFunction,t.sortCriteria=this.sortCriteria,t.sortCriteriaSimple=this.sortCriteriaSimple||null,t.sortDirty=this.sortDirty,t.collection=null,t},j.prototype.removeFilters=function(t){t=t||{},this.rebuildPending=!1,this.resultset.reset(),this.resultdata=[],this.resultsdirty=!0,this.cachedresultset=null;var e=Object.isFrozen(this.filterPipeline),r=this.filterPipeline.length>0;this.filterPipeline=[],e&&Object.freeze(this.filterPipeline),this.sortFunction=null,this.sortCriteria=null,this.sortCriteriaSimple=null,this.sortDirty=!1,!0===t.queueSortPhase&&this.queueSortPhase(),r&&this.emit("filter")},j.prototype.applySort=function(t){return this.sortFunction=t,this.sortCriteria=null,this.sortCriteriaSimple=null,this.queueSortPhase(),this.emit("sort"),this},j.prototype.applySimpleSort=function(t,r){return this.sortCriteriaSimple={propname:t,options:r||!1},this.collection.disableFreeze||e(this.sortCriteriaSimple),this.sortCriteria=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},j.prototype.applySortCriteria=function(t){return this.sortCriteria=t,this.collection.disableFreeze||e(this.sortCriteria),this.sortCriteriaSimple=null,this.sortFunction=null,this.queueSortPhase(),this.emit("sort"),this},j.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},j.prototype.commit=function(){return this.cachedresultset=null,this},j.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},j.prototype._indexOfFilterWithId=function(t){if("string"==typeof t||"number"==typeof t)for(var e=0,r=this.filterPipeline.length;e<r;e+=1)if(t===this.filterPipeline[e].uid)return e;return-1},j.prototype._addFilter=function(t){var r=Object.isFrozen(this.filterPipeline);r&&(this.filterPipeline=this.filterPipeline.slice()),this.collection.disableFreeze||e(t),this.filterPipeline.push(t),r&&Object.freeze(this.filterPipeline),this.resultset[t.type](t.val)},j.prototype.reapplyFilters=function(){this.resultset.reset(),this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0);var t=this.filterPipeline,e=Object.isFrozen(t);this.filterPipeline=[];for(var r=0,n=t.length;r<n;r+=1)this._addFilter(t[r]);return e&&Object.freeze(this.filterPipeline),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},j.prototype.applyFilter=function(t){var e=this._indexOfFilterWithId(t.uid);if(e>=0){var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline[e]=t,r&&(n(t),Object.freeze(this.filterPipeline)),this.reapplyFilters()}return this.cachedresultset=null,this.options.persistent&&(this.resultdata=[],this.resultsdirty=!0),this._addFilter(t),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent(),this.emit("filter"),this},j.prototype.applyFind=function(t,e){return this.applyFilter({type:"find",val:t,uid:e}),this},j.prototype.applyWhere=function(t,e){return this.applyFilter({type:"where",val:t,uid:e}),this},j.prototype.removeFilter=function(t){var e=this._indexOfFilterWithId(t);if(e<0)throw new Error("Dynamic view does not contain a filter with ID: "+t);var r=Object.isFrozen(this.filterPipeline);return r&&(this.filterPipeline=this.filterPipeline.slice()),this.filterPipeline.splice(e,1),r&&Object.freeze(this.filterPipeline),this.reapplyFilters(),this},j.prototype.count=function(){return this.resultsdirty&&(this.resultdata=this.resultset.data()),this.resultset.count()},j.prototype.data=function(t){return(this.sortDirty||this.resultsdirty)&&this.performSortPhase({suppressRebuildEvent:!0}),this.options.persistent?this.resultdata:this.resultset.data(t)},j.prototype.queueRebuildEvent=function(){if(!this.rebuildPending){this.rebuildPending=!0;var t=this;setTimeout((function(){t.rebuildPending&&(t.rebuildPending=!1,t.emit("rebuild",t))}),this.options.minRebuildInterval)}},j.prototype.queueSortPhase=function(){if(!this.sortDirty){this.sortDirty=!0;var t=this;"active"===this.options.sortPriority?setTimeout((function(){t.performSortPhase()}),this.options.minRebuildInterval):this.queueRebuildEvent()}},j.prototype.performSortPhase=function(t){(this.sortDirty||this.resultsdirty)&&(t=t||{},this.sortDirty&&(this.sortFunction?this.resultset.sort(this.sortFunction):this.sortCriteria?this.resultset.compoundsort(this.sortCriteria):this.sortCriteriaSimple&&this.resultset.simplesort(this.sortCriteriaSimple.propname,this.sortCriteriaSimple.options),this.sortDirty=!1),this.options.persistent&&(this.resultdata=this.resultset.data(),this.resultsdirty=!1),t.suppressRebuildEvent||this.emit("rebuild",this))},j.prototype.evaluateDocument=function(t,e){if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var r,n=this.resultset.filteredrows,i=e?-1:n.indexOf(+t),o=n.length,s=new k(this.collection);s.filteredrows=[t],s.filterInitialized=!0;for(var a=0,c=this.filterPipeline.length;a<c;a++)s[(r=this.filterPipeline[a]).type](r.val);var u=0===s.filteredrows.length?-1:0;return-1!==i||-1!==u?-1===i&&-1!==u?(n.push(t),this.options.persistent&&this.resultdata.push(this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1===u?(i<o-1?(n.splice(i,1),this.options.persistent&&this.resultdata.splice(i,1)):(n.length=o-1,this.options.persistent&&(this.resultdata.length=o-1)),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):-1!==i&&-1!==u?(this.options.persistent&&(this.resultdata[i]=this.collection.data[t]),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},j.prototype.removeDocument=function(t){var e,r,n,i={},o={},s=[],a=this.resultset,c=this.resultset.filteredrows,u=c.length;if(!this.resultset.filterInitialized)return this.options.persistent&&(this.resultdata=this.resultset.data()),void(this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());for(Array.isArray(t)||(t=[t]),n=t.length,r=0;r<n;r++)i[t[r]]=!0;for(e=0;e<u;e++)i[c[e]]&&(o[e]=!0);Object.keys(o).length>0&&(this.resultset.filteredrows=this.resultset.filteredrows.filter((function(t,e){return!o[e]})),this.options.persistent&&(this.resultdata=this.resultdata.filter((function(t,e){return!o[e]}))),this.sortFunction||this.sortCriteria||this.sortCriteriaSimple?this.queueSortPhase():this.queueRebuildEvent());var l=function(t){return function(e){return e<a.filteredrows[t]}};for(u=a.filteredrows.length,e=0;e<u;e++)s=t.filter(l(e)),a.filteredrows[e]-=s.length},j.prototype.mapReduce=function(t,e){try{return e(this.data().map(t))}catch(t){throw t}},E.prototype=new w,E.prototype.contructor=E,E.prototype.createChange=function(t,e,r,n){this.changes.push({name:t,operation:e,obj:"U"!=e||this.disableDeltaChangesApi?JSON.parse(JSON.stringify(r)):this.getChangeDelta(r,n)})},E.prototype.insertMeta=function(t){var e,r;if(!this.disableMeta&&t)if(Array.isArray(t))for(e=t.length,r=0;r<e;r++)t[r].hasOwnProperty("meta")||(t[r].meta={}),t[r].meta.created=(new Date).getTime(),t[r].meta.revision=0;else t.meta||(t.meta={}),t.meta.created=(new Date).getTime(),t.meta.revision=0},E.prototype.updateMeta=function(t){return this.disableMeta||!t||(this.disableFreeze||((t=i(t)).meta=i(t.meta)),t.meta.updated=(new Date).getTime(),t.meta.revision+=1),t},E.prototype.createInsertChange=function(t){this.createChange(this.name,"I",t)},E.prototype.createUpdateChange=function(t,e){this.createChange(this.name,"U",t,e)},E.prototype.insertMetaWithChange=function(t){this.insertMeta(t),this.createInsertChange(t)},E.prototype.updateMetaWithChange=function(t,e,r){return t=this.updateMeta(t,r),this.createUpdateChange(t,e),t},E.prototype.lokiConsoleWrapper={log:function(){},warn:function(){},error:function(){}},E.prototype.addAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.observe(t,this.observerCallback,["add","update","delete","reconfigure","setPrototype"])},E.prototype.removeAutoUpdateObserver=function(t){this.autoupdate&&"function"==typeof Object.observe&&Object.unobserve(t,this.observerCallback)},E.prototype.addTransform=function(t,e){if(this.transforms.hasOwnProperty(t))throw new Error("a transform by that name already exists");this.transforms[t]=e},E.prototype.getTransform=function(t){return this.transforms[t]},E.prototype.setTransform=function(t,e){this.transforms[t]=e},E.prototype.removeTransform=function(t){delete this.transforms[t]},E.prototype.byExample=function(t){var e,r,n;for(e in n=[],t)t.hasOwnProperty(e)&&n.push(((r={})[e]=t[e],r));return{$and:n}},E.prototype.findObject=function(t){return this.findOne(this.byExample(t))},E.prototype.findObjects=function(t){return this.find(this.byExample(t))},E.prototype.ttlDaemonFuncGen=function(){var t=this,e=this.ttl.age;return function(){var r=Date.now();t.chain().where((function(t){var n=t.meta.updated||t.meta.created;return e<r-n})).remove()}},E.prototype.setTTL=function(t,e){t<0?clearInterval(this.ttl.daemon):(this.ttl.age=t,this.ttl.ttlInterval=e,this.ttl.daemon=setInterval(this.ttlDaemonFuncGen(),e))},E.prototype.prepareFullDocIndex=function(){for(var t=this.data.length,e=new Array(t),r=0;r<t;r+=1)e[r]=r;return e},E.prototype.configureOptions=function(t){(t=t||{}).hasOwnProperty("adaptiveBinaryIndices")&&(this.adaptiveBinaryIndices=t.adaptiveBinaryIndices,this.adaptiveBinaryIndices&&this.ensureAllIndexes())},E.prototype.ensureIndex=function(t,e){if(void 0===e&&(e=!1),null==t)throw new Error("Attempting to set index without an associated property");if((!this.binaryIndices[t]||e||this.binaryIndices[t].dirty)&&(!0!==this.adaptiveBinaryIndices||!this.binaryIndices.hasOwnProperty(t)||e)){var r={name:t,dirty:!0,values:this.prepareFullDocIndex()};this.binaryIndices[t]=r;var n,i,a,c,u,l=(n=t,i=this.data,u=!!~n.indexOf(".")&&n.split("."),function(t,e){if(u?(a=o.getIn(i[t],u,!0),c=o.getIn(i[e],u,!0)):(a=i[t][n],c=i[e][n]),a!==c){if(s.lt(a,c,!1))return-1;if(s.gt(a,c,!1))return 1}return 0});r.values.sort(l),r.dirty=!1,this.dirty=!0}},E.prototype.checkAllIndexes=function(e){var r,n=this.binaryIndices,i=[];for(r in n)t.call(n,r)&&(this.checkIndex(r,e)||i.push(r));return i},E.prototype.checkIndex=function(t,e){(e=e||{}).randomSamplingFactor&&!1!==e.randomSampling&&(e.randomSampling=!0),e.randomSamplingFactor=e.randomSamplingFactor||.1,(e.randomSamplingFactor<0||e.randomSamplingFactor>1)&&(e.randomSamplingFactor=.1);var r,n,i,s,a,c=!0;if(!this.binaryIndices.hasOwnProperty(t))throw new Error("called checkIndex on property without an index: "+t);if(this.adaptiveBinaryIndices||this.ensureIndex(t),(s=(a=this.binaryIndices[t].values).length)!==this.data.length)return e.repair&&this.ensureIndex(t,!0),!1;if(0===s)return!0;var u=-1!==t.indexOf(".");if(1===s)c=0===a[0];else if(e.randomSampling){if(y.$lte(o.getIn(this.data[a[0]],t,u),o.getIn(this.data[a[1]],t,u))||(c=!1),y.$lte(o.getIn(this.data[a[s-2]],t,u),o.getIn(this.data[a[s-1]],t,u))||(c=!1),c)for(n=Math.floor((s-1)*e.randomSamplingFactor),r=0;r<n-1;r++)if(i=Math.floor(Math.random()*(s-1)),!y.$lte(o.getIn(this.data[a[i]],t,u),o.getIn(this.data[a[i+1]],t,u))){c=!1;break}}else for(r=0;r<s-1;r++)if(!y.$lte(o.getIn(this.data[a[r]],t,u),o.getIn(this.data[a[r+1]],t,u))){c=!1;break}return!c&&e.repair&&this.ensureIndex(t,!0),c},E.prototype.getBinaryIndexValues=function(t){var e,r=this.binaryIndices[t].values,n=[];for(e=0;e<r.length;e++)n.push(o.getIn(this.data[r[e]],t,!0));return n},E.prototype.getUniqueIndex=function(t,e){var r=this.constraints.unique[t];return!r&&e?this.ensureUniqueIndex(t):r},E.prototype.ensureUniqueIndex=function(t){var e=this.constraints.unique[t];return e||-1==this.uniqueNames.indexOf(t)&&this.uniqueNames.push(t),this.constraints.unique[t]=e=new R(t),this.data.forEach((function(t){e.set(t)})),e},E.prototype.ensureAllIndexes=function(e){var r,n=this.binaryIndices;for(r in n)t.call(n,r)&&this.ensureIndex(r,e)},E.prototype.flagBinaryIndexesDirty=function(){var e,r=this.binaryIndices;for(e in r)t.call(r,e)&&(r[e].dirty=!0)},E.prototype.flagBinaryIndexDirty=function(t){this.binaryIndices[t]&&(this.binaryIndices[t].dirty=!0)},E.prototype.count=function(t){return t?this.chain().find(t).filteredrows.length:this.data.length},E.prototype.ensureId=function(){if(!this.idIndex){for(var t=this.data,e=0,r=t.length,n=new Array(r);e<r;e++)n[e]=t[e].$loki;this.idIndex=n}},E.prototype.ensureIdAsync=function(t){this.async((function(){this.ensureId()}),t)},E.prototype.addDynamicView=function(t,e){var r=new j(this,t,e);return this.DynamicViews.push(r),r},E.prototype.removeDynamicView=function(t){this.DynamicViews=this.DynamicViews.filter((function(e){return e.name!==t}))},E.prototype.getDynamicView=function(t){for(var e=0;e<this.DynamicViews.length;e++)if(this.DynamicViews[e].name===t)return this.DynamicViews[e];return null},E.prototype.findAndUpdate=function(t,e){"function"==typeof t?this.updateWhere(t,e):this.chain().find(t).update(e)},E.prototype.findAndRemove=function(t){this.chain().find(t).remove()},E.prototype.insert=function(t,e){if(!Array.isArray(t))return this.insertOne(t);var r,n=[],i=e&&!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0;i&&(this.adaptiveBinaryIndices=!1);try{this.emit("pre-insert",t);for(var o=0,s=t.length;o<s;o++){if(!(r=this.insertOne(t[o],!0)))return;n.push(r)}}finally{i&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}return this.emit("insert",n),1===(n=this.cloneObjects?m(n,this.cloneMethod):n).length?n[0]:n},E.prototype.insertOne=function(t,r){var n,o=null;if("object"!=typeof t?o=new TypeError("Document needs to be an object"):null===t&&(o=new TypeError("Object cannot be null")),null!==o)throw this.emit("error",o),o;var s=this.cloneObjects?m(t,this.cloneMethod):t;if(this.disableFreeze||(s=i(s)),this.disableMeta||(void 0===s.meta?s.meta={revision:0,created:0}:this.disableFreeze||(s.meta=i(s.meta))),r||this.emit("pre-insert",s),this.add(s))return this.disableChangesApi?this.insertMeta(s):this.insertMetaWithChange(s),this.disableFreeze||e(s),n=this.cloneObjects?m(s,this.cloneMethod):s,r||this.emit("insert",n),this.addAutoUpdateObserver(n),n},E.prototype.clear=function(t){var e=this;t=t||{},this.data=[],this.idIndex=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0,this.constraints={unique:{},exact:{}},!0===t.removeIndices?(this.binaryIndices={},this.uniqueNames=[]):Object.keys(this.binaryIndices).forEach((function(t){e.binaryIndices[t].dirty=!1,e.binaryIndices[t].values=[]}))},E.prototype.update=function(r){var n,i,o;if(Array.isArray(r)){o=r.length,(n=!this.cloneObjects&&this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0)&&(this.adaptiveBinaryIndices=!1);try{for(i=0;i<o;i+=1)this.update(r[i])}finally{n&&(this.ensureAllIndexes(),this.adaptiveBinaryIndices=!0)}}else{if(!t.call(r,"$loki"))throw new Error("Trying to update unsynced document. Please save the document first by using insert() or addMany()");try{this.startTransaction();var s,a,c,u,l,f=this.get(r.$loki,!0),h=this;if(!f)throw new Error("Trying to update a document not in collection.");s=f[0],c=f[1],a=this.cloneObjects||!this.disableDeltaChangesApi&&this.disableFreeze?m(r,this.cloneMethod):r,this.emit("pre-update",r),this.uniqueNames.forEach((function(t){h.getUniqueIndex(t,!0).update(s,a)})),this.data[c]=a,a!==r&&this.addAutoUpdateObserver(r);for(var p=0;p<this.DynamicViews.length;p++)this.DynamicViews[p].evaluateDocument(c,!1);if(this.adaptiveBinaryIndices){var d=this.binaryIndices;for(u in d)this.adaptiveBinaryIndexUpdate(c,u)}else this.flagBinaryIndexesDirty();return this.idIndex[c]=a.$loki,this.isIncremental&&this.dirtyIds.push(a.$loki),this.commit(),this.dirty=!0,a=this.disableChangesApi?this.updateMeta(a):this.updateMetaWithChange(a,s),this.disableFreeze||e(a),l=this.cloneObjects?m(a,this.cloneMethod):a,this.emit("update",l,s),l}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}}},E.prototype.add=function(t){if("object"!=typeof t)throw new TypeError("Object being added needs to be an object");if(void 0!==t.$loki)throw new Error("Document is already in collection, please use update()");try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1);var e=this.maxId;t.$loki=e,this.disableMeta||(t.meta.version=0);for(var r=0,n=this.uniqueNames.length;r<n;r++)this.getUniqueIndex(this.uniqueNames[r],!0).set(t);this.idIndex&&this.idIndex.push(e),this.isIncremental&&this.dirtyIds.push(e),this.data.push(t);var i=this.data.length-1,o=this.DynamicViews.length;for(r=0;r<o;r++)this.DynamicViews[r].evaluateDocument(i,!0);if(this.adaptiveBinaryIndices){var s=this.binaryIndices;for(var a in s)this.adaptiveBinaryIndexInsert(i,a)}else this.flagBinaryIndexesDirty();return this.commit(),this.dirty=!0,this.cloneObjects?m(t,this.cloneMethod):t}catch(t){throw this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),t}},E.prototype.updateWhere=function(t,e){var r,n=this.where(t),i=0;try{for(;i<n.length;i++)r=e(n[i]),this.update(r)}catch(t){this.rollback(),this.lokiConsoleWrapper.error(t.message)}},E.prototype.removeWhere=function(t){var e;"function"==typeof t?(e=this.data.filter(t),this.remove(e)):this.chain().find(t).remove()},E.prototype.removeDataOnly=function(){this.remove(this.data.slice())},E.prototype.removeBatchByPositions=function(t){var e,r,n,i,o=t.length,s={},a=Object.keys(this.binaryIndices).length,c=Object.keys(this.constraints.unique).length,u=this.adaptiveBinaryIndices&&Object.keys(this.binaryIndices).length>0,l=this;try{for(this.startTransaction(),this.ensureId(),n=0;n<o;n++)s[this.idIndex[t[n]]]=!0;if((e=this.DynamicViews.length)>0||a>0||c>0){if(e>0)for(r=0;r<e;r++)this.DynamicViews[r].removeDocument(t);if(this.adaptiveBinaryIndices&&!u){var f,h=this.binaryIndices;for(f in h)this.adaptiveBinaryIndexRemove(t,f)}else this.flagBinaryIndexesDirty();c&&this.uniqueNames.forEach((function(e){var r=l.getUniqueIndex(e);if(r)for(n=0;n<o;n++)null!==(i=l.data[t[n]])[e]&&void 0!==i[e]&&r.remove(i[e])}))}if(!this.disableChangesApi||this.events.delete.length>1)for(n=0;n<o;n++)this.emit("delete",this.data[t[n]]);if(this.data=this.data.filter((function(t){return!s[t.$loki]})),this.isIncremental)for(n=0;n<o;n++)this.dirtyIds.push(this.idIndex[t[n]]);this.idIndex=this.idIndex.filter((function(t){return!s[t]})),this.adaptiveBinaryIndices&&u&&(this.adaptiveBinaryIndices=!1,this.ensureAllIndexes(!0),this.adaptiveBinaryIndices=!0),this.commit(),this.dirty=!0}catch(t){return this.rollback(),u&&(this.adaptiveBinaryIndices=!0),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}},E.prototype.removeBatch=function(t){var e,r=t.length,n=this.data.length,i={},o=[];for(e=0;e<n;e++)i[this.data[e].$loki]=e;for(e=0;e<r;e++)"object"==typeof t[e]?o.push(i[t[e].$loki]):o.push(i[t[e]]);this.removeBatchByPositions(o)},E.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e))this.removeBatch(e);else{if(!t.call(e,"$loki"))throw new Error("Object is not a document stored in the collection");try{this.startTransaction();var r=this.get(e.$loki,!0),o=r[1],s=this;this.uniqueNames.forEach((function(t){if(null!==e[t]&&void 0!==e[t]){var r=s.getUniqueIndex(t);r&&r.remove(e[t])}}));for(var a=0;a<this.DynamicViews.length;a++)this.DynamicViews[a].removeDocument(o);if(this.adaptiveBinaryIndices){var c,u=this.binaryIndices;for(c in u)this.adaptiveBinaryIndexRemove(o,c)}else this.flagBinaryIndexesDirty();return this.data.splice(o,1),this.removeAutoUpdateObserver(e),this.idIndex.splice(o,1),this.isIncremental&&this.dirtyIds.push(e.$loki),this.commit(),this.dirty=!0,this.emit("delete",r[0]),this.disableFreeze||(e=i(e)),delete e.$loki,delete e.meta,this.disableFreeze||n(e),e}catch(t){return this.rollback(),this.lokiConsoleWrapper.error(t.message),this.emit("error",t),null}}},E.prototype.get=function(t,e){this.idIndex||this.ensureId();var r=e||!1,n=this.idIndex,i=n.length-1,o=0,s=o+i>>1;if(t="number"==typeof t?t:parseInt(t,10),isNaN(t))throw new TypeError("Passed id is not an integer");for(;n[o]<n[i];)n[s=o+i>>1]<t?o=s+1:i=s;return i===o&&n[o]===t?r?[this.data[o],o]:this.data[o]:null},E.prototype.getBinaryIndexPosition=function(t,e){var r=o.getIn(this.data[t],e,!0),n=this.binaryIndices[e].values,i=this.calculateRange("$eq",e,r);if(0===i[0]&&-1===i[1])return null;for(var s=i[0],a=i[1],c=s;c<=a;c++)if(n[c]===t)return c;return null},E.prototype.adaptiveBinaryIndexInsert=function(t,e){var r=-1!==e.indexOf("."),n=this.binaryIndices[e].values,i=o.getIn(this.data[t],e,r);!0===this.serializableIndices&&i instanceof Date&&(this.data[t][e]=i.getTime(),i=o.getIn(this.data[t],e));var s=0===n.length?0:this.calculateRangeStart(e,i,!0,r);this.binaryIndices[e].values.splice(s,0,t)},E.prototype.adaptiveBinaryIndexUpdate=function(t,e){var r,n=this.binaryIndices[e].values,i=n.length;for(r=0;r<i&&n[r]!==t;r++);this.binaryIndices[e].values.splice(r,1),this.adaptiveBinaryIndexInsert(t,e)},E.prototype.adaptiveBinaryIndexRemove=function(t,e,r){var n,i,o,s,a,c,u,l=this.binaryIndices[e],f={};if(Array.isArray(t)){if(1!==(s=t.length)){for(o=0;o<s;o++)f[t[o]]=!0;if(l.values=l.values.filter((function(t){return!f[t]})),!0===r)return;var h=t.slice();for(h.sort((function(t,e){return t-e})),n=l.values.length,i=0;i<n;i++){for(a=l.values[i],c=0,o=0;o<s&&a>h[o];o++)c++;l.values[i]-=c}return}t=t[0]}if(null===(u=this.getBinaryIndexPosition(t,e)))return null;if(l.values.splice(u,1),!0!==r)for(n=l.values.length,i=0;i<n;i++)l.values[i]>t&&l.values[i]--},E.prototype.calculateRangeStart=function(t,e,r,n){var i=this.data,a=this.binaryIndices[t].values,c=0,u=a.length-1,l=0;if(0===a.length)return-1;for(o.getIn(i[a[c]],t,n),o.getIn(i[a[u]],t,n);c<u;)l=c+u>>1,s.lt(o.getIn(i[a[l]],t,n),e,!1)?c=l+1:u=l;var f=c;return s.aeq(e,o.getIn(i[a[f]],t,n))?f:s.lt(e,o.getIn(i[a[f]],t,n),!1)?r?f:f-1:r?f+1:f},E.prototype.calculateRangeEnd=function(t,e,r){var n=this.data,i=this.binaryIndices[t].values,a=0,c=i.length-1,u=0;if(0===i.length)return-1;for(o.getIn(n[i[a]],t,r),o.getIn(n[i[c]],t,r);a<c;)u=a+c>>1,s.lt(e,o.getIn(n[i[u]],t,r),!1)?c=u:a=u+1;var l=c;return s.aeq(e,o.getIn(n[i[l]],t,r))?l:s.gt(e,o.getIn(n[i[l]],t,r),!1)?l+1:s.aeq(e,o.getIn(n[i[l-1]],t,r))?l-1:l},E.prototype.calculateRange=function(t,e,r){var n,i,a,c=this.data,u=this.binaryIndices[e].values,l=0,f=u.length-1;if(0===c.length)return[0,-1];var h=-1!==e.indexOf("."),p=o.getIn(c[u[l]],e,h),d=o.getIn(c[u[f]],e,h);switch(t){case"$eq":case"$aeq":case"$dteq":if(s.lt(r,p,!1)||s.gt(r,d,!1))return[0,-1];break;case"$gt":if(s.gt(r,d,!0))return[0,-1];if(s.gt(p,r,!1))return[l,f];break;case"$gte":if(s.gt(r,d,!1))return[0,-1];if(s.gt(p,r,!0))return[l,f];break;case"$lt":if(s.lt(r,p,!0))return[0,-1];if(s.lt(d,r,!1))return[l,f];break;case"$lte":if(s.lt(r,p,!1))return[0,-1];if(s.lt(d,r,!0))return[l,f];break;case"$between":return s.gt(r[0],d,!1)||s.lt(r[1],p,!1)?[0,-1]:((n=this.calculateRangeStart(e,r[0],!1,h))<0&&n++,(a=this.calculateRangeEnd(e,r[1],h))>f&&a--,s.gt(o.getIn(c[u[n]],e,h),r[0],!0)||n++,s.lt(o.getIn(c[u[a]],e,h),r[1],!0)||a--,a<n?[0,-1]:[n,a]);case"$in":for(var y=[],v=[],m=0,b=r.length;m<b;m++)for(var g=this.calculateRange("$eq",e,r[m]),w=g[0];w<=g[1];w++)void 0===y[w]&&(y[w]=!0,v.push(w));return v}switch(t){case"$eq":case"$aeq":case"$dteq":case"$gte":case"$lt":n=this.calculateRangeStart(e,r,!1,h),i=o.getIn(c[u[n]],e,h)}switch(t){case"$eq":case"$aeq":case"$dteq":case"$lte":case"$gt":a=this.calculateRangeEnd(e,r,h),o.getIn(c[u[a]],e,h)}switch(t){case"$eq":case"$aeq":case"$dteq":return s.aeq(i,r)?[n,a]:[0,-1];case"$gt":return s.aeq(o.getIn(c[u[a]],e,h),r)?[a+1,f]:[a,f];case"$gte":return s.aeq(o.getIn(c[u[n]],e,h),r)?[n,f]:[n+1,f];case"$lt":return s.aeq(o.getIn(c[u[n]],e,h),r)?[l,n-1]:[l,n];case"$lte":return s.aeq(o.getIn(c[u[a]],e,h),r)?[l,a]:[l,a-1];default:return[0,c.length-1]}},E.prototype.by=function(t,e){var r;if(void 0===e)return r=this,function(e){return r.by(t,e)};var n=this.getUniqueIndex(t,!0).get(e);return this.cloneObjects?m(n,this.cloneMethod):n},E.prototype.findOne=function(t){t=t||{};var e=this.chain().find(t,!0).data();return Array.isArray(e)&&0===e.length?null:this.cloneObjects?m(e[0],this.cloneMethod):e[0]},E.prototype.chain=function(t,e){var r=new k(this);return void 0===t?r:r.transform(t,e)},E.prototype.find=function(t){return this.chain().find(t).data()},E.prototype.findOneUnindexed=function(t,e){for(var r=this.data.length;r--;)if(o.getIn(this.data[r],t,!0)===e)return this.data[r];return null},E.prototype.startTransaction=function(){if(this.transactional){this.cachedData=m(this.data,this.cloneMethod),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices,this.cachedDirtyIds=this.dirtyIds;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].startTransaction()}},E.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedDirtyIds=null;for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].commit()}},E.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex,this.dirtyIds=this.cachedDirtyIds);for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].rollback()}},E.prototype.async=function(t,e){setTimeout((function(){if("function"!=typeof t)throw new TypeError("Argument passed for async execution is not a function");t(),e()}),0)},E.prototype.where=function(t){return this.chain().where(t).data()},E.prototype.mapReduce=function(t,e){try{return e(this.data.map(t))}catch(t){throw t}},E.prototype.eqJoin=function(t,e,r,n,i){return new k(this).eqJoin(t,e,r,n,i)},E.prototype.stages={},E.prototype.getStage=function(t){return this.stages[t]||(this.stages[t]={}),this.stages[t]},E.prototype.commitLog=[],E.prototype.stage=function(t,e){var r=JSON.parse(JSON.stringify(e));return this.getStage(t)[e.$loki]=r,r},E.prototype.commitStage=function(t,e){var r,n=this.getStage(t),i=(new Date).getTime();for(r in n)this.update(n[r]),this.commitLog.push({timestamp:i,message:e,data:JSON.parse(JSON.stringify(n[r]))});this.stages[t]={}},E.prototype.no_op=function(){},E.prototype.extract=function(t){for(var e=0,r=this.data.length,n=D(t),i=[];e<r;e+=1)i.push(L(this.data[e],t,n));return i},E.prototype.max=function(t){return Math.max.apply(null,this.extract(t))},E.prototype.min=function(t){return Math.min.apply(null,this.extract(t))},E.prototype.maxRecord=function(t){for(var e,r=0,n=this.data.length,i=D(t),o={index:0,value:void 0};r<n;r+=1)void 0!==e?e<L(this.data[r],t,i)&&(e=L(this.data[r],t,i),o.index=this.data[r].$loki):(e=L(this.data[r],t,i),o.index=this.data[r].$loki);return o.value=e,o},E.prototype.minRecord=function(t){for(var e,r=0,n=this.data.length,i=D(t),o={index:0,value:void 0};r<n;r+=1)void 0!==e?e>L(this.data[r],t,i)&&(e=L(this.data[r],t,i),o.index=this.data[r].$loki):(e=L(this.data[r],t,i),o.index=this.data[r].$loki);return o.value=e,o},E.prototype.extractNumerical=function(t){return this.extract(t).map(_).filter(Number).filter((function(t){return!isNaN(t)}))},E.prototype.avg=function(t){return T(this.extractNumerical(t))},E.prototype.stdDev=function(t){return N(this.extractNumerical(t))},E.prototype.mode=function(t){var e,r,n,i={},o=this.extract(t);for(r in o.forEach((function(t){i[t]?i[t]+=1:i[t]=1})),i)e?e<i[r]&&(n=r):(n=r,e=i[r]);return n},E.prototype.median=function(t){var e=this.extractNumerical(t);e.sort(M);var r=Math.floor(e.length/2);return e.length%2?e[r]:(e[r-1]+e[r])/2},$.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},setSort:function(t){this.bs=new F(t)},bs:function(){return new F(this.sort)},set:function(t,e){var r=this.bs(this.keys,t);r.found?this.values[r.index]=e:(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,e))},get:function(t){return this.values[z(this.keys,t,this.sort).index]}},R.prototype.keyMap={},R.prototype.lokiMap={},R.prototype.set=function(t){var e=t[this.field];if(null!=e){if(this.keyMap[e])throw new Error("Duplicate key for property "+this.field+": "+e);this.keyMap[e]=t,this.lokiMap[t.$loki]=e}},R.prototype.get=function(t){return this.keyMap[t]},R.prototype.byId=function(t){return this.keyMap[this.lokiMap[t]]},R.prototype.update=function(t,e){if(this.lokiMap[t.$loki]!==e[this.field]){var r=this.lokiMap[t.$loki];this.set(e),this.keyMap[r]=void 0}else this.keyMap[t[this.field]]=e},R.prototype.remove=function(t){var e=this.keyMap[t];if(null==e)throw new Error("Key is not in unique index: "+this.field);this.keyMap[t]=void 0,this.lokiMap[e.$loki]=void 0},R.prototype.clear=function(){this.keyMap=Object.create(null),this.lokiMap=Object.create(null)},B.prototype={set:function(t,e){this.index[t]?this.index[t].push(e):this.index[t]=[e]},remove:function(t,e){var r=this.index[t];for(var n in r)r[n]==e&&r.splice(n,1);r.length<1&&(this.index[t]=void 0)},get:function(t){return this.index[t]},clear:function(t){this.index={}}},q.prototype={keys:[],values:[],sort:function(t,e){return t<e?-1:t>e?1:0},bs:function(){return new F(this.sort)},setSort:function(t){this.bs=new F(t)},set:function(t,e){var r=z(this.keys,t,this.sort);r.found?this.values[r.index].push(e):(this.keys.splice(r.index,0,t),this.values.splice(r.index,0,[e]))},get:function(t){var e=z(this.keys,t,this.sort);return e.found?this.values[e.index]:[]},getLt:function(t){var e=z(this.keys,t,this.sort),r=e.index;return e.found&&r--,this.getAll(t,0,r)},getGt:function(t){var e=z(this.keys,t,this.sort),r=e.index;return e.found&&r++,this.getAll(t,r,this.keys.length)},getAll:function(t,e,r){for(var n=[],i=e;i<r;i++)n=n.concat(this.values[i]);return n},getPos:function(t){return z(this.keys,t,this.sort)},remove:function(t,e){var r=z(this.keys,t,this.sort).index,n=this.values[r];for(var i in n)n[i]==e&&n.splice(i,1);n.length<1&&(this.keys.splice(r,1),this.values.splice(r,1))},clear:function(){this.keys=[],this.values=[]}},S.deepFreeze=e,S.freeze=n,S.unFreeze=i,S.LokiOps=y,S.Collection=E,S.DynamicView=j,S.Resultset=k,S.KeyValueStore=$,S.LokiMemoryAdapter=I,S.LokiPartitioningAdapter=P,S.LokiLocalStorageAdapter=x,S.LokiFsAdapter=O,S.persistenceAdapters={fs:O,localStorage:x},S.aeq=a,S.lt=c,S.gt=u,S.Comparators=s,S}()},void 0===(o="function"==typeof n?n.apply(e,i):n)||(t.exports=o)},1528:function(t,e){var r,n,i;!function(o,s){"use strict";"object"==typeof t.exports?t.exports=s():(n=[],void 0===(i="function"==typeof(r=s)?r.apply(e,n):r)||(t.exports=i))}(0,(function(){"use strict";var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function r(t){if(!t)return!0;if(i(t)&&0===t.length)return!0;if("string"!=typeof t){for(var r in t)if(e(t,r))return!1;return!0}return!1}function n(e){return t.call(e)}var i=Array.isArray||function(e){return"[object Array]"===t.call(e)};function o(t){var e=parseInt(t);return e.toString()===t?e:t}function s(t){var s,a,c=function(t){return Object.keys(c).reduce((function(e,r){return"create"===r||"function"==typeof c[r]&&(e[r]=c[r].bind(c,t)),e}),{})};function u(t,e){if(s(t,e))return t[e]}function l(t,e,r,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return l(t,e.split(".").map(o),r,n);var i=e[0],s=a(t,i);return 1===e.length?(void 0!==s&&n||(t[i]=r),s):(void 0===s&&("number"==typeof e[1]?t[i]=[]:t[i]={}),l(t[i],e.slice(1),r,n))}return s=(t=t||{}).includeInheritedProps?function(){return!0}:function(t,r){return"number"==typeof r&&Array.isArray(t)||e(t,r)},a=t.includeInheritedProps?function(t,e){"string"!=typeof e&&"number"!=typeof e&&(e=String(e));var r=u(t,e);if("__proto__"===e||"prototype"===e||"constructor"===e&&"function"==typeof r)throw new Error("For security reasons, object's magic properties cannot be set");return r}:function(t,e){return u(t,e)},c.has=function(r,n){if("number"==typeof n?n=[n]:"string"==typeof n&&(n=n.split(".")),!n||0===n.length)return!!r;for(var s=0;s<n.length;s++){var a=o(n[s]);if(!("number"==typeof a&&i(r)&&a<r.length||(t.includeInheritedProps?a in Object(r):e(r,a))))return!1;r=r[a]}return!0},c.ensureExists=function(t,e,r){return l(t,e,r,!0)},c.set=function(t,e,r,n){return l(t,e,r,n)},c.insert=function(t,e,r,n){var o=c.get(t,e);n=~~n,i(o)||(o=[],c.set(t,e,o)),o.splice(n,0,r)},c.empty=function(t,e){var o,a;if(!r(e)&&(null!=t&&(o=c.get(t,e)))){if("string"==typeof o)return c.set(t,e,"");if(function(t){return"boolean"==typeof t||"[object Boolean]"===n(t)}(o))return c.set(t,e,!1);if("number"==typeof o)return c.set(t,e,0);if(i(o))o.length=0;else{if(!function(t){return"object"==typeof t&&"[object Object]"===n(t)}(o))return c.set(t,e,null);for(a in o)s(o,a)&&delete o[a]}}},c.push=function(t,e){var r=c.get(t,e);i(r)||(r=[],c.set(t,e,r)),r.push.apply(r,Array.prototype.slice.call(arguments,2))},c.coalesce=function(t,e,r){for(var n,i=0,o=e.length;i<o;i++)if(void 0!==(n=c.get(t,e[i])))return n;return r},c.get=function(t,e,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return r;if("string"==typeof e)return c.get(t,e.split("."),r);var n=o(e[0]),i=a(t,n);return void 0===i?r:1===e.length?i:c.get(t[n],e.slice(1),r)},c.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(r(e))return t;if("string"==typeof e)return c.del(t,e.split("."));var n=o(e[0]);return a(t,n),s(t,n)?1!==e.length?c.del(t[n],e.slice(1)):(i(t)?t.splice(n,1):delete t[n],t):t},c}var a=s();return a.create=s,a.withInheritedProps=s({includeInheritedProps:!0}),a}))},7462:(t,e,r)=>{var n=r(2825),i=r(7187).EventEmitter,o=r(9539),s=t.exports=function(t,e){if(!(this instanceof s))return new s(t,e);i.call(this),(e=e||{}).maxLineLength=e.maxLineLength||4096,e.retainBuffer=!!e.retainBuffer;var r=this,o=new Buffer(e.maxLineLength),a=0,c=0,u=0,l=function(t,n){try{var i=o.slice(0,a);r.emit("line",e.retainBuffer?i:i.toString(),t,n)}catch(t){r.emit("error",t)}finally{a=0}};this.input="string"==typeof t?n.createReadStream(t,e):t,this.input.on("open",(function(t){r.emit("open",t)})).on("data",(function(t){for(var e=0;e<t.length;e++)10==t[e]||13==t[e]?10==t[e]&&(c++,l(c,u)):(o[a]=t[e],a++),u++})).on("error",(function(t){r.emit("error",t)})).on("end",(function(){a&&(c++,l(c,u)),r.emit("end")})).on("close",(function(){r.emit("close")}))};o.inherits(s,i)},3086:(t,e,r)=>{var n=r(624);function i(){n.call(this)}i.prototype=new n,t.exports=i,i.Stream=i,i.prototype.pipe=function(t,e){var r=this;function n(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),t.on("drain",i),t._isStdio||e&&!1===e.end||(r.on("end",s),r.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function c(t){if(u(),!this.hasListeners("error"))throw t}function u(){r.off("data",n),t.off("drain",i),r.off("end",s),r.off("close",a),r.off("error",c),t.off("error",c),r.off("end",u),r.off("close",u),t.off("end",u),t.off("close",u)}return r.on("error",c),t.on("error",c),r.on("end",u),r.on("close",u),t.on("end",u),t.on("close",u),t.emit("pipe",r),t}},2467:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.serialize=e.deserialize=e.registerSerializer=void 0;const n=r(7381);let i=n.DefaultSerializer;e.registerSerializer=function(t){i=n.extendSerializer(i,t)},e.deserialize=function(t){return i.deserialize(t)},e.serialize=function(t){return i.serialize(t)}},7381:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DefaultSerializer=e.extendSerializer=void 0,e.extendSerializer=function(t,e){const r=t.deserialize.bind(t),n=t.serialize.bind(t);return{deserialize:t=>e.deserialize(t,r),serialize:t=>e.serialize(t,n)}};const r={deserialize:t=>Object.assign(Error(t.message),{name:t.name,stack:t.stack}),serialize:t=>({__error_marker:"$$error",message:t.message,name:t.name,stack:t.stack})};e.DefaultSerializer={deserialize(t){return(e=t)&&"object"==typeof e&&"__error_marker"in e&&"$$error"===e.__error_marker?r.deserialize(t):t;var e},serialize:t=>t instanceof Error?r.serialize(t):t}},8258:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.$worker=e.$transferable=e.$terminate=e.$events=e.$errors=void 0,e.$errors=Symbol("thread.errors"),e.$events=Symbol("thread.events"),e.$terminate=Symbol("thread.terminate"),e.$transferable=Symbol("thread.transferable"),e.$worker=Symbol("thread.worker")},8180:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Transfer=e.isTransferDescriptor=void 0;const n=r(8258);e.isTransferDescriptor=function(t){return t&&"object"==typeof t&&t[n.$transferable]},e.Transfer=function(t,e){if(!e){if(!(r=t)||"object"!=typeof r)throw Error();e=[t]}var r;return{[n.$transferable]:!0,send:t,transferables:e}}},3229:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkerMessageType=e.MasterMessageType=void 0,function(t){t.cancel="cancel",t.run="run"}(e.MasterMessageType||(e.MasterMessageType={})),function(t){t.error="error",t.init="init",t.result="result",t.running="running",t.uncaughtError="uncaughtError"}(e.WorkerMessageType||(e.WorkerMessageType={}))},3447:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={isWorkerRuntime:function(){const t="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||t)},postMessageToMaster:function(t,e){self.postMessage(t,e)},subscribeToMasterMessages:function(t){const e=e=>{t(e.data)};return self.addEventListener("message",e),()=>{self.removeEventListener("message",e)}}}},1934:function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.expose=e.isWorkerRuntime=e.Transfer=e.registerSerializer=void 0;const o=i(r(6898)),s=r(2467),a=r(8180),c=r(3229),u=i(r(3447));var l=r(2467);Object.defineProperty(e,"registerSerializer",{enumerable:!0,get:function(){return l.registerSerializer}});var f=r(8180);Object.defineProperty(e,"Transfer",{enumerable:!0,get:function(){return f.Transfer}}),e.isWorkerRuntime=u.default.isWorkerRuntime;let h=!1;const p=new Map,d=t=>t&&t.type===c.MasterMessageType.run,y=t=>o.default(t)||function(t){return t&&"object"==typeof t&&"function"==typeof t.subscribe}(t);function v(t){return a.isTransferDescriptor(t)?{payload:t.send,transferables:t.transferables}:{payload:t,transferables:void 0}}function m(t,e){const{payload:r,transferables:n}=v(e),i={type:c.WorkerMessageType.error,uid:t,error:s.serialize(r)};u.default.postMessageToMaster(i,n)}function b(t,e,r){const{payload:n,transferables:i}=v(r),o={type:c.WorkerMessageType.result,uid:t,complete:!!e||void 0,payload:n};u.default.postMessageToMaster(o,i)}function g(t){try{const e={type:c.WorkerMessageType.uncaughtError,error:s.serialize(t)};u.default.postMessageToMaster(e)}catch(e){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",e,"\nOriginal error:",t)}}function w(t,e,r){return n(this,void 0,void 0,(function*(){let n;try{n=e(...r)}catch(e){return m(t,e)}const i=y(n)?"observable":"promise";if(function(t,e){const r={type:c.WorkerMessageType.running,uid:t,resultType:e};u.default.postMessageToMaster(r)}(t,i),y(n)){const e=n.subscribe((e=>b(t,!1,s.serialize(e))),(e=>{m(t,s.serialize(e)),p.delete(t)}),(()=>{b(t,!0),p.delete(t)}));p.set(t,e)}else try{const e=yield n;b(t,!0,s.serialize(e))}catch(e){m(t,s.serialize(e))}}))}e.expose=function(t){if(!u.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(h)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(h=!0,"function"==typeof t)u.default.subscribeToMasterMessages((e=>{d(e)&&!e.method&&w(e.uid,t,e.args.map(s.deserialize))})),function(){const t={type:c.WorkerMessageType.init,exposed:{type:"function"}};u.default.postMessageToMaster(t)}();else{if("object"!=typeof t||!t)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${t}`);u.default.subscribeToMasterMessages((e=>{d(e)&&e.method&&w(e.uid,t[e.method],e.args.map(s.deserialize))}));!function(t){const e={type:c.WorkerMessageType.init,exposed:{type:"module",methods:t}};u.default.postMessageToMaster(e)}(Object.keys(t).filter((e=>"function"==typeof t[e])))}u.default.subscribeToMasterMessages((t=>{if((e=t)&&e.type===c.MasterMessageType.cancel){const e=t.uid,r=p.get(e);r&&(r.unsubscribe(),p.delete(e))}var e}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&u.default.isWorkerRuntime()&&(self.addEventListener("error",(t=>{setTimeout((()=>g(t.error||t)),250)})),self.addEventListener("unhandledrejection",(t=>{const e=t.reason;e&&"string"==typeof e.message&&setTimeout((()=>g(e)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&u.default.isWorkerRuntime()&&(process.on("uncaughtException",(t=>{setTimeout((()=>g(t)),250)})),process.on("unhandledRejection",(t=>{t&&"string"==typeof t.message&&setTimeout((()=>g(t)),250)})))},384:t=>{t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},5955:(t,e,r)=>{"use strict";var n=r(2584),i=r(8662),o=r(6430),s=r(5692);function a(t){return t.call.bind(t)}var c="undefined"!=typeof BigInt,u="undefined"!=typeof Symbol,l=a(Object.prototype.toString),f=a(Number.prototype.valueOf),h=a(String.prototype.valueOf),p=a(Boolean.prototype.valueOf);if(c)var d=a(BigInt.prototype.valueOf);if(u)var y=a(Symbol.prototype.valueOf);function v(t,e){if("object"!=typeof t)return!1;try{return e(t),!0}catch(t){return!1}}function m(t){return"[object Map]"===l(t)}function b(t){return"[object Set]"===l(t)}function g(t){return"[object WeakMap]"===l(t)}function w(t){return"[object WeakSet]"===l(t)}function S(t){return"[object ArrayBuffer]"===l(t)}function I(t){return"undefined"!=typeof ArrayBuffer&&(S.working?S(t):t instanceof ArrayBuffer)}function P(t){return"[object DataView]"===l(t)}function O(t){return"undefined"!=typeof DataView&&(P.working?P(t):t instanceof DataView)}e.isArgumentsObject=n,e.isGeneratorFunction=i,e.isTypedArray=s,e.isPromise=function(t){return"undefined"!=typeof Promise&&t instanceof Promise||null!==t&&"object"==typeof t&&"function"==typeof t.then&&"function"==typeof t.catch},e.isArrayBufferView=function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):s(t)||O(t)},e.isUint8Array=function(t){return"Uint8Array"===o(t)},e.isUint8ClampedArray=function(t){return"Uint8ClampedArray"===o(t)},e.isUint16Array=function(t){return"Uint16Array"===o(t)},e.isUint32Array=function(t){return"Uint32Array"===o(t)},e.isInt8Array=function(t){return"Int8Array"===o(t)},e.isInt16Array=function(t){return"Int16Array"===o(t)},e.isInt32Array=function(t){return"Int32Array"===o(t)},e.isFloat32Array=function(t){return"Float32Array"===o(t)},e.isFloat64Array=function(t){return"Float64Array"===o(t)},e.isBigInt64Array=function(t){return"BigInt64Array"===o(t)},e.isBigUint64Array=function(t){return"BigUint64Array"===o(t)},m.working="undefined"!=typeof Map&&m(new Map),e.isMap=function(t){return"undefined"!=typeof Map&&(m.working?m(t):t instanceof Map)},b.working="undefined"!=typeof Set&&b(new Set),e.isSet=function(t){return"undefined"!=typeof Set&&(b.working?b(t):t instanceof Set)},g.working="undefined"!=typeof WeakMap&&g(new WeakMap),e.isWeakMap=function(t){return"undefined"!=typeof WeakMap&&(g.working?g(t):t instanceof WeakMap)},w.working="undefined"!=typeof WeakSet&&w(new WeakSet),e.isWeakSet=function(t){return w(t)},S.working="undefined"!=typeof ArrayBuffer&&S(new ArrayBuffer),e.isArrayBuffer=I,P.working="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView&&P(new DataView(new ArrayBuffer(1),0,1)),e.isDataView=O;var x="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:void 0;function k(t){return"[object SharedArrayBuffer]"===l(t)}function A(t){return void 0!==x&&(void 0===k.working&&(k.working=k(new x)),k.working?k(t):t instanceof x)}function j(t){return v(t,f)}function E(t){return v(t,h)}function D(t){return v(t,p)}function _(t){return c&&v(t,d)}function C(t){return u&&v(t,y)}e.isSharedArrayBuffer=A,e.isAsyncFunction=function(t){return"[object AsyncFunction]"===l(t)},e.isMapIterator=function(t){return"[object Map Iterator]"===l(t)},e.isSetIterator=function(t){return"[object Set Iterator]"===l(t)},e.isGeneratorObject=function(t){return"[object Generator]"===l(t)},e.isWebAssemblyCompiledModule=function(t){return"[object WebAssembly.Module]"===l(t)},e.isNumberObject=j,e.isStringObject=E,e.isBooleanObject=D,e.isBigIntObject=_,e.isSymbolObject=C,e.isBoxedPrimitive=function(t){return j(t)||E(t)||D(t)||_(t)||C(t)},e.isAnyArrayBuffer=function(t){return"undefined"!=typeof Uint8Array&&(I(t)||A(t))},["isProxy","isExternal","isModuleNamespaceObject"].forEach((function(t){Object.defineProperty(e,t,{enumerable:!1,value:function(){throw new Error(t+" is not supported in userland")}})}))},9539:(t,e,r)=>{var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++)r[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return r},i=/%[sdj%]/g;e.format=function(t){if(!b(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(c(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,o=n.length,s=String(t).replace(i,(function(t){if("%%"===t)return"%";if(r>=o)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}})),a=n[r];r<o;a=n[++r])v(a)||!S(a)?s+=" "+a:s+=" "+c(a);return s},e.deprecate=function(t,r){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,r).apply(this,arguments)};var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(r);process.traceDeprecation?console.trace(r):console.error(r),n=!0}return t.apply(this,arguments)}};var o={},s=/^$/;if(process.env.NODE_DEBUG){var a=process.env.NODE_DEBUG;a=a.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),s=new RegExp("^"+a+"$","i")}function c(t,r){var n={seen:[],stylize:l};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(r)?n.showHidden=r:r&&e._extend(n,r),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),f(n,t,n.depth)}function u(t,e){var r=c.styles[e];return r?"["+c.colors[r][0]+"m"+t+"["+c.colors[r][1]+"m":t}function l(t,e){return t}function f(t,r,n){if(t.customInspect&&r&&O(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var i=r.inspect(n,t);return b(i)||(i=f(t,i,n)),i}var o=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(b(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(m(e))return t.stylize(""+e,"number");if(y(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(t,r);if(o)return o;var s=Object.keys(r),a=function(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}(s);if(t.showHidden&&(s=Object.getOwnPropertyNames(r)),P(r)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return h(r);if(0===s.length){if(O(r)){var c=r.name?": "+r.name:"";return t.stylize("[Function"+c+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(I(r))return t.stylize(Date.prototype.toString.call(r),"date");if(P(r))return h(r)}var u,l="",S=!1,x=["{","}"];(d(r)&&(S=!0,x=["[","]"]),O(r))&&(l=" [Function"+(r.name?": "+r.name:"")+"]");return w(r)&&(l=" "+RegExp.prototype.toString.call(r)),I(r)&&(l=" "+Date.prototype.toUTCString.call(r)),P(r)&&(l=" "+h(r)),0!==s.length||S&&0!=r.length?n<0?w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),u=S?function(t,e,r,n,i){for(var o=[],s=0,a=e.length;s<a;++s)E(e,String(s))?o.push(p(t,e,r,n,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(p(t,e,r,n,i,!0))})),o}(t,r,n,a,s):s.map((function(e){return p(t,r,n,a,e,S)})),t.seen.pop(),function(t,e,r){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(u,l,x)):x[0]+l+x[1]}function h(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,r,n,i,o){var s,a,c;if((c=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),E(n,i)||(s="["+i+"]"),a||(t.seen.indexOf(c.value)<0?(a=v(r)?f(t,c.value,null):f(t,c.value,r-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").slice(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),g(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.slice(1,-1),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function d(t){return Array.isArray(t)}function y(t){return"boolean"==typeof t}function v(t){return null===t}function m(t){return"number"==typeof t}function b(t){return"string"==typeof t}function g(t){return void 0===t}function w(t){return S(t)&&"[object RegExp]"===x(t)}function S(t){return"object"==typeof t&&null!==t}function I(t){return S(t)&&"[object Date]"===x(t)}function P(t){return S(t)&&("[object Error]"===x(t)||t instanceof Error)}function O(t){return"function"==typeof t}function x(t){return Object.prototype.toString.call(t)}function k(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(t=t.toUpperCase(),!o[t])if(s.test(t)){var r=process.pid;o[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,r,n)}}else o[t]=function(){};return o[t]},e.inspect=c,c.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},c.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.types=r(5955),e.isArray=d,e.isBoolean=y,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=b,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=w,e.types.isRegExp=w,e.isObject=S,e.isDate=I,e.types.isDate=I,e.isError=P,e.types.isNativeError=P,e.isFunction=O,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(384);var A=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function j(){var t=new Date,e=[k(t.getHours()),k(t.getMinutes()),k(t.getSeconds())].join(":");return[t.getDate(),A[t.getMonth()],e].join(" ")}function E(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",j(),e.format.apply(e,arguments))},e.inherits=r(5717),e._extend=function(t,e){if(!e||!S(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t};var D="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function _(t,e){if(!t){var r=new Error("Promise was rejected with a falsy value");r.reason=t,t=r}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(D&&t[D]){var e;if("function"!=typeof(e=t[D]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,D,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,r,n=new Promise((function(t,n){e=t,r=n})),i=[],o=0;o<arguments.length;o++)i.push(arguments[o]);i.push((function(t,n){t?r(t):e(n)}));try{t.apply(this,i)}catch(t){r(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),D&&Object.defineProperty(e,D,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=D,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],r=0;r<arguments.length;r++)e.push(arguments[r]);var n=e.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var i=this,o=function(){return n.apply(i,arguments)};t.apply(this,e).then((function(t){process.nextTick(o.bind(null,null,t))}),(function(t){process.nextTick(_.bind(null,t,o))}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,n(t)),e}},6430:(t,e,r)=>{"use strict";var n=r(4029),i=r(3083),o=r(1924),s=r(7296),a=o("Object.prototype.toString"),c=r(6410)(),u="undefined"==typeof globalThis?r.g:globalThis,l=i(),f=o("String.prototype.slice"),h={},p=Object.getPrototypeOf;c&&s&&p&&n(l,(function(t){if("function"==typeof u[t]){var e=new u[t];if(Symbol.toStringTag in e){var r=p(e),n=s(r,Symbol.toStringTag);if(!n){var i=p(r);n=s(i,Symbol.toStringTag)}h[t]=n.get}}}));var d=r(5692);t.exports=function(t){return!!d(t)&&(c&&Symbol.toStringTag in t?function(t){var e=!1;return n(h,(function(r,n){if(!e)try{var i=r.call(t);i===n&&(e=i)}catch(t){}})),e}(t):f(a(t),8,-1))}},693:()=>{},2825:()=>{},199:()=>{},3083:(t,e,r)=>{"use strict";var n=["BigInt64Array","BigUint64Array","Float32Array","Float64Array","Int16Array","Int32Array","Int8Array","Uint16Array","Uint32Array","Uint8Array","Uint8ClampedArray"],i="undefined"==typeof globalThis?r.g:globalThis;t.exports=function(){for(var t=[],e=0;e<n.length;e++)"function"==typeof i[n[e]]&&(t[t.length]=n[e]);return t}}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(3050),e=r.n(t);r(6313);"function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder;const n=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(t=>{let e={};t.forEach(((t,r)=>e[t]=r))})(n),String.fromCharCode.bind(String),"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array);function i(t){return function(t,e){var r,n,i,o=0;if("undefined"==typeof TextEncoder||e){i=[];for(var s=0;s<t.length;s++)i.push(t.charCodeAt(s))}else i=(new TextEncoder).encode(t);for(r=0,n=t.length;r<n;r++)o=(o<<5)-o+i[r],o|=0;return o<0&&(o*=-1),o.toString(36)}(t)}var o=0;function s(){var t=(new Date).getTime();(t+=.01)<=o&&(t=o+.01);var e=parseFloat(t.toFixed(2));return o=e,e}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(e){return setTimeout(e,t)}))}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);var c=Promise.resolve();function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"object"==typeof window&&window.requestIdleCallback?new Promise((function(e){return window.requestIdleCallback(e,{timeout:t})})):a(0)}function l(t){if(!t)throw new Error("ensureNotFalsy() is falsy");return t}function f(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e="",r="abcdefghijklmnopqrstuvwxyz",n=0;n<t;n++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}function h(t){return Object.assign({},t)}function p(t,e){var r=t.get(e);if(void 0===r)throw new Error("missing value from map "+e);return r}function d(t){return function(e,r){return e._meta.lwt===r._meta.lwt?r[t]<e[t]?1:-1:e._meta.lwt-r._meta.lwt}}var y=function(t,e){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},y(t,e)};function v(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function m(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))}function b(t,e){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,n=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}Object.create;function g(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function S(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function I(t){return this instanceof I?(this.v=t,this):new I(t)}function P(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(t){i[t]&&(n[t]=function(e){return new Promise((function(r,n){o.push([t,e,r,n])>1||a(t,e)}))})}function a(t,e){try{(r=i[t](e)).value instanceof I?Promise.resolve(r.value.v).then(c,u):l(o[0][2],r)}catch(t){l(o[0][3],t)}var r}function c(t){a("next",t)}function u(t){a("throw",t)}function l(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function O(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=g(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,i){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,i,(e=t[r](e)).done,e.value)}))}}}Object.create;function x(t){return"function"==typeof t}function k(t){var e=t((function(t){Error.call(t),t.stack=(new Error).stack}));return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var A=k((function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}}));function j(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var E=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,r,n,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var s=g(o),a=s.next();!a.done;a=s.next()){a.value.remove(this)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}else o.remove(this);var c=this.initialTeardown;if(x(c))try{c()}catch(t){i=t instanceof A?t.errors:[t]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=g(u),f=l.next();!f.done;f=l.next()){var h=f.value;try{C(h)}catch(t){i=null!=i?i:[],t instanceof A?i=S(S([],w(i)),w(t.errors)):i.push(t)}}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}if(i)throw new A(i)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)C(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&j(e,t)},t.prototype.remove=function(e){var r=this._finalizers;r&&j(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),D=E.EMPTY;function _(t){return t instanceof E||t&&"closed"in t&&x(t.remove)&&x(t.add)&&x(t.unsubscribe)}function C(t){x(t)?t():t.unsubscribe()}var M={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},T={setTimeout:function(t,e){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=T.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,S([t,e],w(r))):setTimeout.apply(void 0,S([t,e],w(r)))},clearTimeout:function(t){var e=T.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function N(t){T.setTimeout((function(){var e=M.onUnhandledError;if(!e)throw t;e(t)}))}function L(){}var z=F("C",void 0,void 0);function F(t,e,r){return{kind:t,value:e,error:r}}var $=null;function R(t){if(M.useDeprecatedSynchronousErrorHandling){var e=!$;if(e&&($={errorThrown:!1,error:null}),t(),e){var r=$,n=r.errorThrown,i=r.error;if($=null,n)throw i}}else t()}var B=function(t){function e(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,_(e)&&e.add(r)):r.destination=Q,r}return v(e,t),e.create=function(t,e,r){return new V(t,e,r)},e.prototype.next=function(t){this.isStopped?K(function(t){return F("N",t,void 0)}(t),this):this._next(t)},e.prototype.error=function(t){this.isStopped?K(F("E",void 0,t),this):(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped?K(z,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(E),q=Function.prototype.bind;function U(t,e){return q.call(t,e)}var W=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(t){J(t)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(t){J(t)}else J(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(t){J(t)}},t}(),V=function(t){function e(e,r,n){var i,o,s=t.call(this)||this;x(e)||!e?i={next:null!=e?e:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&M.useDeprecatedNextContext?((o=Object.create(e)).unsubscribe=function(){return s.unsubscribe()},i={next:e.next&&U(e.next,o),error:e.error&&U(e.error,o),complete:e.complete&&U(e.complete,o)}):i=e;return s.destination=new W(i),s}return v(e,t),e}(B);function J(t){var e;M.useDeprecatedSynchronousErrorHandling?(e=t,M.useDeprecatedSynchronousErrorHandling&&$&&($.errorThrown=!0,$.error=e)):N(t)}function K(t,e){var r=M.onStoppedNotification;r&&T.setTimeout((function(){return r(t,e)}))}var Q={closed:!0,next:L,error:function(t){throw t},complete:L},G="function"==typeof Symbol&&Symbol.observable||"@@observable";function H(t){return t}function Y(t){return 0===t.length?H:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var Z=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n,i=this,o=(n=t)&&n instanceof B||function(t){return t&&x(t.next)&&x(t.error)&&x(t.complete)}(n)&&_(n)?t:new V(t,e,r);return R((function(){var t=i,e=t.operator,r=t.source;o.add(e?e.call(o,r):r?i._subscribe(o):i._trySubscribe(o))})),o},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=X(e))((function(e,n){var i=new V({next:function(e){try{t(e)}catch(t){n(t),i.unsubscribe()}},error:n,complete:e});r.subscribe(i)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[G]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Y(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=X(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function X(t){var e;return null!==(e=null!=t?t:M.Promise)&&void 0!==e?e:Promise}var tt=k((function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),et=function(t){function e(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return v(e,t),e.prototype.lift=function(t){var e=new rt(this,this);return e.operator=t,e},e.prototype._throwIfClosed=function(){if(this.closed)throw new tt},e.prototype.next=function(t){var e=this;R((function(){var r,n;if(e._throwIfClosed(),!e.isStopped){e.currentObservers||(e.currentObservers=Array.from(e.observers));try{for(var i=g(e.currentObservers),o=i.next();!o.done;o=i.next()){o.value.next(t)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},e.prototype.error=function(t){var e=this;R((function(){if(e._throwIfClosed(),!e.isStopped){e.hasError=e.isStopped=!0,e.thrownError=t;for(var r=e.observers;r.length;)r.shift().error(t)}}))},e.prototype.complete=function(){var t=this;R((function(){if(t._throwIfClosed(),!t.isStopped){t.isStopped=!0;for(var e=t.observers;e.length;)e.shift().complete()}}))},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)},e.prototype._innerSubscribe=function(t){var e=this,r=this,n=r.hasError,i=r.isStopped,o=r.observers;return n||i?D:(this.currentObservers=null,o.push(t),new E((function(){e.currentObservers=null,j(o,t)})))},e.prototype._checkFinalizedStatuses=function(t){var e=this,r=e.hasError,n=e.thrownError,i=e.isStopped;r?t.error(n):i&&t.complete()},e.prototype.asObservable=function(){var t=new Z;return t.source=this,t},e.create=function(t,e){return new rt(t,e)},e}(Z),rt=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return v(e,t),e.prototype.next=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,t)},e.prototype.error=function(t){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,t)},e.prototype.complete=function(){var t,e;null===(e=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===e||e.call(t)},e.prototype._subscribe=function(t){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(t))&&void 0!==r?r:D},e}(et);function nt(t){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nt(t)}function it(t){var e=function(t,e){if("object"!==nt(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!==nt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===nt(e)?e:String(e)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,it(n.key),n)}}function st(t,e,r){return e&&ot(t.prototype,e),r&&ot(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function at(t,e){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},at(t,e)}function ct(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,at(t,e)}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}function lt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ft(t,e,r){return ft=lt()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&at(i,r.prototype),i},ft.apply(null,arguments)}function ht(t){var e="function"==typeof Map?new Map:void 0;return ht=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return ft(t,arguments,ut(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),at(n,t)},ht(t)}var pt=function(t){return"RxDB Error-Code "+t+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+t+"\n        "};function dt(t,e,r){return"RxError ("+e+"):\n"+t+"\n"+function(t){var e="";return 0===Object.keys(t).length?e:(e+="Given parameters: {\n",e+=Object.keys(t).map((function(e){var r="[object Object]";try{r=JSON.stringify(t[e],(function(t,e){return void 0===e?null:e}),2)}catch(t){}return e+":"+r})).join("\n"),e+="}")}(r)}var yt=function(t){function e(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=dt(r,e,i);return(n=t.call(this,o)||this).code=e,n.message=o,n.parameters=i,n.rxdb=!0,n}return ct(e,t),e.prototype.toString=function(){return this.message},st(e,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}]),e}(ht(Error));TypeError;function vt(t,e){return new yt(t,pt(t),e)}var mt=r(5643),bt=r.n(mt);const gt={add:function(t){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope);else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){t()}),!0),window.addEventListener("unload",(function(){t()}),!0)}}};var wt=r(199),St=r.n(wt),It=bt()?St():gt,Pt=new Set,Ot=!1;function xt(t){if(Ot||(Ot=!0,It.add(kt)),"function"!=typeof t)throw new Error("Listener is no function");return Pt.add(t),{remove:function(){return Pt.delete(t)},run:function(){return Pt.delete(t),t()}}}function kt(){var t=[];return Pt.forEach((function(e){t.push(e()),Pt.delete(e)})),Promise.all(t)}var At=function(){function t(t,e){this.writesSinceLastRun=0,this.saveQueue=c,this.saveQueueC=0,this.lokiDatabase=t,this.databaseSettings=e}var e=t.prototype;return e.addWrite=function(){this.writesSinceLastRun=this.writesSinceLastRun+1,this.run()},e.run=function(){var t=this;return!this.databaseSettings.adapter||this.saveQueueC>2||(this.saveQueueC=this.saveQueueC+1,this.saveQueue=this.saveQueue.then((function(){try{return Promise.resolve(u()).then((function(){if(0!==t.writesSinceLastRun)return Promise.resolve(u().then((function(){return u()}))).then((function(){if(0!==t.writesSinceLastRun){var e=t.writesSinceLastRun;return t.writesSinceLastRun=0,new Promise((function(r,n){t.lokiDatabase.saveDatabase((function(i){i?(t.writesSinceLastRun=t.writesSinceLastRun+e,n(i)):(t.databaseSettings.autosaveCallback&&t.databaseSettings.autosaveCallback(),r())}))}))}}))}))}catch(t){return Promise.reject(t)}})).catch((function(){})).then((function(){t.saveQueueC=t.saveQueueC-1}))),this.saveQueue},t}();function jt(t){return function(e){if(function(t){return x(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(t){this.error(t)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Et=Array.isArray;function Dt(t){return 1===t.length&&Et(t[0])?t[0]:t}function _t(t,e,r,n,i){return new Ct(t,e,r,n,i)}var Ct=function(t){function e(e,r,n,i,o,s){var a=t.call(this,e)||this;return a.onFinalize=o,a.shouldUnsubscribe=s,a._next=r?function(t){try{r(t)}catch(t){e.error(t)}}:t.prototype._next,a._error=i?function(t){try{i(t)}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=n?function(){try{n()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return v(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;t.prototype.unsubscribe.call(this),!r&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(B);var Mt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Tt(t){return x(null==t?void 0:t.then)}function Nt(t){return x(t[G])}function Lt(t){return Symbol.asyncIterator&&x(null==t?void 0:t[Symbol.asyncIterator])}function zt(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Ft="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function $t(t){return x(null==t?void 0:t[Ft])}function Rt(t){return P(this,arguments,(function(){var e,r,n;return b(this,(function(i){switch(i.label){case 0:e=t.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,I(e.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,I(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,I(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function Bt(t){return x(null==t?void 0:t.getReader)}function qt(t){if(t instanceof Z)return t;if(null!=t){if(Nt(t))return i=t,new Z((function(t){var e=i[G]();if(x(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Mt(t))return n=t,new Z((function(t){for(var e=0;e<n.length&&!t.closed;e++)t.next(n[e]);t.complete()}));if(Tt(t))return r=t,new Z((function(t){r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,N)}));if(Lt(t))return Ut(t);if($t(t))return e=t,new Z((function(t){var r,n;try{for(var i=g(e),o=i.next();!o.done;o=i.next()){var s=o.value;if(t.next(s),t.closed)return}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}t.complete()}));if(Bt(t))return Ut(Rt(t))}var e,r,n,i;throw zt(t)}function Ut(t){return new Z((function(e){(function(t,e){var r,n,i,o;return m(this,void 0,void 0,(function(){var s,a;return b(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),r=O(t),c.label=1;case 1:return[4,r.next()];case 2:if((n=c.sent()).done)return[3,4];if(s=n.value,e.next(s),e.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),i={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),n&&!n.done&&(o=r.return)?[4,o.call(r)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Wt(t,e,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var o=e.schedule((function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()}),n);if(t.add(o),!i)return o}function Vt(t,e,r){return void 0===r&&(r=1/0),x(e)?Vt((function(r,n){return function(t,e){return jt((function(r,n){var i=0;r.subscribe(_t(n,(function(r){n.next(t.call(e,r,i++))})))}))}((function(t,i){return e(r,t,n,i)}))(qt(t(r,n)))}),r):("number"==typeof e&&(r=e),jt((function(e,n){return function(t,e,r,n,i,o,s,a){var c=[],u=0,l=0,f=!1,h=function(){!f||c.length||u||e.complete()},p=function(t){return u<n?d(t):c.push(t)},d=function(t){o&&e.next(t),u++;var a=!1;qt(r(t,l++)).subscribe(_t(e,(function(t){null==i||i(t),o?p(t):e.next(t)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var t=function(){var t=c.shift();s?Wt(e,s,(function(){return d(t)})):d(t)};c.length&&u<n;)t();h()}catch(t){e.error(t)}})))};return t.subscribe(_t(e,p,(function(){f=!0,h()}))),function(){null==a||a()}}(e,n,t,r)})))}function Jt(t){return void 0===t&&(t=1/0),Vt(H,t)}function Kt(t){return t[t.length-1]}function Qt(t){return(e=Kt(t))&&x(e.schedule)?t.pop():void 0;var e}function Gt(t,e){return"number"==typeof Kt(t)?t.pop():e}function Ht(t,e){return void 0===e&&(e=0),jt((function(r,n){r.subscribe(_t(n,(function(r){return Wt(n,t,(function(){return n.next(r)}),e)}),(function(){return Wt(n,t,(function(){return n.complete()}),e)}),(function(r){return Wt(n,t,(function(){return n.error(r)}),e)})))}))}function Yt(t,e){return void 0===e&&(e=0),jt((function(r,n){n.add(t.schedule((function(){return r.subscribe(n)}),e))}))}function Zt(t,e){if(!t)throw new Error("Iterable cannot be null");return new Z((function(r){Wt(r,e,(function(){var n=t[Symbol.asyncIterator]();Wt(r,e,(function(){n.next().then((function(t){t.done?r.complete():r.next(t.value)}))}),0,!0)}))}))}function Xt(t,e){if(null!=t){if(Nt(t))return function(t,e){return qt(t).pipe(Yt(e),Ht(e))}(t,e);if(Mt(t))return function(t,e){return new Z((function(r){var n=0;return e.schedule((function(){n===t.length?r.complete():(r.next(t[n++]),r.closed||this.schedule())}))}))}(t,e);if(Tt(t))return function(t,e){return qt(t).pipe(Yt(e),Ht(e))}(t,e);if(Lt(t))return Zt(t,e);if($t(t))return function(t,e){return new Z((function(r){var n;return Wt(r,e,(function(){n=t[Ft](),Wt(r,e,(function(){var t,e,i;try{e=(t=n.next()).value,i=t.done}catch(t){return void r.error(t)}i?r.complete():r.next(e)}),0,!0)})),function(){return x(null==n?void 0:n.return)&&n.return()}}))}(t,e);if(Bt(t))return function(t,e){return Zt(Rt(t),e)}(t,e)}throw zt(t)}function te(t,e){return e?Xt(t,e):qt(t)}function ee(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Qt(t),n=Gt(t,1/0);return t=Dt(t),jt((function(e,i){Jt(n)(te(S([e],w(t)),r)).subscribe(i)}))}Promise.resolve(!1);var re=Promise.resolve(!0),ne=Promise.resolve();function ie(t,e){return t||(t=0),new Promise((function(r){return setTimeout((function(){return r(e)}),t)}))}function oe(){return Math.random().toString(36).substring(2)}var se=0,ae=0;function ce(){var t=(new Date).getTime();return t===se?1e3*t+ ++ae:(se=t,ae=0,1e3*t)}const ue={create:function(t){var e={messagesCallback:null,bc:new BroadcastChannel(t),subFns:[]};return e.bc.onmessage=function(t){e.messagesCallback&&e.messagesCallback(t.data)},e},close:function(t){t.bc.close(),t.subFns=[]},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){try{return t.bc.postMessage(e,!1),ne}catch(t){return Promise.reject(t)}},canBeUsed:function(){if("undefined"==typeof window)return!1;if("function"==typeof BroadcastChannel){if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0}return!1},type:"native",averageResponseTime:function(){return 150},microSeconds:ce};var le=function(){function t(t){this.ttl=t,this.map=new Map,this._to=!1}return t.prototype.has=function(t){return this.map.has(t)},t.prototype.add=function(t){var e=this;this.map.set(t,fe()),this._to||(this._to=!0,setTimeout((function(){e._to=!1,function(t){var e=fe()-t.ttl,r=t.map[Symbol.iterator]();for(;;){var n=r.next().value;if(!n)return;var i=n[0];if(!(n[1]<e))return;t.map.delete(i)}}(e)}),0))},t.prototype.clear=function(){this.map.clear()},t}();function fe(){return(new Date).getTime()}function he(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.parse(JSON.stringify(t));return void 0===e.webWorkerSupport&&(e.webWorkerSupport=!0),e.idb||(e.idb={}),e.idb.ttl||(e.idb.ttl=45e3),e.idb.fallbackInterval||(e.idb.fallbackInterval=150),t.idb&&"function"==typeof t.idb.onclose&&(e.idb.onclose=t.idb.onclose),e.localstorage||(e.localstorage={}),e.localstorage.removeTimeout||(e.localstorage.removeTimeout=6e4),t.methods&&(e.methods=t.methods),e.node||(e.node={}),e.node.ttl||(e.node.ttl=12e4),e.node.maxParallelWrites||(e.node.maxParallelWrites=2048),void 0===e.node.useFastPath&&(e.node.useFastPath=!0),e}var pe="messages",de={durability:"relaxed"};function ye(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function ve(t){t.commit&&t.commit()}function me(t,e){var r=t.transaction(pe,"readonly",de),n=r.objectStore(pe),i=[],o=IDBKeyRange.bound(e+1,1/0);if(n.getAll){var s=n.getAll(o);return new Promise((function(t,e){s.onerror=function(t){return e(t)},s.onsuccess=function(e){t(e.target.result)}}))}return new Promise((function(t,s){var a=function(){try{return o=IDBKeyRange.bound(e+1,1/0),n.openCursor(o)}catch(t){return n.openCursor()}}();a.onerror=function(t){return s(t)},a.onsuccess=function(n){var o=n.target.result;o?o.value.id<e+1?o.continue(e+1):(i.push(o.value),o.continue()):(ve(r),t(i))}}))}function be(t){return(e=t.db,r=t.options.idb.ttl,n=(new Date).getTime()-r,i=e.transaction(pe,"readonly",de),o=i.objectStore(pe),s=[],new Promise((function(t){o.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var o=r.value;if(!(o.time<n))return ve(i),void t(s);s.push(o),r.continue()}else t(s)}}))).then((function(e){return function(t,e){if(t.closed)return Promise.resolve([]);var r=t.db.transaction(pe,"readwrite",de).objectStore(pe);return Promise.all(e.map((function(t){var e=r.delete(t);return new Promise((function(t){e.onsuccess=function(){return t()}}))})))}(t,e.map((function(t){return t.id})))}));var e,r,n,i,o,s}function ge(t){t.closed||we(t).then((function(){return ie(t.options.idb.fallbackInterval)})).then((function(){return ge(t)}))}function we(t){return t.closed?ne:t.messagesCallback?me(t.db,t.lastCursorId).then((function(e){var r=e.filter((function(t){return!!t})).map((function(e){return e.id>t.lastCursorId&&(t.lastCursorId=e.id),e})).filter((function(e){return function(t,e){return!(t.uuid===e.uuid||e.eMIs.has(t.id)||t.data.time<e.messagesCallbackTime)}(e,t)})).sort((function(t,e){return t.time-e.time}));return r.forEach((function(e){t.messagesCallback&&(t.eMIs.add(e.id),t.messagesCallback(e.data))})),ne})):ne}const Se={create:function(t,e){return e=he(e),function(t){var e="pubkey.broadcast-channel-0-"+t,r=ye().open(e);return r.onupgradeneeded=function(t){t.target.result.createObjectStore(pe,{keyPath:"id",autoIncrement:!0})},new Promise((function(t,e){r.onerror=function(t){return e(t)},r.onsuccess=function(){t(r.result)}}))}(t).then((function(r){var n={closed:!1,lastCursorId:0,channelName:t,options:e,uuid:oe(),eMIs:new le(2*e.idb.ttl),writeBlockPromise:ne,messagesCallback:null,readQueuePromises:[],db:r};return r.onclose=function(){n.closed=!0,e.idb.onclose&&e.idb.onclose()},ge(n),n}))},close:function(t){t.closed=!0,t.db.close()},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e,we(t)},postMessage:function(t,e){return t.writeBlockPromise=t.writeBlockPromise.then((function(){return function(t,e,r){var n={uuid:e,time:(new Date).getTime(),data:r},i=t.transaction([pe],"readwrite",de);return new Promise((function(t,e){i.oncomplete=function(){return t()},i.onerror=function(t){return e(t)},i.objectStore(pe).add(n),ve(i)}))}(t.db,t.uuid,e)})).then((function(){var e,r;0===(e=0,r=10,Math.floor(Math.random()*(r-e+1)+e))&&be(t)})),t.writeBlockPromise},canBeUsed:function(){return!!ye()},type:"idb",averageResponseTime:function(t){return 2*t.idb.fallbackInterval},microSeconds:ce};function Ie(){var t;if("undefined"==typeof window)return null;try{t=window.localStorage,t=window["ie8-eventlistener/storage"]||window.localStorage}catch(t){}return t}function Pe(t){return"pubkey.broadcastChannel-"+t}function Oe(){var t=Ie();if(!t)return!1;try{var e="__broadcastchannel_check";t.setItem(e,"works"),t.removeItem(e)}catch(t){return!1}return!0}const xe={create:function(t,e){if(e=he(e),!Oe())throw new Error("BroadcastChannel: localstorage cannot be used");var r=oe(),n=new le(e.localstorage.removeTimeout),i={channelName:t,uuid:r,eMIs:n};return i.listener=function(t,e){var r=Pe(t),n=function(t){t.key===r&&e(JSON.parse(t.newValue))};return window.addEventListener("storage",n),n}(t,(function(t){i.messagesCallback&&t.uuid!==r&&t.token&&!n.has(t.token)&&(t.data.time&&t.data.time<i.messagesCallbackTime||(n.add(t.token),i.messagesCallback(t.data)))})),i},close:function(t){var e;e=t.listener,window.removeEventListener("storage",e)},onMessage:function(t,e,r){t.messagesCallbackTime=r,t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(r){ie().then((function(){var n=Pe(t.channelName),i={token:oe(),time:(new Date).getTime(),data:e,uuid:t.uuid},o=JSON.stringify(i);Ie().setItem(n,o);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=n,s.newValue=o,window.dispatchEvent(s),r()}))}))},canBeUsed:Oe,type:"localstorage",averageResponseTime:function(){var t=navigator.userAgent.toLowerCase();return t.includes("safari")&&!t.includes("chrome")?240:120},microSeconds:ce};var ke=ce,Ae=new Set;const je={create:function(t){var e={name:t,messagesCallback:null};return Ae.add(e),e},close:function(t){Ae.delete(t)},onMessage:function(t,e){t.messagesCallback=e},postMessage:function(t,e){return new Promise((function(r){return setTimeout((function(){Array.from(Ae).filter((function(e){return e.name===t.name})).filter((function(e){return e!==t})).filter((function(t){return!!t.messagesCallback})).forEach((function(t){return t.messagesCallback(e)})),r()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:ke};var Ee=[ue,Se,xe];var De,_e=new Set,Ce=0,Me=function(t,e){var r,n,i;this.id=Ce++,_e.add(this),this.name=t,De&&(e=De),this.options=he(e),this.method=function(t){var e=[].concat(t.methods,Ee).filter(Boolean);if(t.type){if("simulate"===t.type)return je;var r=e.find((function(e){return e.type===t.type}));if(r)return r;throw new Error("method-type "+t.type+" not found")}t.webWorkerSupport||(e=e.filter((function(t){return"idb"!==t.type})));var n=e.find((function(t){return t.canBeUsed()}));if(n)return n;throw new Error("No useable method found in "+JSON.stringify(Ee.map((function(t){return t.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,n=(r=this).method.create(r.name,r.options),(i=n)&&"function"==typeof i.then?(r._prepP=n,n.then((function(t){r._state=t}))):r._state=n};function Te(t,e,r){var n={time:t.method.microSeconds(),type:e,data:r};return(t._prepP?t._prepP:ne).then((function(){var e=t.method.postMessage(t._state,n);return t._uMP.add(e),e.catch().then((function(){return t._uMP.delete(e)})),e}))}function Ne(t){return t._addEL.message.length>0||t._addEL.internal.length>0}function Le(t,e,r){t._addEL[e].push(r),function(t){if(!t._iL&&Ne(t)){var e=function(e){t._addEL[e.type].forEach((function(t){var r=1e5,n=t.time-r;e.time>=n&&t.fn(e.data)}))},r=t.method.microSeconds();t._prepP?t._prepP.then((function(){t._iL=!0,t.method.onMessage(t._state,e,r)})):(t._iL=!0,t.method.onMessage(t._state,e,r))}}(t)}function ze(t,e,r){t._addEL[e]=t._addEL[e].filter((function(t){return t!==r})),function(t){if(t._iL&&!Ne(t)){t._iL=!1;var e=t.method.microSeconds();t.method.onMessage(t._state,null,e)}}(t)}Me._pubkey=!0,Me.prototype={postMessage:function(t){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(t));return Te(this,"message",t)},postInternal:function(t){return Te(this,"internal",t)},set onmessage(t){var e={time:this.method.microSeconds(),fn:t};ze(this,"message",this._onML),t&&"function"==typeof t?(this._onML=e,Le(this,"message",e)):this._onML=null},addEventListener:function(t,e){Le(this,t,{time:this.method.microSeconds(),fn:e})},removeEventListener:function(t,e){ze(this,t,this._addEL[t].find((function(t){return t.fn===e})))},close:function(){var t=this;if(!this.closed){_e.delete(this),this.closed=!0;var e=this._prepP?this._prepP:ne;return this._onML=null,this._addEL.message=[],e.then((function(){return Promise.all(Array.from(t._uMP))})).then((function(){return Promise.all(t._befC.map((function(t){return t()})))})).then((function(){return t.method.close(t._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Fe=function(t,e){var r=this;this.broadcastChannel=t,this._options=e,this.isLeader=!1,this.hasLeader=!1,this.isDead=!1,this.token=oe(),this._aplQ=ne,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var n=function(t){"leader"===t.context&&("death"===t.action&&(r.hasLeader=!1),"tell"===t.action&&(r.hasLeader=!0))};this.broadcastChannel.addEventListener("internal",n),this._lstns.push(n)};function $e(t,e){var r={context:"leader",action:e,token:t.token};return t.broadcastChannel.postInternal(r)}function Re(t,e){if(t._leaderElector)throw new Error("BroadcastChannel already has a leader-elector");e=function(t,e){return t||(t={}),(t=JSON.parse(JSON.stringify(t))).fallbackInterval||(t.fallbackInterval=3e3),t.responseTime||(t.responseTime=e.method.averageResponseTime(e.options)),t}(e,t);var r=new Fe(t,e);return t._befC.push((function(){return r.die()})),t._leaderElector=r,r}Fe.prototype={applyOnce:function(t){var e=this;if(this.isLeader)return ie(0,!0);if(this.isDead)return ie(0,!1);if(this._aplQC>1)return this._aplQ;var r=function(){if(e.isLeader)return re;var r,n=!1,i=new Promise((function(t){r=function(){n=!0,t()}})),o=[],s=function(t){"leader"===t.context&&t.token!=e.token&&(o.push(t),"apply"===t.action&&t.token>e.token&&r(),"tell"===t.action&&(r(),e.hasLeader=!0))};e.broadcastChannel.addEventListener("internal",s);var a=t?4*e._options.responseTime:e._options.responseTime;return $e(e,"apply").then((function(){return Promise.race([ie(a),i.then((function(){return Promise.reject(new Error)}))])})).then((function(){return $e(e,"apply")})).then((function(){return Promise.race([ie(a),i.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return e.broadcastChannel.removeEventListener("internal",s),!n&&function(t){t.isLeader=!0,t.hasLeader=!0;var e=xt((function(){return t.die()}));t._unl.push(e);var r=function(e){"leader"===e.context&&"apply"===e.action&&$e(t,"tell"),"leader"!==e.context||"tell"!==e.action||t._dpLC||(t._dpLC=!0,t._dpL(),$e(t,"tell"))};return t.broadcastChannel.addEventListener("internal",r),t._lstns.push(r),$e(t,"tell")}(e).then((function(){return!0}))}))};return this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return r()})).then((function(){e._aplQC=e._aplQC-1})),this._aplQ.then((function(){return e.isLeader}))},awaitLeadership:function(){return this._aLP||(this._aLP=function(t){if(t.isLeader)return ne;return new Promise((function(e){var r=!1;function n(){r||(r=!0,t.broadcastChannel.removeEventListener("internal",i),e(!0))}t.applyOnce().then((function(){t.isLeader&&n()})),function e(){return ie(t._options.fallbackInterval).then((function(){if(!t.isDead&&!r)return t.isLeader?void n():t.applyOnce(!0).then((function(){t.isLeader?n():e()}))}))}();var i=function(e){"leader"===e.context&&"death"===e.action&&(t.hasLeader=!1,t.applyOnce().then((function(){t.isLeader&&n()})))};t.broadcastChannel.addEventListener("internal",i),t._lstns.push(i)}))}(this)),this._aLP},set onduplicate(t){this._dpL=t},die:function(){var t=this;return this._lstns.forEach((function(e){return t.broadcastChannel.removeEventListener("internal",e)})),this._lstns=[],this._unl.forEach((function(t){return t.remove()})),this._unl=[],this.isLeader&&(this.hasLeader=!1,this.isLeader=!1),this.isDead=!0,$e(this,"death")}};var Be=new Map;function qe(t,e,r){var n=Be.get(t);return n||(n={bc:new Me("RxDB:"+e),refs:new Set},Be.set(t,n)),n.refs.add(r),n.bc}function Ue(t,e){var r=Be.get(t);if(r)return r.refs.delete(e),0===r.refs.size?(Be.delete(t),r.bc.close()):void 0}function We(t,e,r,n){if(e.multiInstance){var i=n||qe(e.databaseInstanceToken,r.databaseName,r),o=new et,s=function(r){r.storageName===t&&r.databaseName===e.databaseName&&r.collectionName===e.collectionName&&r.version===e.schema.version&&o.next(r.eventBulk)};i.addEventListener("message",s);var a=r.changeStream(),c=!1,u=a.subscribe((function(r){c||i.postMessage({storageName:t,databaseName:e.databaseName,collectionName:e.collectionName,version:e.schema.version,eventBulk:r})}));r.changeStream=function(){return o.asObservable().pipe(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ee.apply(void 0,S([],w(t)))}(a))};var l=r.close.bind(r);r.close=function(){try{c=!0,u.unsubscribe(),i.removeEventListener("message",s);var t=function(){if(!n)return Promise.resolve(Ue(e.databaseInstanceToken,r)).then((function(){}))}();return Promise.resolve(t&&t.then?t.then((function(){return l()})):l())}catch(t){return Promise.reject(t)}};var f=r.remove.bind(r);r.remove=function(){try{c=!0,u.unsubscribe(),i.removeEventListener("message",s);var t=function(){if(!n)return Promise.resolve(Ue(e.databaseInstanceToken,r)).then((function(){}))}();return Promise.resolve(t&&t.then?t.then((function(){return f()})):f())}catch(t){return Promise.reject(t)}}}}new WeakMap;var Ve=new WeakMap;function Je(t){var e=Ve.get(t);return e||(e=Re(t),Ve.set(t,e)),e}function Ke(t,e,r){if(!t.s){if(r instanceof Qe){if(!r.s)return void(r.o=Ke.bind(null,t,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(Ke.bind(null,t,e),Ke.bind(null,t,2));t.s=e,t.v=r;var n=t.o;n&&n(t)}}var Qe=function(){function t(){}return t.prototype.then=function(e,r){var n=new t,i=this.s;if(i){var o=1&i?e:r;if(o){try{Ke(n,1,o(this.v))}catch(t){Ke(n,2,t)}return n}return this}return this.o=function(t){try{var i=t.v;1&t.s?Ke(n,1,e?e(i):i):r?Ke(n,1,r(i)):Ke(n,2,i)}catch(t){Ke(n,2,t)}},n},t}();function Ge(t){return t instanceof Qe&&1&t.s}var He=function(t){try{if(t.closed)throw vt("SNH",{args:{instanceClosed:t.closed,databaseName:t.databaseName,collectionName:t.collectionName}});if(t.internals.localState)return Promise.resolve(t.internals.localState);var e=l(t.internals.leaderElector);return Promise.resolve(Ye(e)).then((function(){return t.internals.localState?t.internals.localState:!(!e.isLeader||t.internals.localState)&&(t.internals.localState=pr({databaseInstanceToken:t.databaseInstanceToken,databaseName:t.databaseName,collectionName:t.collectionName,options:t.options,schema:t.schema,multiInstance:!!t.internals.leaderElector},t.databaseSettings),l(t.internals.localState))}))}catch(t){return Promise.reject(t)}},Ye=function(t){try{var e=function(t,e,r){for(var n;;){var i=t();if(Ge(i)&&(i=i.v),!i)return o;if(i.then){n=0;break}var o=r();if(o&&o.then){if(!Ge(o)){n=1;break}o=o.s}if(e){var s=e();if(s&&s.then&&!Ge(s)){n=2;break}}}var a=new Qe,c=Ke.bind(null,a,2);return(0===n?i.then(l):1===n?o.then(u):s.then(f)).then(void 0,c),a;function u(n){o=n;do{if(e&&(s=e())&&s.then&&!Ge(s))return void s.then(f).then(void 0,c);if(!(i=t())||Ge(i)&&!i.v)return void Ke(a,1,o);if(i.then)return void i.then(l).then(void 0,c);Ge(o=r())&&(o=o.v)}while(!o||!o.then);o.then(u).then(void 0,c)}function l(t){t?(o=r())&&o.then?o.then(u).then(void 0,c):u(o):Ke(a,1,o)}function f(){(i=t())?i.then?i.then(l).then(void 0,c):l(i):Ke(a,1,o)}}((function(){return!t.hasLeader}),void 0,(function(){return Promise.resolve(t.applyOnce()).then((function(){return Promise.resolve(a(0)).then((function(){}))}))}));return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}},Ze=function(t,e,r){try{var n="function"==typeof t.query?Xe:tr,i=l(t.internals.leaderElector);return Promise.resolve(Ye(i)).then((function(){var o,s,a=i.broadcastChannel,c=new Promise((function(t){o=function(e){"leader"===e.context&&"death"===e.action&&t({retry:!0})},a.addEventListener("internal",o)})),u=f(12),l=new Promise((function(t,e){s=function(e){e.type===n&&!0===e.response&&e.requestId===u&&(e.isError?t({retry:!1,error:e.result}):t({retry:!1,result:e.result}))},a.addEventListener("message",s)}));return a.postMessage({response:!1,type:n,operation:e,params:r,requestId:u,databaseName:t.databaseName,collectionName:t.collectionName}),Promise.race([c,l]).then((function(n){var i;if(a.removeEventListener("message",s),a.removeEventListener("internal",o),n.retry)return(i=t)[e].apply(i,r);if(n.error)throw n.error;return n.result}))}))}catch(t){return Promise.reject(t)}},Xe="rxdb-lokijs-remote-request",tr="rxdb-lokijs-remote-request-key-object",er="lokijs";function rr(t){if(!t.$loki)return t;var e=h(t);return e.$lastWriteAt&&(e._meta={lwt:e.$lastWriteAt},delete e.$lastWriteAt),delete e.$loki,e}var nr=new Set,ir={disableChangesApi:!0,disableMeta:!0,disableDeltaChangesApi:!0,disableFreeze:!0,cloneMethod:"shallow-assign",clone:!1,transactional:!1,autoupdate:!1},or=new Map;function sr(t,r){var n=or.get(t);if(!n){var i=!!r.adapter;n=function(){try{var n=function(){var t=[];return i&&t.push(xt((function(){return c.run()}))),{database:a,databaseSettings:s,saveQueue:c,collections:{},unloads:t}},o=i?"adapter":"memory";r.persistenceMethod&&(o=r.persistenceMethod);var s=Object.assign({autoload:i,persistenceMethod:o,verbose:!0},r,{autoload:!1,autosave:!1,throttledSaves:!1}),a=new(e())(t+".db",h(s)),c=new At(a,s),u=function(){if(i){var t=new Promise((function(t,e){try{a.loadDatabase({recursiveWait:!1},(function(r){s.autoloadCallback&&s.autoloadCallback(r),r?e(r):t()}))}catch(t){e(t)}}));return c.saveQueue=c.saveQueue.then((function(){return t})),Promise.resolve(t).then((function(){}))}}();return Promise.resolve(u&&u.then?u.then(n):n())}catch(t){return Promise.reject(t)}}(),or.set(t,n)}return n}function ar(t,e){if(!e.sort)throw vt("SNH",{query:e});var r=e.sort;return function(t,n){var i=0;if(r.find((function(e){var r=Object.keys(e)[0],o="asc"===Object.values(e)[0]?1:-1,s=t[r],a=n[r];return s!==a&&(s>a?(i=1*o,!0):(i=-1*o,!0))})),!i)throw vt("SNH",{args:{query:e,a:t,b:n}});return i}}r(1528);function cr(t){return"string"==typeof t?t:t.key}function ur(t){return{previous:t.previous,document:lr(t.document)}}function lr(t){var e=h(t);return e._attachments={},Object.entries(t._attachments).forEach((function(t){var r,n,o,s=t[0],a=t[1];e._attachments[s]=(o=(r=a).data)?{digest:i(o),length:(n=o,atob(n).length),type:r.type}:r})),e}function fr(t,e,r){var n=r.document[e],i=[!!r.previous,r.previous&&r.previous._deleted,!!r.document._deleted].map((function(t){return t?"1":"0"})).join("");return t.databaseName+"|"+t.collectionName+"|"+n+"||"+i+"|"+r.document._rev}var hr=function(t,e,r){try{var n=function(){var n=new yr(e.databaseInstanceToken,t,e.databaseName,e.collectionName,e.schema,i,e.options,r);if(We(er,e,n,i.leaderElector?i.leaderElector.broadcastChannel:void 0),e.multiInstance){var s=n.close.bind(n);n.close=function(){return Ue(e.databaseInstanceToken,o),s()};var a=n.remove.bind(n);n.remove=function(){return Ue(e.databaseInstanceToken,o),a()},l(i.leaderElector).awaitLeadership().then((function(){n.closed||He(n)}))}return n},i={},o={},s=function(){if(!e.multiInstance)return i.localState=pr(e,r),Promise.resolve(i.localState).then((function(){}));var t=function(t,e,r){return Je(qe(t,r,e))}(e.databaseInstanceToken,o,e.databaseName);i.leaderElector=t}();return Promise.resolve(s&&s.then?s.then(n):n())}catch(t){return Promise.reject(t)}},pr=function(t,e){try{return t.options||(t.options={}),Promise.resolve(sr(t.databaseName,e)).then((function(e){var r=[];t.schema.indexes&&t.schema.indexes.forEach((function(t){var e;e=t,Array.isArray(e)||r.push(t)}));var n=cr(t.schema.primaryKey);r.push(n);var i=t.collectionName+"-"+t.schema.version,o=Object.assign({},i,{indices:r,unique:[n]},ir),s=e.database.addCollection(i,o);return e.collections[t.collectionName]=s,{databaseState:e,collection:s}}))}catch(t){return Promise.reject(t)}},dr=s(),yr=function(){function t(t,e,r,n,i,o,s,a){var c=this;if(this.changes$=new et,this.instanceId=dr++,this.closed=!1,this.databaseInstanceToken=t,this.storage=e,this.databaseName=r,this.collectionName=n,this.schema=i,this.internals=o,this.options=s,this.databaseSettings=a,this.primaryPath=cr(this.schema.primaryKey),nr.add(this),this.internals.leaderElector){var u={bulkWrite:this.bulkWrite.bind(this),changeStream:this.changeStream.bind(this),cleanup:this.cleanup.bind(this),close:this.close.bind(this),query:this.query.bind(this),count:this.count.bind(this),findDocumentsById:this.findDocumentsById.bind(this),collectionName:this.collectionName,databaseName:this.databaseName,conflictResultionTasks:this.conflictResultionTasks.bind(this),getAttachmentData:this.getAttachmentData.bind(this),getChangedDocumentsSince:this.getChangedDocumentsSince.bind(this),internals:this.internals,options:this.options,remove:this.remove.bind(this),resolveConflictResultionTask:this.resolveConflictResultionTask.bind(this),schema:this.schema};this.internals.leaderElector.awaitLeadership().then((function(){l(c.internals.leaderElector).broadcastChannel.addEventListener("message",(function(t){return function(t,e){try{var r=function(){if(e.type===Xe&&e.requestId&&e.databaseName===t.databaseName&&e.collectionName===t.collectionName&&!e.response){var r,n=function(){var n={response:!0,requestId:e.requestId,databaseName:t.databaseName,collectionName:t.collectionName,result:r,isError:s,type:e.type};l(t.internals.leaderElector).broadcastChannel.postMessage(n)},i=e.operation,o=e.params,s=!1,a=function(t,e){try{var r=t()}catch(t){return e(t)}return r&&r.then?r.then(void 0,e):r}((function(){var e;return Promise.resolve((e=t)[i].apply(e,o)).then((function(t){r=t}))}),(function(t){console.dir(t),s=!0,r=t}));return a&&a.then?a.then(n):n()}}();return Promise.resolve(r&&r.then?r.then((function(){})):void 0)}catch(t){return Promise.reject(t)}}(u,t)}))}))}}var e=t.prototype;return e.bulkWrite=function(t,e){try{var r=this;if(0===t.length)throw vt("P2",{args:{documentWrites:t}});return Promise.resolve(He(r)).then((function(n){if(!n)return Ze(r,"bulkWrite",[t]);var i={success:{},error:{}},o=new Map,a=new Map;t.forEach((function(t){var e=t.document[r.primaryPath],i=n.collection.by(r.primaryPath,e);i&&(a.set(e,i),o.set(e,rr(i)))}));var c=function(t,e,r,n,i){var o=!!t.schema.attachments,a=[],c=[],u={},h=[],p={id:f(10),events:[],checkpoint:null,context:i},d=[],y=[],v=[],m=s(),b="function"==typeof r.get;return n.forEach((function(n){var i,f=n.document[e],g=b?r.get(f):r[f];if(g){var w=g._rev;if(!n.previous||n.previous&&w!==n.previous._rev){var S={isError:!0,status:409,documentId:f,writeRow:n,documentInDb:g};return void(u[f]=S)}var I=o?ur(n):n;n.document._deleted?n.previous&&Object.keys(n.previous._attachments).forEach((function(t){y.push({documentId:f,attachmentId:t})})):(Object.entries(n.document._attachments).find((function(t){var e=t[0],r=t[1];return(n.previous?n.previous._attachments[e]:void 0)||r.data||(i={documentId:f,documentInDb:g,isError:!0,status:510,writeRow:n}),!0})),i||Object.entries(n.document._attachments).forEach((function(t){var e=t[0],r=t[1],i=n.previous?n.previous._attachments[e]:void 0;if(i){var o=I.document._attachments[e].digest;r.data&&i.digest!==o&&v.push({documentId:f,attachmentId:e,attachmentData:r})}else d.push({documentId:f,attachmentId:e,attachmentData:r})}))),i?u[f]=i:c.push(I);var P=n.document,O=null,x=null,k=null;if(n.previous&&n.previous._deleted&&!P._deleted)k="INSERT",O=o?lr(P):P;else if(!n.previous||n.previous._deleted||P._deleted){if(!P._deleted)throw vt("SNH",{args:{writeRow:n}});k="DELETE",O=l(n.document),x=n.previous}else k="UPDATE",O=o?lr(P):P,x=n.previous;h.push(f),p.events.push({eventId:fr(t,e,n),documentId:f,documentData:l(O),previousDocumentData:x,operation:k,startTime:m,endTime:s()})}else{var A=!!n.document._deleted;Object.entries(n.document._attachments).forEach((function(t){var e=t[0],r=t[1];r.data?d.push({documentId:f,attachmentId:e,attachmentData:r}):(i={documentId:f,isError:!0,status:510,writeRow:n},u[f]=i)})),i||(o?a.push(ur(n)):a.push(n)),A||(h.push(f),p.events.push({eventId:fr(t,e,n),documentId:f,operation:"INSERT",documentData:o?lr(n.document):n.document,previousDocumentData:o&&n.previous?lr(n.previous):n.previous,startTime:m,endTime:s()}))}})),{bulkInsertDocs:a,bulkUpdateDocs:c,errors:u,changedDocumentIds:h,eventBulk:p,attachmentsAdd:d,attachmentsRemove:y,attachmentsUpdate:v}}(r,r.primaryPath,o,t,e);if(i.error=c.errors,c.bulkInsertDocs.forEach((function(t){var e=t.document[r.primaryPath];n.collection.insert(h(t.document)),i.success[e]=t.document})),c.bulkUpdateDocs.forEach((function(t){var e=t.document[r.primaryPath],o=p(a,e),s=Object.assign({},t.document,{$loki:o.$loki});n.collection.update(s),i.success[e]=t.document})),n.databaseState.saveQueue.addWrite(),c.eventBulk.events.length>0){var u=function(t,e){var r=null;return e.forEach((function(e){(!r||e._meta.lwt>r._meta.lwt||e._meta.lwt===r._meta.lwt&&e[t]>r[t])&&(r=e)})),l(r)}(r.primaryPath,Object.values(i.success));c.eventBulk.checkpoint={id:u[r.primaryPath],lwt:u._meta.lwt},r.changes$.next(c.eventBulk)}return i}))}catch(t){return Promise.reject(t)}},e.findDocumentsById=function(t,e){try{var r=this;return Promise.resolve(He(r)).then((function(n){if(!n)return Ze(r,"findDocumentsById",[t,e]);var i={};return t.forEach((function(t){var o=n.collection.by(r.primaryPath,t);!o||o._deleted&&!e||(i[t]=rr(o))})),i}))}catch(t){return Promise.reject(t)}},e.query=function(t){try{var e=this;return Promise.resolve(He(e)).then((function(r){if(!r)return Ze(e,"query",[t]);var n=r.collection.chain().find(t.selector);return t.sort&&(n=n.sort(ar(e.schema,t))),t.skip&&(n=n.offset(t.skip)),t.limit&&(n=n.limit(t.limit)),{documents:n.data().map((function(t){return rr(t)}))}}))}catch(t){return Promise.reject(t)}},e.count=function(t){try{return Promise.resolve(this.query(t)).then((function(t){return{count:t.documents.length,mode:"fast"}}))}catch(t){return Promise.reject(t)}},e.getAttachmentData=function(t,e){throw new Error("Attachments are not implemented in the lokijs RxStorage. Make a pull request.")},e.getChangedDocumentsSince=function(t,e){try{var r=this;return Promise.resolve(He(r)).then((function(n){if(!n)return Ze(r,"getChangedDocumentsSince",[t,e]);var i=e?e.lwt:1,o=n.collection.chain().find({"_meta.lwt":{$gte:i}}).sort(d(r.primaryPath)).data(),s=o[0];e&&s&&s[r.primaryPath]===e.id&&s._meta.lwt===e.lwt&&o.shift(),o=o.slice(0,t);var a,c=(a=o)[a.length-1];return{documents:o.map((function(t){return rr(t)})),checkpoint:c?{id:c[r.primaryPath],lwt:c._meta.lwt}:e||{id:"",lwt:0}}}))}catch(t){return Promise.reject(t)}},e.changeStream=function(){return this.changes$.asObservable()},e.cleanup=function(t){try{var e=this;return Promise.resolve(He(e)).then((function(r){if(!r)return Ze(e,"cleanup",[t]);var n=s()-t,i=r.collection.chain().find({_deleted:!0,"_meta.lwt":{$lt:n}}).limit(10).data();return i.length>0&&(r.collection.remove(i),r.databaseState.saveQueue.addWrite()),10!==i.length}))}catch(t){return Promise.reject(t)}},e.close=function(){try{var t=this;if(t.closed)return Promise.reject(new Error("already closed"));t.closed=!0,t.changes$.complete(),nr.delete(t);var e=function(){if(t.internals.localState)return Promise.resolve(t.internals.localState).then((function(e){return Promise.resolve(sr(t.databaseName,t.databaseSettings)).then((function(r){return Promise.resolve(r.saveQueue.run()).then((function(){return Promise.resolve(function(t,e){try{return Promise.resolve(or.get(t)).then((function(r){if(r)return Promise.resolve(r.saveQueue.run()).then((function(){e.forEach((function(t){var e=t.name;delete r.collections[e]}));var n=function(){if(0===Object.keys(r.collections).length)return or.delete(t),r.unloads.forEach((function(t){return t.remove()})),Promise.resolve(new Promise((function(t,e){r.database.close((function(r){r?e(r):t()}))}))).then((function(){}))}();if(n&&n.then)return n.then((function(){}))}))}))}catch(t){return Promise.reject(t)}}(t.databaseName,[e.collection])).then((function(){}))}))}))}))}();return Promise.resolve(e&&e.then?e.then((function(){})):void 0)}catch(t){return Promise.reject(t)}},e.remove=function(){try{var t=this;return Promise.resolve(He(t)).then((function(e){return e?(e.databaseState.database.removeCollection(e.collection.name),Promise.resolve(e.databaseState.saveQueue.run()).then((function(){return t.close()}))):Ze(t,"remove",[])}))}catch(t){return Promise.reject(t)}},e.conflictResultionTasks=function(){return new et},e.resolveConflictResultionTask=function(t){return Promise.resolve()},t}(),vr={prepareQuery:function(t,e){return e=h(e),Object.keys(l(e.selector)).length>0?e.selector={$and:[{_deleted:!1},e.selector]}:e.selector={_deleted:!1},e},getSortComparator:function(t,e){return ar(0,e)},getQueryMatcher:function(t,r){return function(t){if(t._deleted)return!1;var n=h(t);n._deleted=!!n._deleted;var i={data:[n],binaryIndices:{}};Object.setPrototypeOf(i,e().Collection.prototype);var o={collection:i};return Object.setPrototypeOf(o,e().Resultset.prototype),o.find(r.selector,!0),o.filteredrows.length>0}},checkpointSchema:{type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}},mr=function(){function t(t){this.name=er,this.statics=vr,this.leaderElectorByLokiDbName=new Map,this.databaseSettings=t}return t.prototype.createStorageInstance=function(t){return function(t){if(t.schema.keyCompression)throw vt("UT5",{args:{params:t}});if((e=t.schema).encrypted&&e.encrypted.length>0||e.attachments&&e.attachments.encrypted)throw vt("UT6",{args:{params:t}});var e}(t),hr(this,t,this.databaseSettings)},t}();var br=r(1934);const gr=br.expose;br.registerSerializer,br.Transfer;var wr,Sr,Ir,Pr,Or=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=new mr(t);return e}({adapter:new(r(6194))});wr={storage:Or},Sr=0,Ir=new Map,Pr={createStorageInstance:function(t){try{var e=Sr++;return Promise.resolve(wr.storage.createStorageInstance(t)).then((function(t){return Ir.set(e,t),e}))}catch(t){return Promise.reject(t)}},bulkWrite:function(t,e,r){return p(Ir,t).bulkWrite(e,r)},findDocumentsById:function(t,e,r){return p(Ir,t).findDocumentsById(e,r)},query:function(t,e){return p(Ir,t).query(e)},count:function(t,e){return p(Ir,t).count(e)},getAttachmentData:function(t,e,r){return p(Ir,t).getAttachmentData(e,r)},getChangedDocumentsSince:function(t,e,r){return p(Ir,t).getChangedDocumentsSince(e,r)},changeStream:function(t){return p(Ir,t).changeStream()},cleanup:function(t,e){return p(Ir,t).cleanup(e)},close:function(t){return p(Ir,t).close()},remove:function(t){return p(Ir,t).remove()},conflictResultionTasks:function(t){return p(Ir,t).conflictResultionTasks()},resolveConflictResultionTask:function(t,e){return p(Ir,t).resolveConflictResultionTask(e)}},gr(Pr)})()})();
//# sourceMappingURL=lokijs-fs.worker.js.map