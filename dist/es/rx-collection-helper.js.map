{"version":3,"file":"rx-collection-helper.js","names":["createRevision","getDefaultRxDocumentMeta","fillPrimaryKey","createRxCollectionStorageInstance","rxDatabase","storageInstanceCreationParams","multiInstance","storage","createStorageInstance","fillObjectDataBeforeInsert","schema","data","useJson","fillObjectWithDefaults","primaryPath","jsonSchema","_meta","hasOwnProperty","_deleted","_attachments","_rev"],"sources":["../../src/rx-collection-helper.ts"],"sourcesContent":["import type {\n    RxDatabase,\n    RxDocumentData,\n    RxStorageInstance,\n    RxStorageInstanceCreationParams\n} from './types';\nimport { createRevision, getDefaultRxDocumentMeta } from './util';\nimport {\n    fillPrimaryKey\n} from './rx-schema-helper';\nimport type { RxSchema } from './rx-schema';\n\n/**\n * fills in the default data.\n * This also clones the data.\n */\nexport function fillObjectDataBeforeInsert<RxDocType>(\n    schema: RxSchema<RxDocType>,\n    data: Partial<RxDocumentData<RxDocType>> | any\n): RxDocumentData<RxDocType> {\n    let useJson = schema.fillObjectWithDefaults(data);\n    useJson = fillPrimaryKey(\n        schema.primaryPath,\n        schema.jsonSchema,\n        useJson\n    );\n    useJson._meta = getDefaultRxDocumentMeta();\n    if (!useJson.hasOwnProperty('_deleted')) {\n        useJson._deleted = false;\n    }\n    if (!useJson.hasOwnProperty('_attachments')) {\n        useJson._attachments = {};\n    }\n    if (!useJson.hasOwnProperty('_rev')) {\n        useJson._rev = createRevision(useJson);\n    }\n    return useJson;\n}\n\n/**\n * Creates the storage instances that are used internally in the collection\n */\nexport async function createRxCollectionStorageInstance<RxDocumentType, Internals, InstanceCreationOptions>(\n    rxDatabase: RxDatabase<{}, Internals, InstanceCreationOptions>,\n    storageInstanceCreationParams: RxStorageInstanceCreationParams<RxDocumentType, InstanceCreationOptions>\n): Promise<RxStorageInstance<RxDocumentType, Internals, InstanceCreationOptions>> {\n    storageInstanceCreationParams.multiInstance = rxDatabase.multiInstance;\n    const storageInstance = await rxDatabase.storage.createStorageInstance<RxDocumentType>(\n        storageInstanceCreationParams\n    );\n    return storageInstance;\n}\n"],"mappings":"AAMA,SAASA,cAAT,EAAyBC,wBAAzB,QAAyD,QAAzD;AACA,SACIC,cADJ,QAEO,oBAFP;;AAgCA;AACA;AACA;AACA,WAAsBC,iCAAtB,YAAsBA,iCAAtB,CACIC,UADJ,EAEIC,6BAFJ;EAAA,IAGkF;IAC9EA,6BAA6B,CAACC,aAA9B,GAA8CF,UAAU,CAACE,aAAzD;IAD8E,uBAEhDF,UAAU,CAACG,OAAX,CAAmBC,qBAAnB,CAC1BH,6BAD0B,CAFgD;EAMjF,CATD;IAAA;EAAA;AAAA;;AA9BA;AACA;AACA;AACA;AACA,OAAO,SAASI,0BAAT,CACHC,MADG,EAEHC,IAFG,EAGsB;EACzB,IAAIC,OAAO,GAAGF,MAAM,CAACG,sBAAP,CAA8BF,IAA9B,CAAd;EACAC,OAAO,GAAGV,cAAc,CACpBQ,MAAM,CAACI,WADa,EAEpBJ,MAAM,CAACK,UAFa,EAGpBH,OAHoB,CAAxB;EAKAA,OAAO,CAACI,KAAR,GAAgBf,wBAAwB,EAAxC;;EACA,IAAI,CAACW,OAAO,CAACK,cAAR,CAAuB,UAAvB,CAAL,EAAyC;IACrCL,OAAO,CAACM,QAAR,GAAmB,KAAnB;EACH;;EACD,IAAI,CAACN,OAAO,CAACK,cAAR,CAAuB,cAAvB,CAAL,EAA6C;IACzCL,OAAO,CAACO,YAAR,GAAuB,EAAvB;EACH;;EACD,IAAI,CAACP,OAAO,CAACK,cAAR,CAAuB,MAAvB,CAAL,EAAqC;IACjCL,OAAO,CAACQ,IAAR,GAAepB,cAAc,CAACY,OAAD,CAA7B;EACH;;EACD,OAAOA,OAAP;AACH"}