{"version":3,"file":"validate-ajv.js","names":["Ajv","newRxError","wrappedValidateStorageFactory","ajv","strict","wrappedValidateAjvStorage","schema","validator","compile","docData","isValid","errors","document"],"sources":["../../../src/plugins/validate-ajv.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using ajv as jsonschema-validator\n * @link https://github.com/epoberezkin/ajv\n */\nimport Ajv from 'ajv';\nimport {\n    newRxError\n} from '../rx-error';\nimport type {\n    RxDocumentData,\n    RxJsonSchema\n} from '../types';\nimport { wrappedValidateStorageFactory } from '../plugin-helpers';\n\n\nconst ajv = new Ajv({\n    strict: false\n});\n\nexport const wrappedValidateAjvStorage = wrappedValidateStorageFactory(\n    (schema: RxJsonSchema<any>) => {\n        const validator = ajv.compile(schema);\n        return (docData: RxDocumentData<any>) => {\n            const isValid = validator(docData);\n            if (!isValid) {\n                throw newRxError('VD2', {\n                    errors: validator.errors as any,\n                    document: docData,\n                    schema\n                });\n            }\n        };\n    },\n    'ajv'\n);\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,GAAP,MAAgB,KAAhB;AACA,SACIC,UADJ,QAEO,aAFP;AAOA,SAASC,6BAAT,QAA8C,mBAA9C;AAGA,IAAMC,GAAG,GAAG,IAAIH,GAAJ,CAAQ;EAChBI,MAAM,EAAE;AADQ,CAAR,CAAZ;AAIA,OAAO,IAAMC,yBAAyB,GAAGH,6BAA6B,CAClE,UAACI,MAAD,EAA+B;EAC3B,IAAMC,SAAS,GAAGJ,GAAG,CAACK,OAAJ,CAAYF,MAAZ,CAAlB;EACA,OAAO,UAACG,OAAD,EAAkC;IACrC,IAAMC,OAAO,GAAGH,SAAS,CAACE,OAAD,CAAzB;;IACA,IAAI,CAACC,OAAL,EAAc;MACV,MAAMT,UAAU,CAAC,KAAD,EAAQ;QACpBU,MAAM,EAAEJ,SAAS,CAACI,MADE;QAEpBC,QAAQ,EAAEH,OAFU;QAGpBH,MAAM,EAANA;MAHoB,CAAR,CAAhB;IAKH;EACJ,CATD;AAUH,CAbiE,EAclE,KAdkE,CAA/D"}