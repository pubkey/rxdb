{"version":3,"file":"migration-state.js","names":["BehaviorSubject","ensureNotFalsy","DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE","WeakMap","getMigrationStateByDatabase","database","has","set","subject","get","onDatabaseDestroy","complete"],"sources":["../../../../src/plugins/migration/migration-state.ts"],"sourcesContent":["import {\n    BehaviorSubject,\n    Observable\n} from 'rxjs';\nimport type {\n    MigrationState,\n    RxCollection,\n    RxDatabase\n} from '../../types';\nimport { ensureNotFalsy } from '../../plugins/utils';\n\nexport type MigrationStateWithCollection = {\n    collection: RxCollection;\n    state: MigrationState;\n};\n\nexport const DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE = new WeakMap<RxDatabase, BehaviorSubject<Observable<MigrationStateWithCollection>[]>>();\n\nexport function getMigrationStateByDatabase(database: RxDatabase): BehaviorSubject<Observable<MigrationStateWithCollection>[]> {\n    if (!DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.has(database)) {\n        DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.set(\n            database,\n            new BehaviorSubject<Observable<MigrationStateWithCollection>[]>([])\n        );\n    }\n    const subject = DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.get(database);\n    return ensureNotFalsy(subject);\n}\n\n/**\n * Complete on database destroy\n * so people do not have to unsubscribe\n */\nexport function onDatabaseDestroy(database: RxDatabase) {\n    const subject = DATA_MIGRATION_STATE_SUBJECT_BY_DATABASE.get(database);\n    if (subject) {\n        subject.complete();\n    }\n}\n"],"mappings":"AAAA,SACIA,eAAe,QAEZ,MAAM;AAMb,SAASC,cAAc,QAAQ,qBAAqB;AAOpD,OAAO,IAAMC,wCAAwC,GAAG,IAAIC,OAAO,EAA2E;AAE9I,OAAO,SAASC,2BAA2B,CAACC,QAAoB,EAA+D;EAC3H,IAAI,CAACH,wCAAwC,CAACI,GAAG,CAACD,QAAQ,CAAC,EAAE;IACzDH,wCAAwC,CAACK,GAAG,CACxCF,QAAQ,EACR,IAAIL,eAAe,CAA6C,EAAE,CAAC,CACtE;EACL;EACA,IAAMQ,OAAO,GAAGN,wCAAwC,CAACO,GAAG,CAACJ,QAAQ,CAAC;EACtE,OAAOJ,cAAc,CAACO,OAAO,CAAC;AAClC;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASE,iBAAiB,CAACL,QAAoB,EAAE;EACpD,IAAMG,OAAO,GAAGN,wCAAwC,CAACO,GAAG,CAACJ,QAAQ,CAAC;EACtE,IAAIG,OAAO,EAAE;IACTA,OAAO,CAACG,QAAQ,EAAE;EACtB;AACJ"}