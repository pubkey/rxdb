{"version":3,"file":"firestore-helper.js","names":["Timestamp","flatClone","now","FIRESTORE_REPLICATION_PLUGIN_IDENTITY_PREFIX","getFirestoreSortFieldValue","docData","primaryKey","timeString","padStart","stripServerTimestampField","serverTimestampField","data","serverTimestampToIsoString","timestamp","date","toDate","toISOString","isoStringToServerTimestamp","isoString","Date","fromDate","firestoreRowToDocData","primaryPath","row","id","stripPrimaryKey"],"sources":["../../../../src/plugins/replication-firestore/firestore-helper.ts"],"sourcesContent":["import {\n    QueryDocumentSnapshot,\n    Timestamp\n} from 'firebase/firestore';\nimport type {\n    WithDeleted\n} from '../../types';\nimport { flatClone, now } from '../../util';\n\nexport const FIRESTORE_REPLICATION_PLUGIN_IDENTITY_PREFIX = 'rxdb-replication-firestore-';\n\n\nexport function getFirestoreSortFieldValue(docData: any, primaryKey: string): string {\n    const timeString = now() + '';\n    return 'rxdb-' + timeString.padStart(15, '0') + '-' + docData[primaryKey];\n}\n\nexport function stripServerTimestampField<RxDocType>(\n    serverTimestampField: string,\n    docData: RxDocType\n): WithDeleted<RxDocType> {\n    const data = flatClone(docData);\n    delete (data as any)[serverTimestampField];\n    return data as any;\n}\n\n\nexport function serverTimestampToIsoString(serverTimestampField: string, docData: any): string {\n    const timestamp = (docData as any)[serverTimestampField];\n    const date: Date = timestamp.toDate();\n    return date.toISOString();\n}\n\nexport function isoStringToServerTimestamp(isoString: string): Timestamp {\n    const date = new Date(isoString);\n    return Timestamp.fromDate(date);\n}\n\nexport function firestoreRowToDocData<RxDocType>(\n    serverTimestampField: string,\n    primaryPath: string,\n    row: QueryDocumentSnapshot<RxDocType>\n): WithDeleted<RxDocType> {\n    const docData = stripServerTimestampField(\n        serverTimestampField,\n        row.data()\n    );\n    (docData as any)[primaryPath] = row.id;\n    return docData;\n}\n\nexport function stripPrimaryKey(\n    primaryPath: string,\n    docData: any\n): any {\n    docData = flatClone(docData);\n    delete (docData as any)[primaryPath];\n    return docData;\n}\n"],"mappings":"AAAA,SAEIA,SAAS,QACN,oBAAoB;AAI3B,SAASC,SAAS,EAAEC,GAAG,QAAQ,YAAY;AAE3C,OAAO,IAAMC,4CAA4C,GAAG,6BAA6B;AAGzF,OAAO,SAASC,0BAA0B,CAACC,OAAY,EAAEC,UAAkB,EAAU;EACjF,IAAMC,UAAU,GAAGL,GAAG,EAAE,GAAG,EAAE;EAC7B,OAAO,OAAO,GAAGK,UAAU,CAACC,QAAQ,CAAC,EAAE,EAAE,GAAG,CAAC,GAAG,GAAG,GAAGH,OAAO,CAACC,UAAU,CAAC;AAC7E;AAEA,OAAO,SAASG,yBAAyB,CACrCC,oBAA4B,EAC5BL,OAAkB,EACI;EACtB,IAAMM,IAAI,GAAGV,SAAS,CAACI,OAAO,CAAC;EAC/B,OAAQM,IAAI,CAASD,oBAAoB,CAAC;EAC1C,OAAOC,IAAI;AACf;AAGA,OAAO,SAASC,0BAA0B,CAACF,oBAA4B,EAAEL,OAAY,EAAU;EAC3F,IAAMQ,SAAS,GAAIR,OAAO,CAASK,oBAAoB,CAAC;EACxD,IAAMI,IAAU,GAAGD,SAAS,CAACE,MAAM,EAAE;EACrC,OAAOD,IAAI,CAACE,WAAW,EAAE;AAC7B;AAEA,OAAO,SAASC,0BAA0B,CAACC,SAAiB,EAAa;EACrE,IAAMJ,IAAI,GAAG,IAAIK,IAAI,CAACD,SAAS,CAAC;EAChC,OAAOlB,SAAS,CAACoB,QAAQ,CAACN,IAAI,CAAC;AACnC;AAEA,OAAO,SAASO,qBAAqB,CACjCX,oBAA4B,EAC5BY,WAAmB,EACnBC,GAAqC,EACf;EACtB,IAAMlB,OAAO,GAAGI,yBAAyB,CACrCC,oBAAoB,EACpBa,GAAG,CAACZ,IAAI,EAAE,CACb;EACAN,OAAO,CAASiB,WAAW,CAAC,GAAGC,GAAG,CAACC,EAAE;EACtC,OAAOnB,OAAO;AAClB;AAEA,OAAO,SAASoB,eAAe,CAC3BH,WAAmB,EACnBjB,OAAY,EACT;EACHA,OAAO,GAAGJ,SAAS,CAACI,OAAO,CAAC;EAC5B,OAAQA,OAAO,CAASiB,WAAW,CAAC;EACpC,OAAOjB,OAAO;AAClB"}