{"version":3,"file":"validate-z-schema.js","names":["ZSchema","newRxError","wrappedValidateStorageFactory","getValidator","schema","validatorInstance","validator","obj","validate","docData","useValidator","errors","getLastErrors","formattedZSchemaErrors","map","title","description","message","document","wrappedValidateZSchemaStorage"],"sources":["../../../src/plugins/validate-z-schema.ts"],"sourcesContent":["/**\n * this plugin validates documents before they can be inserted into the RxCollection.\n * It's using z-schema as jsonschema-validator\n * @link https://github.com/zaggino/z-schema\n */\nimport ZSchema from 'z-schema';\nimport {\n    newRxError\n} from '../rx-error';\nimport type { RxJsonSchema } from '../types';\nimport { wrappedValidateStorageFactory } from '../plugin-helpers';\n\n\nexport function getValidator(\n    schema: RxJsonSchema<any>\n) {\n    const validatorInstance = new (ZSchema as any)();\n    const validator = (obj: any) => {\n        validatorInstance.validate(obj, schema);\n        return validatorInstance;\n    };\n    return (docData: any) => {\n        const useValidator = validator(docData);\n        if (useValidator === true) {\n            return;\n        }\n        const errors: ZSchema.SchemaErrorDetail[] = (useValidator as any).getLastErrors();\n        if (errors) {\n            const formattedZSchemaErrors = (errors as any).map(({\n                title,\n                description,\n                message\n            }: any) => ({\n                title,\n                description,\n                message\n            }));\n            throw newRxError('VD2', {\n                errors: formattedZSchemaErrors,\n                document: docData,\n                schema\n            });\n        }\n    };\n}\n\nexport const wrappedValidateZSchemaStorage = wrappedValidateStorageFactory(\n    getValidator,\n    'z-schema'\n);\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA,OAAOA,OAAP,MAAoB,UAApB;AACA,SACIC,UADJ,QAEO,aAFP;AAIA,SAASC,6BAAT,QAA8C,mBAA9C;AAGA,OAAO,SAASC,YAAT,CACHC,MADG,EAEL;EACE,IAAMC,iBAAiB,GAAG,IAAKL,OAAL,EAA1B;;EACA,IAAMM,SAAS,GAAG,SAAZA,SAAY,CAACC,GAAD,EAAc;IAC5BF,iBAAiB,CAACG,QAAlB,CAA2BD,GAA3B,EAAgCH,MAAhC;IACA,OAAOC,iBAAP;EACH,CAHD;;EAIA,OAAO,UAACI,OAAD,EAAkB;IACrB,IAAMC,YAAY,GAAGJ,SAAS,CAACG,OAAD,CAA9B;;IACA,IAAIC,YAAY,KAAK,IAArB,EAA2B;MACvB;IACH;;IACD,IAAMC,MAAmC,GAAID,YAAD,CAAsBE,aAAtB,EAA5C;;IACA,IAAID,MAAJ,EAAY;MACR,IAAME,sBAAsB,GAAIF,MAAD,CAAgBG,GAAhB,CAAoB;QAAA,IAC/CC,KAD+C,QAC/CA,KAD+C;QAAA,IAE/CC,WAF+C,QAE/CA,WAF+C;QAAA,IAG/CC,OAH+C,QAG/CA,OAH+C;QAAA,OAIvC;UACRF,KAAK,EAALA,KADQ;UAERC,WAAW,EAAXA,WAFQ;UAGRC,OAAO,EAAPA;QAHQ,CAJuC;MAAA,CAApB,CAA/B;MASA,MAAMhB,UAAU,CAAC,KAAD,EAAQ;QACpBU,MAAM,EAAEE,sBADY;QAEpBK,QAAQ,EAAET,OAFU;QAGpBL,MAAM,EAANA;MAHoB,CAAR,CAAhB;IAKH;EACJ,CAtBD;AAuBH;AAED,OAAO,IAAMe,6BAA6B,GAAGjB,6BAA6B,CACtEC,YADsE,EAEtE,UAFsE,CAAnE"}