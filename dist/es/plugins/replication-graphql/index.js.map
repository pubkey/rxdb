{"version":3,"sources":["../../../../src/plugins/replication-graphql/index.ts"],"names":["GraphQLClient","objectPath","flatClone","hash","DEFAULT_MODIFIER","GRAPHQL_REPLICATION_PLUGIN_IDENTITY_PREFIX","RxDBLeaderElectionPlugin","overwritable","replicateRxCollection","RxReplicationPullError","RxReplicationPushError","newRxError","addRxPlugin","RxGraphQLReplicationState","replicationState","collection","url","clientState","send$","undefined","error$","canceled$","active$","received$","subjects","received","asObservable","send","error","canceled","active","initialReplicationComplete$","isStopped","awaitInitialReplication","run","retryOnFail","cancel","setHeaders","headers","client","syncGraphQL","waitForLeadership","pull","push","deletedFlag","live","liveInterval","retryTime","autoStart","pullModifier","modifier","pushModifier","mutateableClientState","replicationPrimitivesPull","handler","latestPulledDocument","queryBuilder","pullGraphQL","query","variables","result","errors","tunnelErrorMessage","dataPath","Object","keys","data","docsData","get","length","documents","hasMoreDocuments","batchSize","args","Promise","all","map","doc","isDeleted","_deleted","modified","filter","replicationPrimitivesPush","docs","changedDoc","modifiedPushDocs","pushObj","replicationIdentifier","graphqlReplicationState","RxDBReplicationGraphQLPlugin","name","init","rxdb","prototypes","RxCollection","proto"],"mappings":"AAAA;AACA;AACA;AACA;AAKA,OAAOA,aAAP,MAA0B,gBAA1B;AACA,OAAOC,UAAP,MAAuB,aAAvB;AACA,SACIC,SADJ,QAEO,YAFP;AAIA,SACIC,IADJ,QAEO,YAFP;AAIA,SACIC,gBADJ,EAEIC,0CAFJ,QAGO,UAHP;AAKA,SAASC,wBAAT,QAAyC,oBAAzC;AACA,SACIC,YADJ,QAEO,oBAFP;AAUA,SAASC,qBAAT,QAA8D,gBAA9D;AACA,SAEIC,sBAFJ,EAGIC,sBAHJ,QAIO,qCAJP;AAKA,SAASC,UAAT,QAA2B,gBAA3B;AACA,SAASC,WAAT,QAAgD,aAAhD;AAEA,WAAaC,yBAAb;AASI;AACI;AACR;AACA;AACA;AACwBC,EAAAA,gBALpB,EAMoBC,UANpB,EAOoBC,GAPpB,EAQoBC,WARpB,EASE;AAAA,SAfKC,KAeL,GAf8BC,SAe9B;AAAA,SAdKC,MAcL,GAdyDD,SAczD;AAAA,SAbKE,SAaL,GAbsCF,SAatC;AAAA,SAZKG,OAYL,GAZoCH,SAYpC;AAAA,SAJkBL,gBAIlB,GAJkBA,gBAIlB;AAAA,SAHkBC,UAGlB,GAHkBA,UAGlB;AAAA,SAFkBC,GAElB,GAFkBA,GAElB;AAAA,SADkBC,WAClB,GADkBA,WAClB;AACE;AACA,SAAKM,SAAL,GAAiBT,gBAAgB,CAACU,QAAjB,CAA0BC,QAA1B,CAAmCC,YAAnC,EAAjB;AACA,SAAKR,KAAL,GAAaJ,gBAAgB,CAACU,QAAjB,CAA0BG,IAA1B,CAA+BD,YAA/B,EAAb;AACA,SAAKN,MAAL,GAAcN,gBAAgB,CAACU,QAAjB,CAA0BI,KAA1B,CAAgCF,YAAhC,EAAd;AACA,SAAKL,SAAL,GAAiBP,gBAAgB,CAACU,QAAjB,CAA0BK,QAA1B,CAAmCH,YAAnC,EAAjB;AACA,SAAKJ,OAAL,GAAeR,gBAAgB,CAACU,QAAjB,CAA0BM,MAA1B,CAAiCJ,YAAjC,EAAf;AACA,SAAKK,2BAAL,GAAmCjB,gBAAgB,CAACiB,2BAApD;AACH;;AA1BL;;AAAA,SA6BIC,SA7BJ,GA6BI,qBAAqB;AACjB,WAAO,KAAKlB,gBAAL,CAAsBkB,SAAtB,EAAP;AACH,GA/BL;;AAAA,SAiCIC,uBAjCJ,GAiCI,mCAAyC;AACrC,WAAO,KAAKnB,gBAAL,CAAsBmB,uBAAtB,EAAP;AACH,GAnCL;;AAAA,SAqCIC,GArCJ,GAqCI,eAAuC;AAAA,QAAnCC,WAAmC,uEAArB,IAAqB;AACnC,WAAO,KAAKrB,gBAAL,CAAsBoB,GAAtB,CAA0BC,WAA1B,CAAP;AACH,GAvCL;;AAAA,SAyCIC,MAzCJ,GAyCI,kBAAuB;AACnB,WAAO,KAAKtB,gBAAL,CAAsBsB,MAAtB,EAAP;AACH,GA3CL;;AAAA,SA6CIC,UA7CJ,GA6CI,oBAAWC,OAAX,EAAmD;AAC/C,SAAKrB,WAAL,CAAiBsB,MAAjB,GAA0BvC,aAAa,CAAC;AACpCgB,MAAAA,GAAG,EAAE,KAAKA,GAD0B;AAEpCsB,MAAAA,OAAO,EAAPA;AAFoC,KAAD,CAAvC;AAIH,GAlDL;;AAAA;AAAA;AAqDA,OAAO,SAASE,WAAT,OAciC;AAAA,MAXhCxB,GAWgC,QAXhCA,GAWgC;AAAA,0BAVhCsB,OAUgC;AAAA,MAVhCA,OAUgC,6BAVtB,EAUsB;AAAA,mCAThCG,iBASgC;AAAA,MAThCA,iBASgC,sCATZ,IASY;AAAA,MARhCC,IAQgC,QARhCA,IAQgC;AAAA,MAPhCC,IAOgC,QAPhCA,IAOgC;AAAA,8BANhCC,WAMgC;AAAA,MANhCA,WAMgC,iCANlB,UAMkB;AAAA,uBALhCC,IAKgC;AAAA,MALhCA,IAKgC,0BALzB,KAKyB;AAAA,+BAJhCC,YAIgC;AAAA,MAJhCA,YAIgC,kCAJjB,OAAO,EAIU;AAAA,4BAHhCC,SAGgC;AAAA,MAHhCA,SAGgC,+BAHpB,OAAO,CAGa;AAAA,4BAFhCC,SAEgC;AAAA,MAFhCA,SAEgC,+BAFpB,IAEoB;AACpC,MAAMjC,UAAU,GAAG,IAAnB,CADoC,CAGpC;;AACA,MAAMkC,YAAY,GAAGP,IAAI,IAAIA,IAAI,CAACQ,QAAb,GAAwBR,IAAI,CAACQ,QAA7B,GAAwC9C,gBAA7D;AACA,MAAM+C,YAAY,GAAGR,IAAI,IAAIA,IAAI,CAACO,QAAb,GAAwBP,IAAI,CAACO,QAA7B,GAAwC9C,gBAA7D;AAEA;AACJ;AACA;AACA;;AACI,MAAMgD,qBAAqB,GAAG;AAC1Bb,IAAAA,MAAM,EAAEvC,aAAa,CAAC;AAClBgB,MAAAA,GAAG,EAAHA,GADkB;AAElBsB,MAAAA,OAAO,EAAPA;AAFkB,KAAD;AADK,GAA9B;AAOA,MAAIe,yBAAJ;;AACA,MAAIX,IAAJ,EAAU;AACNW,IAAAA,yBAAyB,GAAG;AAClBC,MAAAA,OADkB,mBACVC,oBADU;AAAA,YACY;AAAA,iCACNb,IAAI,CAACc,YAAL,CAAkBD,oBAAlB,CADM,iBAC1BE,WAD0B;AAAA,mCAEXL,qBAAqB,CAACb,MAAtB,CAA6BmB,KAA7B,CAAmCD,WAAW,CAACC,KAA/C,EAAsDD,WAAW,CAACE,SAAlE,CAFW,iBAE1BC,MAF0B;AAGhC,kBAAIA,MAAM,CAACC,MAAX,EAAmB;AACf,oBAAI,OAAOD,MAAM,CAACC,MAAd,KAAyB,QAA7B,EAAuC;AACnC,wBAAM,IAAIpD,sBAAJ,CACFmD,MAAM,CAACC,MADL,EAEFN,oBAFE,CAAN;AAIH,iBALD,MAKO;AACH,wBAAM,IAAI9C,sBAAJ,CACFF,YAAY,CAACuD,kBAAb,CAAgC,MAAhC,CADE,EAEFP,oBAFE,EAGFK,MAAM,CAACC,MAHL,CAAN;AAKH;AACJ;;AAED,kBAAME,QAAQ,GAAGrB,IAAI,CAACqB,QAAL,IAAiB,CAAC,MAAD,EAASC,MAAM,CAACC,IAAP,CAAYL,MAAM,CAACM,IAAnB,EAAyB,CAAzB,CAAT,CAAlC;AACA,kBAAMC,QAAe,GAAGlE,UAAU,CAACmE,GAAX,CAAeR,MAAf,EAAuBG,QAAvB,CAAxB,CAnBgC,CAqBhC;;AACA,kBAAII,QAAQ,CAACE,MAAT,KAAoB,CAAxB,EAA2B;AACvB,uBAAO;AACHC,kBAAAA,SAAS,EAAE,EADR;AAEHC,kBAAAA,gBAAgB,EAAE;AAFf,iBAAP;AAIH;;AAED,kBAAIA,gBAAyB,GAAG,KAAhC;;AACA,kBAAIJ,QAAQ,CAACE,MAAT,GAAkB3B,IAAI,CAAC8B,SAA3B,EAAsC;AAClC,sBAAM7D,UAAU,CAAC,MAAD,EAAS;AACrB8D,kBAAAA,IAAI,EAAE;AACF/B,oBAAAA,IAAI,EAAJA,IADE;AAEF4B,oBAAAA,SAAS,EAAEH;AAFT;AADe,iBAAT,CAAhB;AAMH,eAPD,MAOO,IAAIA,QAAQ,CAACE,MAAT,KAAoB3B,IAAI,CAAC8B,SAA7B,EAAwC;AAC3CD,gBAAAA,gBAAgB,GAAG,IAAnB;AACH;;AAvC+B,qCAyCDG,OAAO,CAACC,GAAR,CAAYR,QAAQ,CAC9CS,GADsC,WAC3BC,GAD2B;AAAA,oBACd;AACrB;AACA,sBAAIjC,WAAW,KAAK,UAApB,EAAgC;AAC5B,wBAAMkC,SAAS,GAAG,CAAC,CAACD,GAAG,CAACjC,WAAD,CAAvB;AACAiC,oBAAAA,GAAG,CAACE,QAAJ,GAAeD,SAAf;AACA,2BAAOD,GAAG,CAACjC,WAAD,CAAV;AACH;;AANoB,yCAQRK,YAAY,CAAC4B,GAAD,CARJ;AASxB,iBAVsC;AAAA;AAAA;AAAA,gBAAZ,CAzCC;AAyChC,oBAAMG,QAAe,GAAG,aAWrBC,MAXqB,CAWd,UAAAJ,GAAG;AAAA,yBAAI,CAAC,CAACA,GAAN;AAAA,iBAXW,CAAxB;;AAYA,uBAAO;AACHP,kBAAAA,SAAS,EAAEU,QADR;AAEHT,kBAAAA,gBAAgB,EAAhBA;AAFG,iBAAP;AArDgC;AAAA;AAAA;AAyDnC,SA1DuB;AAAA;AAAA;AAAA;AAAA,KAA5B;AA4DH;;AACD,MAAIW,yBAAJ;;AACA,MAAIvC,IAAJ,EAAU;AACNuC,IAAAA,yBAAyB,GAAG;AACxBV,MAAAA,SAAS,EAAE7B,IAAI,CAAC6B,SADQ;AAElBlB,MAAAA,OAFkB,mBAEV6B,IAFU;AAAA,YAEyB;AAAA,iCACaT,OAAO,CAACC,GAAR,CACtDQ,IAAI,CAACP,GAAL,WAAgBC,GAAhB;AAAA,gBAAwB;AACpB,kBAAIO,UAAe,GAAGlF,SAAS,CAAC2E,GAAD,CAA/B,CADoB,CAGpB;;AACA,kBAAIjC,WAAW,KAAK,UAApB,EAAgC;AAC5B,oBAAMkC,SAAS,GAAG,CAAC,CAACD,GAAG,CAACE,QAAxB;AACAK,gBAAAA,UAAU,CAACxC,WAAD,CAAV,GAA0BkC,SAA1B;AACA,uBAAOM,UAAU,CAACL,QAAlB;AACH;;AARmB,qCAUD5B,YAAY,CAACiC,UAAD,CAVX;AAUpBA,gBAAAA,UAAU,gBAAV;AACA,uBAAOA,UAAU,GAAGA,UAAH,GAAgB,IAAjC;AAXoB;AAYvB,aAZD;AAAA;AAAA;AAAA,YADsD,CADb,iBACzCC,gBADyC;AAgB7C;AAChB;AACA;AACA;AACgBA,YAAAA,gBAAgB,GAAGA,gBAAgB,CAACJ,MAAjB,CAAwB,UAAAJ,GAAG;AAAA,qBAAI,CAAC,CAACA,GAAN;AAAA,aAA3B,CAAnB;AAEA;AAChB;AACA;AACA;AACA;AACA;;AACgB,gBAAIQ,gBAAgB,CAAChB,MAAjB,KAA4B,CAAhC,EAAmC;AAC/B;AACH;;AA9B4C,mCAgCvB1B,IAAI,CAACa,YAAL,CAAkB6B,gBAAlB,CAhCuB,iBAgCvCC,OAhCuC;AAAA,qCAiCxBlC,qBAAqB,CAACb,MAAtB,CAA6BmB,KAA7B,CAAmC4B,OAAO,CAAC5B,KAA3C,EAAkD4B,OAAO,CAAC3B,SAA1D,CAjCwB,iBAiCvCC,MAjCuC;AAAA,oBAkCzCA,MAAM,CAACC,MAlCkC;AAAA,sBAmCrC,OAAOD,MAAM,CAACC,MAAd,KAAyB,QAnCY;AAoCrC,0BAAM,IAAInD,sBAAJ,CACFkD,MAAM,CAACC,MADL,EAEFsB,IAFE,CAAN;AApCqC;AAyCrC,0BAAM,IAAIzE,sBAAJ,CACFH,YAAY,CAACuD,kBAAb,CAAgC,MAAhC,CADE,EAEFqB,IAFE,EAGFvB,MAAM,CAACC,MAHL,CAAN;AAzCqC;AAAA;AAAA;AAAA;AAAA;AAgDhD,SAlDuB;AAAA;AAAA;AAAA;AAAA,KAA5B;AAoDH;;AAED,MAAM/C,gBAAgB,GAAGN,qBAAqB,CAAY;AACtD+E,IAAAA,qBAAqB,EAAElF,0CAA0C,GAAGF,IAAI,CAACa,GAAD,CADlB;AAEtDD,IAAAA,UAAU,EAAVA,UAFsD;AAGtD6B,IAAAA,WAAW,EAAXA,WAHsD;AAItDF,IAAAA,IAAI,EAAEW,yBAJgD;AAKtDV,IAAAA,IAAI,EAAEuC,yBALgD;AAMtDzC,IAAAA,iBAAiB,EAAjBA,iBANsD;AAOtDI,IAAAA,IAAI,EAAJA,IAPsD;AAQtDC,IAAAA,YAAY,EAAZA,YARsD;AAStDC,IAAAA,SAAS,EAATA,SATsD;AAUtDC,IAAAA,SAAS,EAATA;AAVsD,GAAZ,CAA9C;AAaA,MAAMwC,uBAAuB,GAAG,IAAI3E,yBAAJ,CAC5BC,gBAD4B,EAE5BC,UAF4B,EAG5BC,GAH4B,EAI5BoC,qBAJ4B,CAAhC;AAOA,SAAOoC,uBAAP;AACH;AAED,cAAc,UAAd;AACA,cAAc,iCAAd;AACA,cAAc,gCAAd;AAEA,OAAO,IAAMC,4BAAsC,GAAG;AAClDC,EAAAA,IAAI,EAAE,qBAD4C;AAElDC,EAAAA,IAFkD,kBAE3C;AACH/E,IAAAA,WAAW,CAACN,wBAAD,CAAX;AACH,GAJiD;AAKlDsF,EAAAA,IAAI,EAAE,IAL4C;AAMlDC,EAAAA,UAAU,EAAE;AACRC,IAAAA,YAAY,EAAE,sBAACC,KAAD,EAAgB;AAC1BA,MAAAA,KAAK,CAACvD,WAAN,GAAoBA,WAApB;AACH;AAHO;AANsC,CAA/C","sourcesContent":["/**\n * this plugin adds the RxCollection.syncGraphQl()-function to rxdb\n * you can use it to sync collections with remote graphql endpoint\n */\n\nimport type {\n    Observable\n} from 'rxjs';\nimport GraphQLClient from 'graphql-client';\nimport objectPath from 'object-path';\nimport {\n    flatClone\n} from '../../util';\n\nimport {\n    hash\n} from '../../util';\n\nimport {\n    DEFAULT_MODIFIER,\n    GRAPHQL_REPLICATION_PLUGIN_IDENTITY_PREFIX\n} from './helper';\n\nimport { RxDBLeaderElectionPlugin } from '../leader-election';\nimport {\n    overwritable\n} from '../../overwritable';\nimport type {\n    RxCollection,\n    RxPlugin,\n    RxDocumentData,\n    ReplicationPullOptions,\n    ReplicationPushOptions\n} from '../../types';\nimport { replicateRxCollection, RxReplicationStateBase } from '../replication';\nimport {\n    RxReplicationError,\n    RxReplicationPullError,\n    RxReplicationPushError\n} from '../replication/rx-replication-error';\nimport { newRxError } from '../../rx-error';\nimport { addRxPlugin, SyncOptionsGraphQL } from '../../index';\n\nexport class RxGraphQLReplicationState<RxDocType> {\n\n    public received$: Observable<RxDocumentData<RxDocType>>;\n    public send$: Observable<any> = undefined as any;\n    public error$: Observable<RxReplicationError<RxDocType>> = undefined as any;\n    public canceled$: Observable<boolean> = undefined as any;\n    public active$: Observable<boolean> = undefined as any;\n    public initialReplicationComplete$: Observable<true>;\n\n    constructor(\n        /**\n         * The GraphQL replication uses the replication primitives plugin\n         * internally. So we need that replicationState.\n         */\n        public readonly replicationState: RxReplicationStateBase<RxDocType>,\n        public readonly collection: RxCollection<RxDocType>,\n        public readonly url: string,\n        public readonly clientState: { client: any }\n    ) {\n        // map observables from replicationState to this\n        this.received$ = replicationState.subjects.received.asObservable();\n        this.send$ = replicationState.subjects.send.asObservable();\n        this.error$ = replicationState.subjects.error.asObservable();\n        this.canceled$ = replicationState.subjects.canceled.asObservable();\n        this.active$ = replicationState.subjects.active.asObservable();\n        this.initialReplicationComplete$ = replicationState.initialReplicationComplete$;\n    }\n\n\n    isStopped(): boolean {\n        return this.replicationState.isStopped();\n    }\n\n    awaitInitialReplication(): Promise<true> {\n        return this.replicationState.awaitInitialReplication();\n    }\n\n    run(retryOnFail = true): Promise<void> {\n        return this.replicationState.run(retryOnFail);\n    }\n\n    cancel(): Promise<any> {\n        return this.replicationState.cancel();\n    }\n\n    setHeaders(headers: { [k: string]: string }): void {\n        this.clientState.client = GraphQLClient({\n            url: this.url,\n            headers\n        });\n    }\n}\n\nexport function syncGraphQL<RxDocType>(\n    this: RxCollection,\n    {\n        url,\n        headers = {},\n        waitForLeadership = true,\n        pull,\n        push,\n        deletedFlag = '_deleted',\n        live = false,\n        liveInterval = 1000 * 10, // in ms\n        retryTime = 1000 * 5, // in ms\n        autoStart = true,\n    }: SyncOptionsGraphQL<RxDocType>\n): RxGraphQLReplicationState<RxDocType> {\n    const collection = this;\n\n    // fill in defaults for pull & push\n    const pullModifier = pull && pull.modifier ? pull.modifier : DEFAULT_MODIFIER;\n    const pushModifier = push && push.modifier ? push.modifier : DEFAULT_MODIFIER;\n\n    /**\n     * We use this object to store the GraphQL client\n     * so we can later swap out the client inside of the replication handlers.\n     */\n    const mutateableClientState = {\n        client: GraphQLClient({\n            url,\n            headers\n        })\n    }\n\n    let replicationPrimitivesPull: ReplicationPullOptions<RxDocType> | undefined;\n    if (pull) {\n        replicationPrimitivesPull = {\n            async handler(latestPulledDocument) {\n                const pullGraphQL = await pull.queryBuilder(latestPulledDocument);\n                const result = await mutateableClientState.client.query(pullGraphQL.query, pullGraphQL.variables);\n                if (result.errors) {\n                    if (typeof result.errors === 'string') {\n                        throw new RxReplicationPullError(\n                            result.errors,\n                            latestPulledDocument,\n                        );\n                    } else {\n                        throw new RxReplicationPullError(\n                            overwritable.tunnelErrorMessage('GQL2'),\n                            latestPulledDocument,\n                            result.errors\n                        );\n                    }\n                }\n\n                const dataPath = pull.dataPath || ['data', Object.keys(result.data)[0]];\n                const docsData: any[] = objectPath.get(result, dataPath);\n\n                // optimization shortcut, do not proceed if there are no documents.\n                if (docsData.length === 0) {\n                    return {\n                        documents: [],\n                        hasMoreDocuments: false\n                    };\n                }\n\n                let hasMoreDocuments: boolean = false;\n                if (docsData.length > pull.batchSize) {\n                    throw newRxError('GQL3', {\n                        args: {\n                            pull,\n                            documents: docsData\n                        }\n                    });\n                } else if (docsData.length === pull.batchSize) {\n                    hasMoreDocuments = true;\n                }\n\n                const modified: any[] = (await Promise.all(docsData\n                    .map(async (doc: any) => {\n                        // swap out deleted flag\n                        if (deletedFlag !== '_deleted') {\n                            const isDeleted = !!doc[deletedFlag];\n                            doc._deleted = isDeleted;\n                            delete doc[deletedFlag];\n                        }\n\n                        return await pullModifier(doc);\n                    })\n                )).filter(doc => !!doc);\n                return {\n                    documents: modified,\n                    hasMoreDocuments\n                }\n            }\n        }\n    }\n    let replicationPrimitivesPush: ReplicationPushOptions<RxDocType> | undefined;\n    if (push) {\n        replicationPrimitivesPush = {\n            batchSize: push.batchSize,\n            async handler(docs: RxDocumentData<RxDocType>[]) {\n                let modifiedPushDocs: RxDocumentData<RxDocType>[] = await Promise.all(\n                    docs.map(async (doc) => {\n                        let changedDoc: any = flatClone(doc);\n\n                        // swap out deleted flag\n                        if (deletedFlag !== '_deleted') {\n                            const isDeleted = !!doc._deleted;\n                            changedDoc[deletedFlag] = isDeleted;\n                            delete changedDoc._deleted;\n                        }\n\n                        changedDoc = await pushModifier(changedDoc);\n                        return changedDoc ? changedDoc : null;\n                    })\n                );\n                /**\n                 * The push modifier might have returned null instead of a document\n                 * which means that these documents must not be pushed and filtered out.\n                 */\n                modifiedPushDocs = modifiedPushDocs.filter(doc => !!doc) as any;\n\n                /**\n                 * Optimization shortcut.\n                 * If we have no more documents to push,\n                 * because all were filtered out by the modifier,\n                 * we can quit here.\n                 */\n                if (modifiedPushDocs.length === 0) {\n                    return;\n                }\n\n                const pushObj = await push.queryBuilder(modifiedPushDocs);\n                const result = await mutateableClientState.client.query(pushObj.query, pushObj.variables);\n                if (result.errors) {\n                    if (typeof result.errors === 'string') {\n                        throw new RxReplicationPushError(\n                            result.errors,\n                            docs\n                        );\n                    } else {\n                        throw new RxReplicationPushError(\n                            overwritable.tunnelErrorMessage('GQL4'),\n                            docs,\n                            result.errors\n                        );\n                    }\n                }\n            }\n        };\n    }\n\n    const replicationState = replicateRxCollection<RxDocType>({\n        replicationIdentifier: GRAPHQL_REPLICATION_PLUGIN_IDENTITY_PREFIX + hash(url),\n        collection,\n        deletedFlag,\n        pull: replicationPrimitivesPull,\n        push: replicationPrimitivesPush,\n        waitForLeadership,\n        live,\n        liveInterval,\n        retryTime,\n        autoStart\n    });\n\n    const graphqlReplicationState = new RxGraphQLReplicationState(\n        replicationState,\n        collection,\n        url,\n        mutateableClientState\n    );\n\n    return graphqlReplicationState;\n}\n\nexport * from './helper';\nexport * from './graphql-schema-from-rx-schema';\nexport * from './query-builder-from-rx-schema';\n\nexport const RxDBReplicationGraphQLPlugin: RxPlugin = {\n    name: 'replication-graphql',\n    init() {\n        addRxPlugin(RxDBLeaderElectionPlugin);\n    },\n    rxdb: true,\n    prototypes: {\n        RxCollection: (proto: any) => {\n            proto.syncGraphQL = syncGraphQL;\n        }\n    }\n};\n"],"file":"index.js"}