{"version":3,"file":"graphql-schema-from-rx-schema.js","names":["getGraphqlSchemaFromJsonSchema","fillWithDefaultSettings","clone","ensureNotFalsy","flatClone","ucfirst","SPACING","graphQLSchemaFromRxSchema","input","ret","asString","queries","mutations","subscriptions","inputs","types","Object","entries","forEach","collectionName","collectionSettings","fillUpOptionals","schema","prefixes","ucCollectionName","collectionNameInput","inputSchema","stripKeysFromSchema","ignoreInputKeys","inputGraphQL","rootName","direction","pushRowGraphQL","pushRow","type","properties","assumedMasterState","newDocumentState","required","additionalProperties","checkpointSchema","checkpointFields","key","subSchema","push","checkpointInputGraphQL","checkpoint","concat","typeDefinitions","map","str","replaceTopLevelTypeName","headersSchema","headerFields","headerField","headersInputName","headers","headersInputGraphQL","length","outputSchema","ignoreOutputKeys","outputGraphQL","checkpointOutputGraphQL","pullBulkOutputGraphQL","pullBulk","documents","items","queryName","pull","queryKeys","queryString","join","mutationName","mutationString","subscriptionHeaderInputString","subscriptionName","stream","subscriptionString","fullQueryString","fullMutationString","fullSubscriptionString","fullTypeString","fullInputString","fullSchemaString","keys","startsWith","deletedField","withRevisions","strip","cloned","replace"],"sources":["../../../../src/plugins/replication-graphql/graphql-schema-from-rx-schema.ts"],"sourcesContent":["import { getGraphqlSchemaFromJsonSchema } from 'get-graphql-from-jsonschema';\n\nimport { fillWithDefaultSettings } from '../../rx-schema-helper';\n\nimport { RxJsonSchema } from '../../types';\nimport { clone, ensureNotFalsy, flatClone, ucfirst } from '../../plugins/utils';\n\nexport type Prefixes = {\n    push?: string;\n    pushRow?: string;\n    checkpoint?: string;\n    pull?: string;\n    pullBulk?: string;\n    stream?: string;\n    headers?: string;\n};\n\n/**\n * just type some common types\n * to have better IDE autocomplete,\n * all strings are allowed\n */\nexport type GraphQLParamType = 'ID' | 'ID!' |\n'String' | 'String!' |\n'Int' | 'Int!' |\n'Float' | 'Float!' |\nstring;\n\nexport type GraphQLSchemaFromRxSchemaInputSingleCollection = {\n    schema: RxJsonSchema<any>;\n    /**\n     * These fields of the document data\n     * will be used for the checkpoint.\n     */\n    checkpointFields: string[];\n    ignoreInputKeys?: string[];\n    ignoreOutputKeys?: string[];\n    withRevisions?: boolean;\n    prefixes?: Prefixes;\n    headerFields?: string[];\n    /**\n     * Name of the boolean field that marks deleted documents.\n     * [default='_deleted']\n     */\n    deletedField?: string;\n};\n\nexport type GraphQLSchemaFromRxSchemaInput = {\n    [collectionName: string]: GraphQLSchemaFromRxSchemaInputSingleCollection;\n};\nexport type GraphQLSchemaFromRxSchemaOutput = {\n    asString: string;\n    queries: string[];\n    mutations: string[];\n    subscriptions: string[];\n    inputs: string[];\n    types: string[];\n};\n\n// we use two spaces because get-graphql-from-jsonschema does also\nexport const SPACING = '  ';\n\n/**\n * Create a GraphQL schema from a given RxJsonSchema\n */\nexport function graphQLSchemaFromRxSchema(\n    input: GraphQLSchemaFromRxSchemaInput\n): GraphQLSchemaFromRxSchemaOutput {\n    const ret: GraphQLSchemaFromRxSchemaOutput = {\n        asString: '',\n        queries: [],\n        mutations: [],\n        subscriptions: [],\n        inputs: [],\n        types: []\n    };\n\n    Object.entries(input).forEach(([collectionName, collectionSettings]) => {\n        collectionSettings = fillUpOptionals(collectionSettings);\n\n        const schema = collectionSettings.schema;\n        const prefixes: Prefixes = ensureNotFalsy(collectionSettings.prefixes);\n        const ucCollectionName = ucfirst(collectionName);\n        const collectionNameInput = ucfirst(collectionName) + 'Input';\n\n        // input\n        const inputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreInputKeys));\n\n        const inputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput,\n            schema: inputSchema as any,\n            direction: 'input'\n        });\n        const pushRowGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput + prefixes.pushRow,\n            schema: {\n                type: 'object',\n                properties: {\n                    assumedMasterState: inputSchema as any,\n                    newDocumentState: inputSchema as any\n                },\n                required: ['newDocumentState'],\n                additionalProperties: false\n            },\n            direction: 'input'\n        });\n\n        const checkpointSchema = {\n            type: 'object',\n            properties: {},\n            required: [],\n            additionalProperties: false\n        } as any;\n        collectionSettings.checkpointFields.forEach(key => {\n            const subSchema: any = schema.properties[key];\n            checkpointSchema.properties[key] = subSchema;\n            checkpointSchema.required.push(key);\n        });\n        const checkpointInputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionNameInput + prefixes.checkpoint,\n            schema: checkpointSchema as any,\n            direction: 'input'\n        });\n\n        ret.inputs = ret.inputs.concat(\n            inputGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput))\n        ).concat(\n            pushRowGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.pushRow))\n        ).concat(\n            checkpointInputGraphQL\n                .typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, collectionNameInput + prefixes.checkpoint))\n        );\n\n        const headersSchema: any = {\n            type: 'object',\n            additionalProperties: false,\n            properties: {},\n            required: []\n        };\n        ensureNotFalsy(collectionSettings.headerFields).forEach(headerField => {\n            headersSchema.properties[headerField] = {\n                type: 'string'\n            };\n            headersSchema.required.push(headerField);\n        });\n        const headersInputName = collectionNameInput + prefixes.headers;\n        const headersInputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: headersInputName,\n            schema: headersSchema,\n            direction: 'input'\n        });\n        if (ensureNotFalsy(collectionSettings.headerFields).length > 0) {\n            ret.inputs = ret.inputs.concat(\n                headersInputGraphQL\n                    .typeDefinitions\n                    .map(str => replaceTopLevelTypeName(str, headersInputName))\n            );\n        }\n\n        // output\n        const outputSchema = stripKeysFromSchema(schema, ensureNotFalsy(collectionSettings.ignoreOutputKeys));\n        const outputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: collectionName,\n            schema: outputSchema as any,\n            direction: 'output'\n        });\n        const checkpointOutputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: ucCollectionName + prefixes.checkpoint,\n            schema: checkpointSchema as any,\n            direction: 'output'\n        });\n        const pullBulkOutputGraphQL = getGraphqlSchemaFromJsonSchema({\n            rootName: ucCollectionName + prefixes.pullBulk,\n            schema: {\n                type: 'object',\n                properties: {\n                    documents: {\n                        type: 'array',\n                        items: inputSchema as any\n                    },\n                    checkpoint: checkpointSchema as any\n                },\n                required: ['documents', 'checkpoint'],\n                additionalProperties: false\n            },\n            direction: 'output'\n        });\n        ret.types = ret.types.concat(\n            outputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName))\n        ).concat(\n            checkpointOutputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.checkpoint))\n        ).concat(\n            pullBulkOutputGraphQL.typeDefinitions\n                .map(str => replaceTopLevelTypeName(str, ucCollectionName + prefixes.pullBulk))\n        );\n\n        // query\n        const queryName = prefixes.pull + ucCollectionName;\n        const queryKeys = [\n            'checkpoint: ' + collectionNameInput + prefixes.checkpoint,\n            'limit: Int!'\n        ];\n        const queryString = queryName + '(' + queryKeys.join(', ') + '): ' + ucCollectionName + prefixes.pullBulk + '!';\n        ret.queries.push(SPACING + queryString);\n\n        // mutation\n        const mutationName = prefixes.push + ucCollectionName;\n        const mutationString = mutationName + '(' + collectionName + prefixes.pushRow + ': [' + collectionNameInput + prefixes.pushRow + ']): [' + ucCollectionName + '!]!';\n        ret.mutations.push(SPACING + mutationString);\n\n        // subscription\n        let subscriptionHeaderInputString = '';\n        if (collectionSettings.headerFields && collectionSettings.headerFields.length > 0) {\n            subscriptionHeaderInputString = '(headers: ' + headersInputName + ')';\n        }\n        const subscriptionName = prefixes.stream + ucCollectionName;\n        const subscriptionString = subscriptionName + subscriptionHeaderInputString + ': ' + ucCollectionName + prefixes.pullBulk + '!';\n        ret.subscriptions.push(SPACING + subscriptionString);\n    });\n\n    // build full string\n    const fullQueryString = 'type Query {\\n' + ret.queries.join('\\n') + '\\n}\\n';\n    const fullMutationString = 'type Mutation {\\n' + ret.mutations.join('\\n') + '\\n}\\n';\n    const fullSubscriptionString = 'type Subscription {\\n' + ret.subscriptions.join('\\n') + '\\n}\\n';\n\n    const fullTypeString = ret.types.join('\\n');\n    const fullInputString = ret.inputs.join('\\n');\n\n    const fullSchemaString = '' +\n        'schema {\\n' +\n        SPACING + 'query: Query\\n' +\n        SPACING + 'mutation: Mutation\\n' +\n        SPACING + 'subscription: Subscription\\n' +\n        '}\\n';\n\n    ret.asString = '' +\n        fullQueryString + '\\n' +\n        fullMutationString + '\\n' +\n        fullSubscriptionString + '\\n' +\n        fullTypeString + '\\n' +\n        fullInputString + '\\n' +\n        fullSchemaString;\n\n    return ret;\n}\n\n\nexport function fillUpOptionals(\n    input: GraphQLSchemaFromRxSchemaInputSingleCollection\n): GraphQLSchemaFromRxSchemaInputSingleCollection {\n    input = flatClone(input);\n\n    const schema = fillWithDefaultSettings(input.schema);\n    // strip internal attributes\n    Object.keys(schema.properties).forEach(key => {\n        if (key.startsWith('_')) {\n            delete schema.properties[key];\n        }\n    });\n    input.schema = schema;\n\n    // add deleted field to schema\n    if (!input.deletedField) {\n        input.deletedField = '_deleted';\n    }\n    schema.properties[input.deletedField] = {\n        type: 'boolean'\n    };\n    (schema.required as string[]).push(input.deletedField);\n\n    // fill up prefixes\n    if (!input.prefixes) {\n        input.prefixes = {} as any;\n    }\n    const prefixes: Prefixes = input.prefixes as any;\n    if (!prefixes.push) {\n        prefixes.push = 'push';\n    }\n    if (!prefixes.pushRow) {\n        prefixes.pushRow = 'PushRow';\n    }\n    if (!prefixes.checkpoint) {\n        prefixes.checkpoint = 'Checkpoint';\n    }\n    if (!prefixes.pull) {\n        prefixes.pull = 'pull';\n    }\n    if (!prefixes.pullBulk) {\n        prefixes.pullBulk = 'PullBulk';\n    }\n    if (!prefixes.stream) {\n        prefixes.stream = 'stream';\n    }\n    if (!prefixes.headers) {\n        prefixes.headers = 'Headers';\n    }\n    if (!input.headerFields) {\n        input.headerFields = [];\n    }\n\n\n    if (!input.withRevisions) {\n        input.withRevisions = false;\n    }\n\n    if (!input.ignoreInputKeys) {\n        input.ignoreInputKeys = [];\n    }\n    if (!input.ignoreOutputKeys) {\n        input.ignoreOutputKeys = [];\n    }\n\n    return input;\n}\n\nfunction stripKeysFromSchema<T>(schema: RxJsonSchema<T>, strip: string[]): RxJsonSchema<Partial<T>> {\n    const cloned: any = clone(schema);\n    strip.forEach(key => {\n        delete cloned.properties[key];\n    });\n    return cloned;\n}\n\n/**\n * get-graphql-from-jsonschema add a T0-suffix\n * that we do not want for the top level type\n */\nfunction replaceTopLevelTypeName(str: string, ucCollectionName: string): string {\n    return str.replace(' ' + ucCollectionName + 'T0 ', ' ' + ucCollectionName + ' ');\n}\n"],"mappings":"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"}