{"version":3,"file":"check-migration-strategies.js","names":["newRxTypeError","newRxError","getPreviousVersions","checkMigrationStrategies","schema","migrationStrategies","Array","isArray","previousVersions","length","Object","keys","have","should","map","vNr","v","s","filter","strat","forEach","version","type"],"sources":["../../../../src/plugins/dev-mode/check-migration-strategies.ts"],"sourcesContent":["import type { RxJsonSchema, NumberFunctionMap } from '../../types';\nimport { newRxTypeError, newRxError } from '../../rx-error';\nimport { getPreviousVersions } from '../../rx-schema';\n\n\n/**\n * checks if the migrationStrategies are ok, throws if not\n * @throws {Error|TypeError} if not ok\n */\nexport function checkMigrationStrategies(\n    schema: RxJsonSchema<any>,\n    migrationStrategies: NumberFunctionMap\n): boolean {\n    // migrationStrategies must be object not array\n    if (\n        typeof migrationStrategies !== 'object' ||\n        Array.isArray(migrationStrategies)\n    ) {\n        throw newRxTypeError('COL11', {\n            schema\n        });\n    }\n\n    const previousVersions = getPreviousVersions(schema);\n\n    // for every previousVersion there must be strategy\n    if (\n        previousVersions.length !== Object\n            .keys(migrationStrategies).length\n    ) {\n        throw newRxError('COL12', {\n            have: Object.keys(migrationStrategies),\n            should: previousVersions\n        });\n    }\n\n    // every strategy must have number as property and be a function\n    previousVersions\n        .map(vNr => ({\n            v: vNr,\n            s: migrationStrategies[(vNr + 1)]\n        }))\n        .filter(strat => typeof strat.s !== 'function')\n        .forEach(strat => {\n            throw newRxTypeError('COL13', {\n                version: strat.v,\n                type: typeof strat,\n                schema\n            });\n        });\n\n    return true;\n}\n"],"mappings":"AACA,SAASA,cAAc,EAAEC,UAAU,QAAQ,gBAAgB;AAC3D,SAASC,mBAAmB,QAAQ,iBAAiB;;AAGrD;AACA;AACA;AACA;AACA,OAAO,SAASC,wBAAwB,CACpCC,MAAyB,EACzBC,mBAAsC,EAC/B;EACP;EACA,IACI,OAAOA,mBAAmB,KAAK,QAAQ,IACvCC,KAAK,CAACC,OAAO,CAACF,mBAAmB,CAAC,EACpC;IACE,MAAML,cAAc,CAAC,OAAO,EAAE;MAC1BI,MAAM,EAANA;IACJ,CAAC,CAAC;EACN;EAEA,IAAMI,gBAAgB,GAAGN,mBAAmB,CAACE,MAAM,CAAC;;EAEpD;EACA,IACII,gBAAgB,CAACC,MAAM,KAAKC,MAAM,CAC7BC,IAAI,CAACN,mBAAmB,CAAC,CAACI,MAAM,EACvC;IACE,MAAMR,UAAU,CAAC,OAAO,EAAE;MACtBW,IAAI,EAAEF,MAAM,CAACC,IAAI,CAACN,mBAAmB,CAAC;MACtCQ,MAAM,EAAEL;IACZ,CAAC,CAAC;EACN;;EAEA;EACAA,gBAAgB,CACXM,GAAG,CAAC,UAAAC,GAAG;IAAA,OAAK;MACTC,CAAC,EAAED,GAAG;MACNE,CAAC,EAAEZ,mBAAmB,CAAEU,GAAG,GAAG,CAAC;IACnC,CAAC;EAAA,CAAC,CAAC,CACFG,MAAM,CAAC,UAAAC,KAAK;IAAA,OAAI,OAAOA,KAAK,CAACF,CAAC,KAAK,UAAU;EAAA,EAAC,CAC9CG,OAAO,CAAC,UAAAD,KAAK,EAAI;IACd,MAAMnB,cAAc,CAAC,OAAO,EAAE;MAC1BqB,OAAO,EAAEF,KAAK,CAACH,CAAC;MAChBM,IAAI,EAAE,OAAOH,KAAK;MAClBf,MAAM,EAANA;IACJ,CAAC,CAAC;EACN,CAAC,CAAC;EAEN,OAAO,IAAI;AACf"}