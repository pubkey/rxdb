{"version":3,"file":"index.js","names":["setFlutterRxDatabaseConnector","createDB","process","init","databaseName","db","eventBulks$","subscribe","eventBulk","sendRxDBEvent","JSON","stringify","collections","Object","entries","forEach","collectionName","collection","push","name","primaryKey","schema","primaryPath","getLokijsAdapterFlutter","ret","loadDatabase","callback","readKeyValue","serializedDb","success","Error","saveDatabase","dbstring","persistKeyValue"],"sources":["../../../../src/plugins/flutter/index.ts"],"sourcesContent":["import type {\n    RxDatabase\n} from '../../types';\n\nexport type CreateRxDatabaseFunctionType = (databaseName: string) => Promise<RxDatabase>;\n\nexport function setFlutterRxDatabaseConnector(\n    createDB: CreateRxDatabaseFunctionType\n) {\n    (process as any).init = async (databaseName: string) => {\n        const db = await createDB(databaseName);\n        db.eventBulks$.subscribe(eventBulk => {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            sendRxDBEvent(JSON.stringify(eventBulk));\n        });\n        (process as any).db = db;\n        const collections: { name: string; primaryKey: string; }[] = [];\n        Object.entries(db.collections).forEach(([collectionName, collection]) => {\n            collections.push({\n                name: collectionName,\n                primaryKey: collection.schema.primaryPath\n            });\n        });\n        return {\n            databaseName,\n            collections\n        };\n    };\n}\n\n/**\n * Create a simple lokijs adapter so that we can persist string via flutter\n * @link https://github.com/techfort/LokiJS/blob/master/tutorials/Persistence%20Adapters.md#creating-your-own-basic-persistence-adapter\n */\nexport function getLokijsAdapterFlutter() {\n    const ret = {\n        async loadDatabase(databaseName: string, callback: (v: string | Error) => {}) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            const serializedDb: string = await readKeyValue(databaseName);\n\n            const success = true;\n            if (success) {\n                callback(serializedDb);\n            } else {\n                callback(new Error('There was a problem loading the database'));\n            }\n        },\n        async saveDatabase(databaseName: string, dbstring: string, callback: (v: string | Error | null) => {}) {\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            await persistKeyValue(databaseName, dbstring);\n\n            const success = true;  // make your own determinations\n            if (success) {\n                callback(null);\n            } else {\n                callback(new Error('An error was encountered loading \" + dbname + \" database.'));\n            }\n        }\n    };\n    return ret;\n}\n"],"mappings":"AAMA,OAAO,SAASA,6BAA6B,CACzCC,QAAsC,EACxC;EACGC,OAAO,CAASC,IAAI,aAAUC,YAAoB;IAAA,IAAK;MAAA,uBACnCH,QAAQ,CAACG,YAAY,CAAC,iBAAjCC,EAAE;QACRA,EAAE,CAACC,WAAW,CAACC,SAAS,CAAC,UAAAC,SAAS,EAAI;UAClC;UACA;UACAC,aAAa,CAACC,IAAI,CAACC,SAAS,CAACH,SAAS,CAAC,CAAC;QAC5C,CAAC,CAAC;QACDN,OAAO,CAASG,EAAE,GAAGA,EAAE;QACxB,IAAMO,WAAoD,GAAG,EAAE;QAC/DC,MAAM,CAACC,OAAO,CAACT,EAAE,CAACO,WAAW,CAAC,CAACG,OAAO,CAAC,gBAAkC;UAAA,IAAhCC,cAAc;YAAEC,UAAU;UAC/DL,WAAW,CAACM,IAAI,CAAC;YACbC,IAAI,EAAEH,cAAc;YACpBI,UAAU,EAAEH,UAAU,CAACI,MAAM,CAACC;UAClC,CAAC,CAAC;QACN,CAAC,CAAC;QACF,OAAO;UACHlB,YAAY,EAAZA,YAAY;UACZQ,WAAW,EAAXA;QACJ,CAAC;MAAC;IACN,CAAC;MAAA;IAAA;EAAA;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASW,uBAAuB,GAAG;EACtC,IAAMC,GAAG,GAAG;IACFC,YAAY,wBAACrB,YAAoB,EAAEsB,QAAmC;MAAA,IAAE;QAC1E;QACA;QAAA,uBACmCC,YAAY,CAACvB,YAAY,CAAC,iBAAvDwB,YAAoB;UAE1B,IAAMC,OAAO,GAAG,IAAI;UAAC,IACjBA,OAAO;YACPH,QAAQ,CAACE,YAAY,CAAC;UAAC;YAEvBF,QAAQ,CAAC,IAAII,KAAK,CAAC,0CAA0C,CAAC,CAAC;UAAC;QAAA;MAExE,CAAC;QAAA;MAAA;IAAA;IACKC,YAAY,wBAAC3B,YAAoB,EAAE4B,QAAgB,EAAEN,QAA0C;MAAA,IAAE;QACnG;QACA;QAAA,uBACMO,eAAe,CAAC7B,YAAY,EAAE4B,QAAQ,CAAC;UAE7C,IAAMH,OAAO,GAAG,IAAI,CAAC,CAAE;UAAA,IACnBA,OAAO;YACPH,QAAQ,CAAC,IAAI,CAAC;UAAC;YAEfA,QAAQ,CAAC,IAAII,KAAK,CAAC,2DAA2D,CAAC,CAAC;UAAC;QAAA;MAEzF,CAAC;QAAA;MAAA;IAAA;EACL,CAAC;EACD,OAAON,GAAG;AACd"}