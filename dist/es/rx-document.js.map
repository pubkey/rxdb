{"version":3,"file":"rx-document.js","names":["objectPath","BehaviorSubject","distinctUntilChanged","map","clone","trimDots","getHeightOfRevision","pluginMissing","flatClone","PROMISE_RESOLVE_NULL","PROMISE_RESOLVE_VOID","ensureNotFalsy","newRxError","isBulkWriteConflictError","runPluginHooks","getDocumentDataOfRxChangeEvent","overwritable","getSchemaByObjectPath","throwIfIsStorageWriteError","body","recover","result","e","then","pact","state","value","s","v","o","bind","observer","prototype","onFulfilled","onRejected","callback","_this","thenable","test","update","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","basePrototype","_data","isInstanceOfRxDocument","undefined","_dataSync$","getValue","primaryPath","collection","schema","primary","revision","_rev","deleted$","pipe","d","_deleted","deleted","$","asObservable","docData","deepFreezeWhenDevMode","_handleChangeEvent","changeEvent","documentId","newRevNr","currentRevNr","operation","next","documentData","_docCache","get$","path","includes","finalFields","schemaObj","jsonSchema","data","get","populate","ref","refCollection","database","collections","type","findByIds","res","valuesIterator","values","Array","from","findOne","exec","objPath","valueObj","isArray","defineGetterSetter","toJSON","withMetaFields","_attachments","_meta","toMutableJSON","_updateObj","updateCRDT","putAttachment","getAttachment","allAttachments","allAttachments$","atomicUpdate","mutationFunction","_context","Promise","rej","_atomicQueue","done","_saveData","newData","oldData","err","useError","parameters","error","isConflict","fillObjectWithDefaults","atomicPatch","patch","Object","entries","forEach","k","id","document","assign","isDevMode","validateChange","_runHooks","storageInstance","bulkWrite","previous","writeResult","isError","remove","deletedData","success","destroy","createRxDocumentConstructor","proto","constructor","RxDocumentConstructor","jsonData","thisObj","pathProperties","properties","keys","key","fullPath","__defineGetter__","ret","defineProperty","enumerable","configurable","__defineSetter__","val","set","createWithConstructor","startsWith","doc","isRxDocument","obj"],"sources":["../../src/rx-document.ts"],"sourcesContent":["import objectPath from 'object-path';\nimport {\n    Observable,\n    BehaviorSubject\n} from 'rxjs';\nimport {\n    distinctUntilChanged,\n    map\n} from 'rxjs/operators';\nimport {\n    clone,\n    trimDots,\n    getHeightOfRevision,\n    pluginMissing,\n    flatClone,\n    PROMISE_RESOLVE_NULL,\n    PROMISE_RESOLVE_VOID,\n    ensureNotFalsy\n} from './util';\nimport {\n    newRxError,\n    isBulkWriteConflictError\n} from './rx-error';\nimport {\n    runPluginHooks\n} from './hooks';\n\nimport type {\n    RxDocument,\n    RxCollection,\n    RxDocumentData,\n    RxDocumentWriteData,\n    RxChangeEvent,\n    UpdateQuery,\n    CRDTEntry\n} from './types';\nimport { getDocumentDataOfRxChangeEvent } from './rx-change-event';\nimport { overwritable } from './overwritable';\nimport { getSchemaByObjectPath } from './rx-schema-helper';\nimport { throwIfIsStorageWriteError } from './rx-storage-helper';\n\nexport const basePrototype = {\n\n    /**\n     * TODO\n     * instead of appliying the _this-hack\n     * we should make these accessors functions instead of getters.\n     */\n    get _data() {\n        const _this: RxDocument = this as any;\n        /**\n         * Might be undefined when vuejs-devtools are used\n         * @link https://github.com/pubkey/rxdb/issues/1126\n         */\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n\n        return _this._dataSync$.getValue();\n    },\n    get primaryPath() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this.collection.schema.primaryPath;\n    },\n    get primary() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return (_this._data as any)[_this.primaryPath];\n    },\n    get revision() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._data._rev;\n    },\n    get deleted$() {\n        const _this: RxDocument<any> = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._dataSync$.pipe(\n            map((d: any) => d._deleted)\n        );\n    },\n    get deleted() {\n        const _this: RxDocument = this as any;\n        if (!_this.isInstanceOfRxDocument) {\n            return undefined;\n        }\n        return _this._data._deleted;\n    },\n\n    /**\n     * returns the observable which emits the plain-data of this document\n     */\n    get $(): Observable<any> {\n        const _this: RxDocument = this as any;\n        return _this._dataSync$.asObservable().pipe(\n            map(docData => overwritable.deepFreezeWhenDevMode(docData))\n        );\n    },\n\n    _handleChangeEvent(this: RxDocument, changeEvent: RxChangeEvent<any>) {\n        if (changeEvent.documentId !== this.primary) {\n            return;\n        }\n\n        // ensure that new _rev is higher then current\n        const docData = getDocumentDataOfRxChangeEvent(changeEvent);\n        const newRevNr = getHeightOfRevision(docData._rev);\n        const currentRevNr = getHeightOfRevision(this._data._rev);\n        if (currentRevNr > newRevNr) return;\n\n        switch (changeEvent.operation) {\n            case 'INSERT':\n                break;\n            case 'UPDATE':\n                this._dataSync$.next(changeEvent.documentData);\n                break;\n            case 'DELETE':\n                // remove from docCache to assure new upserted RxDocuments will be a new instance\n                this.collection._docCache.delete(this.primary);\n                this._dataSync$.next(changeEvent.documentData);\n                break;\n        }\n    },\n\n    /**\n     * returns observable of the value of the given path\n     */\n    get$(this: RxDocument, path: string): Observable<any> {\n        if (path.includes('.item.')) {\n            throw newRxError('DOC1', {\n                path\n            });\n        }\n\n        if (path === this.primaryPath)\n            throw newRxError('DOC2');\n\n        // final fields cannot be modified and so also not observed\n        if (this.collection.schema.finalFields.includes(path)) {\n            throw newRxError('DOC3', {\n                path\n            });\n        }\n\n        const schemaObj = getSchemaByObjectPath(\n            this.collection.schema.jsonSchema,\n            path\n        );\n        if (!schemaObj) {\n            throw newRxError('DOC4', {\n                path\n            });\n        }\n\n        return this._dataSync$\n            .pipe(\n                map(data => objectPath.get(data, path)),\n                distinctUntilChanged()\n            );\n    },\n\n    /**\n     * populate the given path\n     */\n    populate(this: RxDocument, path: string): Promise<RxDocument | null> {\n        const schemaObj = getSchemaByObjectPath(\n            this.collection.schema.jsonSchema,\n            path\n        );\n        const value = this.get(path);\n        if (!value) {\n            return PROMISE_RESOLVE_NULL;\n        }\n        if (!schemaObj) {\n            throw newRxError('DOC5', {\n                path\n            });\n        }\n        if (!schemaObj.ref) {\n            throw newRxError('DOC6', {\n                path,\n                schemaObj\n            });\n        }\n\n        const refCollection: RxCollection = this.collection.database.collections[schemaObj.ref];\n        if (!refCollection) {\n            throw newRxError('DOC7', {\n                ref: schemaObj.ref,\n                path,\n                schemaObj\n            });\n        }\n\n        if (schemaObj.type === 'array') {\n            return refCollection.findByIds(value).then(res => {\n                const valuesIterator = res.values();\n                return Array.from(valuesIterator) as any;\n            });\n        } else {\n            return refCollection.findOne(value).exec();\n        }\n    },\n\n    /**\n     * get data by objectPath\n     */\n    get(this: RxDocument, objPath: string): any | null {\n        if (!this._data) return undefined;\n        let valueObj = objectPath.get(this._data, objPath);\n\n        // direct return if array or non-object\n        if (\n            typeof valueObj !== 'object' ||\n            Array.isArray(valueObj)\n        ) {\n            return overwritable.deepFreezeWhenDevMode(valueObj);\n        }\n\n        /**\n         * TODO find a way to deep-freeze together with defineGetterSetter\n         * so we do not have to do a deep clone here.\n         */\n        valueObj = clone(valueObj);\n        defineGetterSetter(\n            this.collection.schema,\n            valueObj,\n            objPath,\n            this as any\n        );\n        return valueObj;\n    },\n\n    toJSON(this: RxDocument, withMetaFields = false) {\n        if (!withMetaFields) {\n            const data = flatClone(this._data);\n            delete (data as any)._rev;\n            delete (data as any)._attachments;\n            delete (data as any)._deleted;\n            delete (data as any)._meta;\n            return overwritable.deepFreezeWhenDevMode(data);\n        } else {\n            return overwritable.deepFreezeWhenDevMode(this._data);\n        }\n    },\n    toMutableJSON(this: RxDocument, withMetaFields = false) {\n        return clone(this.toJSON(withMetaFields as any));\n    },\n\n    /**\n     * updates document\n     * @overwritten by plugin (optional)\n     * @param updateObj mongodb-like syntax\n     */\n    update(_updateObj: UpdateQuery<any>) {\n        throw pluginMissing('update');\n    },\n    updateCRDT(_updateObj: CRDTEntry<any> | CRDTEntry<any>[]) {\n        throw pluginMissing('crdt');\n    },\n    putAttachment() {\n        throw pluginMissing('attachments');\n    },\n    getAttachment() {\n        throw pluginMissing('attachments');\n    },\n    allAttachments() {\n        throw pluginMissing('attachments');\n    },\n    get allAttachments$() {\n        throw pluginMissing('attachments');\n    },\n\n\n    /**\n     * runs an atomic update over the document\n     * @param function that takes the document-data and returns a new data-object\n     */\n    atomicUpdate(\n        this: RxDocument,\n        mutationFunction: Function,\n        // used by some plugins that wrap the method\n        _context?: string\n    ): Promise<RxDocument> {\n        return new Promise((res, rej) => {\n            this._atomicQueue = this\n                ._atomicQueue\n                .then(async () => {\n                    let done = false;\n                    // we need a hacky while loop to stay incide the chain-link of _atomicQueue\n                    // while still having the option to run a retry on conflicts\n                    while (!done) {\n                        const oldData = this._dataSync$.getValue();\n                        // always await because mutationFunction might be async\n                        let newData;\n\n                        try {\n                            newData = await mutationFunction(\n                                clone(oldData),\n                                this\n                            );\n                            if (this.collection) {\n                                newData = this.collection.schema.fillObjectWithDefaults(newData);\n                            }\n                        } catch (err) {\n                            rej(err);\n                            return;\n                        }\n\n                        try {\n                            await this._saveData(newData, oldData);\n                            done = true;\n                        } catch (err: any) {\n                            const useError = err.parameters && err.parameters.error ? err.parameters.error : err;\n                            /**\n                             * conflicts cannot happen by just using RxDB in one process\n                             * There are two ways they still can appear which is\n                             * replication and multi-tab usage\n                             * Because atomicUpdate has a mutation function,\n                             * we can just re-run the mutation until there is no conflict\n                             */\n                            const isConflict = isBulkWriteConflictError(useError as any);\n                            if (isConflict) {\n                                // conflict error -> retrying\n                            } else {\n                                rej(useError);\n                                return;\n                            }\n                        }\n                    }\n                    res(this);\n                });\n        });\n    },\n\n\n    /**\n     * patches the given properties\n     */\n    atomicPatch<RxDocumentType = any>(\n        this: RxDocument<RxDocumentType>,\n        patch: Partial<RxDocumentType>\n    ): Promise<RxDocument<RxDocumentType>> {\n        return this.atomicUpdate((docData: RxDocumentType) => {\n            Object\n                .entries(patch)\n                .forEach(([k, v]) => {\n                    (docData as any)[k] = v;\n                });\n            return docData;\n        });\n    },\n\n    /**\n     * saves the new document-data\n     * and handles the events\n     */\n    async _saveData<RxDocumentType>(\n        this: RxDocument<RxDocumentType>,\n        newData: RxDocumentWriteData<RxDocumentType>,\n        oldData: RxDocumentData<RxDocumentType>\n    ): Promise<void> {\n        newData = flatClone(newData);\n\n        // deleted documents cannot be changed\n        if (this._data._deleted) {\n            throw newRxError('DOC11', {\n                id: this.primary,\n                document: this\n            });\n        }\n\n        /**\n         * Meta values must always be merged\n         * instead of overwritten.\n         * This ensures that different plugins do not overwrite\n         * each others meta properties.\n         */\n        newData._meta = Object.assign(\n            {},\n            oldData._meta,\n            newData._meta\n        );\n\n        // ensure modifications are ok\n        if (overwritable.isDevMode()) {\n            this.collection.schema.validateChange(oldData, newData);\n        }\n\n        await this.collection._runHooks('pre', 'save', newData, this);\n\n        const writeResult = await this.collection.storageInstance.bulkWrite([{\n            previous: oldData,\n            document: newData\n        }], 'rx-document-save-data');\n\n        const isError = writeResult.error[this.primary];\n        throwIfIsStorageWriteError(this.collection, this.primary, newData, isError);\n\n        return this.collection._runHooks('post', 'save', newData, this);\n    },\n\n    /**\n     * remove the document,\n     * this not not equal to a pouchdb.remove(),\n     * instead we keep the values and only set _deleted: true\n     */\n    remove(this: RxDocument): Promise<RxDocument> {\n        const collection = this.collection;\n        if (this.deleted) {\n            return Promise.reject(newRxError('DOC13', {\n                document: this,\n                id: this.primary\n            }));\n        }\n\n        const deletedData = flatClone(this._data);\n        return collection._runHooks('pre', 'remove', deletedData, this)\n            .then(async () => {\n                deletedData._deleted = true;\n\n                const writeResult = await collection.storageInstance.bulkWrite([{\n                    previous: this._data,\n                    document: deletedData\n                }], 'rx-document-remove');\n                const isError = writeResult.error[this.primary];\n                throwIfIsStorageWriteError(collection, this.primary, deletedData, isError);\n                return ensureNotFalsy(writeResult.success[this.primary]);\n            })\n            .then(() => {\n                return this.collection._runHooks('post', 'remove', deletedData, this);\n            })\n            .then(() => this);\n    },\n    destroy() {\n        throw newRxError('DOC14');\n    }\n};\n\nexport function createRxDocumentConstructor(proto = basePrototype) {\n    const constructor = function RxDocumentConstructor(\n        this: RxDocument,\n        collection: RxCollection,\n        jsonData: any\n    ) {\n        this.collection = collection;\n\n        // assume that this is always equal to the doc-data in the database\n        this._dataSync$ = new BehaviorSubject(jsonData);\n\n        this._atomicQueue = PROMISE_RESOLVE_VOID;\n\n        /**\n         * because of the prototype-merge,\n         * we can not use the native instanceof operator\n         */\n        this.isInstanceOfRxDocument = true;\n    };\n    constructor.prototype = proto;\n    return constructor;\n}\n\nexport function defineGetterSetter(\n    schema: any,\n    valueObj: any,\n    objPath = '',\n    thisObj = false\n) {\n    if (valueObj === null) return;\n\n\n    let pathProperties = getSchemaByObjectPath(\n        schema.jsonSchema,\n        objPath\n    );\n\n    if (typeof pathProperties === 'undefined') return;\n    if (pathProperties.properties) pathProperties = pathProperties.properties;\n\n    Object.keys(pathProperties)\n        .forEach(key => {\n            const fullPath = trimDots(objPath + '.' + key);\n\n            // getter - value\n            valueObj.__defineGetter__(\n                key,\n                function (this: RxDocument) {\n                    const _this: RxDocument = thisObj ? thisObj : (this as any);\n                    if (!_this.get || typeof _this.get !== 'function') {\n                        /**\n                         * When an object gets added to the state of a vuejs-component,\n                         * it happens that this getter is called with another scope.\n                         * To prevent errors, we have to return undefined in this case\n                         */\n                        return undefined;\n                    }\n                    const ret = _this.get(fullPath);\n                    return ret;\n                }\n            );\n            // getter - observable$\n            Object.defineProperty(valueObj, key + '$', {\n                get: function () {\n                    const _this = thisObj ? thisObj : this;\n                    return _this.get$(fullPath);\n                },\n                enumerable: false,\n                configurable: false\n            });\n            // getter - populate_\n            Object.defineProperty(valueObj, key + '_', {\n                get: function () {\n                    const _this = thisObj ? thisObj : this;\n                    return _this.populate(fullPath);\n                },\n                enumerable: false,\n                configurable: false\n            });\n            // setter - value\n            valueObj.__defineSetter__(key, function (\n                this: RxDocument,\n                val: any\n            ) {\n                const _this: any = thisObj ? thisObj : this;\n                return _this.set(fullPath, val);\n            });\n        });\n}\n\nexport function createWithConstructor<RxDocType>(\n    constructor: any,\n    collection: RxCollection<RxDocType>,\n    jsonData: RxDocumentData<RxDocType>\n): RxDocument<RxDocType> | null {\n    const primary: string = jsonData[collection.schema.primaryPath] as any;\n    if (\n        primary &&\n        primary.startsWith('_design')\n    ) {\n        return null;\n    }\n\n    const doc = new constructor(collection, jsonData);\n    runPluginHooks('createRxDocument', doc);\n    return doc;\n}\n\nexport function isRxDocument(obj: any): boolean {\n    if (typeof obj === 'undefined') return false;\n    return !!obj.isInstanceOfRxDocument;\n}\n"],"mappings":"AAAA,OAAOA,UAAU,MAAM,aAAa;AACpC,SAEIC,eAAe,QACZ,MAAM;AACb,SACIC,oBAAoB,EACpBC,GAAG,QACA,gBAAgB;AACvB,SACIC,KAAK,EACLC,QAAQ,EACRC,mBAAmB,EACnBC,aAAa,EACbC,SAAS,EACTC,oBAAoB,EACpBC,oBAAoB,EACpBC,cAAc,QACX,QAAQ;AACf,SACIC,UAAU,EACVC,wBAAwB,QACrB,YAAY;AACnB,SACIC,cAAc,QACX,SAAS;AAWhB,SAASC,8BAA8B,QAAQ,mBAAmB;AAClE,SAASC,YAAY,QAAQ,gBAAgB;AAC7C,SAASC,qBAAqB,QAAQ,oBAAoB;AAC1D,SAASC,0BAA0B,QAAQ,qBAAqB;AA2gBzD,gBAAgBC,IAAI,EAAEC,OAAO,EAAE;EACrC,IAAI;IACH,IAAIC,MAAM,GAAGF,IAAI,EAAE;EACpB,CAAC,CAAC,OAAMG,CAAC,EAAE;IACV,OAAOF,OAAO,CAACE,CAAC,CAAC;EAClB;EACA,IAAID,MAAM,IAAIA,MAAM,CAACE,IAAI,EAAE;IAC1B,OAAOF,MAAM,CAACE,IAAI,CAAC,KAAK,CAAC,EAAEH,OAAO,CAAC;EACpC;EACA,OAAOC,MAAM;AACd;AArhBO,iBAAiBG,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAE;EAC3C,IAAI,CAACF,IAAI,CAACG,CAAC,EAAE;IACZ,IAAID,KAAK,iBAAiB,EAAE;MAC3B,IAAIA,KAAK,CAACC,CAAC,EAAE;QACZ,IAAIF,KAAK,GAAG,CAAC,EAAE;UACdA,KAAK,GAAGC,KAAK,CAACC,CAAC;QAChB;QACAD,KAAK,GAAGA,KAAK,CAACE,CAAC;MAChB,CAAC,MAAM;QACNF,KAAK,CAACG,CAAC,GAAG,QAAQC,IAAI,CAAC,IAAI,EAAEN,IAAI,EAAEC,KAAK,CAAC;QACzC;MACD;IACD;IACA,IAAIC,KAAK,IAAIA,KAAK,CAACH,IAAI,EAAE;MACxBG,KAAK,CAACH,IAAI,CAAC,QAAQO,IAAI,CAAC,IAAI,EAAEN,IAAI,EAAEC,KAAK,CAAC,EAAE,QAAQK,IAAI,CAAC,IAAI,EAAEN,IAAI,EAAE,CAAC,CAAC,CAAC;MACxE;IACD;IACAA,IAAI,CAACG,CAAC,GAAGF,KAAK;IACdD,IAAI,CAACI,CAAC,GAAGF,KAAK;IACd,IAAMK,QAAQ,GAAGP,IAAI,CAACK,CAAC;IACvB,IAAIE,QAAQ,EAAE;MACbA,QAAQ,CAACP,IAAI,CAAC;IACf;EACD;AACD;AA9DO,IAAM,QAAQ,aAAc,YAAW;EAC7C,iBAAiB,CAAC;EAClB,MAAMQ,SAAS,CAACT,IAAI,GAAG,UAASU,WAAW,EAAEC,UAAU,EAAE;IACxD,IAAMb,MAAM,GAAG,WAAW;IAC1B,IAAMI,KAAK,GAAG,IAAI,CAACE,CAAC;IACpB,IAAIF,KAAK,EAAE;MACV,IAAMU,QAAQ,GAAGV,KAAK,GAAG,CAAC,GAAGQ,WAAW,GAAGC,UAAU;MACrD,IAAIC,QAAQ,EAAE;QACb,IAAI;UACH,QAAQd,MAAM,EAAE,CAAC,EAAEc,QAAQ,CAAC,IAAI,CAACP,CAAC,CAAC,CAAC;QACrC,CAAC,CAAC,OAAON,CAAC,EAAE;UACX,QAAQD,MAAM,EAAE,CAAC,EAAEC,CAAC,CAAC;QACtB;QACA,OAAOD,MAAM;MACd,CAAC,MAAM;QACN,OAAO,IAAI;MACZ;IACD;IACA,IAAI,CAACQ,CAAC,GAAG,UAASO,KAAK,EAAE;MACxB,IAAI;QACH,IAAMV,KAAK,GAAGU,KAAK,CAACR,CAAC;QACrB,IAAIQ,KAAK,CAACT,CAAC,GAAG,CAAC,EAAE;UAChB,QAAQN,MAAM,EAAE,CAAC,EAAEY,WAAW,GAAGA,WAAW,CAACP,KAAK,CAAC,GAAGA,KAAK,CAAC;QAC7D,CAAC,MAAM,IAAIQ,UAAU,EAAE;UACtB,QAAQb,MAAM,EAAE,CAAC,EAAEa,UAAU,CAACR,KAAK,CAAC,CAAC;QACtC,CAAC,MAAM;UACN,QAAQL,MAAM,EAAE,CAAC,EAAEK,KAAK,CAAC;QAC1B;MACD,CAAC,CAAC,OAAOJ,CAAC,EAAE;QACX,QAAQD,MAAM,EAAE,CAAC,EAAEC,CAAC,CAAC;MACtB;IACD,CAAC;IACD,OAAOD,MAAM;EACd,CAAC;EACD;AACD,CAAC,EAAG;AA6BG,wBAAwBgB,QAAQ,EAAE;EACxC,OAAOA,QAAQ,iBAAiB,IAAIA,QAAQ,CAACV,CAAC,GAAG,CAAC;AACnD;AA4LO,cAAcW,IAAI,EAAEC,MAAM,EAAEpB,IAAI,EAAE;EACxC,IAAIqB,KAAK;EACT,SAAS;IACR,IAAIC,cAAc,GAAGH,IAAI,EAAE;IAC3B,IAAI,eAAeG,cAAc,CAAC,EAAE;MACnCA,cAAc,GAAGA,cAAc,CAACb,CAAC;IAClC;IACA,IAAI,CAACa,cAAc,EAAE;MACpB,OAAOpB,MAAM;IACd;IACA,IAAIoB,cAAc,CAAClB,IAAI,EAAE;MACxBiB,KAAK,GAAG,CAAC;MACT;IACD;IACA,IAAInB,MAAM,GAAGF,IAAI,EAAE;IACnB,IAAIE,MAAM,IAAIA,MAAM,CAACE,IAAI,EAAE;MAC1B,IAAI,eAAeF,MAAM,CAAC,EAAE;QAC3BA,MAAM,GAAGA,MAAM,CAACM,CAAC;MAClB,CAAC,MAAM;QACNa,KAAK,GAAG,CAAC;QACT;MACD;IACD;IACA,IAAID,MAAM,EAAE;MACX,IAAIG,WAAW,GAAGH,MAAM,EAAE;MAC1B,IAAIG,WAAW,IAAIA,WAAW,CAACnB,IAAI,IAAI,CAAC,eAAemB,WAAW,CAAC,EAAE;QACpEF,KAAK,GAAG,CAAC;QACT;MACD;IACD;EACD;EACA,IAAIhB,IAAI,GAAG,WAAW;EACtB,IAAImB,MAAM,GAAG,QAAQb,IAAI,CAAC,IAAI,EAAEN,IAAI,EAAE,CAAC,CAAC;EACxC,CAACgB,KAAK,KAAK,CAAC,GAAGC,cAAc,CAAClB,IAAI,CAACqB,gBAAgB,CAAC,GAAGJ,KAAK,KAAK,CAAC,GAAGnB,MAAM,CAACE,IAAI,CAACsB,gBAAgB,CAAC,GAAGH,WAAW,CAACnB,IAAI,CAACuB,kBAAkB,CAAC,EAAEvB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;EAC/J,OAAOnB,IAAI;EACX,SAASqB,gBAAgB,CAACnB,KAAK,EAAE;IAChCL,MAAM,GAAGK,KAAK;IACd,GAAG;MACF,IAAIa,MAAM,EAAE;QACXG,WAAW,GAAGH,MAAM,EAAE;QACtB,IAAIG,WAAW,IAAIA,WAAW,CAACnB,IAAI,IAAI,CAAC,eAAemB,WAAW,CAAC,EAAE;UACpEA,WAAW,CAACnB,IAAI,CAACuB,kBAAkB,CAAC,CAACvB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;UACzD;QACD;MACD;MACAF,cAAc,GAAGH,IAAI,EAAE;MACvB,IAAI,CAACG,cAAc,IAAK,eAAeA,cAAc,CAAC,IAAI,CAACA,cAAc,CAACb,CAAE,EAAE;QAC7E,QAAQJ,IAAI,EAAE,CAAC,EAAEH,MAAM,CAAC;QACxB;MACD;MACA,IAAIoB,cAAc,CAAClB,IAAI,EAAE;QACxBkB,cAAc,CAAClB,IAAI,CAACqB,gBAAgB,CAAC,CAACrB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;QAC1D;MACD;MACAtB,MAAM,GAAGF,IAAI,EAAE;MACf,IAAI,eAAeE,MAAM,CAAC,EAAE;QAC3BA,MAAM,GAAGA,MAAM,CAACO,CAAC;MAClB;IACD,CAAC,QAAQ,CAACP,MAAM,IAAI,CAACA,MAAM,CAACE,IAAI;IAChCF,MAAM,CAACE,IAAI,CAACsB,gBAAgB,CAAC,CAACtB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;EACnD;EACA,SAASC,gBAAgB,CAACH,cAAc,EAAE;IACzC,IAAIA,cAAc,EAAE;MACnBpB,MAAM,GAAGF,IAAI,EAAE;MACf,IAAIE,MAAM,IAAIA,MAAM,CAACE,IAAI,EAAE;QAC1BF,MAAM,CAACE,IAAI,CAACsB,gBAAgB,CAAC,CAACtB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;MACnD,CAAC,MAAM;QACNE,gBAAgB,CAACxB,MAAM,CAAC;MACzB;IACD,CAAC,MAAM;MACN,QAAQG,IAAI,EAAE,CAAC,EAAEH,MAAM,CAAC;IACzB;EACD;EACA,SAASyB,kBAAkB,GAAG;IAC7B,IAAIL,cAAc,GAAGH,IAAI,EAAE,EAAE;MAC5B,IAAIG,cAAc,CAAClB,IAAI,EAAE;QACxBkB,cAAc,CAAClB,IAAI,CAACqB,gBAAgB,CAAC,CAACrB,IAAI,CAAC,KAAK,CAAC,EAAEoB,MAAM,CAAC;MAC3D,CAAC,MAAM;QACNC,gBAAgB,CAACH,cAAc,CAAC;MACjC;IACD,CAAC,MAAM;MACN,QAAQjB,IAAI,EAAE,CAAC,EAAEH,MAAM,CAAC;IACzB;EACD;AACD;AA1SA,OAAO,IAAM0B,aAAa,GAAG;EAEzB;AACJ;AACA;AACA;AACA;EACI,IAAIC,KAAK,GAAG;IACR,IAAMZ,KAAiB,GAAG,IAAW;IACrC;AACR;AACA;AACA;IACQ,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IAEA,OAAOd,KAAK,CAACe,UAAU,CAACC,QAAQ,EAAE;EACtC,CAAC;EACD,IAAIC,WAAW,GAAG;IACd,IAAMjB,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOd,KAAK,CAACkB,UAAU,CAACC,MAAM,CAACF,WAAW;EAC9C,CAAC;EACD,IAAIG,OAAO,GAAG;IACV,IAAMpB,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAQd,KAAK,CAACY,KAAK,CAASZ,KAAK,CAACiB,WAAW,CAAC;EAClD,CAAC;EACD,IAAII,QAAQ,GAAG;IACX,IAAMrB,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOd,KAAK,CAACY,KAAK,CAACU,IAAI;EAC3B,CAAC;EACD,IAAIC,QAAQ,GAAG;IACX,IAAMvB,KAAsB,GAAG,IAAW;IAC1C,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOd,KAAK,CAACe,UAAU,CAACS,IAAI,CACxBzD,GAAG,CAAC,UAAC0D,CAAM;MAAA,OAAKA,CAAC,CAACC,QAAQ;IAAA,EAAC,CAC9B;EACL,CAAC;EACD,IAAIC,OAAO,GAAG;IACV,IAAM3B,KAAiB,GAAG,IAAW;IACrC,IAAI,CAACA,KAAK,CAACa,sBAAsB,EAAE;MAC/B,OAAOC,SAAS;IACpB;IACA,OAAOd,KAAK,CAACY,KAAK,CAACc,QAAQ;EAC/B,CAAC;EAED;AACJ;AACA;EACI,IAAIE,CAAC,GAAoB;IACrB,IAAM5B,KAAiB,GAAG,IAAW;IACrC,OAAOA,KAAK,CAACe,UAAU,CAACc,YAAY,EAAE,CAACL,IAAI,CACvCzD,GAAG,CAAC,UAAA+D,OAAO;MAAA,OAAIlD,YAAY,CAACmD,qBAAqB,CAACD,OAAO,CAAC;IAAA,EAAC,CAC9D;EACL,CAAC;EAEDE,kBAAkB,8BAAmBC,WAA+B,EAAE;IAClE,IAAIA,WAAW,CAACC,UAAU,KAAK,IAAI,CAACd,OAAO,EAAE;MACzC;IACJ;;IAEA;IACA,IAAMU,OAAO,GAAGnD,8BAA8B,CAACsD,WAAW,CAAC;IAC3D,IAAME,QAAQ,GAAGjE,mBAAmB,CAAC4D,OAAO,CAACR,IAAI,CAAC;IAClD,IAAMc,YAAY,GAAGlE,mBAAmB,CAAC,IAAI,CAAC0C,KAAK,CAACU,IAAI,CAAC;IACzD,IAAIc,YAAY,GAAGD,QAAQ,EAAE;IAE7B,QAAQF,WAAW,CAACI,SAAS;MACzB,KAAK,QAAQ;QACT;MACJ,KAAK,QAAQ;QACT,IAAI,CAACtB,UAAU,CAACuB,IAAI,CAACL,WAAW,CAACM,YAAY,CAAC;QAC9C;MACJ,KAAK,QAAQ;QACT;QACA,IAAI,CAACrB,UAAU,CAACsB,SAAS,UAAO,CAAC,IAAI,CAACpB,OAAO,CAAC;QAC9C,IAAI,CAACL,UAAU,CAACuB,IAAI,CAACL,WAAW,CAACM,YAAY,CAAC;QAC9C;IAAM;EAElB,CAAC;EAED;AACJ;AACA;EACIE,IAAI,gBAAmBC,IAAY,EAAmB;IAClD,IAAIA,IAAI,CAACC,QAAQ,CAAC,QAAQ,CAAC,EAAE;MACzB,MAAMnE,UAAU,CAAC,MAAM,EAAE;QACrBkE,IAAI,EAAJA;MACJ,CAAC,CAAC;IACN;IAEA,IAAIA,IAAI,KAAK,IAAI,CAACzB,WAAW,EACzB,MAAMzC,UAAU,CAAC,MAAM,CAAC;;IAE5B;IACA,IAAI,IAAI,CAAC0C,UAAU,CAACC,MAAM,CAACyB,WAAW,CAACD,QAAQ,CAACD,IAAI,CAAC,EAAE;MACnD,MAAMlE,UAAU,CAAC,MAAM,EAAE;QACrBkE,IAAI,EAAJA;MACJ,CAAC,CAAC;IACN;IAEA,IAAMG,SAAS,GAAGhE,qBAAqB,CACnC,IAAI,CAACqC,UAAU,CAACC,MAAM,CAAC2B,UAAU,EACjCJ,IAAI,CACP;IACD,IAAI,CAACG,SAAS,EAAE;MACZ,MAAMrE,UAAU,CAAC,MAAM,EAAE;QACrBkE,IAAI,EAAJA;MACJ,CAAC,CAAC;IACN;IAEA,OAAO,IAAI,CAAC3B,UAAU,CACjBS,IAAI,CACDzD,GAAG,CAAC,UAAAgF,IAAI;MAAA,OAAInF,UAAU,CAACoF,GAAG,CAACD,IAAI,EAAEL,IAAI,CAAC;IAAA,EAAC,EACvC5E,oBAAoB,EAAE,CACzB;EACT,CAAC;EAED;AACJ;AACA;EACImF,QAAQ,oBAAmBP,IAAY,EAA8B;IACjE,IAAMG,SAAS,GAAGhE,qBAAqB,CACnC,IAAI,CAACqC,UAAU,CAACC,MAAM,CAAC2B,UAAU,EACjCJ,IAAI,CACP;IACD,IAAMpD,KAAK,GAAG,IAAI,CAAC0D,GAAG,CAACN,IAAI,CAAC;IAC5B,IAAI,CAACpD,KAAK,EAAE;MACR,OAAOjB,oBAAoB;IAC/B;IACA,IAAI,CAACwE,SAAS,EAAE;MACZ,MAAMrE,UAAU,CAAC,MAAM,EAAE;QACrBkE,IAAI,EAAJA;MACJ,CAAC,CAAC;IACN;IACA,IAAI,CAACG,SAAS,CAACK,GAAG,EAAE;MAChB,MAAM1E,UAAU,CAAC,MAAM,EAAE;QACrBkE,IAAI,EAAJA,IAAI;QACJG,SAAS,EAATA;MACJ,CAAC,CAAC;IACN;IAEA,IAAMM,aAA2B,GAAG,IAAI,CAACjC,UAAU,CAACkC,QAAQ,CAACC,WAAW,CAACR,SAAS,CAACK,GAAG,CAAC;IACvF,IAAI,CAACC,aAAa,EAAE;MAChB,MAAM3E,UAAU,CAAC,MAAM,EAAE;QACrB0E,GAAG,EAAEL,SAAS,CAACK,GAAG;QAClBR,IAAI,EAAJA,IAAI;QACJG,SAAS,EAATA;MACJ,CAAC,CAAC;IACN;IAEA,IAAIA,SAAS,CAACS,IAAI,KAAK,OAAO,EAAE;MAC5B,OAAOH,aAAa,CAACI,SAAS,CAACjE,KAAK,CAAC,CAACH,IAAI,CAAC,UAAAqE,GAAG,EAAI;QAC9C,IAAMC,cAAc,GAAGD,GAAG,CAACE,MAAM,EAAE;QACnC,OAAOC,KAAK,CAACC,IAAI,CAACH,cAAc,CAAC;MACrC,CAAC,CAAC;IACN,CAAC,MAAM;MACH,OAAON,aAAa,CAACU,OAAO,CAACvE,KAAK,CAAC,CAACwE,IAAI,EAAE;IAC9C;EACJ,CAAC;EAED;AACJ;AACA;EACId,GAAG,eAAmBe,OAAe,EAAc;IAC/C,IAAI,CAAC,IAAI,CAACnD,KAAK,EAAE,OAAOE,SAAS;IACjC,IAAIkD,QAAQ,GAAGpG,UAAU,CAACoF,GAAG,CAAC,IAAI,CAACpC,KAAK,EAAEmD,OAAO,CAAC;;IAElD;IACA,IACI,OAAOC,QAAQ,KAAK,QAAQ,IAC5BL,KAAK,CAACM,OAAO,CAACD,QAAQ,CAAC,EACzB;MACE,OAAOpF,YAAY,CAACmD,qBAAqB,CAACiC,QAAQ,CAAC;IACvD;;IAEA;AACR;AACA;AACA;IACQA,QAAQ,GAAGhG,KAAK,CAACgG,QAAQ,CAAC;IAC1BE,kBAAkB,CACd,IAAI,CAAChD,UAAU,CAACC,MAAM,EACtB6C,QAAQ,EACRD,OAAO,EACP,IAAI,CACP;IACD,OAAOC,QAAQ;EACnB,CAAC;EAEDG,MAAM,oBAA2C;IAAA,IAAxBC,cAAc,uEAAG,KAAK;IAC3C,IAAI,CAACA,cAAc,EAAE;MACjB,IAAMrB,IAAI,GAAG3E,SAAS,CAAC,IAAI,CAACwC,KAAK,CAAC;MAClC,OAAQmC,IAAI,CAASzB,IAAI;MACzB,OAAQyB,IAAI,CAASsB,YAAY;MACjC,OAAQtB,IAAI,CAASrB,QAAQ;MAC7B,OAAQqB,IAAI,CAASuB,KAAK;MAC1B,OAAO1F,YAAY,CAACmD,qBAAqB,CAACgB,IAAI,CAAC;IACnD,CAAC,MAAM;MACH,OAAOnE,YAAY,CAACmD,qBAAqB,CAAC,IAAI,CAACnB,KAAK,CAAC;IACzD;EACJ,CAAC;EACD2D,aAAa,2BAA2C;IAAA,IAAxBH,cAAc,uEAAG,KAAK;IAClD,OAAOpG,KAAK,CAAC,IAAI,CAACmG,MAAM,CAACC,cAAc,CAAQ,CAAC;EACpD,CAAC;EAED;AACJ;AACA;AACA;AACA;EACIjE,MAAM,kBAACqE,UAA4B,EAAE;IACjC,MAAMrG,aAAa,CAAC,QAAQ,CAAC;EACjC,CAAC;EACDsG,UAAU,sBAACD,UAA6C,EAAE;IACtD,MAAMrG,aAAa,CAAC,MAAM,CAAC;EAC/B,CAAC;EACDuG,aAAa,2BAAG;IACZ,MAAMvG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACDwG,aAAa,2BAAG;IACZ,MAAMxG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACDyG,cAAc,4BAAG;IACb,MAAMzG,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EACD,IAAI0G,eAAe,GAAG;IAClB,MAAM1G,aAAa,CAAC,aAAa,CAAC;EACtC,CAAC;EAGD;AACJ;AACA;AACA;EACI2G,YAAY,wBAERC,gBAA0B;EAC1B;EACAC,QAAiB,EACE;IAAA;IACnB,OAAO,IAAIC,OAAO,CAAC,UAACzB,GAAG,EAAE0B,GAAG,EAAK;MAC7B,MAAI,CAACC,YAAY,GAAG,MAAI,CACnBA,YAAY,CACZhG,IAAI;QAAA,IAAa;UAAA;YAAA;YA2CdqE,GAAG,CAAC,MAAI,CAAC;UAAC;UAAA;UA1CV,IAAI4B,IAAI,GAAG,KAAK;UAChB;UACA;UAAA;YAAA,kBACO,CAACA,IAAI;UAAA,uBAAE;YAAA;cAAA;cAAA,+BAkBN;gBAAA,uBACM,MAAI,CAACC,SAAS,CAACC,OAAO,EAAEC,OAAO,CAAC;kBACtCH,IAAI,GAAG,IAAI;gBAAC;cAChB,CAAC,YAAQI,GAAQ,EAAE;gBACf,IAAMC,QAAQ,GAAGD,GAAG,CAACE,UAAU,IAAIF,GAAG,CAACE,UAAU,CAACC,KAAK,GAAGH,GAAG,CAACE,UAAU,CAACC,KAAK,GAAGH,GAAG;gBACpF;AAC5B;AACA;AACA;AACA;AACA;AACA;gBAC4B,IAAMI,UAAU,GAAGnH,wBAAwB,CAACgH,QAAQ,CAAQ;gBAAC,IACzDG,UAAU;kBAGVV,GAAG,CAACO,QAAQ,CAAC;kBAAC;gBAAA;cAGtB,CAAC;cAAA;YAAA;YApCD,IAAMF,OAAO,GAAG,MAAI,CAACxE,UAAU,CAACC,QAAQ,EAAE;YAC1C;YACA,IAAIsE,OAAO;YAAC,gCAER;cAAA,uBACgBP,gBAAgB,CAC5B/G,KAAK,CAACuH,OAAO,CAAC,EACd,MAAI,CACP;gBAHDD,OAAO,oBAGN;gBAAC,IACE,MAAI,CAACpE,UAAU;kBACfoE,OAAO,GAAG,MAAI,CAACpE,UAAU,CAACC,MAAM,CAAC0E,sBAAsB,CAACP,OAAO,CAAC;gBAAC;cAAA;YAEzE,CAAC,YAAQE,GAAG,EAAE;cACVN,GAAG,CAACM,GAAG,CAAC;cAAC;YAEb,CAAC;YAAA;UAsBL,CAAC;UAAA;QAEL,CAAC;UAAA;QAAA;MAAA,EAAC;IACV,CAAC,CAAC;EACN,CAAC;EAGD;AACJ;AACA;EACIM,WAAW,uBAEPC,KAA8B,EACK;IACnC,OAAO,IAAI,CAACjB,YAAY,CAAC,UAAChD,OAAuB,EAAK;MAClDkE,MAAM,CACDC,OAAO,CAACF,KAAK,CAAC,CACdG,OAAO,CAAC,gBAAY;QAAA,IAAVC,CAAC;UAAE3G,CAAC;QACVsC,OAAO,CAASqE,CAAC,CAAC,GAAG3G,CAAC;MAC3B,CAAC,CAAC;MACN,OAAOsC,OAAO;IAClB,CAAC,CAAC;EACN,CAAC;EAED;AACJ;AACA;AACA;EACUuD,SAAS,qBAEXC,OAA4C,EAC5CC,OAAuC;IAAA,IAC1B;MAAA,aAIT,IAAI;MAHRD,OAAO,GAAGlH,SAAS,CAACkH,OAAO,CAAC;;MAE5B;MACA,IAAI,OAAK1E,KAAK,CAACc,QAAQ,EAAE;QACrB,MAAMlD,UAAU,CAAC,OAAO,EAAE;UACtB4H,EAAE,EAAE,OAAKhF,OAAO;UAChBiF,QAAQ;QACZ,CAAC,CAAC;MACN;;MAEA;AACR;AACA;AACA;AACA;AACA;MACQf,OAAO,CAAChB,KAAK,GAAG0B,MAAM,CAACM,MAAM,CACzB,CAAC,CAAC,EACFf,OAAO,CAACjB,KAAK,EACbgB,OAAO,CAAChB,KAAK,CAChB;;MAED;MACA,IAAI1F,YAAY,CAAC2H,SAAS,EAAE,EAAE;QAC1B,OAAKrF,UAAU,CAACC,MAAM,CAACqF,cAAc,CAACjB,OAAO,EAAED,OAAO,CAAC;MAC3D;MAAC,uBAEK,OAAKpE,UAAU,CAACuF,SAAS,CAAC,KAAK,EAAE,MAAM,EAAEnB,OAAO,SAAO;QAAA,uBAEnC,OAAKpE,UAAU,CAACwF,eAAe,CAACC,SAAS,CAAC,CAAC;UACjEC,QAAQ,EAAErB,OAAO;UACjBc,QAAQ,EAAEf;QACd,CAAC,CAAC,EAAE,uBAAuB,CAAC,iBAHtBuB,WAAW;UAKjB,IAAMC,OAAO,GAAGD,WAAW,CAAClB,KAAK,CAAC,OAAKvE,OAAO,CAAC;UAC/CtC,0BAA0B,CAAC,OAAKoC,UAAU,EAAE,OAAKE,OAAO,EAAEkE,OAAO,EAAEwB,OAAO,CAAC;UAE3E,OAAO,OAAK5F,UAAU,CAACuF,SAAS,CAAC,MAAM,EAAE,MAAM,EAAEnB,OAAO,SAAO;QAAC;MAAA;IACpE,CAAC;MAAA;IAAA;EAAA;EAED;AACJ;AACA;AACA;AACA;EACIyB,MAAM,oBAAwC;IAAA;IAC1C,IAAM7F,UAAU,GAAG,IAAI,CAACA,UAAU;IAClC,IAAI,IAAI,CAACS,OAAO,EAAE;MACd,OAAOsD,OAAO,CAAC1E,MAAM,CAAC/B,UAAU,CAAC,OAAO,EAAE;QACtC6H,QAAQ,EAAE,IAAI;QACdD,EAAE,EAAE,IAAI,CAAChF;MACb,CAAC,CAAC,CAAC;IACP;IAEA,IAAM4F,WAAW,GAAG5I,SAAS,CAAC,IAAI,CAACwC,KAAK,CAAC;IACzC,OAAOM,UAAU,CAACuF,SAAS,CAAC,KAAK,EAAE,QAAQ,EAAEO,WAAW,EAAE,IAAI,CAAC,CAC1D7H,IAAI;MAAA,IAAa;QACd6H,WAAW,CAACtF,QAAQ,GAAG,IAAI;QAAC,uBAEFR,UAAU,CAACwF,eAAe,CAACC,SAAS,CAAC,CAAC;UAC5DC,QAAQ,EAAE,MAAI,CAAChG,KAAK;UACpByF,QAAQ,EAAEW;QACd,CAAC,CAAC,EAAE,oBAAoB,CAAC,iBAHnBH,WAAW;UAIjB,IAAMC,OAAO,GAAGD,WAAW,CAAClB,KAAK,CAAC,MAAI,CAACvE,OAAO,CAAC;UAC/CtC,0BAA0B,CAACoC,UAAU,EAAE,MAAI,CAACE,OAAO,EAAE4F,WAAW,EAAEF,OAAO,CAAC;UAC1E,OAAOvI,cAAc,CAACsI,WAAW,CAACI,OAAO,CAAC,MAAI,CAAC7F,OAAO,CAAC,CAAC;QAAC;MAC7D,CAAC;QAAA;MAAA;IAAA,EAAC,CACDjC,IAAI,CAAC,YAAM;MACR,OAAO,MAAI,CAAC+B,UAAU,CAACuF,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAEO,WAAW,EAAE,MAAI,CAAC;IACzE,CAAC,CAAC,CACD7H,IAAI,CAAC;MAAA,OAAM,MAAI;IAAA,EAAC;EACzB,CAAC;EACD+H,OAAO,qBAAG;IACN,MAAM1I,UAAU,CAAC,OAAO,CAAC;EAC7B;AACJ,CAAC;AAED,OAAO,SAAS2I,2BAA2B,GAAwB;EAAA,IAAvBC,KAAK,uEAAGzG,aAAa;EAC7D,IAAM0G,WAAW,GAAG,SAASC,qBAAqB,CAE9CpG,UAAwB,EACxBqG,QAAa,EACf;IACE,IAAI,CAACrG,UAAU,GAAGA,UAAU;;IAE5B;IACA,IAAI,CAACH,UAAU,GAAG,IAAIlD,eAAe,CAAC0J,QAAQ,CAAC;IAE/C,IAAI,CAACpC,YAAY,GAAG7G,oBAAoB;;IAExC;AACR;AACA;AACA;IACQ,IAAI,CAACuC,sBAAsB,GAAG,IAAI;EACtC,CAAC;EACDwG,WAAW,CAACzH,SAAS,GAAGwH,KAAK;EAC7B,OAAOC,WAAW;AACtB;AAEA,OAAO,SAASnD,kBAAkB,CAC9B/C,MAAW,EACX6C,QAAa,EAGf;EAAA,IAFED,OAAO,uEAAG,EAAE;EAAA,IACZyD,OAAO,uEAAG,KAAK;EAEf,IAAIxD,QAAQ,KAAK,IAAI,EAAE;EAGvB,IAAIyD,cAAc,GAAG5I,qBAAqB,CACtCsC,MAAM,CAAC2B,UAAU,EACjBiB,OAAO,CACV;EAED,IAAI,OAAO0D,cAAc,KAAK,WAAW,EAAE;EAC3C,IAAIA,cAAc,CAACC,UAAU,EAAED,cAAc,GAAGA,cAAc,CAACC,UAAU;EAEzE1B,MAAM,CAAC2B,IAAI,CAACF,cAAc,CAAC,CACtBvB,OAAO,CAAC,UAAA0B,GAAG,EAAI;IACZ,IAAMC,QAAQ,GAAG5J,QAAQ,CAAC8F,OAAO,GAAG,GAAG,GAAG6D,GAAG,CAAC;;IAE9C;IACA5D,QAAQ,CAAC8D,gBAAgB,CACrBF,GAAG,EACH,YAA4B;MACxB,IAAM5H,KAAiB,GAAGwH,OAAO,GAAGA,OAAO,GAAI,IAAY;MAC3D,IAAI,CAACxH,KAAK,CAACgD,GAAG,IAAI,OAAOhD,KAAK,CAACgD,GAAG,KAAK,UAAU,EAAE;QAC/C;AACxB;AACA;AACA;AACA;QACwB,OAAOlC,SAAS;MACpB;MACA,IAAMiH,GAAG,GAAG/H,KAAK,CAACgD,GAAG,CAAC6E,QAAQ,CAAC;MAC/B,OAAOE,GAAG;IACd,CAAC,CACJ;IACD;IACA/B,MAAM,CAACgC,cAAc,CAAChE,QAAQ,EAAE4D,GAAG,GAAG,GAAG,EAAE;MACvC5E,GAAG,EAAE,eAAY;QACb,IAAMhD,KAAK,GAAGwH,OAAO,GAAGA,OAAO,GAAG,IAAI;QACtC,OAAOxH,KAAK,CAACyC,IAAI,CAACoF,QAAQ,CAAC;MAC/B,CAAC;MACDI,UAAU,EAAE,KAAK;MACjBC,YAAY,EAAE;IAClB,CAAC,CAAC;IACF;IACAlC,MAAM,CAACgC,cAAc,CAAChE,QAAQ,EAAE4D,GAAG,GAAG,GAAG,EAAE;MACvC5E,GAAG,EAAE,eAAY;QACb,IAAMhD,KAAK,GAAGwH,OAAO,GAAGA,OAAO,GAAG,IAAI;QACtC,OAAOxH,KAAK,CAACiD,QAAQ,CAAC4E,QAAQ,CAAC;MACnC,CAAC;MACDI,UAAU,EAAE,KAAK;MACjBC,YAAY,EAAE;IAClB,CAAC,CAAC;IACF;IACAlE,QAAQ,CAACmE,gBAAgB,CAACP,GAAG,EAAE,UAE3BQ,GAAQ,EACV;MACE,IAAMpI,KAAU,GAAGwH,OAAO,GAAGA,OAAO,GAAG,IAAI;MAC3C,OAAOxH,KAAK,CAACqI,GAAG,CAACR,QAAQ,EAAEO,GAAG,CAAC;IACnC,CAAC,CAAC;EACN,CAAC,CAAC;AACV;AAEA,OAAO,SAASE,qBAAqB,CACjCjB,WAAgB,EAChBnG,UAAmC,EACnCqG,QAAmC,EACP;EAC5B,IAAMnG,OAAe,GAAGmG,QAAQ,CAACrG,UAAU,CAACC,MAAM,CAACF,WAAW,CAAQ;EACtE,IACIG,OAAO,IACPA,OAAO,CAACmH,UAAU,CAAC,SAAS,CAAC,EAC/B;IACE,OAAO,IAAI;EACf;EAEA,IAAMC,GAAG,GAAG,IAAInB,WAAW,CAACnG,UAAU,EAAEqG,QAAQ,CAAC;EACjD7I,cAAc,CAAC,kBAAkB,EAAE8J,GAAG,CAAC;EACvC,OAAOA,GAAG;AACd;AAEA,OAAO,SAASC,YAAY,CAACC,GAAQ,EAAW;EAC5C,IAAI,OAAOA,GAAG,KAAK,WAAW,EAAE,OAAO,KAAK;EAC5C,OAAO,CAAC,CAACA,GAAG,CAAC7H,sBAAsB;AACvC"}